import{_ as e}from"./V-Card.vue_vue&type=script&setup=true&lang.b57414a9.js";import{_ as t}from"./V-Loader.vue_vue&type=script&setup=true&lang.a67ef8b7.js";import{_ as a}from"./V-Button.vue_vue&type=script&setup=true&lang.115c9f56.js";import{s,_ as l}from"./MemberCards.ab62d3bd.js";import{_ as n}from"./V-Modal.vue_vue&type=script&setup=true&lang.f91cc122.js";import{d as i,r as u,i as r,j as c,k as o,I as d,l as p,S as v,H as m,L as f,G as y,b as _,W as b,X as g,F as h,U as x,_ as k,u as C,A as j,w as S}from"./vendor.84e48f7c.js";import{n as N,m as w,A as O}from"./index.20ca533a.js";import{_ as J}from"./V-Control.b8a16a92.js";import{_ as z}from"./V-Field.vue_vue&type=script&setup=true&lang.5a5e683f.js";import{c as P}from"./Companies.f4a22d58.js";const V={class:"d-flex justify-content-between align-items-start"},B=p("p",{class:"title is-3"},[p("i",{class:"fas fa-credit-card","aria-hidden":"true"})],-1),T={class:"title is-5"},$={key:0,class:"title is-6"},q=p("p",null,[p("b",null,"Cards")],-1),I={key:0,class:"pb-3 mb-5"},F=y(" Sync Cards "),A=y("Confirm");var L=i({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0},card:{type:Boolean,default:!1},textCard:{type:String,default:"Debit Automatic"},newUser:{type:Boolean,dafutl:!1},outline:{type:Boolean,dafutl:!1}},emits:["onPayment"],setup(i,{emit:y}){const _=i,b=u(!1),g=()=>{null!=C.value?(b.value=!1,y("onPayment",{amount:_.total,payment_type_id:3,payment_method_id:C.value})):N.error("Select card")},h=u(!1),x=u(!0),k=()=>{s(_.user.id).then((e=>{x.value=!1,setTimeout((()=>{x.value=!0}),100)}))},C=u(null);return(s,u)=>{const y=e,j=t,S=a,N=l,w=n;return r(),c(v,null,[_.card?(r(),c(j,{key:1,class:"h-100",size:"small",active:s.isLoaderActive},{default:o((()=>[p(y,{color:"success",outlined:"",onClick:u[2]||(u[2]=e=>b.value=!0),class:"\r\n        mr-4\r\n        btn-card\r\n        text-center\r\n        px-2\r\n        h-100\r\n        d-flex\r\n        align-items-center\r\n        justify-content-center\r\n      ",style:{"font-size":"14px"}},{default:o((()=>[q,f(s.$slots,"default")])),_:3})])),_:1},8,["active"])):(r(),c(y,{key:0,onClick:u[1]||(u[1]=e=>b.value=!0),color:"success",class:"mx-2 btn-card w-100 justify-content-center h-100",outlined:_.outline},{default:o((()=>[p("div",V,[p("div",null,[B,p("p",T,m(_.textCard),1)]),(r(),c("p",$,[f(s.$slots,"righttop"),d(' <i class="fas fa-check" aria-hidden="true"></i> ')]))])])),_:3},8,["outlined"])),d("  "),p(w,{title:"",size:"big",open:b.value,actions:"center",onClose:u[4]||(u[4]=e=>b.value=!1)},{content:o((()=>[i.newUser?d("v-if",!0):(r(),c("div",I,[p(j,{size:"large",active:h.value},{default:o((()=>[p(S,{color:"undefined",onClick:k,class:"d-flex justify-content-center",raised:""},{default:o((()=>[F])),_:1})])),_:1},8,["active"])])),_.user&&b.value&&x.value?(r(),c(N,{key:1,"show-option":!0,class:"mb-6",modelValue:C.value,"onUpdate:modelValue":u[3]||(u[3]=e=>C.value=e),method_default:_.user.pm_last_four,"show-new-card":!0,user:_.user,"on-new-card-u-r-l":"v2/stripe/setup","add-card-stripe-u-r-l":"v2/stripe/addCard",v2:!0,actions:[]},null,8,["modelValue","method_default","user"])):d("v-if",!0)])),action:o((()=>[p(S,{color:"success",onClick:g,disabled:!C.value,class:"d-flex justify-content-center",raised:""},{default:o((()=>[A])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const D={class:"d-flex justify-content-between align-items-start"},U=p("div",null,[p("p",{class:"title is-3"},[p("i",{class:"fas fa-money-bill-wave","aria-hidden":"true"})]),p("p",{class:"title is-5"},"Cash")],-1),M={class:"title is-6"},R={class:"d-flex mb-4 justify-content-between"},G={class:"title is-5"},H=y(" Total: "),W={class:"title is-5"},X=y(" Cash Total: "),E={class:"\r\n            d-flex\r\n            justify-content-center\r\n            align-items-center\r\n            flex-column\r\n            mb-4\r\n          "},K=p("p",{class:"title is-5 mb-4"},"Change Back:",-1),Q={class:"title is-3 mb-0"},Y={class:"d-flex justify-content-center flex-wrap mb-4"},Z=p("div",{class:"w-100"},null,-1),ee={class:"d-flex justify-content-center"},te=y("Reset"),ae=y("Confirm");var se=i({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0}},emits:["onPayment"],setup(t,{emit:s}){const l=t,i=u(!1),C=u(0),j=_((()=>{const e=parseFloat(C.value)-parseFloat(l.total);return e>0?e:0})),S=()=>{i.value=!1,s("onPayment",{cash:C.value,changeBack:j.value,amount:l.total,payment_type_id:1})},N=()=>{i.value=!0};return(s,u)=>{const _=e,O=a,P=J,V=z,B=n;return r(),c(v,null,[p(_,{onClick:N,color:l.define_status?"warning":void 0,class:"btn-card w-100 justify-content-center"},{default:o((()=>[p("div",D,[U,p("p",M,[f(s.$slots,"righttop"),d(' <i class="fas fa-check" aria-hidden="true"></i> ')])])])),_:3},8,["color"]),p(B,{title:"",open:i.value,actions:"center",onClose:u[4]||(u[4]=e=>i.value=!1)},{content:o((()=>[b(p("div",null,[f(s.$slots,"modalprev")],512),[[g,!l.define_status]]),b(p("div",null,[p("div",R,[p("p",G,[H,p("b",null,m(h(w)(t.total)),1)]),p("p",W,[X,p("b",null,m(h(w)(C.value)),1)])]),p("div",E,[K,p("p",Q,[p("b",null,m(h(w)(h(j))),1)])]),p("div",Y,[p(O,{bold:"",class:"m-3",style:{"font-size":"14px"},onClick:u[1]||(u[1]=e=>C.value=t.total)},{default:o((()=>[y(" Full Payment "+m(h(w)(t.total)),1)])),_:1}),Z,(r(),c(v,null,x([5,10,20,50,100],((e,t)=>p(O,{key:`calculato-${t}`,bold:"",class:"m-3",style:{"font-size":"14px"},onClick:t=>(e=>{C.value=parseFloat(C.value)+parseFloat(e)})(e)},{default:o((()=>[y(" $"+m(e),1)])),_:2},1032,["onClick"]))),64))]),p("div",ee,[p(V,null,{default:o((()=>[p(P,null,{default:o((()=>[b(p("input",{"onUpdate:modelValue":u[2]||(u[2]=e=>C.value=e),type:"text",class:"input text-center",placeholder:"Cash"},null,512),[[k,C.value]])])),_:1})])),_:1})])],512),[[g,l.define_status]])])),action:o((()=>[p(O,{onClick:u[3]||(u[3]=e=>C.value=0),class:"d-flex justify-content-center",raised:""},{default:o((()=>[te])),_:1}),p(O,{color:"success",onClick:S,disabled:t.total>C.value,class:"d-flex justify-content-center",raised:""},{default:o((()=>[ae])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const le=u([{typeInput:"text",name:"description",placeholder:"Description",model:"",class:"is-12",isLabel:!0,required:!0},{typeInput:"text",name:"amount",placeholder:"Amount",model:"",class:"is-12",isLabel:!0,required:!0}]),ne={failure_code:null,failure_message:null,process_payment_intent:{payment_intent:""},status:"",type:""},ie={amount:0,id:"",created:"",status:""},ue=u(JSON.parse(JSON.stringify(ne))),re=u(JSON.parse(JSON.stringify(ie))),ce=async(e={})=>await O.post("make-manual-payment",e),oe=async e=>{const t=await O.post("v2/stripe/stopTerminal",e);return ue.value=JSON.parse(JSON.stringify(ne)),re.value=JSON.parse(JSON.stringify(ie)),t},de={class:"d-flex justify-content-between align-items-start"},pe=p("div",null,[p("p",{class:"title is-3"},[p("i",{class:"fas fa-mobile","aria-hidden":"true"})]),p("p",{class:"title is-5"},"Terminal")],-1),ve={class:"title is-6"},me={key:0},fe={key:0,class:"mt-4 mx-2"},ye={class:"column is-8"},_e=p("p",{class:"title is-1"},[p("i",{class:"lnir lnir-postcard","aria-hidden":"true"})],-1),be={class:"title is-5 mb-0"},ge={style:{"font-size":"10px"},class:"is-7 mb-0"},he={style:{"font-size":"10px"},class:"is-7 mb-0"},xe={style:{"font-size":"10px"},class:"is-7 mb-0"},ke={style:{"font-size":"10px"},class:"is-7 mb-0"},Ce={style:{"font-size":"10px"},class:"is-7 mb-0"},je={key:0},Se=p("p",{class:"title is-7 text-capitalize m-0"},"retry",-1),Ne=p("p",{class:"title is-6"},[p("i",{class:"lnil lnil-reload"})],-1),we={class:"column is-4"},Oe=p("div",null,[p("p",{class:"title is-6 mb-0"},"Terminal status")],-1),Je=p("p",{class:"title is-5"},[p("i",{class:"lnil lnil-reload"})],-1),ze=p("div",null,[p("p",{class:"title is-6 mb-0"},"Cancel payment")],-1),Pe=p("p",{class:"title is-5"},[p("i",{class:"lnil lnil-trash-can"})],-1),Ve={key:0,class:"column is-12"},Be=p("div",null,[p("p",{class:"title is-6 mb-0"},"Clean and Close")],-1),Te={key:0},$e=p("p",{class:"title is-5"},[p("i",{class:"lnil lnil-checkmark-circle"})],-1);var qe=i({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0}},emits:["onPayment"],setup(a,{emit:s}){const l=a,{cookies:i}=C(),y=u(!1),k=u([]),J=()=>{y.value=!0;let e=P.value.locations;if(e.length&&i.get("locations_id")){let t=e.find((e=>e.id==i.get("locations_id")));if(null!=t){let e=t.terminales;e.length&&(k.value=e)}}0==k.value&&N.error("No terminals found at this location")},z=j(JSON.parse(JSON.stringify({id:null,label:"",status:!1,amount:0}))),V=u(!1);S((()=>y.value),(e=>{z.id=null,z.label="",z.status=!1,z.amount=0,V.value=!1,F.value=!1,B.value=!1,M.value=0,ue.value=JSON.parse(JSON.stringify(ne)),re.value=JSON.parse(JSON.stringify(ie))}));const B=u(!1),T=u(10);S((()=>ue.value.status),(e=>{B.value&&("succeeded"==e?(N.success("Payment Success"),y.value=!1,M.value<=T.value&&I()):"failed"==e?N.error(ue.value.failure_message):"in_progress"==e&&N.success("Payment in progress")),B.value||"succeeded"==e&&R()}));const $=_((()=>{let e={status:"",message:"",color:""};return e.status=ue.value.status,"succeeded"==e.status&&(e.color="success"),"failed"==e.status&&(e.color="danger"),"in_progress"==e.status&&(e.color="info"),e})),q=()=>{"in_progress"!=ue.value.status?"succeeded"!=ue.value.status?null!=z.id?(U(),V.value=!0,(async e=>{const t=await O.post("v2/stripe/paymentIntentTerminal",e);return null==t.data.terminal?ue.value=JSON.parse(JSON.stringify(ne)):ue.value=t.data.terminal,null==t.data.payment_intent?re.value=JSON.parse(JSON.stringify(ie)):re.value=t.data.payment_intent,t})(z).then((e=>{V.value=!1,N.success(e.data.message)})).catch((e=>{V.value=!1}))):console.log("alert. no selecciono el terminal de pago"):N.error("Payment processed"):N.error("Terminal busy")},I=()=>{s("onPayment",{amount:l.total,payment_type_id:5})},F=u(!1),A=e=>{"succeeded"!=ue.value.status&&(F.value=!0,(async e=>{const t=await O.post("v2/stripe/consultaTerminal",e);return null==t.data.terminal?ue.value=JSON.parse(JSON.stringify(ne)):ue.value=t.data.terminal,null==t.data.payment_intent?re.value=JSON.parse(JSON.stringify(ie)):re.value=t.data.payment_intent,t})({id:e.id}).then((()=>{F.value=!1})).catch((()=>{F.value=!1})))},L=_((()=>null!=z.id)),D=()=>{L.value||(y.value=!1)},U=()=>{new Pusher("2cd5b586808b2f41f8e6",{cluster:"us2"}).subscribe("terminal_channel").bind("terminal_event",(function(e){B.value=!0,null==e.terminal?ue.value=JSON.parse(JSON.stringify(ne)):ue.value=e.terminal,null==e.payment_intent?re.value=JSON.parse(JSON.stringify(ie)):re.value=e.payment_intent}))},M=u(0),R=()=>{M.value=0;let e=setInterval((()=>{M.value++,M.value==T.value&&clearInterval(e)}),1e3)};return(a,i)=>{const u=e,_=t,C=n;return r(),c(v,null,[p(u,{onClick:J,color:l.define_status?"info":void 0,class:"btn-card w-100 justify-content-center"},{default:o((()=>[p("div",de,[pe,p("p",ve,[f(a.$slots,"righttop"),d(' <i class="fas fa-check" aria-hidden="true"></i> ')])])])),_:3},8,["color"]),p(C,{title:"",open:y.value,actions:"center",size:"big",noclose:"",onClose:D},{content:o((()=>[b(p("div",null,[f(a.$slots,"modalprev")],512),[[g,!l.define_status]]),0==k.value.length?(r(),c("p",me,"'No terminals found at this location'")):d("v-if",!0),b(p("div",null,[k.value.length?(r(),c("div",fe,[p(_,{size:"small",active:V.value},{default:o((()=>[(r(!0),c(v,null,x(k.value,((e,t)=>(r(),c(u,{key:`terminal-${t}`,class:"columns is-multiline mb-4"},{default:o((()=>[d(" <p>{{ terminal }}</p> "),p("div",ye,[p(u,{class:"p-4 btn-card d-flex justify-content-between",color:h(z).id==e.id?h($).color:void 0,onClick:t=>(e=>{z.id=e.id,z.label=e.label,z.status=e.status,z.amount=l.total,q()})(e)},{default:o((()=>[p("div",null,[_e,p("p",be,m(e.label),1),p("p",null,"Status: "+m(e.status),1)]),p("div",null,[p("p",ge," ID: "+m(h(re).id),1),p("p",he," Amount: "+m(h(w)(h(re).amount/100)),1),p("p",xe," Date: "+m(h(re).created),1),p("p",ke," PI. Status: "+m(h(re).status),1),p("p",Ce," Status: "+m(h(ue).status),1),"failed"==h(ue).status?(r(),c("div",je,[p(u,{class:"\r\n                          d-flex\r\n                          justify-content-between\r\n                          mt-4\r\n                          p-2\r\n                          align-items-center\r\n                        "},{default:o((()=>[Se,Ne])),_:1})])):d("v-if",!0)])])),_:2},1032,["color","onClick"])]),p("div",we,[p(_,{size:"small",active:F.value},{default:o((()=>[p(u,{color:"warning",outlined:"",onClick:t=>A(e),class:"d-flex justify-content-between mb-4"},{default:o((()=>[Oe,Je])),_:2},1032,["onClick"])])),_:2},1032,["active"]),p(_,{size:"small",active:F.value},{default:o((()=>[p(u,{color:"danger",outlined:"",onClick:t=>(e=>{"succeeded"!=ue.value.status&&(F.value=!0,oe({id:e.id,payment_type_id:re.value.id}).then((()=>{y.value=!1,F.value=!1})).catch((()=>{F.value=!1})))})(e),class:"d-flex justify-content-between"},{default:o((()=>[ze,Pe])),_:2},1032,["onClick"])])),_:2},1032,["active"])]),"succeeded"==h(ue).status?(r(),c("div",Ve,[p(_,{size:"small",active:F.value},{default:o((()=>[p(u,{color:M.value==T.value?"success":void 0,outlined:"",onClick:t=>(e=>{M.value==T.value&&(oe({id:e.id,payment_type_id:null}),y.value=!1,F.value=!1,s("onPayment",{amount:l.total,payment_type_id:5}))})(e),class:"d-flex justify-content-between"},{default:o((()=>[Be,M.value<T.value?(r(),c("p",Te,"Loading ... "+m(M.value),1)):d("v-if",!0),$e])),_:2},1032,["color","onClick"])])),_:2},1032,["active"])])):d("v-if",!0),d("")])),_:2},1024)))),128))])),_:1},8,["active"])])):d("v-if",!0)],512),[[g,l.define_status]])])),action:o((()=>[d(' <VButton @click="cash = 0" class="d-flex justify-content-center" raised\r\n        >Reset</VButton\r\n      >\r\n      <VButton\r\n        color="success"\r\n        @click="payment"\r\n        :disabled="total > cash"\r\n        class="d-flex justify-content-center"\r\n        raised\r\n        >Confirm</VButton\r\n      > ')])),_:1},8,["open"])],64)}}});const Ie={class:"d-flex justify-content-between align-items-start"},Fe=p("div",null,[p("p",{class:"title is-3"},[p("i",{class:"fas fa-credit-card","aria-hidden":"true"})]),p("p",{class:"title is-5"},"Debit Card")],-1),Ae={key:0,class:"title is-6"};var Le=i({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0}},emits:["onPayment"],setup(t,{emit:a}){const s=t,l=u(!1),n=()=>{l.value=!1,a("onPayment",{amount:s.total,payment_type_id:3})};return(t,a)=>{const s=e;return r(),c(s,{onClick:n,color:"success",class:"mx-2 btn-card w-100 justify-content-center",outlined:""},{default:o((()=>[p("div",Ie,[Fe,(r(),c("p",Ae,[d(' <i class="fas fa-check" aria-hidden="true"></i> ')]))])])),_:1})}}});export{L as _,se as a,qe as b,Le as c,ce as d,le as m};
