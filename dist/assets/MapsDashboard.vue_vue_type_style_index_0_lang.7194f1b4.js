import{_ as gp}from"./V-Avatar.vue_vue_type_script_setup_true_lang.b4183814.js";import{_ as yp}from"./V-Block.vue_vue_type_script_setup_true_lang.00657afe.js";import{d as xp,o as Ca,e as Ma,f as si,w as vp,t as ph,v as Io,at as ec,r as Ms,j as Mf,V as zf,m as kf,y as Pf,z as Df,F as Lf,G as Rf,a1 as Bf}from"./index.4457215e.js";import{t as tc}from"./themeColors.4f0e93f3.js";import{i as Ia}from"./darkModeState.1f6503fc.js";const Ff={class:"map-box-location"},Of={class:"map-box-header"},Uf={class:"map-box-body"};var Vf=xp({expose:[],props:{logo:{type:String},name:{type:String},openingCount:{type:String},description:{type:String}},setup(qn){const pn=qn;return(Oe,Ne)=>{const ot=gp,de=yp;return Ca(),Ma("div",Ff,[si("div",Of,[si(de,{title:pn.name,subtitle:`Open until ${pn.openingCount}`,center:""},{icon:vp(()=>[si(ot,{size:"small",picture:pn.logo},null,8,["picture"])]),_:1},8,["title","subtitle"])]),si("div",Uf,[si("p",null,ph(pn.description),1)])])}}}),bp={exports:{}};(function(qn,pn){(function(Oe,Ne){qn.exports=Ne()})(Io,function(){var Oe,Ne,ot;function de(s,J){if(!Oe)Oe=J;else if(!Ne)Ne=J;else{var ee="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+Oe+")(sharedChunk); ("+Ne+")(sharedChunk); self.onerror = null;",me={};Oe(me),ot=J(me),typeof window!="undefined"&&(ot.workerUrl=window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"})))}}de(["exports"],function(s){var J="2.3.0",ee=me;function me(i,e,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=r,this.p2y=n}me.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},me.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},me.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},me.prototype.solveCurveX=function(i,e){var r,n,a,h,u;for(e===void 0&&(e=1e-6),a=i,u=0;u<8;u++){if(h=this.sampleCurveX(a)-i,Math.abs(h)<e)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=h/f}if((a=i)<(r=0))return r;if(a>(n=1))return n;for(;r<n;){if(h=this.sampleCurveX(a),Math.abs(h-i)<e)return a;i>h?r=a:n=a,a=.5*(n-r)+r}return a},me.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var X=O;function O(i,e){this.x=i,this.y=e}O.prototype={clone:function(){return new O(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(i,e){var r=Math.cos(i),n=Math.sin(i),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},O.convert=function(i){return i instanceof O?i:Array.isArray(i)?new O(i[0],i[1]):i};var ie=typeof self!="undefined"?self:{};const _e=Math.pow(2,53)-1,De=Math.PI/180,Fe=180/Math.PI;function G(i){return i*De}const Q=[[0,0],[1,0],[1,1],[0,1]];function ye(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function xe(i,e,r,n){const a=new ee(i,e,r,n);return function(h){return a.solve(h)}}const be=xe(.25,.1,.25,1);function Be(i,e,r){return Math.min(r,Math.max(e,i))}function lt(i,e,r){const n=r-e,a=((i-e)%n+n)%n+e;return a===e?r:a}function Qe(i,e,r){if(!i.length)return r(null,[]);let n=i.length;const a=new Array(i.length);let h=null;i.forEach((u,f)=>{e(u,(m,g)=>{m&&(h=m),a[f]=g,--n==0&&r(h,a)})})}function it(i){const e=[];for(const r in i)e.push(i[r]);return e}function Tt(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}let ut=1;function Ot(){return ut++}function Ee(){return function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function qe(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function $e(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Je(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function et(i,e){return i.indexOf(e,i.length-e.length)!==-1}function st(i,e,r){const n={};for(const a in i)n[a]=e.call(r||this,i[a],a,i);return n}function at(i,e,r){const n={};for(const a in i)e.call(r||this,i[a],a,i)&&(n[a]=i[a]);return n}function pt(i){return Array.isArray(i)?i.map(pt):typeof i=="object"&&i?st(i,pt):i}const yi={};function zt(i){yi[i]||(typeof console!="undefined"&&console.warn(i),yi[i]=!0)}function hi(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ji(i){let e=0;for(let r,n,a=0,h=i.length,u=h-1;a<h;u=a++)r=i[a],n=i[u],e+=(n.x-r.x)*(r.y+n.y);return e}function zi(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ai(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,a,h)=>{const u=a||h;return e[n]=!u||u.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ai,ft,Oi,Sr=null;function Qi(i){if(Sr==null){const e=i.navigator?i.navigator.userAgent:null;Sr=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Sr}function mr(i){try{const e=ie[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const kt={now:()=>Oi!==void 0?Oi:ie.performance.now(),setNow(i){Oi=i},restoreNow(){Oi=void 0},frame(i){const e=ie.requestAnimationFrame(i);return{cancel:()=>ie.cancelAnimationFrame(e)}},getImageData(i,e=0){const r=ie.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,n.drawImage(i,0,0,i.width,i.height),n.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(ai||(ai=ie.document.createElement("a")),ai.href=i,ai.href),get devicePixelRatio(){return ie.devicePixelRatio},get prefersReducedMotion(){return!!ie.matchMedia&&(ft==null&&(ft=ie.matchMedia("(prefers-reduced-motion: reduce)")),ft.matches)}};let ui;const bt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ui==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ui={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{ui=i}}return ui},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ki={supported:!1,testSupport:function(i){!qr&&_r&&(Ao?Ar(i):Ir=i)}};let Ir,_r,qr=!1,Ao=!1;function Ar(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,_r),i.isContextLost())return;ki.supported=!0}catch{}i.deleteTexture(e),qr=!0}ie.document&&(_r=ie.document.createElement("img"),_r.onload=function(){Ir&&Ar(Ir),Ir=null,Ao=!0},_r.onerror=function(){qr=!0,Ir=null},_r.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const dn="01",$r="NO_ACCESS_TOKEN";function er(i){return i.indexOf("mapbox:")===0}function Cr(i){return bt.API_URL_REGEX.test(i)}const $n=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ui(i){const e=i.match($n);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Mr(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Vi(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(ie.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class jn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Vi(bt.ACCESS_TOKEN);let n="";return n=r&&r.u?ie.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(a,h)=>String.fromCharCode(Number("0x"+h)))):bt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=mr("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=ie.localStorage.getItem(r);a&&(this.eventData=JSON.parse(a));const h=ie.localStorage.getItem(n);h&&(this.anonId=h)}catch{zt("Unable to read from LocalStorage")}}saveEventData(){const e=mr("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{ie.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&ie.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{zt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,a){if(!bt.EVENTS_URL)return;const h=Ui(bt.EVENTS_URL);h.params.push(`access_token=${a||bt.ACCESS_TOKEN||""}`);const u={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:J,skuId:dn,userId:this.anonId},f=r?Tt(u,r):u,m={url:Mr(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};this.pendingRequest=C(m,g=>{this.pendingRequest=null,n(g),this.saveEventData(),this.processRequests(a)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Zn=new class extends jn{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){bt.EVENTS_URL&&bt.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>er(r)||Cr(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Vi(bt.ACCESS_TOKEN),r=e?e.u:bt.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;$e(this.anonId)||(this.anonId=Ee(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),u=new Date(a),f=(a-this.eventData.lastSuccess)/864e5;n=n||f>=1||f<-1||h.getDate()!==u.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},h=>{h||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},i)}},Co=Zn.postTurnstileEvent.bind(Zn),fn=new class extends jn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,n){this.skuToken=e,this.errorCb=n,bt.EVENTS_URL&&(r||bt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error($r)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),$e(this.anonId)||(this.anonId=Ee()),this.postEvent(r,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i))}},Xn=fn.postMapLoadEvent.bind(fn),Mo=new class extends jn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,n){if(!bt.API_URL||!bt.SESSION_PATH)return;const a=Ui(bt.API_URL+bt.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||bt.ACCESS_TOKEN||""}`);const h={url:Mr(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=B(h,u=>{this.pendingRequest=null,r(u),this.saveEventData(),this.processRequests(n)})}getSessionAPI(i,e,r,n){this.skuToken=e,this.errorCb=n,bt.SESSION_PATH&&bt.API_URL&&(r||bt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error($r)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i)}},zs=Mo.getSessionAPI.bind(Mo),jr=new Set,mn="mapbox-tiles";let Ni,zr,zo=500,Wn=50;function kr(){ie.caches&&!Ni&&(Ni=ie.caches.open(mn))}function Zr(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let Xr=1/0;const Wr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Wr);class _n extends Error{constructor(e,r,n){r===401&&Cr(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const cr=zi()?()=>self.worker&&self.worker.referrer:()=>(ie.location.protocol==="blob:"?ie.parent:ie).location.href,R=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(cr())&&!/^\w+:/.test(r))){if(ie.fetch&&ie.Request&&ie.AbortController&&ie.Request.prototype.hasOwnProperty("signal"))return function(n,a){const h=new ie.AbortController,u=new ie.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:cr(),signal:h.signal});let f=!1,m=!1;const g=(x=u.url).indexOf("sku=")>0&&Cr(x);var x;n.type==="json"&&u.headers.set("Accept","application/json");const b=(I,M,L)=>{if(m)return;if(I&&I.message!=="SecurityError"&&zt(I),M&&L)return T(M);const q=Date.now();ie.fetch(u).then(K=>{if(K.ok){const ne=g?K.clone():null;return T(K,ne,q)}return a(new _n(K.statusText,K.status,n.url))}).catch(K=>{K.code!==20&&a(new Error(K.message))})},T=(I,M,L)=>{(n.type==="arrayBuffer"?I.arrayBuffer():n.type==="json"?I.json():I.text()).then(q=>{m||(M&&L&&function(K,ne,ce){if(kr(),!Ni)return;const ue={status:ne.status,statusText:ne.statusText,headers:new ie.Headers};ne.headers.forEach((pe,Le)=>ue.headers.set(Le,pe));const he=Ai(ne.headers.get("Cache-Control")||"");he["no-store"]||(he["max-age"]&&ue.headers.set("Expires",new Date(ce+1e3*he["max-age"]).toUTCString()),new Date(ue.headers.get("Expires")).getTime()-ce<42e4||function(pe,Le){if(zr===void 0)try{new Response(new ReadableStream),zr=!0}catch{zr=!1}zr?Le(pe.body):pe.blob().then(Le)}(ne,pe=>{const Le=new ie.Response(pe,ue);kr(),Ni&&Ni.then(Ae=>Ae.put(Zr(K.url),Le)).catch(Ae=>zt(Ae.message))}))}(u,M,L),f=!0,a(null,q,I.headers.get("Cache-Control"),I.headers.get("Expires")))}).catch(q=>{m||a(new Error(q.message))})};return g?function(I,M){if(kr(),!Ni)return M(null);const L=Zr(I.url);Ni.then(q=>{q.match(L).then(K=>{const ne=function(ce){if(!ce)return!1;const ue=new Date(ce.headers.get("Expires")||0),he=Ai(ce.headers.get("Cache-Control")||"");return ue>Date.now()&&!he["no-cache"]}(K);q.delete(L),ne&&q.put(L,K.clone()),M(null,K,ne)}).catch(M)}).catch(M)}(u,b):b(null,null),{cancel:()=>{m=!0,f||h.abort()}}}(i,e);if(zi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(n,a){const h=new ie.XMLHttpRequest;h.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const u in n.headers)h.setRequestHeader(u,n.headers[u]);return n.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=n.credentials==="include",h.onerror=()=>{a(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let u=h.response;if(n.type==="json")try{u=JSON.parse(h.response)}catch(f){return a(f)}a(null,u,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else a(new _n(h.statusText,h.status,n.url))},h.send(n.body),{cancel:()=>h.abort()}}(i,e)},S=function(i,e){return R(Tt(i,{type:"arrayBuffer"}),e)},C=function(i,e){return R(Tt(i,{method:"POST"}),e)},B=function(i,e){return R(Tt(i,{method:"GET"}),e)};function V(i){const e=ie.document.createElement("a");return e.href=i,e.protocol===ie.document.location.protocol&&e.host===ie.document.location.host}const W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let se,ae;se=[],ae=0;const te=function(i,e){if(ki.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),ae>=bt.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return se.push(h),h}ae++;let r=!1;const n=()=>{if(!r)for(r=!0,ae--;se.length&&ae<bt.MAX_PARALLEL_IMAGE_REQUESTS;){const h=se.shift(),{requestParameters:u,callback:f,cancelled:m}=h;m||(h.cancel=te(u,f).cancel)}},a=S(i,(h,u,f,m)=>{n(),h?e(h):u&&(ie.createImageBitmap?function(g,x){const b=new ie.Blob([new Uint8Array(g)],{type:"image/png"});ie.createImageBitmap(b).then(T=>{x(null,T)}).catch(T=>{x(new Error(`Could not load image because of ${T.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(u,(g,x)=>e(g,x,f,m)):function(g,x){const b=new ie.Image,T=ie.URL;b.onload=()=>{x(null,b),T.revokeObjectURL(b.src),b.onload=null,ie.requestAnimationFrame(()=>{b.src=W})},b.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new ie.Blob([new Uint8Array(g)],{type:"image/png"});b.src=g.byteLength?T.createObjectURL(I):W}(u,(g,x)=>e(g,x,f,m)))});return{cancel:()=>{a.cancel(),n()}}};function le(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function we(i,e,r){if(r&&r[i]){const n=r[i].indexOf(e);n!==-1&&r[i].splice(n,1)}}class Ve{constructor(e,r={}){Tt(this,r),this.type=e}}class Ce extends Ve{constructor(e,r={}){super("error",Tt({error:e},r))}}class Ke{on(e,r){return this._listeners=this._listeners||{},le(e,r,this._listeners),this}off(e,r){return we(e,r,this._listeners),we(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},le(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new Ve(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const f of a)f.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const f of h)we(n,f,this._oneTimeListeners),f.call(this,e);const u=this._eventedParent;u&&(Tt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof Ce&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Y={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class ge{constructor(e,r,n,a){this.message=(e?`${e}: `:"")+n,a&&(this.identifier=a),r!=null&&r.__line__&&(this.line=r.__line__)}}function rt(i){const e=i.value;return e?[new ge(i.key,e,"constants have been deprecated as of v8")]:[]}function mt(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}function ht(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function At(i){if(Array.isArray(i))return i.map(At);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=At(i[r]);return e}return ht(i)}class wt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Nt{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,a]of r)this.bindings[n]=a}concat(e){return new Nt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gr={kind:"null"},je={kind:"number"},dt={kind:"string"},_t={kind:"boolean"},ri={kind:"color"},Hr={kind:"object"},gt={kind:"value"},ko={kind:"collator"},gn={kind:"formatted"},yn={kind:"resolvedImage"};function Pi(i,e){return{kind:"array",itemType:i,N:e}}function Wt(i){if(i.kind==="array"){const e=Wt(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Po=[gr,je,dt,_t,ri,gn,Hr,Pi(gt),yn];function Hn(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Hn(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of Po)if(!Hn(r,e))return null}}return`Expected ${Wt(i)} but found ${Wt(e)} instead.`}function yr(i,e){return e.some(r=>r.kind===i.kind)}function xn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Gi(i){var e={exports:{}};return i(e,e.exports),e.exports}var za=Gi(function(i,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(f){return(f=Math.round(f))<0?0:f>255?255:f}function a(f){return n(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function h(f){return(m=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:m>1?1:m;var m}function u(f,m,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?f+(m-f)*g*6:2*g<1?m:3*g<2?f+(m-f)*(2/3-g)*6:f}try{e.parseCSSColor=function(f){var m,g=f.replace(/ /g,"").toLowerCase();if(g in r)return r[g].slice();if(g[0]==="#")return g.length===4?(m=parseInt(g.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:g.length===7&&(m=parseInt(g.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var x=g.indexOf("("),b=g.indexOf(")");if(x!==-1&&b+1===g.length){var T=g.substr(0,x),I=g.substr(x+1,b-(x+1)).split(","),M=1;switch(T){case"rgba":if(I.length!==4)return null;M=h(I.pop());case"rgb":return I.length!==3?null:[a(I[0]),a(I[1]),a(I[2]),M];case"hsla":if(I.length!==4)return null;M=h(I.pop());case"hsl":if(I.length!==3)return null;var L=(parseFloat(I[0])%360+360)%360/360,q=h(I[1]),K=h(I[2]),ne=K<=.5?K*(q+1):K+q-K*q,ce=2*K-ne;return[n(255*u(ce,ne,L+1/3)),n(255*u(ce,ne,L)),n(255*u(ce,ne,L-1/3)),M];default:return null}}return null}}catch{}});class It{constructor(e,r,n,a=1){this.r=e,this.g=r,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof It)return e;if(typeof e!="string")return;const r=za.parseCSSColor(e);return r?new It(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${a})`}toArray(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*r/a,255*n/a,a]}}It.black=new It(0,0,0,1),It.white=new It(1,1,1,1),It.transparent=new It(0,0,0,0),It.red=new It(1,0,0,1),It.blue=new It(0,0,1,1);class Kr{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Do{constructor(e,r,n,a,h){this.text=e,this.image=r,this.scale=n,this.fontStack=a,this.textColor=h}}class Ci{constructor(e){this.sections=e}static fromString(e){return new Ci([new Do(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ci?e:Ci.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class qi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new qi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function ka(i,e,r,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,r,n]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kn(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof It||i instanceof Kr||i instanceof Ci||i instanceof qi)return!0;if(Array.isArray(i)){for(const e of i)if(!Kn(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Kn(i[e]))return!1;return!0}return!1}function Jt(i){if(i===null)return gr;if(typeof i=="string")return dt;if(typeof i=="boolean")return _t;if(typeof i=="number")return je;if(i instanceof It)return ri;if(i instanceof Kr)return ko;if(i instanceof Ci)return gn;if(i instanceof qi)return yn;if(Array.isArray(i)){const e=i.length;let r;for(const n of i){const a=Jt(n);if(r){if(r===a)continue;r=gt;break}r=a}return Pi(r||gt,e)}return Hr}function Yn(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof It||i instanceof Ci||i instanceof qi?i.toString():JSON.stringify(i)}class hr{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Kn(e[1]))return r.error("invalid value");const n=e[1];let a=Jt(n);const h=r.expectedType;return a.kind!=="array"||a.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(a=h),new hr(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof It?["rgba"].concat(this.value.toArray()):this.value instanceof Ci?this.value.serialize():this.value}}class _i{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ks={string:dt,number:je,boolean:_t,object:Hr};class tr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,a=1;const h=e[0];if(h==="array"){let f,m;if(e.length>2){const g=e[1];if(typeof g!="string"||!(g in ks)||g==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=ks[g],a++}else f=gt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);m=e[2],a++}n=Pi(f,m)}else n=ks[h];const u=[];for(;a<e.length;a++){const f=r.parse(e[a],a,gt);if(!f)return null;u.push(f)}return new tr(n,u)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!Hn(this.type,Jt(n)))return n;if(r===this.args.length-1)throw new _i(`Expected value to be of type ${Wt(this.type)}, but found ${Wt(Jt(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(n=>n.serialize()))}}class Jn{constructor(e){this.type=gn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const a=[];let h=!1;for(let u=1;u<=e.length-1;++u){const f=e[u];if(h&&typeof f=="object"&&!Array.isArray(f)){h=!1;let m=null;if(f["font-scale"]&&(m=r.parse(f["font-scale"],1,je),!m))return null;let g=null;if(f["text-font"]&&(g=r.parse(f["text-font"],1,Pi(dt)),!g))return null;let x=null;if(f["text-color"]&&(x=r.parse(f["text-color"],1,ri),!x))return null;const b=a[a.length-1];b.scale=m,b.font=g,b.textColor=x}else{const m=r.parse(e[u],1,gt);if(!m)return null;const g=m.type.kind;if(g!=="string"&&g!=="value"&&g!=="null"&&g!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,a.push({content:m,scale:null,font:null,textColor:null})}}return new Jn(a)}evaluate(e){return new Ci(this.sections.map(r=>{const n=r.content.evaluate(e);return Jt(n)===yn?new Do("",n,null,null,null):new Do(Yn(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class Lo{constructor(e){this.type=yn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const n=r.parse(e[1],1,dt);return n?new Lo(n):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),n=qi.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ic={"to-boolean":_t,"to-color":ri,"to-number":je,"to-string":dt};class Pr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");const a=ic[n],h=[];for(let u=1;u<e.length;u++){const f=r.parse(e[u],u,gt);if(!f)return null;h.push(f)}return new Pr(a,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,n;for(const a of this.args){if(r=a.evaluate(e),n=null,r instanceof It)return r;if(typeof r=="string"){const h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ka(r[0],r[1],r[2],r[3]),!n))return new It(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new _i(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const a=Number(r);if(!isNaN(a))return a}throw new _i(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Ci.fromString(Yn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?qi.fromString(Yn(this.args[0].evaluate(e))):Yn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Jn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Pa=["Unknown","Point","LineString","Polygon"];class Qn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=It.parse(e)),r}}class $i{constructor(e,r,n,a){this.name=e,this.type=r,this._evaluate=n,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],a=$i.definitions[n];if(!a)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(a)?a[0]:a.type,u=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,f=u.filter(([g])=>!Array.isArray(g)||g.length===e.length-1);let m=null;for(const[g,x]of f){m=new No(r.registry,r.path,null,r.scope);const b=[];let T=!1;for(let I=1;I<e.length;I++){const M=e[I],L=Array.isArray(g)?g[I-1]:g.type,q=m.parse(M,1+b.length,L);if(!q){T=!0;break}b.push(q)}if(!T)if(Array.isArray(g)&&g.length!==b.length)m.error(`Expected ${g.length} arguments, but found ${b.length} instead.`);else{for(let I=0;I<b.length;I++){const M=Array.isArray(g)?g[I]:g.type,L=b[I];m.concat(I+1).checkSubtype(M,L.type)}if(m.errors.length===0)return new $i(n,h,x,b)}}if(f.length===1)r.errors.push(...m.errors);else{const g=(f.length?f:u).map(([b])=>{return T=b,Array.isArray(T)?`(${T.map(Wt).join(", ")})`:`(${Wt(T.type)}...)`;var T}).join(" | "),x=[];for(let b=1;b<e.length;b++){const T=r.parse(e[b],1+x.length);if(!T)return null;x.push(Wt(T.type))}r.error(`Expected arguments of type ${g}, but found (${x.join(", ")}) instead.`)}return null}static register(e,r){$i.definitions=r;for(const n in r)e[n]=$i}}class Ro{constructor(e,r,n){this.type=ko,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const a=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,_t);if(!a)return null;const h=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,_t);if(!h)return null;let u=null;return n.locale&&(u=r.parse(n.locale,1,dt),!u)?null:new Ro(a,h,u)}evaluate(e){return new Kr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Dr=8192;function Ps(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Bo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function rc(i,e){const r=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(r*a*Dr),Math.round(n*a*Dr)]}function Da(i,e,r){const n=i[0]-e[0],a=i[1]-e[1],h=i[0]-r[0],u=i[1]-r[1];return n*u-h*a==0&&n*h<=0&&a*u<=0}function vn(i,e){let r=!1;for(let u=0,f=e.length;u<f;u++){const m=e[u];for(let g=0,x=m.length;g<x-1;g++){if(Da(i,m[g],m[g+1]))return!1;(a=m[g])[1]>(n=i)[1]!=(h=m[g+1])[1]>n[1]&&n[0]<(h[0]-a[0])*(n[1]-a[1])/(h[1]-a[1])+a[0]&&(r=!r)}}var n,a,h;return r}function nc(i,e){for(let r=0;r<e.length;r++)if(vn(i,e[r]))return!0;return!1}function La(i,e,r,n){const a=n[0]-r[0],h=n[1]-r[1],u=(i[0]-r[0])*h-a*(i[1]-r[1]),f=(e[0]-r[0])*h-a*(e[1]-r[1]);return u>0&&f<0||u<0&&f>0}function oc(i,e,r){for(const g of r)for(let x=0;x<g.length-1;++x)if((f=[(u=g[x+1])[0]-(h=g[x])[0],u[1]-h[1]])[0]*(m=[(a=e)[0]-(n=i)[0],a[1]-n[1]])[1]-f[1]*m[0]!=0&&La(n,a,h,u)&&La(h,u,n,a))return!0;var n,a,h,u,f,m;return!1}function Ra(i,e){for(let r=0;r<i.length;++r)if(!vn(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(oc(i[r],i[r+1],e))return!1;return!0}function ur(i,e){for(let r=0;r<e.length;r++)if(Ra(i,e[r]))return!0;return!1}function Fo(i,e,r){const n=[];for(let a=0;a<i.length;a++){const h=[];for(let u=0;u<i[a].length;u++){const f=rc(i[a][u],r);Ps(e,f),h.push(f)}n.push(h)}return n}function Ds(i,e,r){const n=[];for(let a=0;a<i.length;a++){const h=Fo(i[a],e,r);n.push(h)}return n}function eo(i,e,r,n){if(i[0]<r[0]||i[0]>r[2]){const a=.5*n;let h=i[0]-r[0]>a?-n:r[0]-i[0]>a?n:0;h===0&&(h=i[0]-r[2]>a?-n:r[2]-i[0]>a?n:0),i[0]+=h}Ps(e,i)}function bn(i,e,r,n){const a=Math.pow(2,n.z)*Dr,h=[n.x*Dr,n.y*Dr],u=[];for(const f of i)for(const m of f){const g=[m.x+h[0],m.y+h[1]];eo(g,e,r,a),u.push(g)}return u}function Ls(i,e,r,n){const a=Math.pow(2,n.z)*Dr,h=[n.x*Dr,n.y*Dr],u=[];for(const m of i){const g=[];for(const x of m){const b=[x.x+h[0],x.y+h[1]];Ps(e,b),g.push(b)}u.push(g)}if(e[2]-e[0]<=a/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const m of u)for(const g of m)eo(g,e,r,a)}var f;return u}class Lr{constructor(e,r){this.type=_t,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Kn(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const h=n.features[a].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Lr(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Lr(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Lr(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],u=r.canonicalID();if(n.type==="Polygon"){const f=Fo(n.coordinates,h,u),m=bn(r.geometry(),a,h,u);if(!Bo(a,h))return!1;for(const g of m)if(!vn(g,f))return!1}if(n.type==="MultiPolygon"){const f=Ds(n.coordinates,h,u),m=bn(r.geometry(),a,h,u);if(!Bo(a,h))return!1;for(const g of m)if(!nc(g,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],u=r.canonicalID();if(n.type==="Polygon"){const f=Fo(n.coordinates,h,u),m=Ls(r.geometry(),a,h,u);if(!Bo(a,h))return!1;for(const g of m)if(!Ra(g,f))return!1}if(n.type==="MultiPolygon"){const f=Ds(n.coordinates,h,u),m=Ls(r.geometry(),a,h,u);if(!Bo(a,h))return!1;for(const g of m)if(!ur(g,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Oo(i){if(i instanceof $i&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Lr)return!1;let e=!0;return i.eachChild(r=>{e&&!Oo(r)&&(e=!1)}),e}function Et(i){if(i instanceof $i&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Et(r)&&(e=!1)}),e}function Uo(i,e){if(i instanceof $i&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(n=>{r&&!Uo(n,e)&&(r=!1)}),r}class Vo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new Vo(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class No{constructor(e,r=[],n,a=new Nt,h=[]){this.registry=e,this.path=r,this.key=r.map(u=>`[${u}]`).join(""),this.scope=a,this.errors=h,this.expectedType=n}parse(e,r,n,a,h={}){return r?this.concat(r,n,a)._parse(e,h):this._parse(e,h)}_parse(e,r){function n(a,h,u){return u==="assert"?new tr(h,[a]):u==="coerce"?new Pr(h,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[a];if(h){let u=h.parse(e,this);if(!u)return null;if(this.expectedType){const f=this.expectedType,m=u.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||m.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(f,m))return null}else u=n(u,f,r.typeAnnotation||"coerce");else u=n(u,f,r.typeAnnotation||"assert")}if(!(u instanceof hr)&&u.type.kind!=="resolvedImage"&&Go(u)){const f=new Qn;try{u=new hr(u.type,u.evaluate(f))}catch(m){return this.error(m.message),null}}return u}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const a=typeof e=="number"?this.path.concat(e):this.path,h=n?this.scope.concat(n):this.scope;return new No(this.registry,a,r||null,h,this.errors)}error(e,...r){const n=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new wt(n,e))}checkSubtype(e,r){const n=Hn(e,r);return n&&this.error(n),n}}function Go(i){if(i instanceof Vo)return Go(i.boundExpression);if(i instanceof $i&&i.name==="error"||i instanceof Ro||i instanceof Lr)return!1;const e=i instanceof Pr||i instanceof tr;let r=!0;return i.eachChild(n=>{r=e?r&&Go(n):r&&n instanceof hr}),!!r&&Oo(i)&&Uo(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function qo(i,e){const r=i.length-1;let n,a,h=0,u=r,f=0;for(;h<=u;)if(f=Math.floor((h+u)/2),n=i[f],a=i[f+1],n<=e){if(f===r||e<a)return f;h=f+1}else{if(!(n>e))throw new _i("Input is not a number.");u=f-1}return 0}class wn{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[a,h]of n)this.labels.push(a),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,je);if(!n)return null;const a=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let u=1;u<e.length;u+=2){const f=u===1?-1/0:e[u],m=e[u+1],g=u,x=u+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(a.length&&a[a.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);const b=r.parse(m,x,h);if(!b)return null;h=h||b.type,a.push([f,b])}return new wn(h,n,a)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const h=r.length;return a>=r[h-1]?n[h-1].evaluate(e):n[qo(r,a)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function Mt(i,e,r){return i*(1-r)+e*r}var Tn=Object.freeze({__proto__:null,number:Mt,color:function(i,e,r){return new It(Mt(i.r,e.r,r),Mt(i.g,e.g,r),Mt(i.b,e.b,r),Mt(i.a,e.a,r))},array:function(i,e,r){return i.map((n,a)=>Mt(n,e[a],r))}});const Rs=.95047,Bs=1.08883,Ba=4/29,to=6/29,Fs=3*to*to,sc=Math.PI/180,Fa=180/Math.PI;function Os(i){return i>.008856451679035631?Math.pow(i,1/3):i/Fs+Ba}function $o(i){return i>to?i*i*i:Fs*(i-Ba)}function jo(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Zo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Us(i){const e=Zo(i.r),r=Zo(i.g),n=Zo(i.b),a=Os((.4124564*e+.3575761*r+.1804375*n)/Rs),h=Os((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*h-16,a:500*(a-h),b:200*(h-Os((.0193339*e+.119192*r+.9503041*n)/Bs)),alpha:i.a}}function Oa(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=1*$o(e),r=Rs*$o(r),n=Bs*$o(n),new It(jo(3.2404542*r-1.5371385*e-.4985314*n),jo(-.969266*r+1.8760108*e+.041556*n),jo(.0556434*r-.2040259*e+1.0572252*n),i.alpha)}function Ua(i,e,r){const n=e-i;return i+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const En={forward:Us,reverse:Oa,interpolate:function(i,e,r){return{l:Mt(i.l,e.l,r),a:Mt(i.a,e.a,r),b:Mt(i.b,e.b,r),alpha:Mt(i.alpha,e.alpha,r)}}},io={forward:function(i){const{l:e,a:r,b:n}=Us(i),a=Math.atan2(n,r)*Fa;return{h:a<0?a+360:a,c:Math.sqrt(r*r+n*n),l:e,alpha:i.a}},reverse:function(i){const e=i.h*sc,r=i.c;return Oa({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:Ua(i.h,e.h,r),c:Mt(i.c,e.c,r),l:Mt(i.l,e.l,r),alpha:Mt(i.alpha,e.alpha,r)}}};var Va=Object.freeze({__proto__:null,lab:En,hcl:io});class Di{constructor(e,r,n,a,h){this.type=e,this.operator=r,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[u,f]of h)this.labels.push(u),this.outputs.push(f)}static interpolationFactor(e,r,n,a){let h=0;if(e.name==="exponential")h=Vs(r,e.base,n,a);else if(e.name==="linear")h=Vs(r,1,n,a);else if(e.name==="cubic-bezier"){const u=e.controlPoints;h=new ee(u[0],u[1],u[2],u[3]).solve(Vs(r,1,n,a))}return h}static parse(e,r){let[n,a,h,...u]=e;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const g=a[1];if(typeof g!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:g}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const g=a.slice(1);if(g.length!==4||g.some(x=>typeof x!="number"||x<0||x>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:g}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,je),!h)return null;const f=[];let m=null;n==="interpolate-hcl"||n==="interpolate-lab"?m=ri:r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let g=0;g<u.length;g+=2){const x=u[g],b=u[g+1],T=g+3,I=g+4;if(typeof x!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(f.length&&f[f.length-1][0]>=x)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);const M=r.parse(b,I,m);if(!M)return null;m=m||M.type,f.push([x,M])}return m.kind==="number"||m.kind==="color"||m.kind==="array"&&m.itemType.kind==="number"&&typeof m.N=="number"?new Di(m,n,a,h,f):r.error(`Type ${Wt(m)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const h=r.length;if(a>=r[h-1])return n[h-1].evaluate(e);const u=qo(r,a),f=Di.interpolationFactor(this.interpolation,a,r[u],r[u+1]),m=n[u].evaluate(e),g=n[u+1].evaluate(e);return this.operator==="interpolate"?Tn[this.type.kind.toLowerCase()](m,g,f):this.operator==="interpolate-hcl"?io.reverse(io.interpolate(io.forward(m),io.forward(g),f)):En.reverse(En.interpolate(En.forward(m),En.forward(g),f))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function Vs(i,e,r,n){const a=n-r,h=i-r;return a===0?0:e===1?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)}class Xo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const a=r.expectedType;a&&a.kind!=="value"&&(n=a);const h=[];for(const f of e.slice(1)){const m=r.parse(f,1+h.length,n,void 0,{typeAnnotation:"omit"});if(!m)return null;n=n||m.type,h.push(m)}const u=a&&h.some(f=>Hn(a,f.type));return new Xo(u?gt:n,h)}evaluate(e){let r,n=null,a=0;for(const h of this.args)if(a++,n=h.evaluate(e),n&&n instanceof qi&&!n.available&&(r||(r=n.name),n=null,a===this.args.length&&(n=r)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ro{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let h=1;h<e.length-1;h+=2){const u=e[h];if(typeof u!="string")return r.error(`Expected string, but found ${typeof u} instead.`,h);if(/[^a-zA-Z0-9_]/.test(u))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const f=r.parse(e[h+1],h+1);if(!f)return null;n.push([u,f])}const a=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return a?new ro(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}class Ns{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,je),a=r.parse(e[2],2,Pi(r.expectedType||gt));return n&&a?new Ns(a.type.itemType,n,a):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new _i(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new _i(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new _i(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class no{constructor(e,r){this.type=_t,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,gt),a=r.parse(e[2],2,gt);return n&&a?yr(n.type,[_t,dt,je,gr,gt])?new no(n,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!xn(r,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(Jt(r))} instead.`);if(!xn(n,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Wt(Jt(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Wo{constructor(e,r,n){this.type=je,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,gt),a=r.parse(e[2],2,gt);if(!n||!a)return null;if(!yr(n.type,[_t,dt,je,gr,gt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(n.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,je);return h?new Wo(n,a,h):null}return new Wo(n,a)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!xn(r,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(Jt(r))} instead.`);if(!xn(n,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Wt(Jt(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(r,a)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gs{constructor(e,r,n,a,h,u){this.inputType=e,this.type=r,this.input=n,this.cases=a,this.outputs=h,this.otherwise=u}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const h={},u=[];for(let g=2;g<e.length-1;g+=2){let x=e[g];const b=e[g+1];Array.isArray(x)||(x=[x]);const T=r.concat(g);if(x.length===0)return T.error("Expected at least one branch label.");for(const M of x){if(typeof M!="number"&&typeof M!="string")return T.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return T.error("Numeric branch labels must be integer values.");if(n){if(T.checkSubtype(n,Jt(M)))return null}else n=Jt(M);if(h[String(M)]!==void 0)return T.error("Branch labels must be unique.");h[String(M)]=u.length}const I=r.parse(b,g,a);if(!I)return null;a=a||I.type,u.push(I)}const f=r.parse(e[1],1,gt);if(!f)return null;const m=r.parse(e[e.length-1],e.length-1,a);return m?f.type.kind!=="value"&&r.concat(1).checkSubtype(n,f.type)?null:new Gs(n,a,f,h,u,m):null}evaluate(e){const r=this.input.evaluate(e);return(Jt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],a={};for(const u of r){const f=a[this.cases[u]];f===void 0?(a[this.cases[u]]=n.length,n.push([this.cases[u],[u]])):n[f][1].push(u)}const h=u=>this.inputType.kind==="number"?Number(u):u;for(const[u,f]of n)e.push(f.length===1?h(f[0]):f.map(h)),e.push(this.outputs[u].serialize());return e.push(this.otherwise.serialize()),e}}class qs{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const a=[];for(let u=1;u<e.length-1;u+=2){const f=r.parse(e[u],u,_t);if(!f)return null;const m=r.parse(e[u+1],u+1,n);if(!m)return null;a.push([f,m]),n=n||m.type}const h=r.parse(e[e.length-1],e.length-1,n);return h?new qs(n,a,h):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class oo{constructor(e,r,n,a){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,gt),a=r.parse(e[2],2,je);if(!n||!a)return null;if(!yr(n.type,[Pi(gt),dt,gt]))return r.error(`Expected first argument to be of type array or string, but found ${Wt(n.type)} instead`);if(e.length===4){const h=r.parse(e[3],3,je);return h?new oo(n.type,n,a,h):null}return new oo(n.type,n,a)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!xn(r,["string","array"]))throw new _i(`Expected first argument to be of type array or string, but found ${Wt(Jt(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return r.slice(n,a)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function $s(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Na(i,e,r,n){return n.compare(e,r)===0}function Sn(i,e,r){const n=i!=="=="&&i!=="!=";return class wp{constructor(h,u,f){this.type=_t,this.lhs=h,this.rhs=u,this.collator=f,this.hasUntypedArgument=h.type.kind==="value"||u.type.kind==="value"}static parse(h,u){if(h.length!==3&&h.length!==4)return u.error("Expected two or three arguments.");const f=h[0];let m=u.parse(h[1],1,gt);if(!m)return null;if(!$s(f,m.type))return u.concat(1).error(`"${f}" comparisons are not supported for type '${Wt(m.type)}'.`);let g=u.parse(h[2],2,gt);if(!g)return null;if(!$s(f,g.type))return u.concat(2).error(`"${f}" comparisons are not supported for type '${Wt(g.type)}'.`);if(m.type.kind!==g.type.kind&&m.type.kind!=="value"&&g.type.kind!=="value")return u.error(`Cannot compare types '${Wt(m.type)}' and '${Wt(g.type)}'.`);n&&(m.type.kind==="value"&&g.type.kind!=="value"?m=new tr(g.type,[m]):m.type.kind!=="value"&&g.type.kind==="value"&&(g=new tr(m.type,[g])));let x=null;if(h.length===4){if(m.type.kind!=="string"&&g.type.kind!=="string"&&m.type.kind!=="value"&&g.type.kind!=="value")return u.error("Cannot use collator to compare non-string types.");if(x=u.parse(h[3],3,ko),!x)return null}return new wp(m,g,x)}evaluate(h){const u=this.lhs.evaluate(h),f=this.rhs.evaluate(h);if(n&&this.hasUntypedArgument){const m=Jt(u),g=Jt(f);if(m.kind!==g.kind||m.kind!=="string"&&m.kind!=="number")throw new _i(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${m.kind}, ${g.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const m=Jt(u),g=Jt(f);if(m.kind!=="string"||g.kind!=="string")return e(h,u,f)}return this.collator?r(h,u,f,this.collator.evaluate(h)):e(h,u,f)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[i];return this.eachChild(u=>{h.push(u.serialize())}),h}}}const Ga=Sn("==",function(i,e,r){return e===r},Na),qa=Sn("!=",function(i,e,r){return e!==r},function(i,e,r,n){return!Na(0,e,r,n)}),ac=Sn("<",function(i,e,r){return e<r},function(i,e,r,n){return n.compare(e,r)<0}),lc=Sn(">",function(i,e,r){return e>r},function(i,e,r,n){return n.compare(e,r)>0}),cc=Sn("<=",function(i,e,r){return e<=r},function(i,e,r,n){return n.compare(e,r)<=0}),hc=Sn(">=",function(i,e,r){return e>=r},function(i,e,r,n){return n.compare(e,r)>=0});class In{constructor(e,r,n,a,h){this.type=dt,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=a,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,je);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let h=null;if(a.locale&&(h=r.parse(a.locale,1,dt),!h))return null;let u=null;if(a.currency&&(u=r.parse(a.currency,1,dt),!u))return null;let f=null;if(a["min-fraction-digits"]&&(f=r.parse(a["min-fraction-digits"],1,je),!f))return null;let m=null;return a["max-fraction-digits"]&&(m=r.parse(a["max-fraction-digits"],1,je),!m)?null:new In(n,h,u,f,m)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ho{constructor(e){this.type=je,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Wt(n.type)} instead.`):new Ho(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new _i(`Expected value to be of type string or array, but found ${Wt(Jt(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Yr={"==":Ga,"!=":qa,">":lc,"<":ac,">=":hc,"<=":cc,array:tr,at:Ns,boolean:tr,case:qs,coalesce:Xo,collator:Ro,format:Jn,image:Lo,in:no,"index-of":Wo,interpolate:Di,"interpolate-hcl":Di,"interpolate-lab":Di,length:Ho,let:ro,literal:hr,match:Gs,number:tr,"number-format":In,object:tr,slice:oo,step:wn,string:tr,"to-boolean":Pr,"to-color":Pr,"to-number":Pr,"to-string":Pr,var:Vo,within:Lr};function $a(i,[e,r,n,a]){e=e.evaluate(i),r=r.evaluate(i),n=n.evaluate(i);const h=a?a.evaluate(i):1,u=ka(e,r,n,h);if(u)throw new _i(u);return new It(e/255*h,r/255*h,n/255*h,h)}function ja(i,e){return i in e}function js(i,e){const r=e[i];return r===void 0?null:r}function Rr(i){return{type:i}}function Zs(i){return{result:"success",value:i}}function Jr(i){return{result:"error",value:i}}function Br(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Za(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Xs(i){return!!i.expression&&i.expression.interpolated}function Pt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ko(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function uc(i){return i}function Xa(i,e){const r=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",a=n||!(n||i.property!==void 0),h=i.type||(Xs(e)?"exponential":"interval");if(r&&((i=mt({},i)).stops&&(i.stops=i.stops.map(g=>[g[0],It.parse(g[1])])),i.default=It.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Va[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let u,f,m;if(h==="exponential")u=Ha;else if(h==="interval")u=Yo;else if(h==="categorical"){u=Wa,f=Object.create(null);for(const g of i.stops)f[g[0]]=g[1];m=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);u=pc}if(n){const g={},x=[];for(let I=0;I<i.stops.length;I++){const M=i.stops[I],L=M[0].zoom;g[L]===void 0&&(g[L]={zoom:L,type:i.type,property:i.property,default:i.default,stops:[]},x.push(L)),g[L].stops.push([M[0].value,M[1]])}const b=[];for(const I of x)b.push([g[I].zoom,Xa(g[I],e)]);const T={name:"linear"};return{kind:"composite",interpolationType:T,interpolationFactor:Di.interpolationFactor.bind(void 0,T),zoomStops:b.map(I=>I[0]),evaluate:({zoom:I},M)=>Ha({stops:b,base:i.base},e,I).evaluate(I,M)}}if(a){const g=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:g,interpolationFactor:Di.interpolationFactor.bind(void 0,g),zoomStops:i.stops.map(x=>x[0]),evaluate:({zoom:x})=>u(i,e,x,f,m)}}return{kind:"source",evaluate(g,x){const b=x&&x.properties?x.properties[i.property]:void 0;return b===void 0?An(i.default,e.default):u(i,e,b,f,m)}}}function An(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Wa(i,e,r,n,a){return An(typeof r===a?n[r]:void 0,i.default,e.default)}function Yo(i,e,r){if(Pt(r)!=="number")return An(i.default,e.default);const n=i.stops.length;if(n===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[n-1][0])return i.stops[n-1][1];const a=qo(i.stops.map(h=>h[0]),r);return i.stops[a][1]}function Ha(i,e,r){const n=i.base!==void 0?i.base:1;if(Pt(r)!=="number")return An(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const h=qo(i.stops.map(x=>x[0]),r),u=function(x,b,T,I){const M=I-T,L=x-T;return M===0?0:b===1?L/M:(Math.pow(b,L)-1)/(Math.pow(b,M)-1)}(r,n,i.stops[h][0],i.stops[h+1][0]),f=i.stops[h][1],m=i.stops[h+1][1];let g=Tn[e.type]||uc;if(i.colorSpace&&i.colorSpace!=="rgb"){const x=Va[i.colorSpace];g=(b,T)=>x.reverse(x.interpolate(x.forward(b),x.forward(T),u))}return typeof f.evaluate=="function"?{evaluate(...x){const b=f.evaluate.apply(void 0,x),T=m.evaluate.apply(void 0,x);if(b!==void 0&&T!==void 0)return g(b,T,u)}}:g(f,m,u)}function pc(i,e,r){return e.type==="color"?r=It.parse(r):e.type==="formatted"?r=Ci.fromString(r.toString()):e.type==="resolvedImage"?r=qi.fromString(r.toString()):Pt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),An(r,i.default,e.default)}$i.register(Yr,{error:[{kind:"error"},[dt],(i,[e])=>{throw new _i(e.evaluate(i))}],typeof:[dt,[gt],(i,[e])=>Wt(Jt(e.evaluate(i)))],"to-rgba":[Pi(je,4),[ri],(i,[e])=>e.evaluate(i).toArray()],rgb:[ri,[je,je,je],$a],rgba:[ri,[je,je,je,je],$a],has:{type:_t,overloads:[[[dt],(i,[e])=>ja(e.evaluate(i),i.properties())],[[dt,Hr],(i,[e,r])=>ja(e.evaluate(i),r.evaluate(i))]]},get:{type:gt,overloads:[[[dt],(i,[e])=>js(e.evaluate(i),i.properties())],[[dt,Hr],(i,[e,r])=>js(e.evaluate(i),r.evaluate(i))]]},"feature-state":[gt,[dt],(i,[e])=>js(e.evaluate(i),i.featureState||{})],properties:[Hr,[],i=>i.properties()],"geometry-type":[dt,[],i=>i.geometryType()],id:[gt,[],i=>i.id()],zoom:[je,[],i=>i.globals.zoom],"heatmap-density":[je,[],i=>i.globals.heatmapDensity||0],"line-progress":[je,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[je,[],i=>i.globals.skyRadialProgress||0],accumulated:[gt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[je,Rr(je),(i,e)=>{let r=0;for(const n of e)r+=n.evaluate(i);return r}],"*":[je,Rr(je),(i,e)=>{let r=1;for(const n of e)r*=n.evaluate(i);return r}],"-":{type:je,overloads:[[[je,je],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[je],(i,[e])=>-e.evaluate(i)]]},"/":[je,[je,je],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[je,[je,je],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[je,[je],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[je,[je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[je,[je],(i,[e])=>Math.log(e.evaluate(i))],log2:[je,[je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[je,[je],(i,[e])=>Math.sin(e.evaluate(i))],cos:[je,[je],(i,[e])=>Math.cos(e.evaluate(i))],tan:[je,[je],(i,[e])=>Math.tan(e.evaluate(i))],asin:[je,[je],(i,[e])=>Math.asin(e.evaluate(i))],acos:[je,[je],(i,[e])=>Math.acos(e.evaluate(i))],atan:[je,[je],(i,[e])=>Math.atan(e.evaluate(i))],min:[je,Rr(je),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[je,Rr(je),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[je,[je],(i,[e])=>Math.abs(e.evaluate(i))],round:[je,[je],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[je,[je],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[je,[je],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[_t,[dt,gt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[_t,[gt],(i,[e])=>i.id()===e.value],"filter-type-==":[_t,[dt],(i,[e])=>i.geometryType()===e.value],"filter-<":[_t,[dt,gt],(i,[e,r])=>{const n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[_t,[gt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[_t,[dt,gt],(i,[e,r])=>{const n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[_t,[gt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[_t,[dt,gt],(i,[e,r])=>{const n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[_t,[gt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[_t,[dt,gt],(i,[e,r])=>{const n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[_t,[gt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[_t,[gt],(i,[e])=>e.value in i.properties()],"filter-has-id":[_t,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[_t,[Pi(dt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[_t,[Pi(gt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[_t,[dt,Pi(gt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[_t,[dt,Pi(gt)],(i,[e,r])=>function(n,a,h,u){for(;h<=u;){const f=h+u>>1;if(a[f]===n)return!0;a[f]>n?u=f-1:h=f+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Rr(_t),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Rr(_t),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[_t,[_t],(i,[e])=>!e.evaluate(i)],"is-supported-script":[_t,[dt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[dt,[dt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[dt,[dt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[dt,Rr(gt),(i,e)=>e.map(r=>Yn(r.evaluate(i))).join("")],"resolved-locale":[dt,[ko],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Ws{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Qn,this._defaultValue=r?function(n){return n.type==="color"&&Ko(n.default)?new It(0,0,0,0):n.type==="color"?It.parse(n.default)||null:n.default===void 0?null:n.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,a,h,u){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=a,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=u,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,a,h,u){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=u||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map(m=>JSON.stringify(m)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console!="undefined"&&console.warn(f.message)),this._defaultValue}}}function ji(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Yr}function so(i,e){const r=new No(Yr,[],e?function(a){const h={color:ri,string:dt,number:je,enum:dt,boolean:_t,formatted:gn,resolvedImage:yn};return a.type==="array"?Pi(h[a.value]||gt,a.length):h[a.type]}(e):void 0),n=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Zs(new Ws(n,e)):Jr(r.errors)}class Fr{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Et(r.expression)}evaluateWithoutErrorHandling(e,r,n,a,h,u){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,h,u)}evaluate(e,r,n,a,h,u){return this._styleExpression.evaluate(e,r,n,a,h,u)}}class Jo{constructor(e,r,n,a){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Et(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,r,n,a,h,u){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,h,u)}evaluate(e,r,n,a,h,u){return this._styleExpression.evaluate(e,r,n,a,h,u)}interpolationFactor(e,r,n){return this.interpolationType?Di.interpolationFactor(this.interpolationType,e,r,n):0}}function Ka(i,e){if((i=so(i,e)).result==="error")return i;const r=i.value.expression,n=Oo(r);if(!n&&!Br(e))return Jr([new wt("","data expressions not supported")]);const a=Uo(r,["zoom"]);if(!a&&!Za(e))return Jr([new wt("","zoom expressions not supported")]);const h=Or(r);return h||a?h instanceof wt?Jr([h]):h instanceof Di&&!Xs(e)?Jr([new wt("",'"interpolate" expressions cannot be used with this property')]):Zs(h?new Jo(n?"camera":"composite",i.value,h.labels,h instanceof Di?h.interpolation:void 0):new Fr(n?"constant":"source",i.value)):Jr([new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Cn{constructor(e,r){this._parameters=e,this._specification=r,mt(this,Xa(this._parameters,this._specification))}static deserialize(e){return new Cn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Or(i){let e=null;if(i instanceof ro)e=Or(i.result);else if(i instanceof Xo){for(const r of i.args)if(e=Or(r),e)break}else(i instanceof wn||i instanceof Di)&&i.input instanceof $i&&i.input.name==="zoom"&&(e=i);return e instanceof wt||i.eachChild(r=>{const n=Or(r);n instanceof wt?e=n:!e&&n?e=new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new wt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Zi(i){const e=i.key,r=i.value,n=i.valueSpec||{},a=i.objectElementValidators||{},h=i.style,u=i.styleSpec;let f=[];const m=Pt(r);if(m!=="object")return[new ge(e,r,`object expected, ${m} found`)];for(const g in r){const x=g.split(".")[0],b=n[x]||n["*"];let T;if(a[x])T=a[x];else if(n[x])T=wi;else if(a["*"])T=a["*"];else{if(!n["*"]){f.push(new ge(e,r[g],`unknown property "${g}"`));continue}T=wi}f=f.concat(T({key:(e&&`${e}.`)+g,value:r[g],valueSpec:b,style:h,styleSpec:u,object:r,objectKey:g},r))}for(const g in n)a[g]||n[g].required&&n[g].default===void 0&&r[g]===void 0&&f.push(new ge(e,r,`missing required property "${g}"`));return f}function Qo(i){const e=i.value,r=i.valueSpec,n=i.style,a=i.styleSpec,h=i.key,u=i.arrayElementValidator||wi;if(Pt(e)!=="array")return[new ge(h,e,`array expected, ${Pt(e)} found`)];if(r.length&&e.length!==r.length)return[new ge(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ge(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let f={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};a.$version<7&&(f.function=r.function),Pt(r.value)==="object"&&(f=r.value);let m=[];for(let g=0;g<e.length;g++)m=m.concat(u({array:e,arrayIndex:g,value:e[g],valueSpec:f,style:n,styleSpec:a,key:`${h}[${g}]`}));return m}function Hs(i){const e=i.key,r=i.value,n=i.valueSpec;let a=Pt(r);if(a==="number"&&r!=r&&(a="NaN"),a!=="number")return[new ge(e,r,`number expected, ${a} found`)];if("minimum"in n){let h=n.minimum;if(Pt(n.minimum)==="array"&&(h=n.minimum[i.arrayIndex]),r<h)return[new ge(e,r,`${r} is less than the minimum value ${h}`)]}if("maximum"in n){let h=n.maximum;if(Pt(n.maximum)==="array"&&(h=n.maximum[i.arrayIndex]),r>h)return[new ge(e,r,`${r} is greater than the maximum value ${h}`)]}return[]}function es(i){const e=i.valueSpec,r=ht(i.value.type);let n,a,h,u={};const f=r!=="categorical"&&i.value.property===void 0,m=!f,g=Pt(i.value.stops)==="array"&&Pt(i.value.stops[0])==="array"&&Pt(i.value.stops[0][0])==="object",x=Zi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(I){if(r==="identity")return[new ge(I.key,I.value,'identity function may not have a "stops" property')];let M=[];const L=I.value;return M=M.concat(Qo({key:I.key,value:L,valueSpec:I.valueSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:b})),Pt(L)==="array"&&L.length===0&&M.push(new ge(I.key,L,"array must have at least one stop")),M},default:function(I){return wi({key:I.key,value:I.value,valueSpec:e,style:I.style,styleSpec:I.styleSpec})}}});return r==="identity"&&f&&x.push(new ge(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||x.push(new ge(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Xs(i.valueSpec)&&x.push(new ge(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(m&&!Br(i.valueSpec)?x.push(new ge(i.key,i.value,"property functions not supported")):f&&!Za(i.valueSpec)&&x.push(new ge(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!g||i.value.property!==void 0||x.push(new ge(i.key,i.value,'"property" property is required')),x;function b(I){let M=[];const L=I.value,q=I.key;if(Pt(L)!=="array")return[new ge(q,L,`array expected, ${Pt(L)} found`)];if(L.length!==2)return[new ge(q,L,`array length 2 expected, length ${L.length} found`)];if(g){if(Pt(L[0])!=="object")return[new ge(q,L,`object expected, ${Pt(L[0])} found`)];if(L[0].zoom===void 0)return[new ge(q,L,"object stop key must have zoom")];if(L[0].value===void 0)return[new ge(q,L,"object stop key must have value")];if(h&&h>ht(L[0].zoom))return[new ge(q,L[0].zoom,"stop zoom values must appear in ascending order")];ht(L[0].zoom)!==h&&(h=ht(L[0].zoom),a=void 0,u={}),M=M.concat(Zi({key:`${q}[0]`,value:L[0],valueSpec:{zoom:{}},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{zoom:Hs,value:T}}))}else M=M.concat(T({key:`${q}[0]`,value:L[0],valueSpec:{},style:I.style,styleSpec:I.styleSpec},L));return ji(At(L[1]))?M.concat([new ge(`${q}[1]`,L[1],"expressions are not allowed in function stops.")]):M.concat(wi({key:`${q}[1]`,value:L[1],valueSpec:e,style:I.style,styleSpec:I.styleSpec}))}function T(I,M){const L=Pt(I.value),q=ht(I.value),K=I.value!==null?I.value:M;if(n){if(L!==n)return[new ge(I.key,K,`${L} stop domain type must match previous stop domain type ${n}`)]}else n=L;if(L!=="number"&&L!=="string"&&L!=="boolean")return[new ge(I.key,K,"stop domain value must be a number, string, or boolean")];if(L!=="number"&&r!=="categorical"){let ne=`number expected, ${L} found`;return Br(e)&&r===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ge(I.key,K,ne)]}return r!=="categorical"||L!=="number"||isFinite(q)&&Math.floor(q)===q?r!=="categorical"&&L==="number"&&a!==void 0&&q<a?[new ge(I.key,K,"stop domain values must appear in ascending order")]:(a=q,r==="categorical"&&q in u?[new ge(I.key,K,"stop domain values must be unique")]:(u[q]=!0,[])):[new ge(I.key,K,`integer expected, found ${q}`)]}}function Ur(i){const e=(i.expressionContext==="property"?Ka:so)(At(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new ge(`${i.key}${n.key}`,i.value,n.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ge(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Et(r))return[new ge(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Et(r))return[new ge(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Uo(r,["zoom","feature-state"]))return[new ge(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Oo(r))return[new ge(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ao(i){const e=i.key,r=i.value,n=i.valueSpec,a=[];return Array.isArray(n.values)?n.values.indexOf(ht(r))===-1&&a.push(new ge(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(ht(r))===-1&&a.push(new ge(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),a}function lo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!lo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ks={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ts(i){if(i==null)return{filter:()=>!0,needGeometry:!1};lo(i)||(i=rs(i));const e=so(i,Ks);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,n,a)=>e.value.evaluate(r,n,{},a),needGeometry:Ya(i)}}function is(i,e){return i<e?-1:i>e?1:0}function Ya(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Ya(i[e]))return!0;return!1}function rs(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Ys(i[1],i[2],"=="):e==="!="?Qr(Ys(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ys(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(rs))):e==="all"?["all"].concat(i.slice(1).map(rs)):e==="none"?["all"].concat(i.slice(1).map(rs).map(Qr)):e==="in"?Ja(i[1],i.slice(2)):e==="!in"?Qr(Ja(i[1],i.slice(2))):e==="has"?Qa(i[1]):e==="!has"?Qr(Qa(i[1])):e!=="within"||i;var r}function Ys(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Ja(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(is)]]:["filter-in-small",i,["literal",e]]}}function Qa(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Qr(i){return["!",i]}function Mn(i){return lo(At(i.value))?Ur(mt({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Li(i)}function Li(i){const e=i.value,r=i.key;if(Pt(e)!=="array")return[new ge(r,e,`array expected, ${Pt(e)} found`)];const n=i.styleSpec;let a,h=[];if(e.length<1)return[new ge(r,e,"filter array must have at least 1 element")];switch(h=h.concat(ao({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),ht(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ht(e[1])==="$type"&&h.push(new ge(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new ge(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=Pt(e[1]),a!=="string"&&h.push(new ge(`${r}[1]`,e[1],`string expected, ${a} found`)));for(let u=2;u<e.length;u++)a=Pt(e[u]),ht(e[1])==="$type"?h=h.concat(ao({key:`${r}[${u}]`,value:e[u],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&h.push(new ge(`${r}[${u}]`,e[u],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let u=1;u<e.length;u++)h=h.concat(Li({key:`${r}[${u}]`,value:e[u],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":a=Pt(e[1]),e.length!==2?h.push(new ge(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&h.push(new ge(`${r}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=Pt(e[1]),e.length!==2?h.push(new ge(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&h.push(new ge(`${r}[1]`,e[1],`object expected, ${a} found`))}return h}function co(i,e){const r=i.key,n=i.style,a=i.styleSpec,h=i.value,u=i.objectKey,f=a[`${e}_${i.layerType}`];if(!f)return[];const m=u.match(/^(.*)-transition$/);if(e==="paint"&&m&&f[m[1]]&&f[m[1]].transition)return wi({key:r,value:h,valueSpec:a.transition,style:n,styleSpec:a});const g=i.valueSpec||f[u];if(!g)return[new ge(r,h,`unknown property "${u}"`)];let x;if(Pt(h)==="string"&&Br(g)&&!g.tokens&&(x=/^{([^}]+)}$/.exec(h)))return[new ge(r,h,`"${u}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(x[1])} }\`.`)];const b=[];return i.layerType==="symbol"&&(u==="text-field"&&n&&!n.glyphs&&b.push(new ge(r,h,'use of "text-field" requires a style "glyphs" property')),u==="text-font"&&Ko(At(h))&&ht(h.type)==="identity"&&b.push(new ge(r,h,'"text-font" does not support identity functions'))),b.concat(wi({key:i.key,value:h,valueSpec:g,style:n,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:u}))}function el(i){return co(i,"paint")}function tl(i){return co(i,"layout")}function il(i){let e=[];const r=i.value,n=i.key,a=i.style,h=i.styleSpec;r.type||r.ref||e.push(new ge(n,r,'either "type" or "ref" is required'));let u=ht(r.type);const f=ht(r.ref);if(r.id){const m=ht(r.id);for(let g=0;g<i.arrayIndex;g++){const x=a.layers[g];ht(x.id)===m&&e.push(new ge(n,r.id,`duplicate layer id "${r.id}", previously used at line ${x.id.__line__}`))}}if("ref"in r){let m;["type","source","source-layer","filter","layout"].forEach(g=>{g in r&&e.push(new ge(n,r[g],`"${g}" is prohibited for ref layers`))}),a.layers.forEach(g=>{ht(g.id)===f&&(m=g)}),m?m.ref?e.push(new ge(n,r.ref,"ref cannot reference another ref layer")):u=ht(m.type):e.push(new ge(n,r.ref,`ref layer "${f}" not found`))}else if(u!=="background"&&u!=="sky")if(r.source){const m=a.sources&&a.sources[r.source],g=m&&ht(m.type);m?g==="vector"&&u==="raster"?e.push(new ge(n,r.source,`layer "${r.id}" requires a raster source`)):g==="raster"&&u!=="raster"?e.push(new ge(n,r.source,`layer "${r.id}" requires a vector source`)):g!=="vector"||r["source-layer"]?g==="raster-dem"&&u!=="hillshade"?e.push(new ge(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):u!=="line"||!r.paint||!r.paint["line-gradient"]||g==="geojson"&&m.lineMetrics||e.push(new ge(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ge(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ge(n,r.source,`source "${r.source}" not found`))}else e.push(new ge(n,r,'missing required property "source"'));return e=e.concat(Zi({key:n,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wi({key:`${n}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:Mn,layout:m=>Zi({layer:r,key:m.key,value:m.value,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":g=>tl(mt({layerType:u},g))}}),paint:m=>Zi({layer:r,key:m.key,value:m.value,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":g=>el(mt({layerType:u},g))}})}})),e}function zn(i){const e=i.value,r=i.key,n=Pt(e);return n!=="string"?[new ge(r,e,`string expected, ${n} found`)]:[]}const ns={promoteId:function({key:i,value:e}){if(Pt(e)==="string")return zn({key:i,value:e});{const r=[];for(const n in e)r.push(...zn({key:`${i}.${n}`,value:e[n]}));return r}}};function rl(i){const e=i.value,r=i.key,n=i.styleSpec,a=i.style;if(!e.type)return[new ge(r,e,'"type" is required')];const h=ht(e.type);let u;switch(h){case"vector":case"raster":case"raster-dem":return u=Zi({key:r,value:e,valueSpec:n[`source_${h.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:ns}),u;case"geojson":if(u=Zi({key:r,value:e,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:ns}),e.cluster)for(const f in e.clusterProperties){const[m,g]=e.clusterProperties[f],x=typeof m=="string"?[m,["accumulated"],["get",f]]:m;u.push(...Ur({key:`${r}.${f}.map`,value:g,expressionContext:"cluster-map"})),u.push(...Ur({key:`${r}.${f}.reduce`,value:x,expressionContext:"cluster-reduce"}))}return u;case"video":return Zi({key:r,value:e,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return Zi({key:r,value:e,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new ge(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ao({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:n})}}function os(i){const e=i.value,r=i.styleSpec,n=r.light,a=i.style;let h=[];const u=Pt(e);if(e===void 0)return h;if(u!=="object")return h=h.concat([new ge("light",e,`object expected, ${u} found`)]),h;for(const f in e){const m=f.match(/^(.*)-transition$/);h=h.concat(m&&n[m[1]]&&n[m[1]].transition?wi({key:f,value:e[f],valueSpec:r.transition,style:a,styleSpec:r}):n[f]?wi({key:f,value:e[f],valueSpec:n[f],style:a,styleSpec:r}):[new ge(f,e[f],`unknown property "${f}"`)])}return h}function nl(i){const e=i.value,r=i.key,n=i.style,a=i.styleSpec,h=a.terrain;let u=[];const f=Pt(e);if(e===void 0)return u;if(f!=="object")return u=u.concat([new ge("terrain",e,`object expected, ${f} found`)]),u;for(const m in e){const g=m.match(/^(.*)-transition$/);u=u.concat(g&&h[g[1]]&&h[g[1]].transition?wi({key:m,value:e[m],valueSpec:a.transition,style:n,styleSpec:a}):h[m]?wi({key:m,value:e[m],valueSpec:h[m],style:n,styleSpec:a}):[new ge(m,e[m],`unknown property "${m}"`)])}if(e.source){const m=n.sources&&n.sources[e.source],g=m&&ht(m.type);m?g!=="raster-dem"&&u.push(new ge(r,e.source,`terrain cannot be used with a source of type ${g}, it only be used with a "raster-dem" source type`)):u.push(new ge(r,e.source,`source "${e.source}" not found`))}else u.push(new ge(r,e,'terrain is missing required property "source"'));return u}function ol(i){const e=i.value,r=i.style,n=i.styleSpec,a=n.fog;let h=[];const u=Pt(e);if(e===void 0)return h;if(u!=="object")return h=h.concat([new ge("fog",e,`object expected, ${u} found`)]),h;e.range&&!ji(At(e.range))&&e.range[0]>=e.range[1]&&(h=h.concat([new ge("fog",e,"fog.range[0] can't be greater than or equal to fog.range[1]")]));for(const f in e){const m=f.match(/^(.*)-transition$/);h=h.concat(m&&a[m[1]]&&a[m[1]].transition?wi({key:f,value:e[f],valueSpec:n.transition,style:r,styleSpec:n}):a[f]?wi({key:f,value:e[f],valueSpec:a[f],style:r,styleSpec:n}):[new ge(f,e[f],`unknown property "${f}"`)])}return h}const ss={"*":()=>[],array:Qo,boolean:function(i){const e=i.value,r=i.key,n=Pt(e);return n!=="boolean"?[new ge(r,e,`boolean expected, ${n} found`)]:[]},number:Hs,color:function(i){const e=i.key,r=i.value,n=Pt(r);return n!=="string"?[new ge(e,r,`color expected, ${n} found`)]:za.parseCSSColor(r)===null?[new ge(e,r,`color expected, "${r}" found`)]:[]},constants:rt,enum:ao,filter:Mn,function:es,layer:il,object:Zi,source:rl,light:os,terrain:nl,fog:ol,string:zn,formatted:function(i){return zn(i).length===0?[]:Ur(i)},resolvedImage:function(i){return zn(i).length===0?[]:Ur(i)}};function wi(i){const e=i.value,r=i.valueSpec,n=i.styleSpec;return r.expression&&Ko(ht(e))?es(i):r.expression&&ji(At(e))?Ur(i):r.type&&ss[r.type]?ss[r.type](i):Zi(mt({},i,{valueSpec:r.type?n[r.type]:r}))}function sl(i){const e=i.value,r=i.key,n=zn(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new ge(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new ge(r,e,'"glyphs" url must include a "{range}" token'))),n}function pr(i,e=Y){let r=[];return r=r.concat(wi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:sl,"*":()=>[]}})),i.constants&&(r=r.concat(rt({key:"constants",value:i.constants,style:i,styleSpec:e}))),al(r)}function al(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function dr(i){return function(...e){return al(i.apply(this,e))}}pr.source=dr(rl),pr.light=dr(os),pr.terrain=dr(nl),pr.fog=dr(ol),pr.layer=dr(il),pr.filter=dr(Mn),pr.paintProperty=dr(el),pr.layoutProperty=dr(tl);const xr=pr,ll=xr.light,dc=xr.fog,cl=xr.paintProperty,fc=xr.layoutProperty;function as(i,e){let r=!1;if(e&&e.length)for(const n of e)i.fire(new Ce(new Error(n.message))),r=!0;return r}var ho=fr;function fr(i,e,r){var n=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var a=new Int32Array(this.arrayBuffer);i=a[0],this.d=(e=a[1])+2*(r=a[2]);for(var h=0;h<this.d*this.d;h++){var u=a[3+h],f=a[3+h+1];n.push(u===f?null:a.subarray(u,f))}var m=a[3+n.length+1];this.keys=a.subarray(a[3+n.length],m),this.bboxes=a.subarray(m),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var g=0;g<this.d*this.d;g++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var x=r/e*i;this.min=-x,this.max=i+x}fr.prototype.insert=function(i,e,r,n,a){this._forEachCell(e,r,n,a,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(a)},fr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fr.prototype._insertCell=function(i,e,r,n,a,h){this.cells[a].push(h)},fr.prototype.query=function(i,e,r,n,a){var h=this.min,u=this.max;if(i<=h&&e<=h&&u<=r&&u<=n&&!a)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(i,e,r,n,this._queryCell,f,{},a),f},fr.prototype._queryCell=function(i,e,r,n,a,h,u,f){var m=this.cells[a];if(m!==null)for(var g=this.keys,x=this.bboxes,b=0;b<m.length;b++){var T=m[b];if(u[T]===void 0){var I=4*T;(f?f(x[I+0],x[I+1],x[I+2],x[I+3]):i<=x[I+2]&&e<=x[I+3]&&r>=x[I+0]&&n>=x[I+1])?(u[T]=!0,h.push(g[T])):u[T]=!1}}},fr.prototype._forEachCell=function(i,e,r,n,a,h,u,f){for(var m=this._convertToCellCoord(i),g=this._convertToCellCoord(e),x=this._convertToCellCoord(r),b=this._convertToCellCoord(n),T=m;T<=x;T++)for(var I=g;I<=b;I++){var M=this.d*I+T;if((!f||f(this._convertFromCellCoord(T),this._convertFromCellCoord(I),this._convertFromCellCoord(T+1),this._convertFromCellCoord(I+1)))&&a.call(this,i,e,r,n,M,h,u,f))return}},fr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},fr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},fr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var a=new Int32Array(e+r+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var h=e,u=0;u<i.length;u++){var f=i[u];a[3+u]=h,a.set(f,h),h+=f.length}return a[3+i.length]=h,a.set(this.keys,h),a[3+i.length+1]=h+=this.keys.length,a.set(this.bboxes,h),h+=this.bboxes.length,a.buffer};const{ImageData:hl,ImageBitmap:ul}=ie,kn={};function Ze(i,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),kn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ze("Object",Object),ho.serialize=function(i,e){const r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},ho.deserialize=function(i){return new ho(i.buffer)},Ze("Grid",ho),Ze("Color",It),Ze("Error",Error),Ze("ResolvedImage",qi),Ze("StylePropertyFunction",Cn),Ze("StyleExpression",Ws,{omit:["_evaluator"]}),Ze("ZoomDependentExpression",Jo),Ze("ZoomConstantExpression",Fr),Ze("CompoundExpression",$i,{omit:["_evaluate"]});for(const i in Yr)Yr[i]._classRegistryKey||Ze(`Expression_${i}`,Yr[i]);function pl(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function dl(i){return ul&&i instanceof ul}function uo(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(pl(i)||dl(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof hl)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const n of i)r.push(uo(n,e));return r}if(typeof i=="object"){const r=i.constructor,n=r._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const a=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const h in i){if(!i.hasOwnProperty(h)||kn[n].omit.indexOf(h)>=0)continue;const u=i[h];a[h]=kn[n].shallow.indexOf(h)>=0?u:uo(u,e)}i instanceof Error&&(a.message=i.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof i)}function po(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||pl(i)||dl(i)||ArrayBuffer.isView(i)||i instanceof hl)return i;if(Array.isArray(i))return i.map(po);if(typeof i=="object"){const e=i.$name||"Object",{klass:r}=kn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const n=Object.create(r.prototype);for(const a of Object.keys(i)){if(a==="$name")continue;const h=i[a];n[a]=kn[e].shallow.indexOf(a)>=0?h:po(h)}return n}throw new Error("can't deserialize object of type "+typeof i)}class fl{constructor(){this.first=!0}update(e,r){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const ml=i=>i>=1536&&i<=1791,fo=i=>i>=1872&&i<=1919,_l=i=>i>=2208&&i<=2303,gl=i=>i>=11904&&i<=12031,mo=i=>i>=12032&&i<=12255,yl=i=>i>=12272&&i<=12287,Js=i=>i>=12288&&i<=12351,ls=i=>i>=12352&&i<=12447,_o=i=>i>=12448&&i<=12543,Qs=i=>i>=12544&&i<=12591,ea=i=>i>=12704&&i<=12735,cs=i=>i>=12736&&i<=12783,ta=i=>i>=12784&&i<=12799,hs=i=>i>=12800&&i<=13055,xl=i=>i>=13056&&i<=13311,vl=i=>i>=13312&&i<=19903,Pn=i=>i>=19968&&i<=40959,bl=i=>i>=40960&&i<=42127,en=i=>i>=42128&&i<=42191,wl=i=>i>=44032&&i<=55215,us=i=>i>=63744&&i<=64255,ia=i=>i>=64336&&i<=65023,Tl=i=>i>=65040&&i<=65055,ra=i=>i>=65072&&i<=65103,tn=i=>i>=65104&&i<=65135,Dn=i=>i>=65136&&i<=65279,rn=i=>i>=65280&&i<=65519;function na(i){for(const e of i)if(oa(e.charCodeAt(0)))return!0;return!1}function El(i){for(const e of i)if(!go(e.charCodeAt(0)))return!1;return!0}function go(i){return!(ml(i)||fo(i)||_l(i)||ia(i)||Dn(i))}function oa(i){return!(i!==746&&i!==747&&(i<4352||!(ea(i)||Qs(i)||ra(i)&&!(i>=65097&&i<=65103)||us(i)||xl(i)||gl(i)||cs(i)||!(!Js(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||vl(i)||Pn(i)||hs(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||wl(i)||ls(i)||yl(i)||(e=>e>=12688&&e<=12703)(i)||mo(i)||ta(i)||_o(i)&&i!==12540||!(!rn(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!tn(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Tl(i)||(e=>e>=19904&&e<=19967)(i)||bl(i)||en(i))))}function Sl(i){return!(oa(i)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Js(e)||_o(e)||(r=>r>=57344&&r<=63743)(e)||ra(e)||tn(e)||rn(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function sa(i){return i>=1424&&i<=2303||ia(i)||Dn(i)}function ps(i,e){return!(!e&&sa(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function l(i){for(const e of i)if(sa(e.charCodeAt(0)))return!0;return!1}const t="deferred",o="loading",c="loaded";let p=null,d="unavailable",_=null;const y=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(d="error"),p&&p(i)};function v(){w.fire(new Ve("pluginStateChange",{pluginStatus:d,pluginURL:_}))}const w=new Ke,E=function(){return d},A=function(){if(d!==t||!_)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=o,v(),_&&S({url:_},i=>{i?y(i):(d=c,v())})},z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===c||z.applyArabicShaping!=null,isLoading:()=>d===o,setState(i){d=i.pluginStatus,_=i.pluginURL},isParsed:()=>z.applyArabicShaping!=null&&z.processBidirectionalText!=null&&z.processStyledBidirectionalText!=null,getPluginURL:()=>_};class k{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fl,this.transition={})}isSupportedScript(e){return function(r,n){for(const a of r)if(!ps(a.charCodeAt(0),n))return!1;return!0}(e,z.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class D{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,a){if(Ko(n))return new Cn(n,a);if(ji(n)){const h=Ka(n,a);if(h.result==="error")throw new Error(h.value.map(u=>`${u.key}: ${u.message}`).join(", "));return h.value}{let h=n;return typeof n=="string"&&a.type==="color"&&(h=It.parse(n)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class F{constructor(e){this.property=e,this.value=new D(e,void 0)}transitioned(e,r){return new P(this.property,this.value,r,Tt({},e.transition,this.transition),e.now)}untransitioned(){return new P(this.property,this.value,null,{},0)}}class Z{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return pt(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new F(this._values[e].property)),this._values[e].value=new D(this._values[e].property,r===null?void 0:pt(r))}getTransition(e){return pt(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new F(this._values[e].property)),this._values[e].transition=pt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const a=this.getTransition(r);a!==void 0&&(e[`${r}-transition`]=a)}return e}transitioned(e,r){const n=new U(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,r._values[a]);return n}untransitioned(){const e=new U(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class P{constructor(e,r,n,a,h){const u=a.delay||0,f=a.duration||0;h=h||0,this.property=e,this.value=r,this.begin=h+u,this.end=this.begin+f,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const a=e.now||0,h=this.value.possiblyEvaluate(e,r,n),u=this.prior;if(u){if(a>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(a<this.begin)return u.possiblyEvaluate(e,r,n);{const f=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(u.possiblyEvaluate(e,r,n),h,ye(f))}}return h}}class U{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const a=new re(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,r,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ${constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return pt(this._values[e].value)}setValue(e,r){this._values[e]=new D(this._values[e].property,r===null?void 0:pt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const a=new re(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,r,n);return a}}class H{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,a){return this.property.evaluate(this.value,this.parameters,e,r,n,a)}}class re{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class N{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const a=Tn[this.specification.type];return a?a(e,r,n):e}}class oe{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,a){return new H(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,a)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new H(this,{kind:"constant",value:void 0},e.parameters);const a=Tn[this.specification.type];return a?new H(this,{kind:"constant",value:a(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,a,h,u){return e.kind==="constant"?e.value:e.evaluate(r,n,a,h,u)}}class ve extends oe{possiblyEvaluate(e,r,n,a){if(e.value===void 0)return new H(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},n,a),u=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,f=this._calculate(u,u,u,r);return new H(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new H(this,{kind:"constant",value:h},r)}return new H(this,e.expression,r)}evaluate(e,r,n,a,h,u){if(e.kind==="source"){const f=e.evaluate(r,n,a,h,u);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,a),e.evaluate({zoom:Math.floor(r.zoom)},n,a),e.evaluate({zoom:Math.floor(r.zoom)+1},n,a),r):e.value}_calculate(e,r,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:r,other:n}:{from:n,to:r,other:e}}interpolate(e){return e}}class Ie{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(r,null,{},n,a);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new k(Math.floor(r.zoom-1),r)),e.expression.evaluate(new k(Math.floor(r.zoom),r)),e.expression.evaluate(new k(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class j{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){return!!e.expression.evaluate(r,null,{},n,a)}interpolate(){return!1}}class ke{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const a=this.defaultPropertyValues[r]=new D(n,void 0),h=this.defaultTransitionablePropertyValues[r]=new F(n);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=a.possiblyEvaluate({})}}}function ze(i,e){return 256*(i=Be(Math.floor(i),0,255))+Be(Math.floor(e),0,255)}Ze("DataDrivenProperty",oe),Ze("DataConstantProperty",N),Ze("CrossFadedDataDrivenProperty",ve),Ze("CrossFadedProperty",Ie),Ze("ColorRampProperty",j);const Ye={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class We{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ge{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function He(i,e=1){let r=0,n=0;return{members:i.map(a=>{const h=Ye[a.type].BYTES_PER_ELEMENT,u=r=nt(r,Math.max(e,h)),f=a.components||1;return n=Math.max(n,h),r+=h*f,{name:a.name,type:a.type,components:f,offset:u}}),size:nt(r,Math.max(n,e)),alignment:e}}function nt(i,e){return Math.ceil(i/e)*e}class St extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.int16[a+0]=r,this.int16[a+1]=n,e}}St.prototype.bytesPerElement=4,Ze("StructArrayLayout2i4",St);class Ut extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){const u=4*e;return this.int16[u+0]=r,this.int16[u+1]=n,this.int16[u+2]=a,this.int16[u+3]=h,e}}Ut.prototype.bytesPerElement=8,Ze("StructArrayLayout4i8",Ut);class jt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,h,u,f)}emplace(e,r,n,a,h,u,f,m){const g=6*e,x=12*e,b=3*e;return this.int16[g+0]=r,this.int16[g+1]=n,this.uint8[x+4]=a,this.uint8[x+5]=h,this.uint8[x+6]=u,this.uint8[x+7]=f,this.float32[b+2]=m,e}}jt.prototype.bytesPerElement=12,Ze("StructArrayLayout2i4ub1f12",jt);class xt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.float32[a+0]=r,this.float32[a+1]=n,e}}xt.prototype.bytesPerElement=8,Ze("StructArrayLayout2f8",xt);class Ct extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u,f,m,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,n,a,h,u,f,m,g,x)}emplace(e,r,n,a,h,u,f,m,g,x,b){const T=10*e;return this.uint16[T+0]=r,this.uint16[T+1]=n,this.uint16[T+2]=a,this.uint16[T+3]=h,this.uint16[T+4]=u,this.uint16[T+5]=f,this.uint16[T+6]=m,this.uint16[T+7]=g,this.uint16[T+8]=x,this.uint16[T+9]=b,e}}Ct.prototype.bytesPerElement=20,Ze("StructArrayLayout10ui20",Ct);class Kt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,n,a,h,u,f,m)}emplace(e,r,n,a,h,u,f,m,g){const x=8*e;return this.uint16[x+0]=r,this.uint16[x+1]=n,this.uint16[x+2]=a,this.uint16[x+3]=h,this.uint16[x+4]=u,this.uint16[x+5]=f,this.uint16[x+6]=m,this.uint16[x+7]=g,e}}Kt.prototype.bytesPerElement=16,Ze("StructArrayLayout8ui16",Kt);class ir extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u,f,m,g,x,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,n,a,h,u,f,m,g,x,b,T)}emplace(e,r,n,a,h,u,f,m,g,x,b,T,I){const M=12*e;return this.int16[M+0]=r,this.int16[M+1]=n,this.int16[M+2]=a,this.int16[M+3]=h,this.uint16[M+4]=u,this.uint16[M+5]=f,this.uint16[M+6]=m,this.uint16[M+7]=g,this.int16[M+8]=x,this.int16[M+9]=b,this.int16[M+10]=T,this.int16[M+11]=I,e}}ir.prototype.bytesPerElement=24,Ze("StructArrayLayout4i4ui4i24",ir);class Ti extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const h=3*e;return this.float32[h+0]=r,this.float32[h+1]=n,this.float32[h+2]=a,e}}Ti.prototype.bytesPerElement=12,Ze("StructArrayLayout3f12",Ti);class Ei extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Ei.prototype.bytesPerElement=4,Ze("StructArrayLayout1ul4",Ei);class rr extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u,f,m,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,n,a,h,u,f,m,g,x)}emplace(e,r,n,a,h,u,f,m,g,x,b){const T=16*e,I=8*e;return this.int16[T+0]=r,this.int16[T+1]=n,this.float32[I+1]=a,this.float32[I+2]=h,this.float32[I+3]=u,this.float32[I+4]=f,this.int16[T+10]=m,this.uint32[I+6]=g,this.uint16[T+14]=x,this.uint16[T+15]=b,e}}rr.prototype.bytesPerElement=32,Ze("StructArrayLayout2i4f1i1ul2ui32",rr);class nr extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,n,a,h,u)}emplace(e,r,n,a,h,u,f){const m=6*e;return this.int16[m+0]=r,this.int16[m+1]=n,this.int16[m+2]=a,this.int16[m+3]=h,this.int16[m+4]=u,this.int16[m+5]=f,e}}nr.prototype.bytesPerElement=12,Ze("StructArrayLayout2i2i2i12",nr);class Yt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,a,h)}emplace(e,r,n,a,h,u){const f=4*e,m=8*e;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=a,this.int16[m+6]=h,this.int16[m+7]=u,e}}Yt.prototype.bytesPerElement=16,Ze("StructArrayLayout2f1f2i16",Yt);class ni extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){const u=12*e,f=3*e;return this.uint8[u+0]=r,this.uint8[u+1]=n,this.float32[f+1]=a,this.float32[f+2]=h,e}}ni.prototype.bytesPerElement=12,Ze("StructArrayLayout2ub2f12",ni);class vt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=n,this.uint16[h+2]=a,e}}vt.prototype.bytesPerElement=6,Ze("StructArrayLayout3ui6",vt);class Qt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u,f,m,g,x,b,T,I,M,L,q,K){const ne=this.length;return this.resize(ne+1),this.emplace(ne,e,r,n,a,h,u,f,m,g,x,b,T,I,M,L,q,K)}emplace(e,r,n,a,h,u,f,m,g,x,b,T,I,M,L,q,K,ne){const ce=24*e,ue=12*e,he=48*e;return this.int16[ce+0]=r,this.int16[ce+1]=n,this.uint16[ce+2]=a,this.uint16[ce+3]=h,this.uint32[ue+2]=u,this.uint32[ue+3]=f,this.uint32[ue+4]=m,this.uint16[ce+10]=g,this.uint16[ce+11]=x,this.uint16[ce+12]=b,this.float32[ue+7]=T,this.float32[ue+8]=I,this.uint8[he+36]=M,this.uint8[he+37]=L,this.uint8[he+38]=q,this.uint32[ue+10]=K,this.int16[ce+22]=ne,e}}Qt.prototype.bytesPerElement=48,Ze("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qt);class xi extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,u,f,m,g,x,b,T,I,M,L,q,K,ne,ce,ue,he,pe,Le,Ae,Me,Ue,Se,Re){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,r,n,a,h,u,f,m,g,x,b,T,I,M,L,q,K,ne,ce,ue,he,pe,Le,Ae,Me,Ue,Se,Re)}emplace(e,r,n,a,h,u,f,m,g,x,b,T,I,M,L,q,K,ne,ce,ue,he,pe,Le,Ae,Me,Ue,Se,Re,Pe){const Te=34*e,Xe=17*e;return this.int16[Te+0]=r,this.int16[Te+1]=n,this.int16[Te+2]=a,this.int16[Te+3]=h,this.int16[Te+4]=u,this.int16[Te+5]=f,this.int16[Te+6]=m,this.int16[Te+7]=g,this.uint16[Te+8]=x,this.uint16[Te+9]=b,this.uint16[Te+10]=T,this.uint16[Te+11]=I,this.uint16[Te+12]=M,this.uint16[Te+13]=L,this.uint16[Te+14]=q,this.uint16[Te+15]=K,this.uint16[Te+16]=ne,this.uint16[Te+17]=ce,this.uint16[Te+18]=ue,this.uint16[Te+19]=he,this.uint16[Te+20]=pe,this.uint16[Te+21]=Le,this.uint16[Te+22]=Ae,this.uint32[Xe+12]=Me,this.float32[Xe+13]=Ue,this.float32[Xe+14]=Se,this.float32[Xe+15]=Re,this.float32[Xe+16]=Pe,e}}xi.prototype.bytesPerElement=68,Ze("StructArrayLayout8i15ui1ul4f68",xi);class Gt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Gt.prototype.bytesPerElement=4,Ze("StructArrayLayout1f4",Gt);class Ri extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const h=3*e;return this.int16[h+0]=r,this.int16[h+1]=n,this.int16[h+2]=a,e}}Ri.prototype.bytesPerElement=6,Ze("StructArrayLayout3i6",Ri);class Ln extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){const u=6*e;return this.uint32[3*e+0]=r,this.uint16[u+2]=n,this.uint16[u+3]=a,this.uint16[u+4]=h,e}}Ln.prototype.bytesPerElement=12,Ze("StructArrayLayout1ul3ui12",Ln);class pi extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.uint16[a+0]=r,this.uint16[a+1]=n,e}}pi.prototype.bytesPerElement=4,Ze("StructArrayLayout2ui4",pi);class vr extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}vr.prototype.bytesPerElement=2,Ze("StructArrayLayout1ui2",vr);class aa extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){const u=4*e;return this.float32[u+0]=r,this.float32[u+1]=n,this.float32[u+2]=a,this.float32[u+3]=h,e}}aa.prototype.bytesPerElement=16,Ze("StructArrayLayout4f16",aa);class ds extends We{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new X(this.anchorPointX,this.anchorPointY)}}ds.prototype.size=32;class nn extends rr{get(e){return new ds(this,e)}}Ze("CollisionBoxArray",nn);class Il extends We{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Il.prototype.size=48;class yo extends Qt{get(e){return new Il(this,e)}}Ze("PlacedSymbolArray",yo);class fs extends We{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}fs.prototype.size=68;class dh extends xi{get(e){return new fs(this,e)}}Ze("SymbolInstanceArray",dh);class fh extends Gt{getoffsetX(e){return this.float32[1*e+0]}}Ze("GlyphOffsetArray",fh);class mh extends Ri{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ze("SymbolLineVertexArray",mh);class _h extends We{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}_h.prototype.size=12;class gh extends Ln{get(e){return new _h(this,e)}}Ze("FeatureIndexArray",gh);class yh extends We{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}yh.prototype.size=4;class xh extends pi{get(e){return new yh(this,e)}}Ze("FillExtrusionCentroidArray",xh);const Ep=He([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Sp=He([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var vh=Gi(function(i){i.exports=function(e,r){var n,a,h,u,f,m,g,x;for(a=e.length-(n=3&e.length),h=r,f=3432918353,m=461845907,x=0;x<a;)g=255&e.charCodeAt(x)|(255&e.charCodeAt(++x))<<8|(255&e.charCodeAt(++x))<<16|(255&e.charCodeAt(++x))<<24,++x,h=27492+(65535&(u=5*(65535&(h=(h^=g=(65535&(g=(g=(65535&g)*f+(((g>>>16)*f&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(g=0,n){case 3:g^=(255&e.charCodeAt(x+2))<<16;case 2:g^=(255&e.charCodeAt(x+1))<<8;case 1:h^=g=(65535&(g=(g=(65535&(g^=255&e.charCodeAt(x)))*f+(((g>>>16)*f&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}}),Ip=Gi(function(i){i.exports=function(e,r){for(var n,a=e.length,h=r^a,u=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++u;switch(a){case 3:h^=(255&e.charCodeAt(u+2))<<16;case 2:h^=(255&e.charCodeAt(u+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(u)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}}),la=vh,Ap=Ip;la.murmur3=vh,la.murmur2=Ap;class Al{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,a){this.ids.push(bh(e)),this.positions.push(r,n,a)}getPositions(e){const r=bh(e);let n=0,a=this.ids.length-1;for(;n<a;){const u=n+a>>1;this.ids[u]>=r?a=u:n=u+1}const h=[];for(;this.ids[n]===r;)h.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return h}static serialize(e,r){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return mc(n,a,0,n.length-1),r&&r.push(n.buffer,a.buffer),{ids:n,positions:a}}static deserialize(e){const r=new Al;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function bh(i){const e=+i;return!isNaN(e)&&e<=_e?e:la(String(i))}function mc(i,e,r,n){for(;r<n;){const a=i[r+n>>1];let h=r-1,u=n+1;for(;;){do h++;while(i[h]<a);do u--;while(i[u]>a);if(h>=u)break;Cl(i,h,u),Cl(e,3*h,3*u),Cl(e,3*h+1,3*u+1),Cl(e,3*h+2,3*u+2)}u-r<n-u?(mc(i,e,r,u),r=u+1):(mc(i,e,u+1,n),n=u)}}function Cl(i,e,r){const n=i[e];i[e]=i[r],i[r]=n}Ze("FeaturePositionMap",Al);class Rn{constructor(e,r){this.gl=e.gl,this.location=r}}class Ml extends Rn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class wh extends Rn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Th extends Rn{constructor(e,r){super(e,r),this.current=It.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Cp=new Float32Array(16),Mp=new Float32Array(9);function _c(i){return[ze(255*i.r,255*i.g),ze(255*i.b,255*i.a)]}class ca{constructor(e,r,n){this.value=e,this.uniformNames=r.map(a=>`u_${a}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new Th(e,r):new Ml(e,r)}}class ms{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,n,a){const h=a==="u_pattern_to"||a==="u_dash_to"?this.patternTo:a==="u_pattern_from"||a==="u_dash_from"?this.patternFrom:a==="u_pixel_ratio_to"?this.pixelRatioTo:a==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new wh(e,r):new Ml(e,r)}}class on{constructor(e,r,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,r,n,a,h){const u=this.paintVertexArray.length,f=this.expression.evaluate(new k(0),r,{},a,[],h);this.paintVertexArray.resize(e),this._setPaintValue(u,e,f)}updatePaintArray(e,r,n,a){const h=this.expression.evaluate({zoom:0},n,a);this._setPaintValue(e,r,h)}_setPaintValue(e,r,n){if(this.type==="color"){const a=_c(n);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a[0],a[1])}else{for(let a=e;a<r;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class br{constructor(e,r,n,a,h,u){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,n,a,h){const u=this.expression.evaluate(new k(this.zoom),r,{},a,[],h),f=this.expression.evaluate(new k(this.zoom+1),r,{},a,[],h),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,u,f)}updatePaintArray(e,r,n,a){const h=this.expression.evaluate({zoom:this.zoom},n,a),u=this.expression.evaluate({zoom:this.zoom+1},n,a);this._setPaintValue(e,r,h,u)}_setPaintValue(e,r,n,a){if(this.type==="color"){const h=_c(n),u=_c(a);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,h[0],h[1],u[0],u[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=Be(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(a)}getBinding(e,r,n){return new Ml(e,r)}}class Bn{constructor(e,r,n,a,h,u,f){this.expression=e,this.type=n,this.useIntegerZoom=a,this.zoom=h,this.layerId=f,this.paintVertexAttributes=(n==="array"?Sp:Ep).members;for(let m=0;m<r.length;++m);this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u}populatePaintArray(e,r,n){const a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(a,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,a,h){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],h)}_setPaintValues(e,r,n,a){if(!a||!n)return;const{min:h,mid:u,max:f}=n,m=a[h],g=a[u],x=a[f];if(m&&g&&x)for(let b=e;b<r;b++)this._setPaintValue(this.zoomInPaintVertexArray,b,g,m),this._setPaintValue(this.zoomOutPaintVertexArray,b,g,x)}_setPaintValue(e,r,n,a){e.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],n.pixelRatio,a.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class sn{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const h in e.paint._values){if(!n(h))continue;const u=e.paint.get(h);if(!(u instanceof H&&Br(u.property.specification)))continue;const f=kp(h,e.type),m=u.value,g=u.property.specification.type,x=u.property.useIntegerZoom,b=u.property.specification["property-type"],T=b==="cross-faded"||b==="cross-faded-data-driven",I=String(h)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(m.kind!=="constant"||I)if(m.kind==="source"||I||T){const M=Eh(h,g,"source");this.binders[h]=T?new Bn(m,f,g,x,r,M,e.id):new on(m,f,g,M),a.push(`/a_${h}`)}else{const M=Eh(h,g,"composite");this.binders[h]=new br(m,f,g,x,r,M),a.push(`/z_${h}`)}else this.binders[h]=T?new ms(m.value,f):new ca(m.value,f,g),a.push(`/u_${h}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof on||r instanceof br?r.maxValue:0}populatePaintArrays(e,r,n,a,h){for(const u in this.binders){const f=this.binders[u];(f instanceof on||f instanceof br||f instanceof Bn)&&f.populatePaintArray(e,r,n,a,h)}}setConstantPatternPositions(e,r){for(const n in this.binders){const a=this.binders[n];a instanceof ms&&a.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,a,h){let u=!1;for(const f in e){const m=r.getPositions(f);for(const g of m){const x=n.feature(g.index);for(const b in this.binders){const T=this.binders[b];if((T instanceof on||T instanceof br||T instanceof Bn)&&T.expression.isStateDependent===!0){const I=a.paint.get(b);T.expression=I.value,T.updatePaintArray(g.start,g.end,x,e[f],h),u=!0}}}}return u}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof ca||n instanceof ms)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof on||n instanceof br||n instanceof Bn)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof ca||n instanceof ms||n instanceof br)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const n=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof ca||h instanceof ms||h instanceof br){for(const u of h.uniformNames)if(r[u]){const f=h.getBinding(e,r[u],u);n.push({name:u,property:a,binding:f})}}}return n}setUniforms(e,r,n,a){for(const{name:h,property:u,binding:f}of r)this.binders[u].setUniform(f,a,n.get(u),h)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(e&&n instanceof Bn){const a=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(n instanceof on||n instanceof br)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof on||n instanceof br||n instanceof Bn)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof on||r instanceof br||r instanceof Bn)&&r.destroy()}}}class xo{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new sn(a,r,n);this.needsUpload=!1,this._featureMap=new Al,this._bufferOffset=0}populatePaintArrays(e,r,n,a,h,u){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,a,h,u);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,a){for(const h of n)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,a)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const zp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function kp(i,e){return zp[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Pp={"line-pattern":{source:Ct,composite:Ct},"fill-pattern":{source:Ct,composite:Ct},"fill-extrusion-pattern":{source:Ct,composite:Ct},"line-dasharray":{source:Kt,composite:Kt}},Dp={color:{source:xt,composite:aa},number:{source:Gt,composite:xt}};function Eh(i,e,r){const n=Pp[i];return n&&n[r]||Dp[e][r]}Ze("ConstantBinder",ca),Ze("CrossFadedConstantBinder",ms),Ze("SourceExpressionBinder",on),Ze("CrossFadedCompositeBinder",Bn),Ze("CompositeExpressionBinder",br),Ze("ProgramConfiguration",sn,{omit:["_buffers"]}),Ze("ProgramConfigurationSet",xo);const zl="-transition";class wr extends Ke{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new $(r.layout)),r.paint)){this._transitionablePaint=new Z(r.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new re(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(fc,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return et(e,zl)?this._transitionablePaint.getTransition(e.slice(0,-zl.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(cl,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(et(e,zl))return this._transitionablePaint.setTransition(e.slice(0,-zl.length),r||void 0),!1;{const a=this._transitionablePaint._values[e],h=a.property.specification["property-type"]==="cross-faded-data-driven",u=a.value.isDataDriven(),f=a.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const m=this._transitionablePaint._values[e].value;return m.isDataDriven()||u||h||this._handleOverridablePaintPropertyUpdate(e,f,m)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),at(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,a,h={}){return(!h||h.validate!==!1)&&as(this,e.call(xr,{key:r,layerType:this.type,objectKey:n,value:a,styleSpec:Y,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof H&&Br(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Lp=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rp}=Lp;class Si{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,a){let h=this.segments[this.segments.length-1];return e>Si.MAX_VERTEX_ARRAY_LENGTH&&zt(`Max vertices per segment is ${Si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>Si.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==a)&&(h={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},a!==void 0&&(h.sortKey=a),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,a){return new Si([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}Si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze("SegmentVector",Si);var Rt=8192;const gc=Math.pow(2,14)-1,Sh=-gc-1;function vo(i){const e=Rt/i.extent,r=i.loadGeometry();for(let n=0;n<r.length;n++){const a=r[n];for(let h=0;h<a.length;h++){const u=a[h],f=Math.round(u.x*e),m=Math.round(u.y*e);u.x=Be(f,Sh,gc),u.y=Be(m,Sh,gc),(f<u.x||f>u.x+1||m<u.y||m>u.y+1)&&zt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function bo(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?vo(i):[]}}function kl(i,e,r,n,a){i.emplaceBack(2*e+(n+1)/2,2*r+(a+1)/2)}class yc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new St,this.indexArray=new vt,this.segments=new Si,this.programConfigurations=new xo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n){const a=this.layers[0],h=[];let u=null;a.type==="circle"&&(u=a.layout.get("circle-sort-key"));for(const{feature:f,id:m,index:g,sourceLayerIndex:x}of e){const b=this.layers[0]._featureFilter.needGeometry,T=bo(f,b);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),T,n))continue;const I=u?u.evaluate(T,{},n):void 0,M={id:m,properties:f.properties,type:f.type,sourceLayerIndex:x,index:g,geometry:b?T.geometry:vo(f),patterns:{},sortKey:I};h.push(M)}u&&h.sort((f,m)=>f.sortKey-m.sortKey);for(const f of h){const{geometry:m,index:g,sourceLayerIndex:x}=f,b=e[g].feature;this.addFeature(f,m,g,n),r.featureIndex.insert(b,m,g,x,this.index)}}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,a){for(const h of r)for(const u of h){const f=u.x,m=u.y;if(f<0||f>=Rt||m<0||m>=Rt)continue;const g=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),x=g.vertexLength;kl(this.layoutVertexArray,f,m,-1,-1),kl(this.layoutVertexArray,f,m,1,-1),kl(this.layoutVertexArray,f,m,1,1),kl(this.layoutVertexArray,f,m,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+3,x+2),g.vertexLength+=4,g.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a)}}function Ih(i,e){for(let r=0;r<i.length;r++)if(_s(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(_s(i,e[r]))return!0;return!!xc(i,e)}function Bp(i,e,r){return!!_s(i,e)||!!vc(e,i,r)}function Ah(i,e){if(i.length===1)return Mh(e,i[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let a=0;a<n.length;a++)if(_s(i,n[a]))return!0}for(let r=0;r<i.length;r++)if(Mh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(xc(i,e[r]))return!0;return!1}function Fp(i,e,r){if(i.length>1){if(xc(i,e))return!0;for(let n=0;n<e.length;n++)if(vc(e[n],i,r))return!0}for(let n=0;n<i.length;n++)if(vc(i[n],e,r))return!0;return!1}function xc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const n=i[r],a=i[r+1];for(let h=0;h<e.length-1;h++)if(Op(n,a,e[h],e[h+1]))return!0}return!1}function Op(i,e,r,n){return hi(i,r,n)!==hi(e,r,n)&&hi(i,e,r)!==hi(i,e,n)}function vc(i,e,r){const n=r*r;if(e.length===1)return i.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(Ch(i,e[a-1],e[a])<n)return!0;return!1}function Ch(i,e,r){const n=e.distSqr(r);if(n===0)return i.distSqr(e);const a=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/n;return i.distSqr(a<0?e:a>1?r:r.sub(e)._mult(a)._add(e))}function Mh(i,e){let r,n,a,h=!1;for(let u=0;u<i.length;u++){r=i[u];for(let f=0,m=r.length-1;f<r.length;m=f++)n=r[f],a=r[m],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(h=!h)}return h}function _s(i,e){let r=!1;for(let n=0,a=i.length-1;n<i.length;a=n++){const h=i[n],u=i[a];h.y>e.y!=u.y>e.y&&e.x<(u.x-h.x)*(e.y-h.y)/(u.y-h.y)+h.x&&(r=!r)}return r}function zh(i,e,r,n,a){for(const u of i)if(e<=u.x&&r<=u.y&&n>=u.x&&a>=u.y)return!0;const h=[new X(e,r),new X(e,a),new X(n,a),new X(n,r)];if(i.length>2){for(const u of h)if(_s(i,u))return!0}for(let u=0;u<i.length-1;u++)if(Up(i[u],i[u+1],h))return!0;return!1}function Up(i,e,r){const n=r[0],a=r[2];if(i.x<n.x&&e.x<n.x||i.x>a.x&&e.x>a.x||i.y<n.y&&e.y<n.y||i.y>a.y&&e.y>a.y)return!1;const h=hi(i,e,r[0]);return h!==hi(i,e,r[1])||h!==hi(i,e,r[2])||h!==hi(i,e,r[3])}function ha(i,e,r){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Pl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function kh(i,e,r,n,a){if(!e[0]&&!e[1])return i;const h=X.convert(e)._mult(a);r==="viewport"&&h._rotate(-n);const u=[];for(let f=0;f<i.length;f++)u.push(i[f].sub(h));return u}function Ph(i,e,r,n){const a=X.convert(i)._mult(n);return e==="viewport"&&a._rotate(-r),a}Ze("CircleBucket",yc,{omit:["layers"]});const Vp=new ke({"circle-sort-key":new oe(Y.layout_circle["circle-sort-key"])});var Np={paint:new ke({"circle-radius":new oe(Y.paint_circle["circle-radius"]),"circle-color":new oe(Y.paint_circle["circle-color"]),"circle-blur":new oe(Y.paint_circle["circle-blur"]),"circle-opacity":new oe(Y.paint_circle["circle-opacity"]),"circle-translate":new N(Y.paint_circle["circle-translate"]),"circle-translate-anchor":new N(Y.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new N(Y.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new N(Y.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new oe(Y.paint_circle["circle-stroke-width"]),"circle-stroke-color":new oe(Y.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new oe(Y.paint_circle["circle-stroke-opacity"])}),layout:Vp},Xi=typeof Float32Array!="undefined"?Float32Array:Array;function Dh(){var i=new Xi(9);return Xi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function bc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Lh(i,e,r){var n=e[0],a=e[1],h=e[2],u=e[3],f=e[4],m=e[5],g=e[6],x=e[7],b=e[8],T=e[9],I=e[10],M=e[11],L=e[12],q=e[13],K=e[14],ne=e[15],ce=r[0],ue=r[1],he=r[2],pe=r[3];return i[0]=ce*n+ue*f+he*b+pe*L,i[1]=ce*a+ue*m+he*T+pe*q,i[2]=ce*h+ue*g+he*I+pe*K,i[3]=ce*u+ue*x+he*M+pe*ne,i[4]=(ce=r[4])*n+(ue=r[5])*f+(he=r[6])*b+(pe=r[7])*L,i[5]=ce*a+ue*m+he*T+pe*q,i[6]=ce*h+ue*g+he*I+pe*K,i[7]=ce*u+ue*x+he*M+pe*ne,i[8]=(ce=r[8])*n+(ue=r[9])*f+(he=r[10])*b+(pe=r[11])*L,i[9]=ce*a+ue*m+he*T+pe*q,i[10]=ce*h+ue*g+he*I+pe*K,i[11]=ce*u+ue*x+he*M+pe*ne,i[12]=(ce=r[12])*n+(ue=r[13])*f+(he=r[14])*b+(pe=r[15])*L,i[13]=ce*a+ue*m+he*T+pe*q,i[14]=ce*h+ue*g+he*I+pe*K,i[15]=ce*u+ue*x+he*M+pe*ne,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Gp=Lh;function Dl(){var i=new Xi(3);return Xi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Rh(i){return Math.hypot(i[0],i[1],i[2])}function gs(i,e,r){var n=new Xi(3);return n[0]=i,n[1]=e,n[2]=r,n}function Bh(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function Fh(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function Oh(i,e,r,n){return i[0]=e[0]+r[0]*n,i[1]=e[1]+r[1]*n,i[2]=e[2]+r[2]*n,i}function Uh(i,e){var r=e[0],n=e[1],a=e[2],h=r*r+n*n+a*a;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i}function Vh(i,e,r){var n=r[0],a=r[1],h=r[2],u=e[0],f=e[1],m=e[2],g=a*m-h*f,x=h*u-n*m,b=n*f-a*u,T=a*b-h*x,I=h*g-n*b,M=n*x-a*g,L=2*r[3];return x*=L,b*=L,I*=2,M*=2,i[0]=u+(g*=L)+(T*=2),i[1]=f+x+I,i[2]=m+b+M,i}var ua,qp=Bh,$p=Fh,jp=Rh;function pa(i,e,r){var n=e[0],a=e[1],h=e[2],u=e[3];return i[0]=r[0]*n+r[4]*a+r[8]*h+r[12]*u,i[1]=r[1]*n+r[5]*a+r[9]*h+r[13]*u,i[2]=r[2]*n+r[6]*a+r[10]*h+r[14]*u,i[3]=r[3]*n+r[7]*a+r[11]*h+r[15]*u,i}function wc(){var i=new Xi(4);return Xi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Nh(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Gh(i,e,r){r*=.5;var n=e[0],a=e[1],h=e[2],u=e[3],f=Math.sin(r),m=Math.cos(r);return i[0]=n*m+u*f,i[1]=a*m+h*f,i[2]=h*m-a*f,i[3]=u*m-n*f,i}function Zp(i,e,r){const n=pa([],[i.x,i.y,e,1],r);return new X(n[0]/n[3],n[1]/n[3])}Dl(),ua=new Xi(4),Xi!=Float32Array&&(ua[0]=0,ua[1]=0,ua[2]=0,ua[3]=0),Dl(),gs(1,0,0),gs(0,1,0),wc(),wc(),Dh();const qh=gs(0,0,0),Xp=gs(0,0,1);function Wp(i,e){const r=Dl();return qh[2]=e,i.intersectsPlane(qh,Xp,r),new X(r[0],r[1])}class $h extends yc{}function Tc(i,{width:e,height:r},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*r*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*r*n);return i.width=e,i.height=r,i.data=a,i}function jh(i,{width:e,height:r},n){if(e===i.width&&r===i.height)return;const a=Tc({},{width:e,height:r},n);Ec(i,a,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},n),i.width=e,i.height=r,i.data=a.data}function Ec(i,e,r,n,a,h){if(a.width===0||a.height===0)return e;if(a.width>i.width||a.height>i.height||r.x>i.width-a.width||r.y>i.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const u=i.data,f=e.data;for(let m=0;m<a.height;m++){const g=((r.y+m)*i.width+r.x)*h,x=((n.y+m)*e.width+n.x)*h;for(let b=0;b<a.width*h;b++)f[x+b]=u[g+b]}return e}Ze("HeatmapBucket",$h,{omit:["layers"]});class Fn{constructor(e,r){Tc(this,e,1,r)}resize(e){jh(this,e,1)}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,h){Ec(e,r,n,a,h,1)}}class or{constructor(e,r){Tc(this,e,4,r)}resize(e){jh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new or({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,h){Ec(e,r,n,a,h,4)}}Ze("AlphaImage",Fn),Ze("RGBAImage",or);var Hp={paint:new ke({"heatmap-radius":new oe(Y.paint_heatmap["heatmap-radius"]),"heatmap-weight":new oe(Y.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new N(Y.paint_heatmap["heatmap-intensity"]),"heatmap-color":new j(Y.paint_heatmap["heatmap-color"]),"heatmap-opacity":new N(Y.paint_heatmap["heatmap-opacity"])})};function Sc(i){const e={},r=i.resolution||256,n=i.clips?i.clips.length:1,a=i.image||new or({width:r,height:n}),h=(u,f,m)=>{e[i.evaluationKey]=m;const g=i.expression.evaluate(e);a.data[u+f+0]=Math.floor(255*g.r/g.a),a.data[u+f+1]=Math.floor(255*g.g/g.a),a.data[u+f+2]=Math.floor(255*g.b/g.a),a.data[u+f+3]=Math.floor(255*g.a)};if(i.clips)for(let u=0,f=0;u<n;++u,f+=4*r)for(let m=0,g=0;m<r;m++,g+=4){const x=m/(r-1),{start:b,end:T}=i.clips[u];h(f,g,b*(1-x)+T*x)}else for(let u=0,f=0;u<r;u++,f+=4)h(0,f,u/(r-1));return a}var Kp={paint:new ke({"hillshade-illumination-direction":new N(Y.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new N(Y.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new N(Y.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new N(Y.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new N(Y.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new N(Y.paint_hillshade["hillshade-accent-color"])})};const Yp=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jp}=Yp;var Ic=Ll,Qp=Ll;function Ll(i,e,r){r=r||2;var n,a,h,u,f,m,g,x=e&&e.length,b=x?e[0]*r:i.length,T=Zh(i,0,b,r,!0),I=[];if(!T||T.next===T.prev)return I;if(x&&(T=function(L,q,K,ne){var ce,ue,he,pe=[];for(ce=0,ue=q.length;ce<ue;ce++)(he=Zh(L,q[ce]*ne,ce<ue-1?q[ce+1]*ne:L.length,ne,!1))===he.next&&(he.steiner=!0),pe.push(ad(he));for(pe.sort(nd),ce=0;ce<pe.length;ce++)od(pe[ce],K),K=On(K,K.next);return K}(i,e,T,r)),i.length>80*r){n=h=i[0],a=u=i[1];for(var M=r;M<b;M+=r)(f=i[M])<n&&(n=f),(m=i[M+1])<a&&(a=m),f>h&&(h=f),m>u&&(u=m);g=(g=Math.max(h-n,u-a))!==0?1/g:0}return da(T,I,r,n,a,g),I}function Zh(i,e,r,n,a){var h,u;if(a===Mc(i,e,r,n)>0)for(h=e;h<r;h+=n)u=Hh(h,i[h],i[h+1],u);else for(h=r-n;h>=e;h-=n)u=Hh(h,i[h],i[h+1],u);return u&&Rl(u,u.next)&&(ma(u),u=u.next),u}function On(i,e){if(!i)return i;e||(e=i);var r,n=i;do if(r=!1,n.steiner||!Rl(n,n.next)&&oi(n.prev,n,n.next)!==0)n=n.next;else{if(ma(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function da(i,e,r,n,a,h,u){if(i){!u&&h&&function(x,b,T,I){var M=x;do M.z===null&&(M.z=Ac(M.x,M.y,b,T,I)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==x);M.prevZ.nextZ=null,M.prevZ=null,function(L){var q,K,ne,ce,ue,he,pe,Le,Ae=1;do{for(K=L,L=null,ue=null,he=0;K;){for(he++,ne=K,pe=0,q=0;q<Ae&&(pe++,ne=ne.nextZ);q++);for(Le=Ae;pe>0||Le>0&&ne;)pe!==0&&(Le===0||!ne||K.z<=ne.z)?(ce=K,K=K.nextZ,pe--):(ce=ne,ne=ne.nextZ,Le--),ue?ue.nextZ=ce:L=ce,ce.prevZ=ue,ue=ce;K=ne}ue.nextZ=null,Ae*=2}while(he>1)}(M)}(i,n,a,h);for(var f,m,g=i;i.prev!==i.next;)if(f=i.prev,m=i.next,h?td(i,n,a,h):ed(i))e.push(f.i/r),e.push(i.i/r),e.push(m.i/r),ma(i),i=m.next,g=m.next;else if((i=m)===g){u?u===1?da(i=id(On(i),e,r),e,r,n,a,h,2):u===2&&rd(i,e,r,n,a,h):da(On(i),e,r,n,a,h,1);break}}}function ed(i){var e=i.prev,r=i,n=i.next;if(oi(e,r,n)>=0)return!1;for(var a=i.next.next;a!==i.prev;){if(ys(e.x,e.y,r.x,r.y,n.x,n.y,a.x,a.y)&&oi(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function td(i,e,r,n){var a=i.prev,h=i,u=i.next;if(oi(a,h,u)>=0)return!1;for(var f=a.x>h.x?a.x>u.x?a.x:u.x:h.x>u.x?h.x:u.x,m=a.y>h.y?a.y>u.y?a.y:u.y:h.y>u.y?h.y:u.y,g=Ac(a.x<h.x?a.x<u.x?a.x:u.x:h.x<u.x?h.x:u.x,a.y<h.y?a.y<u.y?a.y:u.y:h.y<u.y?h.y:u.y,e,r,n),x=Ac(f,m,e,r,n),b=i.prevZ,T=i.nextZ;b&&b.z>=g&&T&&T.z<=x;){if(b!==i.prev&&b!==i.next&&ys(a.x,a.y,h.x,h.y,u.x,u.y,b.x,b.y)&&oi(b.prev,b,b.next)>=0||(b=b.prevZ,T!==i.prev&&T!==i.next&&ys(a.x,a.y,h.x,h.y,u.x,u.y,T.x,T.y)&&oi(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;b&&b.z>=g;){if(b!==i.prev&&b!==i.next&&ys(a.x,a.y,h.x,h.y,u.x,u.y,b.x,b.y)&&oi(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;T&&T.z<=x;){if(T!==i.prev&&T!==i.next&&ys(a.x,a.y,h.x,h.y,u.x,u.y,T.x,T.y)&&oi(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function id(i,e,r){var n=i;do{var a=n.prev,h=n.next.next;!Rl(a,h)&&Xh(a,n,n.next,h)&&fa(a,h)&&fa(h,a)&&(e.push(a.i/r),e.push(n.i/r),e.push(h.i/r),ma(n),ma(n.next),n=i=h),n=n.next}while(n!==i);return On(n)}function rd(i,e,r,n,a,h){var u=i;do{for(var f=u.next.next;f!==u.prev;){if(u.i!==f.i&&ld(u,f)){var m=Wh(u,f);return u=On(u,u.next),m=On(m,m.next),da(u,e,r,n,a,h),void da(m,e,r,n,a,h)}f=f.next}u=u.next}while(u!==i)}function nd(i,e){return i.x-e.x}function od(i,e){if(e=function(n,a){var h,u=a,f=n.x,m=n.y,g=-1/0;do{if(m<=u.y&&m>=u.next.y&&u.next.y!==u.y){var x=u.x+(m-u.y)*(u.next.x-u.x)/(u.next.y-u.y);if(x<=f&&x>g){if(g=x,x===f){if(m===u.y)return u;if(m===u.next.y)return u.next}h=u.x<u.next.x?u:u.next}}u=u.next}while(u!==a);if(!h)return null;if(f===g)return h;var b,T=h,I=h.x,M=h.y,L=1/0;u=h;do f>=u.x&&u.x>=I&&f!==u.x&&ys(m<M?f:g,m,I,M,m<M?g:f,m,u.x,u.y)&&(b=Math.abs(m-u.y)/(f-u.x),fa(u,n)&&(b<L||b===L&&(u.x>h.x||u.x===h.x&&sd(h,u)))&&(h=u,L=b)),u=u.next;while(u!==T);return h}(i,e)){var r=Wh(e,i);On(e,e.next),On(r,r.next)}}function sd(i,e){return oi(i.prev,i,e.prev)<0&&oi(e.next,i,i.next)<0}function Ac(i,e,r,n,a){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*a)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ad(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ys(i,e,r,n,a,h,u,f){return(a-u)*(e-f)-(i-u)*(h-f)>=0&&(i-u)*(n-f)-(r-u)*(e-f)>=0&&(r-u)*(h-f)-(a-u)*(n-f)>=0}function ld(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,n){var a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==n.i&&a.next.i!==n.i&&Xh(a,a.next,r,n))return!0;a=a.next}while(a!==r);return!1}(i,e)&&(fa(i,e)&&fa(e,i)&&function(r,n){var a=r,h=!1,u=(r.x+n.x)/2,f=(r.y+n.y)/2;do a.y>f!=a.next.y>f&&a.next.y!==a.y&&u<(a.next.x-a.x)*(f-a.y)/(a.next.y-a.y)+a.x&&(h=!h),a=a.next;while(a!==r);return h}(i,e)&&(oi(i.prev,i,e.prev)||oi(i,e.prev,e))||Rl(i,e)&&oi(i.prev,i,i.next)>0&&oi(e.prev,e,e.next)>0)}function oi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Rl(i,e){return i.x===e.x&&i.y===e.y}function Xh(i,e,r,n){var a=Fl(oi(i,e,r)),h=Fl(oi(i,e,n)),u=Fl(oi(r,n,i)),f=Fl(oi(r,n,e));return a!==h&&u!==f||!(a!==0||!Bl(i,r,e))||!(h!==0||!Bl(i,n,e))||!(u!==0||!Bl(r,i,n))||!(f!==0||!Bl(r,e,n))}function Bl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Fl(i){return i>0?1:i<0?-1:0}function fa(i,e){return oi(i.prev,i,i.next)<0?oi(i,e,i.next)>=0&&oi(i,i.prev,e)>=0:oi(i,e,i.prev)<0||oi(i,i.next,e)<0}function Wh(i,e){var r=new Cc(i.i,i.x,i.y),n=new Cc(e.i,e.x,e.y),a=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=a,a.prev=r,n.next=r,r.prev=n,h.next=n,n.prev=h,n}function Hh(i,e,r,n){var a=new Cc(i,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function ma(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Cc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mc(i,e,r,n){for(var a=0,h=e,u=r-n;h<r;h+=n)a+=(i[u]-i[h])*(i[h+1]+i[u+1]),u=h;return a}function cd(i,e,r,n,a){Kh(i,e,r||0,n||i.length-1,a||hd)}function Kh(i,e,r,n,a){for(;n>r;){if(n-r>600){var h=n-r+1,u=e-r+1,f=Math.log(h),m=.5*Math.exp(2*f/3),g=.5*Math.sqrt(f*m*(h-m)/h)*(u-h/2<0?-1:1);Kh(i,e,Math.max(r,Math.floor(e-u*m/h+g)),Math.min(n,Math.floor(e+(h-u)*m/h+g)),a)}var x=i[e],b=r,T=n;for(_a(i,r,e),a(i[n],x)>0&&_a(i,r,n);b<T;){for(_a(i,b,T),b++,T--;a(i[b],x)<0;)b++;for(;a(i[T],x)>0;)T--}a(i[r],x)===0?_a(i,r,T):_a(i,++T,n),T<=e&&(r=T+1),e<=T&&(n=T-1)}}function _a(i,e,r){var n=i[e];i[e]=i[r],i[r]=n}function hd(i,e){return i<e?-1:i>e?1:0}function zc(i,e){const r=i.length;if(r<=1)return[i];const n=[];let a,h;for(let u=0;u<r;u++){const f=Ji(i[u]);f!==0&&(i[u].area=Math.abs(f),h===void 0&&(h=f<0),h===f<0?(a&&n.push(a),a=[i[u]]):a.push(i[u]))}if(a&&n.push(a),e>1)for(let u=0;u<n.length;u++)n[u].length<=e||(cd(n[u],e,1,n[u].length-1,ud),n[u]=n[u].slice(0,e));return n}function ud(i,e){return e.area-i.area}function kc(i,e,r){const n=r.patternDependencies;let a=!1;for(const h of e){const u=h.paint.get(`${i}-pattern`);u.isConstant()||(a=!0);const f=u.constantOr(null);f&&(a=!0,n[f.to]=!0,n[f.from]=!0)}return a}function Pc(i,e,r,n,a){const h=a.patternDependencies;for(const u of e){const f=u.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let m=f.evaluate({zoom:n-1},r,{},a.availableImages),g=f.evaluate({zoom:n},r,{},a.availableImages),x=f.evaluate({zoom:n+1},r,{},a.availableImages);m=m&&m.name?m.name:m,g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,h[m]=!0,h[g]=!0,h[x]=!0,r.patterns[u.id]={min:m,mid:g,max:x}}}return r}Ll.deviation=function(i,e,r,n){var a=e&&e.length,h=Math.abs(Mc(i,0,a?e[0]*r:i.length,r));if(a)for(var u=0,f=e.length;u<f;u++)h-=Math.abs(Mc(i,e[u]*r,u<f-1?e[u+1]*r:i.length,r));var m=0;for(u=0;u<n.length;u+=3){var g=n[u]*r,x=n[u+1]*r,b=n[u+2]*r;m+=Math.abs((i[g]-i[b])*(i[x+1]-i[g+1])-(i[g]-i[x])*(i[b+1]-i[g+1]))}return h===0&&m===0?0:Math.abs((m-h)/h)},Ll.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<i.length;a++){for(var h=0;h<i[a].length;h++)for(var u=0;u<e;u++)r.vertices.push(i[a][h][u]);a>0&&r.holes.push(n+=i[a-1].length)}return r},Ic.default=Qp;class Dc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new St,this.indexArray=new vt,this.indexArray2=new pi,this.programConfigurations=new xo(e.layers,e.zoom),this.segments=new Si,this.segments2=new Si,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n){this.hasPattern=kc("fill",this.layers,r);const a=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:u,id:f,index:m,sourceLayerIndex:g}of e){const x=this.layers[0]._featureFilter.needGeometry,b=bo(u,x);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),b,n))continue;const T=a?a.evaluate(b,{},n,r.availableImages):void 0,I={id:f,properties:u.properties,type:u.type,sourceLayerIndex:g,index:m,geometry:x?b.geometry:vo(u),patterns:{},sortKey:T};h.push(I)}a&&h.sort((u,f)=>u.sortKey-f.sortKey);for(const u of h){const{geometry:f,index:m,sourceLayerIndex:g}=u;if(this.hasPattern){const x=Pc("fill",this.layers,u,this.zoom,r);this.patternFeatures.push(x)}else this.addFeature(u,f,m,n,{});r.featureIndex.insert(e[m].feature,f,m,g,this.index)}}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}addFeatures(e,r,n){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,a,h){for(const u of zc(r,500)){let f=0;for(const I of u)f+=I.length;const m=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),g=m.vertexLength,x=[],b=[];for(const I of u){if(I.length===0)continue;I!==u[0]&&b.push(x.length/2);const M=this.segments2.prepareSegment(I.length,this.layoutVertexArray,this.indexArray2),L=M.vertexLength;this.layoutVertexArray.emplaceBack(I[0].x,I[0].y),this.indexArray2.emplaceBack(L+I.length-1,L),x.push(I[0].x),x.push(I[0].y);for(let q=1;q<I.length;q++)this.layoutVertexArray.emplaceBack(I[q].x,I[q].y),this.indexArray2.emplaceBack(L+q-1,L+q),x.push(I[q].x),x.push(I[q].y);M.vertexLength+=I.length,M.primitiveLength+=I.length}const T=Ic(x,b);for(let I=0;I<T.length;I+=3)this.indexArray.emplaceBack(g+T[I],g+T[I+1],g+T[I+2]);m.vertexLength+=f,m.primitiveLength+=T.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,h,a)}}Ze("FillBucket",Dc,{omit:["layers","patternFeatures"]});const pd=new ke({"fill-sort-key":new oe(Y.layout_fill["fill-sort-key"])});var dd={paint:new ke({"fill-antialias":new N(Y.paint_fill["fill-antialias"]),"fill-opacity":new oe(Y.paint_fill["fill-opacity"]),"fill-color":new oe(Y.paint_fill["fill-color"]),"fill-outline-color":new oe(Y.paint_fill["fill-outline-color"]),"fill-translate":new N(Y.paint_fill["fill-translate"]),"fill-translate-anchor":new N(Y.paint_fill["fill-translate-anchor"]),"fill-pattern":new ve(Y.paint_fill["fill-pattern"])}),layout:pd};const fd=He([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),md=He([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:_d}=fd;var Yh=xs;function xs(i,e,r,n,a){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=a,i.readFields(gd,this,e)}function gd(i,e,r){i==1?e.id=r.readVarint():i==2?function(n,a){for(var h=n.readVarint()+n.pos;n.pos<h;){var u=a._keys[n.readVarint()],f=a._values[n.readVarint()];a.properties[u]=f}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function yd(i){for(var e,r,n=0,a=0,h=i.length,u=h-1;a<h;u=a++)n+=((r=i[u]).x-(e=i[a]).x)*(e.y+r.y);return n}xs.types=["Unknown","Point","LineString","Polygon"],xs.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,n=1,a=0,h=0,u=0,f=[];i.pos<r;){if(a<=0){var m=i.readVarint();n=7&m,a=m>>3}if(a--,n===1||n===2)h+=i.readSVarint(),u+=i.readSVarint(),n===1&&(e&&f.push(e),e=[]),e.push(new X(h,u));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&f.push(e),f},xs.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,n=0,a=0,h=0,u=1/0,f=-1/0,m=1/0,g=-1/0;i.pos<e;){if(n<=0){var x=i.readVarint();r=7&x,n=x>>3}if(n--,r===1||r===2)(a+=i.readSVarint())<u&&(u=a),a>f&&(f=a),(h+=i.readSVarint())<m&&(m=h),h>g&&(g=h);else if(r!==7)throw new Error("unknown command "+r)}return[u,m,f,g]},xs.prototype.toGeoJSON=function(i,e,r){var n,a,h=this.extent*Math.pow(2,r),u=this.extent*i,f=this.extent*e,m=this.loadGeometry(),g=xs.types[this.type];function x(I){for(var M=0;M<I.length;M++){var L=I[M];I[M]=[360*(L.x+u)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+f)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var b=[];for(n=0;n<m.length;n++)b[n]=m[n][0];x(m=b);break;case 2:for(n=0;n<m.length;n++)x(m[n]);break;case 3:for(m=function(I){var M=I.length;if(M<=1)return[I];for(var L,q,K=[],ne=0;ne<M;ne++){var ce=yd(I[ne]);ce!==0&&(q===void 0&&(q=ce<0),q===ce<0?(L&&K.push(L),L=[I[ne]]):L.push(I[ne]))}return L&&K.push(L),K}(m),n=0;n<m.length;n++)for(a=0;a<m[n].length;a++)x(m[n][a])}m.length===1?m=m[0]:g="Multi"+g;var T={type:"Feature",geometry:{type:g,coordinates:m},properties:this.properties};return"id"in this&&(T.id=this.id),T};var Jh=Qh;function Qh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(xd,this,e),this.length=this._features.length}function xd(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(n){for(var a=null,h=n.readVarint()+n.pos;n.pos<h;){var u=n.readVarint()>>3;a=u===1?n.readString():u===2?n.readFloat():u===3?n.readDouble():u===4?n.readVarint64():u===5?n.readVarint():u===6?n.readSVarint():u===7?n.readBoolean():null}return a}(r))}function vd(i,e,r){if(i===3){var n=new Jh(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Qh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Yh(this._pbf,e,this.extent,this._keys,this._values)};var wo={VectorTile:function(i,e){this.layers=i.readFields(vd,{},e)},VectorTileFeature:Yh,VectorTileLayer:Jh};const eu=wo.VectorTileFeature.types,bd=Math.pow(2,13);function ga(i,e,r,n,a,h,u,f){i.emplaceBack((e<<1)+u,(r<<1)+h,(Math.floor(n*bd)<<1)+a,Math.round(f))}class tu{constructor(){this.acc=new X(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new X(e.x,e.y),this.max=new X(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let n=!!this.borders;const a=this.min,h=this.max;e.x<a.x?(a.x=e.x,n=!0):e.x>h.x&&(h.x=e.x,n=!0),e.y<a.y?(a.y=e.y,n=!0):e.y>h.y&&(h.y=e.y,n=!0),((e.x===0||e.x===Rt)&&e.x===r.x)!=((e.y===0||e.y===Rt)&&e.y===r.y)&&this.processBorderOverlap(e,r),n&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Mt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Rt!=e.x>Rt&&this.addBorderIntersection(1,Mt(r.y,e.y,(Rt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Mt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Rt!=e.y>Rt&&this.addBorderIntersection(3,Mt(r.x,e.x,(Rt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((r,n)=>r+n.edges,0);return e!==0?this.acc.div(e)._round():new X(0,0)}span(){return new X(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Lc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ut,this.centroidVertexArray=new xh,this.indexArray=new vt,this.programConfigurations=new xo(e.layers,e.zoom),this.segments=new Si,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,n){this.features=[],this.hasPattern=kc("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(a){const h=Math.exp(Math.PI*(1-a.y/(1<<a.z)*2));return 80150034*h/(h*h+1)/Rt/(1<<a.z)}(n);for(const{feature:a,id:h,index:u,sourceLayerIndex:f}of e){const m=this.layers[0]._featureFilter.needGeometry,g=bo(a,m);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),g,n))continue;const x={id:h,sourceLayerIndex:f,index:u,geometry:m?g.geometry:vo(a),properties:a.properties,type:a.type,patterns:{}},b=this.layoutVertexArray.length;this.hasPattern?this.features.push(Pc("fill-extrusion",this.layers,x,this.zoom,r)):this.addFeature(x,x.geometry,u,n,{}),r.featureIndex.insert(a,x.geometry,u,f,this.index,b)}this.sortBorders()}addFeatures(e,r,n){for(const a of this.features){const{geometry:h}=a;this.addFeature(a,h,a.index,r,n)}this.sortBorders()}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_d),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,md.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,a,h){const u=this.enableTerrain&&e.properties&&eu[e.type]==="Polygon"?new tu:null;for(const m of zc(r,500)){let g=0,x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(m.length===0||(f=m[0]).every(L=>L.x<=0)||f.every(L=>L.x>=Rt)||f.every(L=>L.y<=0)||f.every(L=>L.y>=Rt))continue;for(let L=0;L<m.length;L++){const q=m[L];if(q.length===0)continue;g+=q.length;let K=0;u&&u.startRing(q[0]);for(let ne=0;ne<q.length;ne++){const ce=q[ne];if(ne>=1){const ue=q[ne-1];if(!wd(ce,ue)){u&&u.append(ce,ue),x.vertexLength+4>Si.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const he=ce.sub(ue)._perp(),pe=he.x/(Math.abs(he.x)+Math.abs(he.y)),Le=he.y>0?1:0,Ae=ue.dist(ce);K+Ae>32768&&(K=0),ga(this.layoutVertexArray,ce.x,ce.y,pe,Le,0,0,K),ga(this.layoutVertexArray,ce.x,ce.y,pe,Le,0,1,K),K+=Ae,ga(this.layoutVertexArray,ue.x,ue.y,pe,Le,0,0,K),ga(this.layoutVertexArray,ue.x,ue.y,pe,Le,0,1,K);const Me=x.vertexLength;this.indexArray.emplaceBack(Me,Me+2,Me+1),this.indexArray.emplaceBack(Me+1,Me+2,Me+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+g>Si.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),eu[e.type]!=="Polygon")continue;const b=[],T=[],I=x.vertexLength;for(let L=0;L<m.length;L++){const q=m[L];if(q.length!==0){q!==m[0]&&T.push(b.length/2);for(let K=0;K<q.length;K++){const ne=q[K];ga(this.layoutVertexArray,ne.x,ne.y,0,0,1,1,0),b.push(ne.x),b.push(ne.y),u&&u.currentPolyCount.top++}}}const M=Ic(b,T);for(let L=0;L<M.length;L+=3)this.indexArray.emplaceBack(I+M[L],I+M[L+2],I+M[L+1]);x.primitiveLength+=M.length/3,x.vertexLength+=g}var f;if(u&&u.polyCount.length>0){if(u.borders){u.vertexArrayOffset=this.centroidVertexArray.length;const m=u.borders,g=this.featuresOnBorder.push(u)-1;for(let x=0;x<4;x++)m[x][0]!==Number.MAX_VALUE&&this.borders[x].push(g)}this.encodeCentroid(u.borders?void 0:u.centroid(),u)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,h,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,r,n=!0){let a,h;if(e)if(e.y!==0){const f=r.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(f.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(f.y/10))}else a=Math.ceil(7*(e.x+450)),h=0;else a=0,h=+n;let u=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(const f of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*f.edges+f.top);for(let m=0;m<2*f.edges;m++)this.centroidVertexArray.emplace(u++,0,h),this.centroidVertexArray.emplace(u++,a,h);for(let m=0;m<f.top;m++)this.centroidVertexArray.emplace(u++,a,h)}}}function wd(i,e){return i.x===e.x&&(i.x<0||i.x>Rt)||i.y===e.y&&(i.y<0||i.y>Rt)}Ze("FillExtrusionBucket",Lc,{omit:["layers","features"]}),Ze("PartMetadata",tu);var Td={paint:new ke({"fill-extrusion-opacity":new N(Y["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new oe(Y["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new N(Y["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new N(Y["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ve(Y["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new oe(Y["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new oe(Y["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new N(Y["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ya(i,e){return i.x*e.x+i.y*e.y}function iu(i,e){if(i.length===1){let r=0;const n=e[r++];let a;for(;!a||n.equals(a);)if(a=e[r++],!a)return 1/0;for(;r<e.length;r++){const h=e[r],u=i[0],f=a.sub(n),m=h.sub(n),g=u.sub(n),x=ya(f,f),b=ya(f,m),T=ya(m,m),I=ya(g,f),M=ya(g,m),L=x*T-b*b,q=(T*I-b*M)/L,K=(x*M-b*I)/L,ne=n.z*(1-q-K)+a.z*q+h.z*K;if(isFinite(ne))return ne}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function ru(i){const e=new X(i[0],i[1]);return e.z=i[2],e}function Ed(i,e,r,n,a,h,u,f){const m=u*a.getElevationAt(i,e,!0,!0),g=h[0]!==0,x=g?h[1]===0?u*(h[0]/7-450):u*function(b,T,I){const M=Math.floor(T[0]/8),L=Math.floor(T[1]/8),q=10*(T[0]-8*M),K=10*(T[1]-8*L),ne=b.getElevationAt(M,L,!0,!0),ce=b.getMeterToDEM(I),ue=Math.floor(.5*(q*ce-1)),he=Math.floor(.5*(K*ce-1)),pe=b.tileCoordToPixel(M,L),Le=2*ue+1,Ae=2*he+1,Me=function(Xe,tt,Bt,yt,qt){return[Xe.getElevationAtPixel(tt,Bt,!0),Xe.getElevationAtPixel(tt+qt,Bt,!0),Xe.getElevationAtPixel(tt,Bt+qt,!0),Xe.getElevationAtPixel(tt+yt,Bt+qt,!0)]}(b,pe.x-ue,pe.y-he,Le,Ae),Ue=Math.abs(Me[0]-Me[1]),Se=Math.abs(Me[2]-Me[3]),Re=Math.abs(Me[0]-Me[2])+Math.abs(Me[1]-Me[3]),Pe=Math.min(.25,.5*ce*(Ue+Se)/Le),Te=Math.min(.25,.5*ce*Re/Ae);return ne+Math.max(Pe*q,Te*K)}(a,h,f):m;return{base:m+(r===0)?-1:r,top:g?Math.max(x+n,m+r+2):m+n}}const Sd=He([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Id}=Sd,Ad=He([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Cd}=Ad,Md=wo.VectorTileFeature.types,zd=Math.cos(Math.PI/180*37.5);class Rc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new jt,this.layoutVertexArray2=new xt,this.indexArray=new vt,this.programConfigurations=new xo(e.layers,e.zoom),this.segments=new Si,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n){this.hasPattern=kc("line",this.layers,r);const a=this.layers[0].layout.get("line-sort-key"),h=[];for(const{feature:g,id:x,index:b,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,M=bo(g,I);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),M,n))continue;const L=a?a.evaluate(M,{},n):void 0,q={id:x,properties:g.properties,type:g.type,sourceLayerIndex:T,index:b,geometry:I?M.geometry:vo(g),patterns:{},sortKey:L};h.push(q)}a&&h.sort((g,x)=>g.sortKey-x.sortKey);const{lineAtlas:u,featureIndex:f}=r,m=this.addConstantDashes(u);for(const g of h){const{geometry:x,index:b,sourceLayerIndex:T}=g;if(m&&this.addFeatureDashes(g,u),this.hasPattern){const I=Pc("line",this.layers,g,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(g,x,b,n,u.positions);f.insert(e[b].feature,x,b,T,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,h=n.layout.get("line-cap").value;if(a.kind!=="constant"||h.kind!=="constant")r=!0;else{const u=h.value,f=a.value;if(!f)continue;e.addDash(f.from,u),e.addDash(f.to,u),f.other&&e.addDash(f.other,u)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,u=a.layout.get("line-cap").value;if(h.kind==="constant"&&u.kind==="constant")continue;let f,m,g,x,b,T;if(h.kind==="constant"){const q=h.value;if(!q)continue;f=q.other||q.to,m=q.to,g=q.from}else f=h.evaluate({zoom:n-1},e),m=h.evaluate({zoom:n},e),g=h.evaluate({zoom:n+1},e);u.kind==="constant"?x=b=T=u.value:(x=u.evaluate({zoom:n-1},e),b=u.evaluate({zoom:n},e),T=u.evaluate({zoom:n+1},e)),r.addDash(f,x),r.addDash(m,b),r.addDash(g,T);const I=r.getKey(f,x),M=r.getKey(m,b),L=r.getKey(g,T);e.patterns[a.id]={min:I,mid:M,max:L}}}update(e,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n)}addFeatures(e,r,n){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,r,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Cd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Id),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,a,h){const u=this.layers[0].layout,f=u.get("line-join").evaluate(e,{}),m=u.get("line-cap").evaluate(e,{}),g=u.get("line-miter-limit"),x=u.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const b of r)this.addLine(b,e,f,m,g,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,h,a)}addLine(e,r,n,a,h,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<e.length-1;K++)this.totalDistance+=e[K].dist(e[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=Md[r.type]==="Polygon";let m=e.length;for(;m>=2&&e[m-1].equals(e[m-2]);)m--;let g=0;for(;g<m-1&&e[g].equals(e[g+1]);)g++;if(m<(f?3:2))return;n==="bevel"&&(h=1.05);const x=this.overscaling<=16?122880/(512*this.overscaling):0,b=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let T,I,M,L,q;this.e1=this.e2=-1,f&&(T=e[m-2],q=e[g].sub(T)._unit()._perp());for(let K=g;K<m;K++){if(M=K===m-1?f?e[g+1]:void 0:e[K+1],M&&e[K].equals(M))continue;q&&(L=q),T&&(I=T),T=e[K],q=M?M.sub(T)._unit()._perp():L,L=L||q;let ne=L.add(q);ne.x===0&&ne.y===0||ne._unit();const ce=L.x*q.x+L.y*q.y,ue=ne.x*q.x+ne.y*q.y,he=ue!==0?1/ue:1/0,pe=2*Math.sqrt(2-2*ue),Le=ue<zd&&I&&M,Ae=L.x*q.y-L.y*q.x>0;if(Le&&K>g){const Se=T.dist(I);if(Se>2*x){const Re=T.sub(T.sub(I)._mult(x/Se)._round());this.updateDistance(I,Re),this.addCurrentVertex(Re,L,0,0,b),I=Re}}const Me=I&&M;let Ue=Me?n:f?"butt":a;if(Me&&Ue==="round"&&(he<u?Ue="miter":he<=2&&(Ue="fakeround")),Ue==="miter"&&he>h&&(Ue="bevel"),Ue==="bevel"&&(he>2&&(Ue="flipbevel"),he<h&&(Ue="miter")),I&&this.updateDistance(I,T),Ue==="miter")ne._mult(he),this.addCurrentVertex(T,ne,0,0,b);else if(Ue==="flipbevel"){if(he>100)ne=q.mult(-1);else{const Se=he*L.add(q).mag()/L.sub(q).mag();ne._perp()._mult(Se*(Ae?-1:1))}this.addCurrentVertex(T,ne,0,0,b),this.addCurrentVertex(T,ne.mult(-1),0,0,b)}else if(Ue==="bevel"||Ue==="fakeround"){const Se=-Math.sqrt(he*he-1),Re=Ae?Se:0,Pe=Ae?0:Se;if(I&&this.addCurrentVertex(T,L,Re,Pe,b),Ue==="fakeround"){const Te=Math.round(180*pe/Math.PI/20);for(let Xe=1;Xe<Te;Xe++){let tt=Xe/Te;if(tt!==.5){const yt=tt-.5;tt+=tt*yt*(tt-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*yt*yt+(.848013+ce*(.215638*ce-1.06021)))}const Bt=q.sub(L)._mult(tt)._add(L)._unit()._mult(Ae?-1:1);this.addHalfVertex(T,Bt.x,Bt.y,!1,Ae,0,b)}}M&&this.addCurrentVertex(T,q,-Re,-Pe,b)}else if(Ue==="butt")this.addCurrentVertex(T,ne,0,0,b);else if(Ue==="square"){const Se=I?1:-1;I||this.addCurrentVertex(T,ne,Se,Se,b),this.addCurrentVertex(T,ne,0,0,b),I&&this.addCurrentVertex(T,ne,Se,Se,b)}else Ue==="round"&&(I&&(this.addCurrentVertex(T,L,0,0,b),this.addCurrentVertex(T,L,1,1,b,!0)),M&&(this.addCurrentVertex(T,q,-1,-1,b,!0),this.addCurrentVertex(T,q,0,0,b)));if(Le&&K<m-1){const Se=T.dist(M);if(Se>2*x){const Re=T.add(M.sub(T)._mult(x/Se)._round());this.updateDistance(T,Re),this.addCurrentVertex(Re,q,0,0,b),T=Re}}}}addCurrentVertex(e,r,n,a,h,u=!1){const f=r.y*a-r.x,m=-r.y-r.x*a;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,u,!1,n,h),this.addHalfVertex(e,f,m,u,!0,-a,h)}addHalfVertex({x:e,y:r},n,a,h,u,f,m){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(u?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const g=m.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),m.primitiveLength++),u?this.e2=g:this.e1=g}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ze("LineBucket",Rc,{omit:["layers","patternFeatures"]});const kd=new ke({"line-cap":new oe(Y.layout_line["line-cap"]),"line-join":new oe(Y.layout_line["line-join"]),"line-miter-limit":new N(Y.layout_line["line-miter-limit"]),"line-round-limit":new N(Y.layout_line["line-round-limit"]),"line-sort-key":new oe(Y.layout_line["line-sort-key"])});var nu={paint:new ke({"line-opacity":new oe(Y.paint_line["line-opacity"]),"line-color":new oe(Y.paint_line["line-color"]),"line-translate":new N(Y.paint_line["line-translate"]),"line-translate-anchor":new N(Y.paint_line["line-translate-anchor"]),"line-width":new oe(Y.paint_line["line-width"]),"line-gap-width":new oe(Y.paint_line["line-gap-width"]),"line-offset":new oe(Y.paint_line["line-offset"]),"line-blur":new oe(Y.paint_line["line-blur"]),"line-dasharray":new ve(Y.paint_line["line-dasharray"]),"line-pattern":new ve(Y.paint_line["line-pattern"]),"line-gradient":new j(Y.paint_line["line-gradient"])}),layout:kd};const ou=new class extends oe{possiblyEvaluate(i,e){return e=new k(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,n){return e=Tt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,n)}}(nu.paint.properties["line-width"].specification);function su(i,e){return e>0?e+2*i:i}ou.useIntegerZoom=!0;const Pd=He([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dd=He([{name:"a_projected_pos",components:3,type:"Float32"}],4);He([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ld=He([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Rd=He([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);He([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const au=He([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bd=He([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);He([{name:"triangle",components:3,type:"Uint16"}]),He([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),He([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),He([{type:"Float32",name:"offsetX"}]),He([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var di=24;const Vr=128;function Bc(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new k(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=r;let h=0;for(;h<n.length&&n[h]<=i;)h++;h=Math.max(0,h-1);let u=h;for(;u<n.length&&n[u]<i+1;)u++;u=Math.min(n.length-1,u);const f=n[h],m=n[u];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:m,interpolationType:a}:{kind:"camera",minZoom:f,maxZoom:m,minSize:r.evaluate(new k(f)),maxSize:r.evaluate(new k(m)),interpolationType:a}}}function Ol(i,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:a}){return i.kind==="source"?n/Vr:i.kind==="composite"?Mt(n/Vr,a/Vr,r):e}function vs(i,e){let r=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:a,minZoom:h,maxZoom:u}=i,f=a?Be(Di.interpolationFactor(a,e,h,u),0,1):0;i.kind==="camera"?n=Mt(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:n}}var Fd=Object.freeze({__proto__:null,getSizeData:Bc,evaluateSizeForFeature:Ol,evaluateSizeForZoom:vs,SIZE_PACK_FACTOR:Vr});function Od(i,e,r){return i.sections.forEach(n=>{n.text=function(a,h,u){const f=h.layout.get("text-transform").evaluate(u,{});return f==="uppercase"?a=a.toLocaleUpperCase():f==="lowercase"&&(a=a.toLocaleLowerCase()),z.applyArabicShaping&&(a=z.applyArabicShaping(a)),a}(n.text,e,r)}),i}const xa={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var lu=function(i,e,r,n,a){var h,u,f=8*a-n-1,m=(1<<f)-1,g=m>>1,x=-7,b=r?a-1:0,T=r?-1:1,I=i[e+b];for(b+=T,h=I&(1<<-x)-1,I>>=-x,x+=f;x>0;h=256*h+i[e+b],b+=T,x-=8);for(u=h&(1<<-x)-1,h>>=-x,x+=n;x>0;u=256*u+i[e+b],b+=T,x-=8);if(h===0)h=1-g;else{if(h===m)return u?NaN:1/0*(I?-1:1);u+=Math.pow(2,n),h-=g}return(I?-1:1)*u*Math.pow(2,h-n)},cu=function(i,e,r,n,a,h){var u,f,m,g=8*h-a-1,x=(1<<g)-1,b=x>>1,T=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=n?0:h-1,M=n?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,u=x):(u=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-u))<1&&(u--,m*=2),(e+=u+b>=1?T/m:T*Math.pow(2,1-b))*m>=2&&(u++,m/=2),u+b>=x?(f=0,u=x):u+b>=1?(f=(e*m-1)*Math.pow(2,a),u+=b):(f=e*Math.pow(2,b-1)*Math.pow(2,a),u=0));a>=8;i[r+I]=255&f,I+=M,f/=256,a-=8);for(u=u<<a|f,g+=a;g>0;i[r+I]=255&u,I+=M,u/=256,g-=8);i[r+I-M]|=128*L},va=Vt;function Vt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Vt.Varint=0,Vt.Fixed64=1,Vt.Bytes=2,Vt.Fixed32=5;var Fc=4294967296,hu=1/Fc,uu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function an(i){return i.type===Vt.Bytes?i.readVarint()+i.pos:i.pos+1}function bs(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function pu(i,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var a=r.pos-1;a>=i;a--)r.buf[a+n]=r.buf[a]}function Ud(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Vd(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Nd(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Gd(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function qd(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function $d(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function jd(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Zd(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Xd(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Ul(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function ws(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function du(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Wd(i,e,r){i===1&&r.readMessage(Hd,e)}function Hd(i,e,r){if(i===3){const{id:n,bitmap:a,width:h,height:u,left:f,top:m,advance:g}=r.readMessage(Kd,{});e.push({id:n,bitmap:new Fn({width:h+6,height:u+6},a),metrics:{width:h,height:u,left:f,top:m,advance:g}})}}function Kd(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Oc(i){let e=0,r=0;for(const u of i)e+=u.w*u.h,r=Math.max(r,u.w);i.sort((u,f)=>f.h-u.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let a=0,h=0;for(const u of i)for(let f=n.length-1;f>=0;f--){const m=n[f];if(!(u.w>m.w||u.h>m.h)){if(u.x=m.x,u.y=m.y,h=Math.max(h,u.y+u.h),a=Math.max(a,u.x+u.w),u.w===m.w&&u.h===m.h){const g=n.pop();f<n.length&&(n[f]=g)}else u.h===m.h?(m.x+=u.w,m.w-=u.w):u.w===m.w?(m.y+=u.h,m.h-=u.h):(n.push({x:m.x+u.w,y:m.y,w:m.w-u.w,h:u.h}),m.y+=u.h,m.h-=u.h);break}}return{w:a,h,fill:e/(a*h)||0}}Vt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),a=n>>3,h=this.pos;this.type=7&n,i(a,e,this),this.pos===h&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Ul(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=du(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Ul(this.buf,this.pos)+Ul(this.buf,this.pos+4)*Fc;return this.pos+=8,i},readSFixed64:function(){var i=Ul(this.buf,this.pos)+du(this.buf,this.pos+4)*Fc;return this.pos+=8,i},readFloat:function(){var i=lu(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=lu(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(a,h,u){var f,m,g=u.buf;if(f=(112&(m=g[u.pos++]))>>4,m<128||(f|=(127&(m=g[u.pos++]))<<3,m<128)||(f|=(127&(m=g[u.pos++]))<<10,m<128)||(f|=(127&(m=g[u.pos++]))<<17,m<128)||(f|=(127&(m=g[u.pos++]))<<24,m<128)||(f|=(1&(m=g[u.pos++]))<<31,m<128))return bs(a,f,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&uu?function(r,n,a){return uu.decode(r.subarray(n,a))}(this.buf,e,i):function(r,n,a){for(var h="",u=n;u<a;){var f,m,g,x=r[u],b=null,T=x>239?4:x>223?3:x>191?2:1;if(u+T>a)break;T===1?x<128&&(b=x):T===2?(192&(f=r[u+1]))==128&&(b=(31&x)<<6|63&f)<=127&&(b=null):T===3?(m=r[u+2],(192&(f=r[u+1]))==128&&(192&m)==128&&((b=(15&x)<<12|(63&f)<<6|63&m)<=2047||b>=55296&&b<=57343)&&(b=null)):T===4&&(m=r[u+2],g=r[u+3],(192&(f=r[u+1]))==128&&(192&m)==128&&(192&g)==128&&((b=(15&x)<<18|(63&f)<<12|(63&m)<<6|63&g)<=65535||b>=1114112)&&(b=null)),b===null?(b=65533,T=1):b>65535&&(b-=65536,h+=String.fromCharCode(b>>>10&1023|55296),b=56320|1023&b),h+=String.fromCharCode(b),u+=T}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Vt.Bytes)return i.push(this.readVarint(e));var r=an(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSVarint());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Vt.Bytes)return i.push(this.readBoolean());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFloat());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Vt.Bytes)return i.push(this.readDouble());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFixed32());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSFixed32());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFixed64());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSFixed64());var e=an(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Vt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Vt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Vt.Fixed32)this.pos+=4;else{if(e!==Vt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ws(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ws(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ws(this.buf,-1&i,this.pos),ws(this.buf,Math.floor(i*hu),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ws(this.buf,-1&i,this.pos),ws(this.buf,Math.floor(i*hu),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,u,f){f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,f.buf[f.pos]=127&(h>>>=7)}(n,0,r),function(h,u){var f=(7&h)<<4;u.buf[u.pos++]|=f|((h>>>=3)?128:0),h&&(u.buf[u.pos++]=127&h|((h>>>=7)?128:0),h&&(u.buf[u.pos++]=127&h|((h>>>=7)?128:0),h&&(u.buf[u.pos++]=127&h|((h>>>=7)?128:0),h&&(u.buf[u.pos++]=127&h|((h>>>=7)?128:0),h&&(u.buf[u.pos++]=127&h)))))}(a,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,a,h){for(var u,f,m=0;m<a.length;m++){if((u=a.charCodeAt(m))>55295&&u<57344){if(!f){u>56319||m+1===a.length?(n[h++]=239,n[h++]=191,n[h++]=189):f=u;continue}if(u<56320){n[h++]=239,n[h++]=191,n[h++]=189,f=u;continue}u=f-55296<<10|u-56320|65536,f=null}else f&&(n[h++]=239,n[h++]=191,n[h++]=189,f=null);u<128?n[h++]=u:(u<2048?n[h++]=u>>6|192:(u<65536?n[h++]=u>>12|224:(n[h++]=u>>18|240,n[h++]=u>>12&63|128),n[h++]=u>>6&63|128),n[h++]=63&u|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&pu(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),cu(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),cu(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var n=this.pos-r;n>=128&&pu(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,r){this.writeTag(i,Vt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Ud,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Vd,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,qd,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Nd,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Gd,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,$d,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,jd,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Zd,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Xd,e)},writeBytesField:function(i,e){this.writeTag(i,Vt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Vt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Vt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Vt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Uc{constructor(e,{pixelRatio:r,version:n,stretchX:a,stretchY:h,content:u}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=a,this.stretchY=h,this.content=u,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class fu{constructor(e,r){const n={},a={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,n,h),this.addImages(r,a,h);const{w:u,h:f}=Oc(h),m=new or({width:u||1,height:f||1});for(const g in e){const x=e[g],b=n[g].paddedRect;or.copy(x.data,m,{x:0,y:0},{x:b.x+1,y:b.y+1},x.data)}for(const g in r){const x=r[g],b=a[g].paddedRect,T=b.x+1,I=b.y+1,M=x.data.width,L=x.data.height;or.copy(x.data,m,{x:0,y:0},{x:T,y:I},x.data),or.copy(x.data,m,{x:0,y:L-1},{x:T,y:I-1},{width:M,height:1}),or.copy(x.data,m,{x:0,y:0},{x:T,y:I+L},{width:M,height:1}),or.copy(x.data,m,{x:M-1,y:0},{x:T-1,y:I},{width:1,height:L}),or.copy(x.data,m,{x:0,y:0},{x:T+M,y:I},{width:1,height:L})}this.image=m,this.iconPositions=n,this.patternPositions=a}addImages(e,r,n){for(const a in e){const h=e[a],u={x:0,y:0,w:h.data.width+2,h:h.data.height+2};n.push(u),r[a]=new Uc(u,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[a,h]=e.tl;n.update(r.data,void 0,{x:a,y:h})}}Ze("ImagePosition",Uc),Ze("ImageAtlas",fu);const Wi={horizontal:1,vertical:2,horizontalOnly:3},Vl=-17;class ba{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new ba;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new ba;return r.imageName=e,r}}class Ts{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new Ts;for(let a=0;a<e.sections.length;a++){const h=e.sections[a];h.image?n.addImageSection(h):n.addTextSection(h,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let n=0;n<e.length;n++){const a=e.charCodeAt(n+1)||null,h=e.charCodeAt(n-1)||null;r+=a&&Sl(a)&&!xa[e[n+1]]||h&&Sl(h)&&!xa[e[n-1]]||!xa[e[n]]?e[n]:xa[e[n]]}return r}(this.text)}trim(){let e=0;for(let n=0;n<this.text.length&&Gl[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Gl[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new Ts;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(ba.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void zt("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(ba.forImage(r)),this.sectionIndex.push(this.sections.length-1)):zt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Nl(i,e,r,n,a,h,u,f,m,g,x,b,T,I,M,L){const q=Ts.fromFeature(i,a);let K;b===Wi.vertical&&q.verticalizePunctuation();const{processBidirectionalText:ne,processStyledBidirectionalText:ce}=z;if(ne&&q.sections.length===1){K=[];const pe=ne(q.toString(),Vc(q,g,h,e,n,I,M));for(const Le of pe){const Ae=new Ts;Ae.text=Le,Ae.sections=q.sections;for(let Me=0;Me<Le.length;Me++)Ae.sectionIndex.push(0);K.push(Ae)}}else if(ce){K=[];const pe=ce(q.text,q.sectionIndex,Vc(q,g,h,e,n,I,M));for(const Le of pe){const Ae=new Ts;Ae.text=Le[0],Ae.sectionIndex=Le[1],Ae.sections=q.sections,K.push(Ae)}}else K=function(pe,Le){const Ae=[],Me=pe.text;let Ue=0;for(const Se of Le)Ae.push(pe.substring(Ue,Se)),Ue=Se;return Ue<Me.length&&Ae.push(pe.substring(Ue,Me.length)),Ae}(q,Vc(q,g,h,e,n,I,M));const ue=[],he={positionedLines:ue,text:q.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:b,iconsInText:!1,verticalizable:!1};return function(pe,Le,Ae,Me,Ue,Se,Re,Pe,Te,Xe,tt,Bt){let yt=0,qt=Vl,Zt=0,ct=0;const Xt=Pe==="right"?1:Pe==="left"?0:.5;let gi=0;for(const ii of Ue){ii.trim();const Ht=ii.getMaxScale(),li=(Ht-1)*di,Ii={positionedGlyphs:[],lineOffset:0};pe.positionedLines[gi]=Ii;const vi=Ii.positionedGlyphs;let bi=0;if(!ii.length()){qt+=Se,++gi;continue}for(let Dt=0;Dt<ii.length();Dt++){const Lt=ii.getSection(Dt),Hi=ii.getSectionIndex(Dt),Ft=ii.getCharCode(Dt);let Gr=0,ci=null,sr=null,ar=null,Er=di;const lr=!(Te===Wi.horizontal||!tt&&!oa(Ft)||tt&&(Gl[Ft]||(ti=Ft,ml(ti)||fo(ti)||_l(ti)||ia(ti)||Dn(ti))));if(Lt.imageName){const ln=Me[Lt.imageName];if(!ln)continue;ar=Lt.imageName,pe.iconsInText=pe.iconsInText||!0,sr=ln.paddedRect;const Fi=ln.displaySize;Lt.scale=Lt.scale*di/Bt,ci={width:Fi[0],height:Fi[1],left:1,top:-3,advance:lr?Fi[1]:Fi[0],localGlyph:!1},Gr=li+(di-Fi[1]*Lt.scale),Er=ci.advance;const cn=lr?Fi[0]*Lt.scale-di*Ht:Fi[1]*Lt.scale-di*Ht;cn>0&&cn>bi&&(bi=cn)}else{const ln=Ae[Lt.fontStack],Fi=ln&&ln[Ft];if(Fi&&Fi.rect)sr=Fi.rect,ci=Fi.metrics;else{const cn=Le[Lt.fontStack],Ea=cn&&cn[Ft];if(!Ea)continue;ci=Ea.metrics}Gr=(Ht-Lt.scale)*di}lr?(pe.verticalizable=!0,vi.push({glyph:Ft,imageName:ar,x:yt,y:qt+Gr,vertical:lr,scale:Lt.scale,localGlyph:ci.localGlyph,fontStack:Lt.fontStack,sectionIndex:Hi,metrics:ci,rect:sr}),yt+=Er*Lt.scale+Xe):(vi.push({glyph:Ft,imageName:ar,x:yt,y:qt+Gr,vertical:lr,scale:Lt.scale,localGlyph:ci.localGlyph,fontStack:Lt.fontStack,sectionIndex:Hi,metrics:ci,rect:sr}),yt+=ci.advance*Lt.scale+Xe)}vi.length!==0&&(Zt=Math.max(yt-Xe,Zt),Qd(vi,0,vi.length-1,Xt,bi)),yt=0;const $t=Se*Ht+bi;Ii.lineOffset=Math.max(bi,li),qt+=$t,ct=Math.max($t,ct),++gi}var ti;const fi=qt-Vl,{horizontalAlign:mi,verticalAlign:Mi}=Nc(Re);(function(ii,Ht,li,Ii,vi,bi,$t,Dt,Lt){const Hi=(Ht-li)*vi;let Ft=0;Ft=bi!==$t?-Dt*Ii-Vl:(-Ii*Lt+.5)*$t;for(const Gr of ii)for(const ci of Gr.positionedGlyphs)ci.x+=Hi,ci.y+=Ft})(pe.positionedLines,Xt,mi,Mi,Zt,ct,Se,fi,Ue.length),pe.top+=-Mi*fi,pe.bottom=pe.top+fi,pe.left+=-mi*Zt,pe.right=pe.left+Zt}(he,e,r,n,K,u,f,m,b,g,T,L),!function(pe){for(const Le of pe)if(Le.positionedGlyphs.length!==0)return!1;return!0}(ue)&&he}const Gl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function mu(i,e,r,n,a,h){if(e.imageName){const u=n[e.imageName];return u?u.displaySize[0]*e.scale*di/h+a:0}{const u=r[e.fontStack],f=u&&u[i];return f?f.metrics.advance*e.scale+a:0}}function _u(i,e,r,n){const a=Math.pow(i-e,2);return n?i<e?a/2:2*a:a+Math.abs(r)*r}function Jd(i,e,r){let n=0;return i===10&&(n-=1e4),r&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function gu(i,e,r,n,a,h){let u=null,f=_u(e,r,a,h);for(const m of n){const g=_u(e-m.x,r,a,h)+m.badness;g<=f&&(u=m,f=g)}return{index:i,x:e,priorBreak:u,badness:f}}function yu(i){return i?yu(i.priorBreak).concat(i.index):[]}function Vc(i,e,r,n,a,h,u){if(h!=="point")return[];if(!i)return[];const f=[],m=function(T,I,M,L,q,K){let ne=0;for(let ce=0;ce<T.length();ce++){const ue=T.getSection(ce);ne+=mu(T.getCharCode(ce),ue,L,q,I,K)}return ne/Math.max(1,Math.ceil(ne/M))}(i,e,r,n,a,u),g=i.text.indexOf("\u200B")>=0;let x=0;for(let T=0;T<i.length();T++){const I=i.getSection(T),M=i.getCharCode(T);if(Gl[M]||(x+=mu(M,I,n,a,e,u)),T<i.length()-1){const L=!((b=M)<11904||!(ea(b)||Qs(b)||ra(b)||us(b)||xl(b)||gl(b)||cs(b)||Js(b)||vl(b)||Pn(b)||hs(b)||rn(b)||ls(b)||yl(b)||mo(b)||ta(b)||_o(b)||Tl(b)||en(b)||bl(b)));(Yd[M]||L||I.imageName)&&f.push(gu(T+1,x,m,f,Jd(M,i.getCharCode(T+1),L&&g),!1))}}var b;return yu(gu(i.length(),x,m,f,0,!0))}function Nc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Qd(i,e,r,n,a){if(!n&&!a)return;const h=i[r],u=(i[r].x+h.metrics.advance*h.scale)*n;for(let f=e;f<=r;f++)i[f].x-=u,i[f].y+=a}function ef(i,e,r){const{horizontalAlign:n,verticalAlign:a}=Nc(r),h=e[0]-i.displaySize[0]*n,u=e[1]-i.displaySize[1]*a;return{image:i,top:u,bottom:u+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function xu(i,e,r,n,a,h){const u=i.image;let f;if(u.content){const q=u.content,K=u.pixelRatio||1;f=[q[0]/K,q[1]/K,u.displaySize[0]-q[2]/K,u.displaySize[1]-q[3]/K]}const m=e.left*h,g=e.right*h;let x,b,T,I;r==="width"||r==="both"?(I=a[0]+m-n[3],b=a[0]+g+n[1]):(I=a[0]+(m+g-u.displaySize[0])/2,b=I+u.displaySize[0]);const M=e.top*h,L=e.bottom*h;return r==="height"||r==="both"?(x=a[1]+M-n[0],T=a[1]+L+n[2]):(x=a[1]+(M+L-u.displaySize[1])/2,T=x+u.displaySize[1]),{image:u,top:x,right:b,bottom:T,left:I,collisionPadding:f}}class Un extends X{constructor(e,r,n,a){super(e,r),this.angle=n,a!==void 0&&(this.segment=a)}clone(){return new Un(this.x,this.y,this.angle,this.segment)}}function vu(i,e,r,n,a){if(e.segment===void 0)return!0;let h=e,u=e.segment+1,f=0;for(;f>-r/2;){if(u--,u<0)return!1;f-=i[u].dist(h),h=i[u]}f+=i[u].dist(i[u+1]),u++;const m=[];let g=0;for(;f<r/2;){const x=i[u],b=i[u+1];if(!b)return!1;let T=i[u-1].angleTo(x)-x.angleTo(b);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),m.push({distance:f,angleDelta:T}),g+=T;f-m[0].distance>n;)g-=m.shift().angleDelta;if(g>a)return!1;u++,f+=x.dist(b)}return!0}function bu(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function wu(i,e,r){return i?.6*e*r:0}function Tu(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function tf(i,e,r,n,a,h){const u=wu(r,a,h),f=Tu(r,n)*h;let m=0;const g=bu(i)/2;for(let x=0;x<i.length-1;x++){const b=i[x],T=i[x+1],I=b.dist(T);if(m+I>g){const M=(g-m)/I,L=Mt(b.x,T.x,M),q=Mt(b.y,T.y,M),K=new Un(L,q,T.angleTo(b),x);return K._round(),!u||vu(i,K,f,u,e)?K:void 0}m+=I}}function rf(i,e,r,n,a,h,u,f,m){const g=wu(n,h,u),x=Tu(n,a),b=x*u,T=i[0].x===0||i[0].x===m||i[0].y===0||i[0].y===m;return e-b<e/4&&(e=b+e/4),Eu(i,T?e/2*f%e:(x/2+2*h)*u*f%e,e,g,r,b,T,!1,m)}function Eu(i,e,r,n,a,h,u,f,m){const g=h/2,x=bu(i);let b=0,T=e-r,I=[];for(let M=0;M<i.length-1;M++){const L=i[M],q=i[M+1],K=L.dist(q),ne=q.angleTo(L);for(;T+r<b+K;){T+=r;const ce=(T-b)/K,ue=Mt(L.x,q.x,ce),he=Mt(L.y,q.y,ce);if(ue>=0&&ue<m&&he>=0&&he<m&&T-g>=0&&T+g<=x){const pe=new Un(ue,he,ne,M);pe._round(),n&&!vu(i,pe,h,n,a)||I.push(pe)}}b+=K}return f||I.length||u||(I=Eu(i,b/2,r,n,a,h,u,!0,m)),I}function Su(i,e,r,n,a){const h=[];for(let u=0;u<i.length;u++){const f=i[u];let m;for(let g=0;g<f.length-1;g++){let x=f[g],b=f[g+1];x.x<e&&b.x<e||(x.x<e?x=new X(e,x.y+(e-x.x)/(b.x-x.x)*(b.y-x.y))._round():b.x<e&&(b=new X(e,x.y+(e-x.x)/(b.x-x.x)*(b.y-x.y))._round()),x.y<r&&b.y<r||(x.y<r?x=new X(x.x+(r-x.y)/(b.y-x.y)*(b.x-x.x),r)._round():b.y<r&&(b=new X(x.x+(r-x.y)/(b.y-x.y)*(b.x-x.x),r)._round()),x.x>=n&&b.x>=n||(x.x>=n?x=new X(n,x.y+(n-x.x)/(b.x-x.x)*(b.y-x.y))._round():b.x>=n&&(b=new X(n,x.y+(n-x.x)/(b.x-x.x)*(b.y-x.y))._round()),x.y>=a&&b.y>=a||(x.y>=a?x=new X(x.x+(a-x.y)/(b.y-x.y)*(b.x-x.x),a)._round():b.y>=a&&(b=new X(x.x+(a-x.y)/(b.y-x.y)*(b.x-x.x),a)._round()),m&&x.equals(m[m.length-1])||(m=[x],h.push(m)),m.push(b)))))}}return h}Ze("Anchor",Un);var Iu=wa,nf=wa,Es=1e20;function wa(i,e,r,n,a,h){this.fontSize=i||24,this.buffer=e===void 0?3:e,this.cutoff=n||.25,this.fontFamily=a||"sans-serif",this.fontWeight=h||"normal",this.radius=r||8;var u=this.size=this.fontSize+2*this.buffer,f=u+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=u,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(u/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Au(i,e,r,n,a,h){for(var u=0;u<e;u++)Cu(i,u,e,r,n,a,h);for(var f=0;f<r;f++)Cu(i,f*e,1,e,n,a,h)}function Cu(i,e,r,n,a,h,u){var f,m,g,x;for(h[0]=0,u[0]=-Es,u[1]=Es,f=0;f<n;f++)a[f]=i[e+f*r];for(f=1,m=0,g=0;f<n;f++){do g=(a[f]-a[x=h[m]]+f*f-x*x)/(f-x)/2;while(g<=u[m]&&--m>-1);h[++m]=f,u[m]=g,u[m+1]=Es}for(f=0,m=0;f<n;f++){for(;u[m+1]<f;)m++;i[e+f*r]=a[x=h[m]]+(f-x)*(f-x)}}wa.prototype._draw=function(i,e){var r,n,a,h,u,f,m,g,x,b=this.ctx.measureText(i),T=b.width,I=2*this.buffer;e&&this.useMetrics?(u=Math.floor(b.actualBoundingBoxAscent),g=this.buffer+Math.ceil(b.actualBoundingBoxAscent),f=this.buffer,m=this.buffer,r=(n=Math.min(this.size,Math.ceil(b.actualBoundingBoxRight-b.actualBoundingBoxLeft)))+I,a=(h=Math.min(this.size-f,Math.ceil(b.actualBoundingBoxAscent+b.actualBoundingBoxDescent)))+I,this.ctx.textBaseline="alphabetic"):(r=n=this.size,a=h=this.size,u=19*this.fontSize/24,f=m=0,g=this.middle,this.ctx.textBaseline="middle"),n&&h&&(this.ctx.clearRect(m,f,n,h),this.ctx.fillText(i,this.buffer,g),x=this.ctx.getImageData(m,f,n,h));var M=new Uint8ClampedArray(r*a);return function(L,q,K,ne,ce,ue,he){ue.fill(Es,0,q*K),he.fill(0,0,q*K);for(var pe=(q-ne)/2,Le=0;Le<ce;Le++)for(var Ae=0;Ae<ne;Ae++){var Me=(Le+pe)*q+Ae+pe,Ue=L.data[4*(Le*ne+Ae)+3]/255;if(Ue===1)ue[Me]=0,he[Me]=Es;else if(Ue===0)ue[Me]=Es,he[Me]=0;else{var Se=Math.max(0,.5-Ue),Re=Math.max(0,Ue-.5);ue[Me]=Se*Se,he[Me]=Re*Re}}}(x,r,a,n,h,this.gridOuter,this.gridInner),Au(this.gridOuter,r,a,this.f,this.v,this.z),Au(this.gridInner,r,a,this.f,this.v,this.z),function(L,q,K,ne,ce,ue,he){for(var pe=0;pe<q*K;pe++){var Le=Math.sqrt(ne[pe])-Math.sqrt(ce[pe]);L[pe]=Math.round(255-255*(Le/ue+he))}}(M,r,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:M,metrics:{width:n,height:h,sdfWidth:r,sdfHeight:a,top:u,left:0,advance:T}}},wa.prototype.draw=function(i){return this._draw(i,!1).data},wa.prototype.drawWithMetrics=function(i){return this._draw(i,!0)},Iu.default=nf;const Gc={none:0,ideographs:1,all:2};class Ss{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const n=[];for(const a in e)for(const h of e[a])n.push({stack:a,id:h});Qe(n,({stack:a,id:h},u)=>{let f=this.entries[a];f||(f=this.entries[a]={glyphs:{},requests:{},ranges:{}});let m=f.glyphs[h];if(m!==void 0)return void u(null,{stack:a,id:h,glyph:m});if(m=this._tinySDF(f,a,h),m)return f.glyphs[h]=m,void u(null,{stack:a,id:h,glyph:m});const g=Math.floor(h/256);if(256*g>65535)return void u(new Error("glyphs > 65535 not supported"));if(f.ranges[g])return void u(null,{stack:a,id:h,glyph:m});let x=f.requests[g];x||(x=f.requests[g]=[],Ss.loadGlyphRange(a,g,this.url,this.requestManager,(b,T)=>{if(T){for(const I in T)this._doesCharSupportLocalGlyph(+I)||(f.glyphs[+I]=T[+I]);f.ranges[g]=!0}for(const I of x)I(b,T);delete f.requests[g]})),x.push((b,T)=>{b?u(b):T&&u(null,{stack:a,id:h,glyph:T[h]||null})})},(a,h)=>{if(a)r(a);else if(h){const u={};for(const{stack:f,id:m,glyph:g}of h)(u[f]||(u[f]={}))[m]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics};r(null,u)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Gc.none&&(this.localGlyphMode===Gc.all?!!this.localFontFamily:!!this.localFontFamily&&(Pn(e)||wl(e)||ls(e)||_o(e)))}_tinySDF(e,r,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let h=e.tinySDF;if(!h){let L="400";/bold/i.test(r)?L="900":/medium/i.test(r)?L="500":/light/i.test(r)&&(L="200"),h=e.tinySDF=new Ss.TinySDF(48,6,16,.25,a,L)}if(this.localGlyphs[h.fontWeight][n])return this.localGlyphs[h.fontWeight][n];const{data:u,metrics:f}=h.drawWithMetrics(String.fromCharCode(n)),{sdfWidth:m,sdfHeight:g,width:x,height:b,left:T,top:I,advance:M}=f;return this.localGlyphs[h.fontWeight][n]={id:n,bitmap:new Fn({width:m,height:g},u),metrics:{width:x/2,height:b/2,left:T/2,top:I/2-27,advance:M/2,localGlyph:!0}}}}function Mu(i,e,r,n){const a=[],h=i.image,u=h.pixelRatio,f=h.paddedRect.w-2,m=h.paddedRect.h-2,g=i.right-i.left,x=i.bottom-i.top,b=h.stretchX||[[0,f]],T=h.stretchY||[[0,m]],I=(Se,Re)=>Se+Re[1]-Re[0],M=b.reduce(I,0),L=T.reduce(I,0),q=f-M,K=m-L;let ne=0,ce=M,ue=0,he=L,pe=0,Le=q,Ae=0,Me=K;if(h.content&&n){const Se=h.content;ne=ql(b,0,Se[0]),ue=ql(T,0,Se[1]),ce=ql(b,Se[0],Se[2]),he=ql(T,Se[1],Se[3]),pe=Se[0]-ne,Ae=Se[1]-ue,Le=Se[2]-Se[0]-ce,Me=Se[3]-Se[1]-he}const Ue=(Se,Re,Pe,Te)=>{const Xe=$l(Se.stretch-ne,ce,g,i.left),tt=jl(Se.fixed-pe,Le,Se.stretch,M),Bt=$l(Re.stretch-ue,he,x,i.top),yt=jl(Re.fixed-Ae,Me,Re.stretch,L),qt=$l(Pe.stretch-ne,ce,g,i.left),Zt=jl(Pe.fixed-pe,Le,Pe.stretch,M),ct=$l(Te.stretch-ue,he,x,i.top),Xt=jl(Te.fixed-Ae,Me,Te.stretch,L),gi=new X(Xe,Bt),ti=new X(qt,Bt),fi=new X(qt,ct),mi=new X(Xe,ct),Mi=new X(tt/u,yt/u),ii=new X(Zt/u,Xt/u),Ht=e*Math.PI/180;if(Ht){const vi=Math.sin(Ht),bi=Math.cos(Ht),$t=[bi,-vi,vi,bi];gi._matMult($t),ti._matMult($t),mi._matMult($t),fi._matMult($t)}const li=Se.stretch+Se.fixed,Ii=Re.stretch+Re.fixed;return{tl:gi,tr:ti,bl:mi,br:fi,tex:{x:h.paddedRect.x+1+li,y:h.paddedRect.y+1+Ii,w:Pe.stretch+Pe.fixed-li,h:Te.stretch+Te.fixed-Ii},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mi,pixelOffsetBR:ii,minFontScaleX:Le/u/g,minFontScaleY:Me/u/x,isSDF:r}};if(n&&(h.stretchX||h.stretchY)){const Se=zu(b,q,M),Re=zu(T,K,L);for(let Pe=0;Pe<Se.length-1;Pe++){const Te=Se[Pe],Xe=Se[Pe+1];for(let tt=0;tt<Re.length-1;tt++)a.push(Ue(Te,Re[tt],Xe,Re[tt+1]))}}else a.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:m+1}));return a}function ql(i,e,r){let n=0;for(const a of i)n+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]));return n}function zu(i,e,r){const n=[{fixed:-1,stretch:0}];for(const[a,h]of i){const u=n[n.length-1];n.push({fixed:a-u.stretch,stretch:u.stretch}),n.push({fixed:a-u.stretch,stretch:u.stretch+(h-a)})}return n.push({fixed:e+1,stretch:r}),n}function $l(i,e,r,n){return i/e*r+n}function jl(i,e,r,n){return i-e*r/n}Ss.loadGlyphRange=function(i,e,r,n,a){const h=256*e,u=h+255,f=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${h}-${u}`),Wr.Glyphs);S(f,(m,g)=>{if(m)a(m);else if(g){const x={};for(const b of function(T){return new va(T).readFields(Wd,[])}(g))x[b.id]=b;a(null,x)}})},Ss.TinySDF=Iu;class of{constructor(e=[],r=sf){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,a=r[e];for(;e>0;){const h=e-1>>1,u=r[h];if(n(a,u)>=0)break;r[e]=u,e=h}r[e]=a}_down(e){const{data:r,compare:n}=this,a=this.length>>1,h=r[e];for(;e<a;){let u=1+(e<<1),f=r[u];const m=u+1;if(m<this.length&&n(r[m],f)<0&&(u=m,f=r[m]),n(f,h)>=0)break;r[e]=f,e=u}r[e]=h}}function sf(i,e){return i<e?-1:i>e?1:0}function af(i,e=1,r=!1){let n=1/0,a=1/0,h=-1/0,u=-1/0;const f=i[0];for(let I=0;I<f.length;I++){const M=f[I];(!I||M.x<n)&&(n=M.x),(!I||M.y<a)&&(a=M.y),(!I||M.x>h)&&(h=M.x),(!I||M.y>u)&&(u=M.y)}const m=Math.min(h-n,u-a);let g=m/2;const x=new of([],lf);if(m===0)return new X(n,a);for(let I=n;I<h;I+=m)for(let M=a;M<u;M+=m)x.push(new Is(I+g,M+g,g,i));let b=function(I){let M=0,L=0,q=0;const K=I[0];for(let ne=0,ce=K.length,ue=ce-1;ne<ce;ue=ne++){const he=K[ne],pe=K[ue],Le=he.x*pe.y-pe.x*he.y;L+=(he.x+pe.x)*Le,q+=(he.y+pe.y)*Le,M+=3*Le}return new Is(L/M,q/M,0,I)}(i),T=x.length;for(;x.length;){const I=x.pop();(I.d>b.d||!b.d)&&(b=I,r&&console.log("found best %d after %d probes",Math.round(1e4*I.d)/1e4,T)),I.max-b.d<=e||(g=I.h/2,x.push(new Is(I.p.x-g,I.p.y-g,g,i)),x.push(new Is(I.p.x+g,I.p.y-g,g,i)),x.push(new Is(I.p.x-g,I.p.y+g,g,i)),x.push(new Is(I.p.x+g,I.p.y+g,g,i)),T+=4)}return r&&(console.log(`num probes: ${T}`),console.log(`best distance: ${b.d}`)),b.p}function lf(i,e){return e.max-i.max}function Is(i,e,r,n){this.p=new X(i,e),this.h=r,this.d=function(a,h){let u=!1,f=1/0;for(let m=0;m<h.length;m++){const g=h[m];for(let x=0,b=g.length,T=b-1;x<b;T=x++){const I=g[x],M=g[T];I.y>a.y!=M.y>a.y&&a.x<(M.x-I.x)*(a.y-I.y)/(M.y-I.y)+I.x&&(u=!u),f=Math.min(f,Ch(a,I,M))}}return(u?1:-1)*Math.sqrt(f)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const qc=Number.POSITIVE_INFINITY;function ku(i,e){return e[1]!==qc?function(r,n,a){let h=0,u=0;switch(n=Math.abs(n),a=Math.abs(a),r){case"top-right":case"top-left":case"top":u=a-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-a}switch(r){case"top-right":case"bottom-right":case"right":h=-n;break;case"top-left":case"bottom-left":case"left":h=n}return[h,u]}(i,e[0],e[1]):function(r,n){let a=0,h=0;n<0&&(n=0);const u=n/Math.sqrt(2);switch(r){case"top-right":case"top-left":h=u-7;break;case"bottom-right":case"bottom-left":h=7-u;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(r){case"top-right":case"bottom-right":a=-u;break;case"top-left":case"bottom-left":a=u;break;case"left":a=n;break;case"right":a=-n}return[a,h]}(i,e[0])}function cf(i,e,r,n,a,h,u,f){i.createArrays(),i.tilePixelRatio=Rt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const m=i.layers[0].layout,g=i.layers[0]._unevaluatedLayout._values,x={};if(i.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:L}=i.textSizeData;x.compositeTextSizes=[g["text-size"].possiblyEvaluate(new k(M),u),g["text-size"].possiblyEvaluate(new k(L),u)]}if(i.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:L}=i.iconSizeData;x.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new k(M),u),g["icon-size"].possiblyEvaluate(new k(L),u)]}x.layoutTextSize=g["text-size"].possiblyEvaluate(new k(f+1),u),x.layoutIconSize=g["icon-size"].possiblyEvaluate(new k(f+1),u),x.textMaxSize=g["text-size"].possiblyEvaluate(new k(18),u);const b=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point",T=m.get("text-keep-upright"),I=m.get("text-size");for(const M of i.features){const L=m.get("text-font").evaluate(M,{},u).join(","),q=I.evaluate(M,{},u),K=x.layoutTextSize.evaluate(M,{},u),ne=(x.layoutIconSize.evaluate(M,{},u),{horizontal:{},vertical:void 0}),ce=M.text;let ue,he=[0,0];if(ce){const Ae=ce.toString(),Me=m.get("text-letter-spacing").evaluate(M,{},u)*di,Ue=m.get("text-line-height").evaluate(M,{},u)*di,Se=El(Ae)?Me:0,Re=m.get("text-anchor").evaluate(M,{},u),Pe=m.get("text-variable-anchor");if(!Pe){const yt=m.get("text-radial-offset").evaluate(M,{},u);he=yt?ku(Re,[yt*di,qc]):m.get("text-offset").evaluate(M,{},u).map(qt=>qt*di)}let Te=b?"center":m.get("text-justify").evaluate(M,{},u);const Xe=m.get("symbol-placement"),tt=Xe==="point"?m.get("text-max-width").evaluate(M,{},u)*di:0,Bt=()=>{i.allowVerticalPlacement&&na(Ae)&&(ne.vertical=Nl(ce,e,r,a,L,tt,Ue,Re,"left",Se,he,Wi.vertical,!0,Xe,K,q))};if(!b&&Pe){const yt=Te==="auto"?Pe.map(Zt=>$c(Zt)):[Te];let qt=!1;for(let Zt=0;Zt<yt.length;Zt++){const ct=yt[Zt];if(!ne.horizontal[ct])if(qt)ne.horizontal[ct]=ne.horizontal[0];else{const Xt=Nl(ce,e,r,a,L,tt,Ue,"center",ct,Se,he,Wi.horizontal,!1,Xe,K,q);Xt&&(ne.horizontal[ct]=Xt,qt=Xt.positionedLines.length===1)}}Bt()}else{Te==="auto"&&(Te=$c(Re));const yt=Nl(ce,e,r,a,L,tt,Ue,Re,Te,Se,he,Wi.horizontal,!1,Xe,K,q);yt&&(ne.horizontal[Te]=yt),Bt(),na(Ae)&&b&&T&&(ne.vertical=Nl(ce,e,r,a,L,tt,Ue,Re,Te,Se,he,Wi.vertical,!1,Xe,K,q))}}let pe=!1;if(M.icon&&M.icon.name){const Ae=n[M.icon.name];Ae&&(ue=ef(a[M.icon.name],m.get("icon-offset").evaluate(M,{},u),m.get("icon-anchor").evaluate(M,{},u)),pe=Ae.sdf,i.sdfIcons===void 0?i.sdfIcons=Ae.sdf:i.sdfIcons!==Ae.sdf&&zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==i.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Le=Du(ne.horizontal)||ne.vertical;i.iconsInText||(i.iconsInText=!!Le&&Le.iconsInText),(Le||ue)&&hf(i,M,ne,ue,n,x,K,0,he,pe,u)}h&&i.generateCollisionDebugBuffers(f,i.collisionBoxArray)}function $c(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hf(i,e,r,n,a,h,u,f,m,g,x){let b=h.textMaxSize.evaluate(e,{},x);b===void 0&&(b=u);const T=i.layers[0].layout,I=T.get("icon-offset").evaluate(e,{},x),M=Du(r.horizontal),L=u/24,q=i.tilePixelRatio*L,K=i.tilePixelRatio*b/24,ne=i.tilePixelRatio*T.get("symbol-spacing"),ce=T.get("text-padding")*i.tilePixelRatio,ue=T.get("icon-padding")*i.tilePixelRatio,he=G(T.get("text-max-angle")),pe=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Le=T.get("icon-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Ae=T.get("symbol-placement"),Me=ne/2,Ue=T.get("icon-text-fit");let Se;n&&Ue!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Se=xu(n,r.vertical,Ue,T.get("icon-text-fit-padding"),I,L)),M&&(n=xu(n,M,Ue,T.get("icon-text-fit-padding"),I,L)));const Re=(Pe,Te)=>{Te.x<0||Te.x>=Rt||Te.y<0||Te.y>=Rt||function(Xe,tt,Bt,yt,qt,Zt,ct,Xt,gi,ti,fi,mi,Mi,ii,Ht,li,Ii,vi,bi,$t,Dt,Lt,Hi,Ft,Gr){const ci=Xe.addToLineVertexArray(tt,Bt);let sr,ar,Er,lr,ln,Fi,cn,Ea=0,up=0,pp=0,dp=0,sh=-1,ah=-1;const hn={};let fp=la(""),lh=0,ch=0;if(Xt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[lh,ch]=Xt.layout.get("text-offset").evaluate(Dt,{},Ft).map(Ki=>Ki*di):(lh=Xt.layout.get("text-radial-offset").evaluate(Dt,{},Ft)*di,ch=qc),Xe.allowVerticalPlacement&&yt.vertical){const Ki=yt.vertical;if(Ht)Fi=jc(Ki),ct&&(cn=jc(ct));else{const Yi=Xt.layout.get("text-rotate").evaluate(Dt,{},Ft)+90;Er=Zl(gi,tt,ti,fi,mi,Ki,0,ii,Yi),ct&&(lr=Zl(gi,tt,ti,fi,mi,ct,0,vi,Yi))}}if(qt){const Ki=Xt.layout.get("icon-rotate").evaluate(Dt,{},Ft),Yi=Xt.layout.get("icon-text-fit")!=="none",Sa=Mu(qt,Ki,Hi,Yi),uh=ct?Mu(ct,Ki,Hi,Yi):void 0;ar=Zl(gi,tt,ti,fi,mi,qt,0,vi,Ki),Ea=4*Sa.length;const _p=Xe.iconSizeData;let So=null;_p.kind==="source"?(So=[Vr*Xt.layout.get("icon-size").evaluate(Dt,{},Ft)],So[0]>Vn&&zt(`${Xe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):_p.kind==="composite"&&(So=[Vr*Lt.compositeIconSizes[0].evaluate(Dt,{},Ft),Vr*Lt.compositeIconSizes[1].evaluate(Dt,{},Ft)],(So[0]>Vn||So[1]>Vn)&&zt(`${Xe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,Sa,So,$t,bi,Dt,!1,tt,ci.lineStartIndex,ci.lineLength,-1,Ft),sh=Xe.icon.placedSymbolArray.length-1,uh&&(up=4*uh.length,Xe.addSymbols(Xe.icon,uh,So,$t,bi,Dt,Wi.vertical,tt,ci.lineStartIndex,ci.lineLength,-1,Ft),ah=Xe.icon.placedSymbolArray.length-1)}for(const Ki in yt.horizontal){const Yi=yt.horizontal[Ki];sr||(fp=la(Yi.text),Ht?ln=jc(Yi):sr=Zl(gi,tt,ti,fi,mi,Yi,0,ii,Xt.layout.get("text-rotate").evaluate(Dt,{},Ft)));const Sa=Yi.positionedLines.length===1;if(pp+=Pu(Xe,tt,Yi,Zt,Xt,Ht,Dt,li,ci,yt.vertical?Wi.horizontal:Wi.horizontalOnly,Sa?Object.keys(yt.horizontal):[Ki],hn,sh,Lt,Ft),Sa)break}yt.vertical&&(dp+=Pu(Xe,tt,yt.vertical,Zt,Xt,Ht,Dt,li,ci,Wi.vertical,["vertical"],hn,ah,Lt,Ft));let un=-1;const hh=(Ki,Yi)=>Ki?Math.max(Ki,Yi):Yi;un=hh(ln,un),un=hh(Fi,un),un=hh(cn,un);const mp=un>-1?1:0;mp&&(un*=Gr/di),Xe.glyphOffsetArray.length>=Nn.MAX_GLYPHS&&zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dt.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,Dt.sortKey),Xe.symbolInstances.emplaceBack(tt.x,tt.y,hn.right>=0?hn.right:-1,hn.center>=0?hn.center:-1,hn.left>=0?hn.left:-1,hn.vertical||-1,sh,ah,fp,sr!==void 0?sr:Xe.collisionBoxArray.length,sr!==void 0?sr+1:Xe.collisionBoxArray.length,Er!==void 0?Er:Xe.collisionBoxArray.length,Er!==void 0?Er+1:Xe.collisionBoxArray.length,ar!==void 0?ar:Xe.collisionBoxArray.length,ar!==void 0?ar+1:Xe.collisionBoxArray.length,lr||Xe.collisionBoxArray.length,lr?lr+1:Xe.collisionBoxArray.length,ti,pp,dp,Ea,up,mp,0,Mi,lh,ch,un)}(i,Te,Pe,r,n,a,Se,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,q,ce,pe,m,0,ue,Le,I,e,h,g,x,u)};if(Ae==="line")for(const Pe of Su(e.geometry,0,0,Rt,Rt)){const Te=rf(Pe,ne,he,r.vertical||M,n,24,K,i.overscaling,Rt);for(const Xe of Te){const tt=M;tt&&uf(i,tt.text,Me,Xe)||Re(Pe,Xe)}}else if(Ae==="line-center"){for(const Pe of e.geometry)if(Pe.length>1){const Te=tf(Pe,he,r.vertical||M,n,24,K);Te&&Re(Pe,Te)}}else if(e.type==="Polygon")for(const Pe of zc(e.geometry,0)){const Te=af(Pe,16);Re(Pe[0],new Un(Te.x,Te.y,0))}else if(e.type==="LineString")for(const Pe of e.geometry)Re(Pe,new Un(Pe[0].x,Pe[0].y,0));else if(e.type==="Point")for(const Pe of e.geometry)for(const Te of Pe)Re([Te],new Un(Te.x,Te.y,0))}const Vn=32640;function Pu(i,e,r,n,a,h,u,f,m,g,x,b,T,I,M){const L=function(ne,ce,ue,he,pe,Le,Ae,Me){const Ue=he.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,Se=[];for(const Re of ce.positionedLines)for(const Pe of Re.positionedGlyphs){if(!Pe.rect)continue;const Te=Pe.rect||{};let Xe=4,tt=!0,Bt=1,yt=0;const qt=(pe||Me)&&Pe.vertical,Zt=Pe.metrics.advance*Pe.scale/2;if(Me&&ce.verticalizable){const $t=(Pe.scale-1)*di,Dt=(di-Pe.metrics.width*Pe.scale)/2;yt=Re.lineOffset/2-(Pe.imageName?-Dt:$t)}if(Pe.imageName){const $t=Ae[Pe.imageName];tt=$t.sdf,Bt=$t.pixelRatio,Xe=1/Bt}const ct=pe?[Pe.x+Zt,Pe.y]:[0,0];let Xt=pe?[0,0]:[Pe.x+Zt+ue[0],Pe.y+ue[1]-yt],gi=[0,0];qt&&(gi=Xt,Xt=[0,0]);const ti=(Pe.metrics.left-Xe)*Pe.scale-Zt+Xt[0],fi=(-Pe.metrics.top-Xe)*Pe.scale+Xt[1],mi=ti+Te.w*Pe.scale/(Bt*(Pe.localGlyph?2:1)),Mi=fi+Te.h*Pe.scale/(Bt*(Pe.localGlyph?2:1)),ii=new X(ti,fi),Ht=new X(mi,fi),li=new X(ti,Mi),Ii=new X(mi,Mi);if(qt){const $t=new X(-Zt,Zt-Vl),Dt=-Math.PI/2,Lt=12-Zt,Hi=new X(22-Lt,-(Pe.imageName?Lt:0)),Ft=new X(...gi);ii._rotateAround(Dt,$t)._add(Hi)._add(Ft),Ht._rotateAround(Dt,$t)._add(Hi)._add(Ft),li._rotateAround(Dt,$t)._add(Hi)._add(Ft),Ii._rotateAround(Dt,$t)._add(Hi)._add(Ft)}if(Ue){const $t=Math.sin(Ue),Dt=Math.cos(Ue),Lt=[Dt,-$t,$t,Dt];ii._matMult(Lt),Ht._matMult(Lt),li._matMult(Lt),Ii._matMult(Lt)}const vi=new X(0,0),bi=new X(0,0);Se.push({tl:ii,tr:Ht,bl:li,br:Ii,tex:Te,writingMode:ce.writingMode,glyphOffset:ct,sectionIndex:Pe.sectionIndex,isSDF:tt,pixelOffsetTL:vi,pixelOffsetBR:bi,minFontScaleX:0,minFontScaleY:0})}return Se}(0,r,f,a,h,u,n,i.allowVerticalPlacement),q=i.textSizeData;let K=null;q.kind==="source"?(K=[Vr*a.layout.get("text-size").evaluate(u,{},M)],K[0]>Vn&&zt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):q.kind==="composite"&&(K=[Vr*I.compositeTextSizes[0].evaluate(u,{},M),Vr*I.compositeTextSizes[1].evaluate(u,{},M)],(K[0]>Vn||K[1]>Vn)&&zt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,L,K,f,h,u,g,e,m.lineStartIndex,m.lineLength,T,M);for(const ne of x)b[ne]=i.text.placedSymbolArray.length-1;return 4*L.length}function Du(i){for(const e in i)return i[e];return null}function Zl(i,e,r,n,a,h,u,f,m){let g=h.top,x=h.bottom,b=h.left,T=h.right;const I=h.collisionPadding;if(I&&(b-=I[0],g-=I[1],T+=I[2],x+=I[3]),m){const M=new X(b,g),L=new X(T,g),q=new X(b,x),K=new X(T,x),ne=G(m);M._rotate(ne),L._rotate(ne),q._rotate(ne),K._rotate(ne),b=Math.min(M.x,L.x,q.x,K.x),T=Math.max(M.x,L.x,q.x,K.x),g=Math.min(M.y,L.y,q.y,K.y),x=Math.max(M.y,L.y,q.y,K.y)}return i.emplaceBack(e.x,e.y,b,g,T,x,f,r,n,a),i.length-1}function jc(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function uf(i,e,r,n){const a=i.compareText;if(e in a){const h=a[e];for(let u=h.length-1;u>=0;u--)if(n.dist(h[u])<r)return!0}else a[e]=[];return a[e].push(n),!1}const pf=wo.VectorTileFeature.types,df=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xl(i,e,r,n,a,h,u,f,m,g,x,b,T){const I=f?Math.min(Vn,Math.round(f[0])):0,M=f?Math.min(Vn,Math.round(f[1])):0;i.emplaceBack(e,r,Math.round(32*n),Math.round(32*a),h,u,(I<<1)+(m?1:0),M,16*g,16*x,256*b,256*T)}function Zc(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function ff(i){for(const e of i.sections)if(l(e.text))return!0;return!1}class Xc{constructor(e){this.layoutVertexArray=new ir,this.indexArray=new vt,this.programConfigurations=e,this.segments=new Si,this.dynamicLayoutVertexArray=new Ti,this.opacityVertexArray=new Ei,this.placedSymbolArray=new yo}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,a){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Dd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,df,!0),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ze("SymbolBuffers",Xc);class Wc{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new Si,this.collisionVertexArray=new ni,this.collisionVertexArrayExt=new Ti}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ld.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Rd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ze("CollisionBuffers",Wc);class Nn{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(u=>u.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=bc([]),this.placementViewportMatrix=bc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bc(this.zoom,r["text-size"]),this.iconSizeData=Bc(this.zoom,r["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),h=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map(u=>Wi[u])),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.sourceID=e.sourceID}createArrays(){this.text=new Xc(new xo(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Xc(new xo(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new fh,this.lineVertexArray=new mh,this.symbolInstances=new dh}calculateGlyphDependencies(e,r,n,a,h){for(let u=0;u<e.length;u++)if(r[e.charCodeAt(u)]=!0,(n||a)&&h){const f=xa[e.charAt(u)];f&&(r[f.charCodeAt(0)]=!0)}}populate(e,r,n){const a=this.layers[0],h=a.layout,u=h.get("text-font"),f=h.get("text-field"),m=h.get("icon-image"),g=(f.value.kind!=="constant"||f.value.value instanceof Ci&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(u.value.kind!=="constant"||u.value.value.length>0),x=m.value.kind!=="constant"||!!m.value.value||Object.keys(m.parameters).length>0,b=h.get("symbol-sort-key");if(this.features=[],!g&&!x)return;const T=r.iconDependencies,I=r.glyphDependencies,M=r.availableImages,L=new k(this.zoom);for(const{feature:q,id:K,index:ne,sourceLayerIndex:ce}of e){const ue=a._featureFilter.needGeometry,he=bo(q,ue);if(!a._featureFilter.filter(L,he,n))continue;let pe,Le;if(ue||(he.geometry=vo(q)),g){const Me=a.getValueAndResolveTokens("text-field",he,n,M),Ue=Ci.factory(Me);ff(Ue)&&(this.hasRTLText=!0),(!this.hasRTLText||E()==="unavailable"||this.hasRTLText&&z.isParsed())&&(pe=Od(Ue,a,he))}if(x){const Me=a.getValueAndResolveTokens("icon-image",he,n,M);Le=Me instanceof qi?Me:qi.fromString(Me)}if(!pe&&!Le)continue;const Ae=this.sortFeaturesByKey?b.evaluate(he,{},n):void 0;if(this.features.push({id:K,text:pe,icon:Le,index:ne,sourceLayerIndex:ce,geometry:he.geometry,properties:q.properties,type:pf[q.type],sortKey:Ae}),Le&&(T[Le.name]=!0),pe){const Me=u.evaluate(he,{},n).join(","),Ue=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wi.vertical)>=0;for(const Se of pe.sections)if(Se.image)T[Se.image.name]=!0;else{const Re=na(pe.toString()),Pe=Se.fontStack||Me,Te=I[Pe]=I[Pe]||{};this.calculateGlyphDependencies(Se.text,Te,Ue,this.allowVerticalPlacement,Re)}}}h.get("symbol-placement")==="line"&&(this.features=function(q){const K={},ne={},ce=[];let ue=0;function he(Me){ce.push(q[Me]),ue++}function pe(Me,Ue,Se){const Re=ne[Me];return delete ne[Me],ne[Ue]=Re,ce[Re].geometry[0].pop(),ce[Re].geometry[0]=ce[Re].geometry[0].concat(Se[0]),Re}function Le(Me,Ue,Se){const Re=K[Ue];return delete K[Ue],K[Me]=Re,ce[Re].geometry[0].shift(),ce[Re].geometry[0]=Se[0].concat(ce[Re].geometry[0]),Re}function Ae(Me,Ue,Se){const Re=Se?Ue[0][Ue[0].length-1]:Ue[0][0];return`${Me}:${Re.x}:${Re.y}`}for(let Me=0;Me<q.length;Me++){const Ue=q[Me],Se=Ue.geometry,Re=Ue.text?Ue.text.toString():null;if(!Re){he(Me);continue}const Pe=Ae(Re,Se),Te=Ae(Re,Se,!0);if(Pe in ne&&Te in K&&ne[Pe]!==K[Te]){const Xe=Le(Pe,Te,Se),tt=pe(Pe,Te,ce[Xe].geometry);delete K[Pe],delete ne[Te],ne[Ae(Re,ce[tt].geometry,!0)]=tt,ce[Xe].geometry=null}else Pe in ne?pe(Pe,Te,Se):Te in K?Le(Pe,Te,Se):(he(Me),K[Pe]=ue-1,ne[Te]=ue-1)}return ce.filter(Me=>Me.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,K)=>q.sortKey-K.sortKey)}update(e,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length;if(e.segment!==void 0){let a=e.dist(r[e.segment+1]),h=e.dist(r[e.segment]);const u={};for(let f=e.segment+1;f<r.length;f++)u[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:a},f<r.length-1&&(a+=r[f+1].dist(r[f]));for(let f=e.segment||0;f>=0;f--)u[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:h},f>0&&(h+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const m=u[f];this.lineVertexArray.emplaceBack(m.x,m.y,m.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,a,h,u,f,m,g,x,b,T){const I=e.indexArray,M=e.layoutVertexArray,L=e.segments.prepareSegment(4*r.length,M,I,this.canOverlap?u.sortKey:void 0),q=this.glyphOffsetArray.length,K=L.vertexLength,ne=this.allowVerticalPlacement&&f===Wi.vertical?Math.PI/2:0,ce=u.text&&u.text.sections;for(let ue=0;ue<r.length;ue++){const{tl:he,tr:pe,bl:Le,br:Ae,tex:Me,pixelOffsetTL:Ue,pixelOffsetBR:Se,minFontScaleX:Re,minFontScaleY:Pe,glyphOffset:Te,isSDF:Xe,sectionIndex:tt}=r[ue],Bt=L.vertexLength,yt=Te[1];Xl(M,m.x,m.y,he.x,yt+he.y,Me.x,Me.y,n,Xe,Ue.x,Ue.y,Re,Pe),Xl(M,m.x,m.y,pe.x,yt+pe.y,Me.x+Me.w,Me.y,n,Xe,Se.x,Ue.y,Re,Pe),Xl(M,m.x,m.y,Le.x,yt+Le.y,Me.x,Me.y+Me.h,n,Xe,Ue.x,Se.y,Re,Pe),Xl(M,m.x,m.y,Ae.x,yt+Ae.y,Me.x+Me.w,Me.y+Me.h,n,Xe,Se.x,Se.y,Re,Pe),Zc(e.dynamicLayoutVertexArray,m,ne),I.emplaceBack(Bt,Bt+1,Bt+2),I.emplaceBack(Bt+1,Bt+2,Bt+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),ue!==r.length-1&&tt===r[ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(M.length,u,u.index,{},T,ce&&ce[tt])}e.placedSymbolArray.emplaceBack(m.x,m.y,q,this.glyphOffsetArray.length-q,K,g,x,m.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],f,0,!1,0,b)}_commitLayoutVertex(e,r,n,a,h){e.emplaceBack(r.x,r.y,n,a,Math.round(h.x),Math.round(h.y))}_addCollisionDebugVertices(e,r,n,a,h){const u=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),f=u.vertexLength,m=h.anchorX,g=h.anchorY;for(let b=0;b<4;b++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,a,m,g,new X(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,m,g,new X(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,m,g,new X(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,m,g,new X(e.x1,e.y2)),u.vertexLength+=4;const x=n.indexArray;x.emplaceBack(f,f+1),x.emplaceBack(f+1,f+2),x.emplaceBack(f+2,f+3),x.emplaceBack(f+3,f),u.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,a,h,u){for(let f=a;f<h;f++){const m=n.get(f),g=this.getSymbolInstanceTextSize(e,u,r,f);this._addCollisionDebugVertices(m,g,this.textCollisionBox,m.anchorPoint,u)}}_addIconDebugCollisionBoxes(e,r,n,a,h,u){for(let f=a;f<h;f++){const m=n.get(f),g=this.getSymbolInstanceIconSize(e,r,f);this._addCollisionDebugVertices(m,g,this.iconCollisionBox,m.anchorPoint,u)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wc(nr,au.members,pi),this.iconCollisionBox=new Wc(nr,au.members,pi);const n=vs(this.iconSizeData,e),a=vs(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const u=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(a,e,r,u.textBoxStartIndex,u.textBoxEndIndex,u),this._addTextDebugCollisionBoxes(a,e,r,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._addIconDebugCollisionBoxes(n,e,r,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._addIconDebugCollisionBoxes(n,e,r,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}}getSymbolInstanceTextSize(e,r,n,a){const h=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),u=Ol(this.textSizeData,e,h)/di;return this.tilePixelRatio*u}getSymbolInstanceIconSize(e,r,n){const a=this.icon.placedSymbolArray.get(n),h=Ol(this.iconSizeData,e,a);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,r,n){e.emplaceBack(r,-n,-n),e.emplaceBack(r,n,-n),e.emplaceBack(r,n,n),e.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(e,r,n,a,h,u){for(let f=a;f<h;f++){const m=n.get(f),g=this.getSymbolInstanceTextSize(e,u,r,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,m.padding)}}_updateIconDebugCollisionBoxes(e,r,n,a,h){for(let u=a;u<h;u++){const f=n.get(u),m=this.getSymbolInstanceIconSize(e,r,u);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,m,f.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=vs(this.iconSizeData,e),a=vs(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const u=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(a,e,r,u.textBoxStartIndex,u.textBoxEndIndex,u),this._updateTextDebugCollisionBoxes(a,e,r,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._updateIconDebugCollisionBoxes(n,e,r,u.iconBoxStartIndex,u.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,r,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,a,h,u,f,m,g){const x={};for(let b=r;b<n;b++){const T=e.get(b);x.textBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.textFeatureIndex=T.featureIndex;break}for(let b=a;b<h;b++){const T=e.get(b);x.verticalTextBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.verticalTextFeatureIndex=T.featureIndex;break}for(let b=u;b<f;b++){const T=e.get(b);x.iconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.iconFeatureIndex=T.featureIndex;break}for(let b=m;b<g;b++){const T=e.get(b);x.verticalIconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.verticalIconFeatureIndex=T.featureIndex;break}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),a=n.vertexStartIndex+4*n.numGlyphs;for(let h=n.vertexStartIndex;h<a;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),a=[],h=[],u=[];for(let f=0;f<this.symbolInstances.length;++f){u.push(f);const m=this.symbolInstances.get(f);a.push(0|Math.round(r*m.anchorX+n*m.anchorY)),h.push(m.featureIndex)}return u.sort((f,m)=>a[f]-a[m]||h[m]-h[f]),u}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((a,h,u)=>{a>=0&&u.indexOf(a)===h&&this.addIndicesForPlacedSymbol(this.text,a)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ze("SymbolBucket",Nn,{omit:["layers","collisionBoxArray","features","compareText"]}),Nn.MAX_GLYPHS=65535,Nn.addDynamicAttributes=Zc;const mf=new ke({"symbol-placement":new N(Y.layout_symbol["symbol-placement"]),"symbol-spacing":new N(Y.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new N(Y.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new oe(Y.layout_symbol["symbol-sort-key"]),"symbol-z-order":new N(Y.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new N(Y.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new N(Y.layout_symbol["icon-ignore-placement"]),"icon-optional":new N(Y.layout_symbol["icon-optional"]),"icon-rotation-alignment":new N(Y.layout_symbol["icon-rotation-alignment"]),"icon-size":new oe(Y.layout_symbol["icon-size"]),"icon-text-fit":new N(Y.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new N(Y.layout_symbol["icon-text-fit-padding"]),"icon-image":new oe(Y.layout_symbol["icon-image"]),"icon-rotate":new oe(Y.layout_symbol["icon-rotate"]),"icon-padding":new N(Y.layout_symbol["icon-padding"]),"icon-keep-upright":new N(Y.layout_symbol["icon-keep-upright"]),"icon-offset":new oe(Y.layout_symbol["icon-offset"]),"icon-anchor":new oe(Y.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new N(Y.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new N(Y.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new N(Y.layout_symbol["text-rotation-alignment"]),"text-field":new oe(Y.layout_symbol["text-field"]),"text-font":new oe(Y.layout_symbol["text-font"]),"text-size":new oe(Y.layout_symbol["text-size"]),"text-max-width":new oe(Y.layout_symbol["text-max-width"]),"text-line-height":new oe(Y.layout_symbol["text-line-height"]),"text-letter-spacing":new oe(Y.layout_symbol["text-letter-spacing"]),"text-justify":new oe(Y.layout_symbol["text-justify"]),"text-radial-offset":new oe(Y.layout_symbol["text-radial-offset"]),"text-variable-anchor":new N(Y.layout_symbol["text-variable-anchor"]),"text-anchor":new oe(Y.layout_symbol["text-anchor"]),"text-max-angle":new N(Y.layout_symbol["text-max-angle"]),"text-writing-mode":new N(Y.layout_symbol["text-writing-mode"]),"text-rotate":new oe(Y.layout_symbol["text-rotate"]),"text-padding":new N(Y.layout_symbol["text-padding"]),"text-keep-upright":new N(Y.layout_symbol["text-keep-upright"]),"text-transform":new oe(Y.layout_symbol["text-transform"]),"text-offset":new oe(Y.layout_symbol["text-offset"]),"text-allow-overlap":new N(Y.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new N(Y.layout_symbol["text-ignore-placement"]),"text-optional":new N(Y.layout_symbol["text-optional"])});var Hc={paint:new ke({"icon-opacity":new oe(Y.paint_symbol["icon-opacity"]),"icon-color":new oe(Y.paint_symbol["icon-color"]),"icon-halo-color":new oe(Y.paint_symbol["icon-halo-color"]),"icon-halo-width":new oe(Y.paint_symbol["icon-halo-width"]),"icon-halo-blur":new oe(Y.paint_symbol["icon-halo-blur"]),"icon-translate":new N(Y.paint_symbol["icon-translate"]),"icon-translate-anchor":new N(Y.paint_symbol["icon-translate-anchor"]),"text-opacity":new oe(Y.paint_symbol["text-opacity"]),"text-color":new oe(Y.paint_symbol["text-color"],{runtimeType:ri,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new oe(Y.paint_symbol["text-halo-color"]),"text-halo-width":new oe(Y.paint_symbol["text-halo-width"]),"text-halo-blur":new oe(Y.paint_symbol["text-halo-blur"]),"text-translate":new N(Y.paint_symbol["text-translate"]),"text-translate-anchor":new N(Y.paint_symbol["text-translate-anchor"])}),layout:mf};class Lu{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze("FormatSectionOverride",Lu,{omit:["defaultValue"]});class Wl extends wr{constructor(e){super(e,Hc)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const h of n)a.indexOf(h)<0&&a.push(h);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,a){const h=this.layout.get(e).evaluate(r,{},n,a),u=this._unevaluatedLayout._values[e];return u.isDataDriven()||ji(u.value)||!h?h:function(f,m){return m.replace(/{([^{}]+)}/g,(g,x)=>x in f?String(f[x]):"")}(r.properties,h)}createBucket(e){return new Nn(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Hc.paint.overridableProperties){if(!Wl.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new Lu(r),a=new Ws(n,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new Fr("source",a):new Jo("composite",a,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new H(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Wl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),a=Hc.paint.properties[r];let h=!1;const u=f=>{for(const m of f)if(a.overrides&&a.overrides.hasOverride(m))return void(h=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Ci)u(n.value.value.sections);else if(n.value.kind==="source"){const f=g=>{h||(g instanceof hr&&Jt(g.value)===gn?u(g.value.sections):g instanceof Jn?u(g.sections):g.eachChild(f))},m=n.value;m._styleExpression&&f(m._styleExpression.expression)}return h}getProgramConfiguration(e){return new sn(this,e)}}var _f={paint:new ke({"background-color":new N(Y.paint_background["background-color"]),"background-pattern":new Ie(Y.paint_background["background-pattern"]),"background-opacity":new N(Y.paint_background["background-opacity"])})},gf={paint:new ke({"raster-opacity":new N(Y.paint_raster["raster-opacity"]),"raster-hue-rotate":new N(Y.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new N(Y.paint_raster["raster-brightness-min"]),"raster-brightness-max":new N(Y.paint_raster["raster-brightness-max"]),"raster-saturation":new N(Y.paint_raster["raster-saturation"]),"raster-contrast":new N(Y.paint_raster["raster-contrast"]),"raster-resampling":new N(Y.paint_raster["raster-resampling"]),"raster-fade-duration":new N(Y.paint_raster["raster-fade-duration"])})};class yf extends wr{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var xf={paint:new ke({"sky-type":new N(Y.paint_sky["sky-type"]),"sky-atmosphere-sun":new N(Y.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new N(Y.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new N(Y.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new N(Y.paint_sky["sky-gradient-radius"]),"sky-gradient":new j(Y.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new N(Y.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new N(Y.paint_sky["sky-atmosphere-color"]),"sky-opacity":new N(Y.paint_sky["sky-opacity"])})};function Kc(i,e,r){const n=gs(0,0,1),a=Nh(wc());return function(h,u,f){f*=.5;var m=u[0],g=u[1],x=u[2],b=u[3],T=Math.sin(f),I=Math.cos(f);h[0]=m*I-x*T,h[1]=g*I+b*T,h[2]=x*I+m*T,h[3]=b*I-g*T}(a,a,r?-G(i)+Math.PI:G(i)),Gh(a,a,-G(e)),Vh(n,n,a),Uh(n,n)}const vf={circle:class extends wr{constructor(i){super(i,Np)}createBucket(i){return new yc(i)}queryRadius(i){const e=i;return ha("circle-radius",this,e)+ha("circle-stroke-width",this,e)+Pl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,n,a,h,u,f){const m=this.paint.get("circle-pitch-alignment")==="map";if(m&&i.queryGeometry.isAboveHorizon)return!1;const g=Ph(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),b=m?x*i.pixelToTileUnitsFactor:x;for(const T of n)for(const I of T){const M=I.add(g),L=f&&h.elevation?h.elevation.exaggeration()*f.getElevationAt(M.x,M.y,!0):0,q=m?M:Zp(M,L,u),K=m?i.tilespaceRays.map(ue=>Wp(ue,L)):i.queryGeometry.screenGeometry;let ne=b;const ce=pa([],[I.x,I.y,L,1],u);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ne*=ce[3]/h.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ne*=h.cameraToCenterDistance/ce[3]),Bp(K,q,ne))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new sn(this,i)}},heatmap:class extends wr{createBucket(i){return new $h(i)}constructor(i){super(i,Hp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new sn(this,i)}},hillshade:class extends wr{constructor(i){super(i,Kp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new sn(this,i)}},fill:class extends wr{constructor(i){super(i,dd)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new sn(this,i)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Dc(i)}queryRadius(){return Pl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,n,a,h){return!i.queryGeometry.isAboveHorizon&&Ah(kh(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends wr{constructor(i){super(i,Td)}createBucket(i){return new Lc(i)}queryRadius(){return Pl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new sn(this,i)}queryIntersectsFeature(i,e,r,n,a,h,u,f,m){const g=Ph(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,r),b=this.paint.get("fill-extrusion-base").evaluate(e,r),T=[0,0],I=f&&h.elevation,M=h.elevation?h.elevation.exaggeration():1;if(I){const K=i.tile.getBucket(this).centroidVertexArray,ne=m+1;if(ne<K.length){const ce=K.get(ne);T[0]=ce.a_centroid_pos0,T[1]=ce.a_centroid_pos1}}if(T[0]===0&&T[1]===1)return!1;const L=function(K,ne,ce,ue,he,pe,Le,Ae,Me){return pe?function(Ue,Se,Re,Pe,Te,Xe,tt,Bt,yt){const qt=[],Zt=[],ct=[0,0,0,1];for(const Xt of Ue){const gi=[],ti=[];for(const fi of Xt){const mi=fi.x+Pe.x,Mi=fi.y+Pe.y,ii=Ed(mi,Mi,Se,Re,Xe,tt,Bt,yt);ct[0]=mi,ct[1]=Mi,ct[2]=ii.base,ct[3]=1,pa(ct,ct,Te),ct[3]=Math.max(ct[3],1e-5);const Ht=ru([ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]]);ct[0]=mi,ct[1]=Mi,ct[2]=ii.top,ct[3]=1,pa(ct,ct,Te),ct[3]=Math.max(ct[3],1e-5);const li=ru([ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]]);gi.push(Ht),ti.push(li)}qt.push(gi),Zt.push(ti)}return[qt,Zt]}(K,ne,ce,ue,he,pe,Le,Ae,Me):function(Ue,Se,Re,Pe,Te){const Xe=[],tt=[],Bt=Te[8]*Se,yt=Te[9]*Se,qt=Te[10]*Se,Zt=Te[11]*Se,ct=Te[8]*Re,Xt=Te[9]*Re,gi=Te[10]*Re,ti=Te[11]*Re;for(const fi of Ue){const mi=[],Mi=[];for(const ii of fi){const Ht=ii.x+Pe.x,li=ii.y+Pe.y,Ii=Te[0]*Ht+Te[4]*li+Te[12],vi=Te[1]*Ht+Te[5]*li+Te[13],bi=Te[2]*Ht+Te[6]*li+Te[14],$t=Te[3]*Ht+Te[7]*li+Te[15],Dt=Ii+Bt,Lt=vi+yt,Hi=bi+qt,Ft=Math.max($t+Zt,1e-5),Gr=Ii+ct,ci=vi+Xt,sr=bi+gi,ar=Math.max($t+ti,1e-5),Er=new X(Dt/Ft,Lt/Ft);Er.z=Hi/Ft,mi.push(Er);const lr=new X(Gr/ar,ci/ar);lr.z=sr/ar,Mi.push(lr)}Xe.push(mi),tt.push(Mi)}return[Xe,tt]}(K,ne,ce,ue,he)}(n,b,x,g,u,I?f:null,T,M,h.center.lat),q=i.queryGeometry;return function(K,ne,ce){let ue=1/0;Ah(ce,ne)&&(ue=iu(ce,ne[0]));for(let he=0;he<ne.length;he++){const pe=ne[he],Le=K[he];for(let Ae=0;Ae<pe.length-1;Ae++){const Me=pe[Ae],Ue=[Me,pe[Ae+1],Le[Ae+1],Le[Ae],Me];Ih(ce,Ue)&&(ue=Math.min(ue,iu(ce,Ue)))}}return ue!==1/0&&ue}(L[0],L[1],q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends wr{constructor(i){super(i,nu),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof wn,this.gradientVersion=(this.gradientVersion+1)%_e}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=ou.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Rc(i)}getProgramIds(){const i=this.paint.get("line-dasharray"),e=this.paint.get("line-pattern").constantOr(1),r=this.paint.get("line-gradient");return[e?"linePattern":i?"lineSDF":r?"lineGradient":"line"]}getProgramConfiguration(i){return new sn(this,i)}queryRadius(i){const e=i,r=su(ha("line-width",this,e),ha("line-gap-width",this,e)),n=ha("line-offset",this,e);return r/2+Math.abs(n)+Pl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,n,a,h){if(i.queryGeometry.isAboveHorizon)return!1;const u=kh(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),f=i.pixelToTileUnitsFactor/2*su(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),m=this.paint.get("line-offset").evaluate(e,r);return m&&(n=function(g,x){const b=[],T=new X(0,0);for(let I=0;I<g.length;I++){const M=g[I],L=[];for(let q=0;q<M.length;q++){const K=M[q-1],ne=M[q],ce=M[q+1],ue=q===0?T:ne.sub(K)._unit()._perp(),he=q===M.length-1?T:ce.sub(ne)._unit()._perp(),pe=ue._add(he)._unit();pe._mult(1/(pe.x*he.x+pe.y*he.y)),L.push(pe._mult(x)._add(ne))}b.push(L)}return b}(n,m*i.pixelToTileUnitsFactor)),function(g,x,b){for(let T=0;T<x.length;T++){const I=x[T];if(g.length>=3){for(let M=0;M<I.length;M++)if(_s(g,I[M]))return!0}if(Fp(g,I,b))return!0}return!1}(u,n,f)}isTileClipped(){return!0}},symbol:Wl,background:class extends wr{constructor(i){super(i,_f)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends wr{constructor(i){super(i,gf)}getProgramIds(){return["raster"]}},sky:class extends wr{constructor(i){super(i,xf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Sc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(i,e){const r=this.paint.get("sky-type");if(r==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,h=i.style.light,u=h.properties.get("position");return a&&h.properties.get("anchor")==="viewport"&&zt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Kc(u.azimuthal,90-u.polar,e):Kc(n[0],90-n[1],e)}if(r==="gradient"){const n=this.paint.get("sky-gradient-center");return Kc(n[0],90-n[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:Ru,HTMLCanvasElement:Bu,HTMLVideoElement:Fu,ImageData:Ou,ImageBitmap:Hl}=ie;class Kl{constructor(e,r,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,a)}update(e,r,n){const{width:a,height:h}=e,u=!(this.size&&this.size[0]===a&&this.size[1]===h||n),{context:f}=this,{gl:m}=f;if(this.useMipmap=Boolean(r&&r.useMipmap),m.bindTexture(m.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!r||r.premultiply!==!1)),u)this.size=[a,h],e instanceof Ru||e instanceof Bu||e instanceof Fu||e instanceof Ou||Hl&&e instanceof Hl?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,e):m.texImage2D(m.TEXTURE_2D,0,this.format,a,h,0,this.format,m.UNSIGNED_BYTE,e.data);else{const{x:g,y:x}=n||{x:0,y:0};e instanceof Ru||e instanceof Bu||e instanceof Fu||e instanceof Ou||Hl&&e instanceof Hl?m.texSubImage2D(m.TEXTURE_2D,0,g,x,m.RGBA,m.UNSIGNED_BYTE,e):m.texSubImage2D(m.TEXTURE_2D,0,g,x,a,h,m.RGBA,m.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&m.generateMipmap(m.TEXTURE_2D)}bind(e,r,n){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),n!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n||e),this.filter=e),r!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class To{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ei?new ei(e.lng,e.lat):ei.convert(e),this}setSouthWest(e){return this._sw=e instanceof ei?new ei(e.lng,e.lat):ei.convert(e),this}extend(e){const r=this._sw,n=this._ne;let a,h;if(e instanceof ei)a=e,h=e;else{if(!(e instanceof To))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(To.convert(e)):this.extend(ei.convert(e)):this;if(a=e._sw,h=e._ne,!a||!h)return this}return r||n?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),n.lng=Math.max(h.lng,n.lng),n.lat=Math.max(h.lat,n.lat)):(this._sw=new ei(a.lng,a.lat),this._ne=new ei(h.lng,h.lat)),this}getCenter(){return new ei((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ei(this.getWest(),this.getNorth())}getSouthEast(){return new ei(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=ei.convert(e);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof To?e:new To(e)}}const Uu=63710088e-1;class ei{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ei(lt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,a=e.lat*r,h=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*r);return Uu*Math.acos(Math.min(h,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new To(new ei(this.lng-n,this.lat-r),new ei(this.lng+n,this.lat+r))}static convert(e){if(e instanceof ei)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ei(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ei(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Vu=2*Math.PI*Uu;function Nu(i){return Vu*Math.cos(i*Math.PI/180)}function Gu(i){return(180+i)/360}function qu(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Yc(i,e){return i/Nu(e)}function Yl(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Jc(i,e){return i*Nu(Yl(e))}class As{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=ei.convert(e);return new As(Gu(n.lng),qu(n.lat),Yc(r,n.lat))}toLngLat(){return new ei(360*this.x-180,Yl(this.y))}toAltitude(){return Jc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Vu*(e=Yl(this.y),1/Math.cos(e*Math.PI/180));var e}}class Qc{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Fn({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=qe(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const a=[];let h=e.length%2==1?-e[e.length-1]*n:0,u=e[0]*n,f=!0;a.push({left:h,right:u,isDash:f,zeroLength:e[0]===0});let m=e[0];for(let g=1;g<e.length;g++){f=!f;const x=e[g];h=m*n,m+=x,u=m*n,a.push({left:h,right:u,isDash:f,zeroLength:x===0})}return a}addRoundDash(e,r,n){const a=r/2;for(let h=-n;h<=n;h++){const u=this.width*(this.nextRow+n+h);let f=0,m=e[f];for(let g=0;g<this.width;g++){g/m.right>1&&(m=e[++f]);const x=Math.abs(g-m.left),b=Math.abs(g-m.right),T=Math.min(x,b);let I;const M=h/n*(a+1);if(m.isDash){const L=a-Math.abs(M);I=Math.sqrt(T*T+L*L)}else I=a-Math.sqrt(T*T+M*M);this.image.data[u+g]=Math.max(0,Math.min(255,I+128))}}}addRegularDash(e,r){for(let m=e.length-1;m>=0;--m){const g=e[m],x=e[m+1];g.zeroLength?e.splice(m,1):x&&x.isDash===g.isDash&&(x.left=g.left,e.splice(m,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const h=this.width*this.nextRow;let u=0,f=e[u];for(let m=0;m<this.width;m++){m/f.right>1&&(f=e[++u]);const g=Math.abs(m-f.left),x=Math.abs(m-f.right),b=Math.min(g,x);this.image.data[h+m]=Math.max(0,Math.min(255,(f.isDash?b:-b)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const a=r==="round",h=a?7:0,u=2*h+1;if(this.nextRow+u>this.height)return zt("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let x=0;x<e.length;x++)e[x]<0&&(zt("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),f+=e[x];if(f!==0){const x=this.width/f,b=this.getDashRanges(e,this.width,x);a?this.addRoundDash(b,x,h):this.addRegularDash(b,r==="square"?.5*x:0)}const m=this.nextRow+h;this.nextRow+=u;const g={tl:[m,h],br:[f,0]};return this.positions[n]=g,g}}Ze("LineAtlas",Qc);class bf{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const wf=ie.performance;function $u(i){const e=i?i.url.toString():void 0;return wf.getEntriesByName(e)}class Tf{constructor(){this.tasks={},this.taskQueue=[],Je(["process"],this),this.invoker=new bf(this.process),this.nextId=0}add(e,r){const n=this.nextId++,a=function({type:h,isSymbolTile:u,zoom:f}){return f=f||0,h==="message"?0:h!=="maybePrepare"||u?h!=="parseTile"||u?h==="parseTile"&&u?300-f:h==="maybePrepare"&&u?400-f:500:200-f:100-f}(r);if(a===0){zi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:r,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){zi();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const h=this.tasks[this.taskQueue[a]];h.priority<r&&(r=h.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}function ju(i,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class eh{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=Ta(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=(h=this.y,u=this.z,f=ju(256*(a=this.x),256*(h=Math.pow(2,u)-h-1),u),m=ju(256*(a+1),256*(h+1),u),f[0]+","+f[1]+","+m[0]+","+m[1]);var a,h,u,f,m;const g=function(x,b,T){let I,M="";for(let L=x;L>0;L--)I=1<<L-1,M+=(b&I?1:0)+(T&I?2:0);return M}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",n)}getTilePoint(e){const r=Math.pow(2,this.z);return new X((e.x*r-this.x)*Rt,(e.y*r-this.y)*Rt)}getTileVec3(e){const r=Math.pow(2,this.z);return gs((e.x*r-this.x)*Rt,(e.y*r-this.y)*Rt,Jc(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zu{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ta(e,r.z,r.z,r.x,r.y)}}class Bi{constructor(e,r,n,a,h){this.overscaledZ=e,this.wrap=r,this.canonical=new eh(n,+a,+h),this.key=r===0&&e===n?this.canonical.key:Ta(r,e,n,a,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Bi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Ta(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Ta(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Bi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new Bi(r,this.wrap,r,n,a),new Bi(r,this.wrap,r,n+1,a),new Bi(r,this.wrap,r,n,a+1),new Bi(r,this.wrap,r,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Bi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Bi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new As(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new As(e.x-this.wrap,e.y,e.z))}}function Ta(i,e,r,n,a){const h=1<<Math.min(r,22);let u=h*(a%h)+n%h;return i&&r<22&&(u+=h*h*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*u+r)+(e-r)}Ze("CanonicalTileID",eh),Ze("OverscaledTileID",Bi,{omit:["projMatrix"]});class Xu{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Wu{constructor(e,r,n,a,h){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=n,e._y=a,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}var Ef=He([{name:"a_pos",type:"Int16",components:2}]);class Hu{constructor(e,r,n){this.tileID=e,this.uid=Ot(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<kt.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(e,r,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,h){const u={};if(!h)return u;for(const f of a){const m=f.layerIds.map(g=>h.getLayer(g)).filter(Boolean);if(m.length!==0){f.layers=m,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(g=>m.filter(x=>x.id===g)[0]));for(const g of m)u[g.id]=f}}return u}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const h=this.buckets[a];if(h instanceof Nn){if(this.hasSymbolBuckets=!0,!n)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const h=this.buckets[a];if(h instanceof Nn&&h.hasRTLText){this.hasRTLText=!0,z.isLoading()||z.isLoaded()||E()!=="deferred"||A();break}}this.queryPadding=0;for(const a in this.buckets){const h=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(a).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new nn}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const a=this.buckets[n];a.uploadPending()&&a.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Kl(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Kl(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Kl(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,n,a,h,u,f,m){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:f,transform:u,params:h},e,r,n):{}}querySourceFeatures(e,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const a=n.loadVTLayers(),h=r?r.sourceLayer:"",u=a._geojsonTileLayer||a[h];if(!u)return;const f=ts(r&&r.filter),{z:m,x:g,y:x}=this.tileID.canonical,b={z:m,x:g,y:x};for(let T=0;T<u.length;T++){const I=u.feature(T);if(f.needGeometry){const q=bo(I,!0);if(!f.filter(new k(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!f.filter(new k(this.tileID.overscaledZ),I))continue;const M=n.getId(I,h),L=new Wu(I,m,g,x,M);L.tile=b,e.push(L)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const n=Ai(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let a=!1;if(this.expirationTime>n)a=!1;else if(r)if(this.expirationTime<r)a=!0;else{const h=this.expirationTime-r;h?this.expirationTime=n+Math.max(h,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const n=this.latestFeatureIndex.loadVTLayers();for(const a in this.buckets){if(!r.style.hasLayer(a))continue;const h=this.buckets[a],u=h.layers[0].sourceLayer||"_geojsonTileLayer",f=n[u],m=e[u];if(!f||!m||Object.keys(m).length===0)continue;h.update(m,f,this.imageAtlas&&this.imageAtlas.patternPositions||{});const g=r&&r.style&&r.style.getLayer(a);g&&(this.queryPadding=Math.max(this.queryPadding,g.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<kt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=kt.now()+e}setDependencies(e,r){const n={};for(const a of r)n[a]=!0;this.dependencies[e]=n}hasDependency(e,r){for(const n of e){const a=this.dependencies[n];if(a){for(const h of r)if(a[h])return!0}}return!1}clearQueryDebugViz(){}}class Sf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,n){const a=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},Tt(this.stateChanges[e][a],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==a&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const h in this.state[e][a])n[h]||(this.deletedStates[e][a][h]=null)}else for(const h in n)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][h]===null&&delete this.deletedStates[e][a][h]}removeFeatureState(e,r,n){if(this.deletedStates[e]===null)return;const a=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&r!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][n]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(n in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][n]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,r){const n=String(r),a=Tt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][r];if(h===null)return{};for(const u in h)delete a[u]}return a}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const n={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const h={};for(const u in this.stateChanges[a])this.state[a][u]||(this.state[a][u]={}),Tt(this.state[a][u],this.stateChanges[a][u]),h[u]=this.state[a][u];n[a]=h}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const h={};if(this.deletedStates[a]===null)for(const u in this.state[a])h[u]={},this.state[a][u]={};else for(const u in this.deletedStates[a]){if(this.deletedStates[a][u]===null)this.state[a][u]={};else for(const f of Object.keys(this.deletedStates[a][u]))delete this.state[a][u][f];h[u]=this.state[a][u]}n[a]=n[a]||{},Tt(n[a],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const a in e)e[a].setFeatureState(n,r)}}class Ku{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Yu(i,e,r,n){let a=0,h=Number.MAX_VALUE;for(let u=0;u<3;u++)if(Math.abs(n[u])<1e-15){if(r[u]<i[u]||r[u]>e[u])return null}else{const f=1/n[u];let m=(i[u]-r[u])*f,g=(e[u]-r[u])*f;if(m>g){const x=m;m=g,g=x}if(m>a&&(a=m),g<h&&(h=g),a>h)return null}return a}function Ju(i,e,r,n,a,h,u,f,m,g,x){const b=n-i,T=a-e,I=h-r,M=u-i,L=f-e,q=m-r,K=x[1]*q-x[2]*L,ne=x[2]*M-x[0]*q,ce=x[0]*L-x[1]*M,ue=b*K+T*ne+I*ce;if(Math.abs(ue)<1e-15)return null;const he=1/ue,pe=g[0]-i,Le=g[1]-e,Ae=g[2]-r,Me=(pe*K+Le*ne+Ae*ce)*he;if(Me<0||Me>1)return null;const Ue=Le*I-Ae*T,Se=Ae*b-pe*I,Re=pe*T-Le*b,Pe=(x[0]*Ue+x[1]*Se+x[2]*Re)*he;return Pe<0||Me+Pe>1?null:(M*Ue+L*Se+q*Re)*he}function Qu(i,e,r){return(i-e)/(r-e)}function ep(i,e,r,n,a,h,u,f,m){const g=1<<r,x=h-n,b=u-a,T=(i+1)/g*x+n,I=(e+0)/g*b+a,M=(e+1)/g*b+a;f[0]=(i+0)/g*x+n,f[1]=I,m[0]=T,m[1]=M}class tp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(h){const u=Math.ceil(Math.log2(h.dim/8)),f=[];let m=Math.ceil(Math.pow(2,u));const g=1/m,x=(I,M,L,q,K)=>{const ne=q?1:0,ce=(I+1)*L-ne,ue=M*L,he=(M+1)*L-ne;K[0]=I*L,K[1]=ue,K[2]=ce,K[3]=he};let b=new Ku(m);const T=[];for(let I=0;I<m*m;I++){x(I%m,Math.floor(I/m),g,!1,T);const M=Gn(T[0],T[1],h),L=Gn(T[2],T[1],h),q=Gn(T[2],T[3],h),K=Gn(T[0],T[3],h);b.minimums.push(Math.min(M,L,q,K)),b.maximums.push(Math.max(M,L,q,K)),b.leaves.push(1)}for(f.push(b),m/=2;m>=1;m/=2){const I=f[f.length-1];b=new Ku(m);for(let M=0;M<m*m;M++){x(M%m,Math.floor(M/m),2,!0,T);const L=I.getElevation(T[0],T[1]),q=I.getElevation(T[2],T[1]),K=I.getElevation(T[2],T[3]),ne=I.getElevation(T[0],T[3]),ce=I.isLeaf(T[0],T[1]),ue=I.isLeaf(T[2],T[1]),he=I.isLeaf(T[2],T[3]),pe=I.isLeaf(T[0],T[3]),Le=Math.min(L.min,q.min,K.min,ne.min),Ae=Math.max(L.max,q.max,K.max,ne.max),Me=ce&&ue&&he&&pe;b.maximums.push(Ae),b.minimums.push(Le),b.leaves.push(Ae-Le<=5&&Me?1:0)}f.push(b)}return f}(this.dem),n=r.length-1,a=r[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,a,h,u,f=1){return Yu([e,r,-100],[n,a,this.maximums[0]*f],h,u)}raycast(e,r,n,a,h,u,f=1){if(!this.nodeCount)return null;const m=this.raycastRoot(e,r,n,a,h,u,f);if(m==null)return null;const g=[],x=[],b=[],T=[],I=[{idx:0,t:m,nodex:0,nodey:0,depth:0}];for(;I.length>0;){const{idx:M,t:L,nodex:q,nodey:K,depth:ne}=I.pop();if(this.leaves[M]){ep(q,K,ne,e,r,n,a,b,T);const ue=1<<ne,he=(q+0)/ue,pe=(q+1)/ue,Le=(K+0)/ue,Ae=(K+1)/ue,Me=Gn(he,Le,this.dem)*f,Ue=Gn(pe,Le,this.dem)*f,Se=Gn(pe,Ae,this.dem)*f,Re=Gn(he,Ae,this.dem)*f,Pe=Ju(b[0],b[1],Me,T[0],b[1],Ue,T[0],T[1],Se,h,u),Te=Ju(T[0],T[1],Se,b[0],T[1],Re,b[0],b[1],Me,h,u),Xe=Math.min(Pe!==null?Pe:Number.MAX_VALUE,Te!==null?Te:Number.MAX_VALUE);if(Xe!==Number.MAX_VALUE)return Xe;{const tt=Oh([],h,u,L);if(ip(Me,Ue,Re,Se,Qu(tt[0],b[0],T[0]),Qu(tt[1],b[1],T[1]))>=tt[2])return L}continue}let ce=0;for(let ue=0;ue<this._siblingOffset.length;ue++){ep((q<<1)+this._siblingOffset[ue][0],(K<<1)+this._siblingOffset[ue][1],ne+1,e,r,n,a,b,T),b[2]=-100,T[2]=this.maximums[this.childOffsets[M]+ue]*f;const he=Yu(b,T,h,u);if(he!=null){const pe=he;g[ue]=pe;let Le=!1;for(let Ae=0;Ae<ce&&!Le;Ae++)pe>=g[x[Ae]]&&(x.splice(Ae,0,ue),Le=!0);Le||(x[ce]=ue),ce++}}for(let ue=0;ue<ce;ue++){const he=x[ue];I.push({idx:this.childOffsets[M]+he,t:g[he],nodex:(q<<1)+this._siblingOffset[he][0],nodey:(K<<1)+this._siblingOffset[he][1],depth:ne+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,a,h){if(e[a].isLeaf(r,n)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const u=a-1,f=e[u];let m,g=0;for(let x=0;x<this._siblingOffset.length;x++){const b=2*r+this._siblingOffset[x][0],T=2*n+this._siblingOffset[x][1],I=f.getElevation(b,T),M=f.isLeaf(b,T),L=this._addNode(I.min,I.max,M);M&&(g|=1<<x),m||(m=L)}for(let x=0;x<this._siblingOffset.length;x++)g&1<<x||this._construct(e,2*r+this._siblingOffset[x][0],2*n+this._siblingOffset[x][1],u,m+x)}}function ip(i,e,r,n,a,h){return Mt(Mt(i,r,h),Mt(e,n,h),a)}function Gn(i,e,r){const n=r.dim,a=Be(i*n-.5,0,n-1),h=Be(e*n-.5,0,n-1),u=Math.floor(a),f=Math.floor(h),m=Math.min(u+1,n-1),g=Math.min(f+1,n-1);return ip(r.get(u,f),r.get(m,f),r.get(u,g),r.get(m,g),a-u,h-f)}const rp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Jl{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,a=!1,h=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return zt(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const u=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=a,!a){for(let f=0;f<u;f++)this.data[this._idx(-1,f)]=this.data[this._idx(0,f)],this.data[this._idx(u,f)]=this.data[this._idx(u-1,f)],this.data[this._idx(f,-1)]=this.data[this._idx(f,0)],this.data[this._idx(f,u)]=this.data[this._idx(f,u-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(u,-1)]=this.data[this._idx(u-1,0)],this.data[this._idx(-1,u)]=this.data[this._idx(0,u-1)],this.data[this._idx(u,u)]=this.data[this._idx(u-1,u-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new tp(this)}get(e,r,n=!1){const a=new Uint8Array(this.data.buffer);n&&(e=Be(e,-1,this.dim),r=Be(r,-1,this.dim));const h=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[h],a[h+1],a[h+2])}static getUnpackVector(e){return rp[e]}get unpackVector(){return rp[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,n){return(256*e*256+256*r+n)/10-1e4}_unpackTerrarium(e,r,n){return 256*e+r+n/256-32768}static pack(e,r){const n=[0,0,0,0],a=Jl.getUnpackVector(r);let h=Math.floor((e+a[3])/a[2]);return n[2]=h%256,h=Math.floor(h/256),n[1]=h%256,h=Math.floor(h/256),n[0]=h,n}getPixels(){return new or({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,h=r*this.dim+this.dim,u=n*this.dim,f=n*this.dim+this.dim;switch(r){case-1:a=h-1;break;case 1:h=a+1}switch(n){case-1:u=f-1;break;case 1:f=u+1}const m=-r*this.dim,g=-n*this.dim;for(let x=u;x<f;x++)for(let b=a;b<h;b++)this.data[this._idx(b,x)]=e.data[this._idx(b+m,x+g)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ze("DEMData",Jl),Ze("DemMinMaxQuadTree",tp,{omit:["dem"]});class If{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,n){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const h={value:r,timeout:void 0};if(n!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},n)),this.data[a].push(h),this.order.push(a),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const n=e.wrapped().key,a=r===void 0?0:this.data[n].indexOf(r),h=this.data[n][a];return this.data[n].splice(a,1),h.timeout&&clearTimeout(h.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(h.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const n in this.data)for(const a of this.data[n])e(a.value)||r.push(a);for(const n of r)this.remove(n.value.tileID,n)}}class Cs{constructor(e,r,n){this.func=e,this.mask=r,this.range=n}}Cs.ReadOnly=!1,Cs.ReadWrite=!0,Cs.disabled=new Cs(519,Cs.ReadOnly,[0,1]);const th=7680;class ih{constructor(e,r,n,a,h,u){this.test=e,this.ref=r,this.mask=n,this.fail=a,this.depthFail=h,this.pass=u}}ih.disabled=new ih({func:519,mask:0},0,0,th,th,th);class Nr{constructor(e,r,n){this.blendFunction=e,this.blendColor=r,this.mask=n}}Nr.Replace=[1,0],Nr.disabled=new Nr(Nr.Replace,It.transparent,[!1,!1,!1,!1]),Nr.unblended=new Nr(Nr.Replace,It.transparent,[!0,!0,!0,!0]),Nr.alphaBlended=new Nr([1,771],It.transparent,[!0,!0,!0,!0]);const rh=1029,nh=2305;class Tr{constructor(e,r,n){this.enable=e,this.mode=r,this.frontFace=n}}Tr.disabled=new Tr(!1,rh,nh),Tr.backCCW=new Tr(!0,rh,nh),Tr.backCW=new Tr(!0,rh,2304),Tr.frontCW=new Tr(!0,1028,2304),Tr.frontCCW=new Tr(!0,1028,nh);class Eo extends Ke{constructor(e,r,n){super(),this.id=e,this._onlySymbols=n,r.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new If(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Sf}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const n=this._tiles[r];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return it(this._tiles).map(e=>e.tileID).sort(np).map(e=>e.key)}getRenderableIds(e){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((n,a)=>{const h=n.tileID,u=a.tileID,f=new X(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),m=new X(u.canonical.x,u.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-u.overscaledZ||m.y-f.y||m.x-f.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(np).map(n=>n.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,e,r)))}_tileLoaded(e,r,n,a){if(a)return e.state="errored",void(a.status!==404?this._source.fire(new Ce(a,{tile:e})):this.update(this.transform));e.timeAdded=kt.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ve("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let a=0;a<r.length;a++){const h=r[a];if(e.neighboringTiles&&e.neighboringTiles[h]){const u=this.getTileByID(h);n(e,u),n(u,e)}}function n(a,h){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let u=h.tileID.canonical.x-a.tileID.canonical.x;const f=h.tileID.canonical.y-a.tileID.canonical.y,m=Math.pow(2,a.tileID.canonical.z),g=h.tileID.key;u===0&&f===0||Math.abs(f)>1||(Math.abs(u)>1&&(Math.abs(u+m)===1?u+=m:Math.abs(u-m)===1&&(u-=m)),h.dem&&a.dem&&(a.dem.backfillBorder(h.dem,u,f),a.neighboringTiles&&a.neighboringTiles[g]&&(a.neighboringTiles[g].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,n,a){for(const h in this._tiles){let u=this._tiles[h];if(a[h]||!u.hasData()||u.tileID.overscaledZ<=r||u.tileID.overscaledZ>n)continue;let f=u.tileID;for(;u&&u.tileID.overscaledZ>r+1;){const g=u.tileID.scaledTo(u.tileID.overscaledZ-1);u=this._tiles[g.key],u&&u.hasData()&&(f=g)}let m=f;for(;m.overscaledZ>r;)if(m=m.scaledTo(m.overscaledZ-1),e[m.key]){a[f.key]=f;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=e.overscaledZ-1;n>=r;n--){const a=e.scaledTo(n),h=this._getLoadedTile(a);if(h)return h}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const n=Math.ceil(e.width/r)+1,a=Math.ceil(e.height/r)+1,h=Math.floor(n*a*5),u=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(u)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const n={};for(const a in this._tiles){const h=this._tiles[a];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),n[h.tileID.key]=h}this._tiles=n;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let a;this.updateCacheSize(e,r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Bi(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(a=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(f=>this._source.hasTile(f)))):a=[];const h=this._updateRetainedTiles(a);if(op(this._source.type)&&a.length!==0){const f={},m={},g=Object.keys(h);for(const b of g){const T=h[b],I=this._tiles[b];if(!I||I.fadeEndTime&&I.fadeEndTime<=kt.now())continue;const M=this.findLoadedParent(T,Math.max(T.overscaledZ-Eo.maxOverzooming,this._source.minzoom));M&&(this._addTile(M.tileID),f[M.tileID.key]=M.tileID),m[b]=T}const x=a[a.length-1].overscaledZ;for(const b in this._tiles){const T=this._tiles[b];if(h[b]||!T.hasData())continue;let I=T.tileID;for(;I.overscaledZ>x;){I=I.scaledTo(I.overscaledZ-1);const M=this._tiles[I.key];if(M&&M.hasData()&&m[I.key]){h[b]=T.tileID;break}}}for(const b in f)h[b]||(this._coveredTiles[b]=!0,h[b]=f[b])}for(const f in h)this._tiles[f].clearFadeHold();const u=function(f,m){const g=[];for(const x in f)x in m||g.push(x);return g}(this._tiles,h);for(const f of u){const m=this._tiles[f];m.hasSymbolBuckets&&!m.holdingForFade()?m.setHoldDuration(this.map._fadeDuration):m.hasSymbolBuckets&&!m.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const n={},a=e[e.length-1].overscaledZ,h=e[0].overscaledZ,u=Math.max(h-Eo.maxOverzooming,this._source.minzoom),f=Math.max(h+Eo.maxUnderzooming,this._source.minzoom),m={};for(const g of e){const x=this._addTile(g);r[g.key]=g,x.hasData()||a<this._source.maxzoom&&(m[g.key]=g)}this._retainLoadedChildren(m,a,f,r);for(const g of e){let x=this._tiles[g.key];if(x.hasData())continue;if(g.canonical.z>=this._source.maxzoom){const T=g.children(this._source.maxzoom)[0],I=this.getTile(T);if(I&&I.hasData()){r[T.key]=T;continue}}else{const T=g.children(this._source.maxzoom);if(r[T[0].key]&&r[T[1].key]&&r[T[2].key]&&r[T[3].key])continue}let b=x.wasRequested();for(let T=g.overscaledZ-1;T>=u;--T){const I=g.scaledTo(T);if(n[I.key]||(n[I.key]=!0,x=this.getTile(I),!x&&b&&(x=this._addTile(I)),x&&(r[I.key]=I,b=x.wasRequested(),x.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let n,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){n=this._loadedParentTiles[a.key];break}r.push(a.key);const h=a.scaledTo(a.overscaledZ-1);if(n=this._getLoadedTile(h),n)break;a=h}for(const h of r)this._loadedParentTiles[h]=n}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const n=Boolean(r);return n||(r=new Hu(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))),r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new Ve("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=r.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,r,n){const a=[],h=this.transform;if(!h)return a;for(const u in this._tiles){const f=this._tiles[u];if(n&&f.clearQueryDebugViz(),f.holdingForFade())continue;const m=e.containsTile(f,h,r);m&&a.push(m)}return a}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(op(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=kt.now())return!0}return!1}setFeatureState(e,r,n){this._state.updateState(e=e||"_geojsonTileLayer",r,n)}removeFeatureState(e,r,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,n)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,n){const a=this._tiles[e];a&&a.setDependencies(r,n)}reloadTilesForDependencies(e,r){for(const n in this._tiles)this._tiles[n].hasDependency(e,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,r))}}function np(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||n-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function op(i){return i==="raster"||i==="image"||i==="video"}Eo.maxOverzooming=10,Eo.maxUnderzooming=3;class Ql{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const a=n||e.findDEMTileFor(r);if(!a||!a.dem)return;const h=a.dem,u=a.tileID,f=1<<r.canonical.z-u.canonical.z;return new Ql(a,a.tileSize/Rt/f,[(r.canonical.x/f-u.canonical.x)*h.dim,(r.canonical.y/f-u.canonical.y)*h.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(n);return new X(a,h)}getElevationAt(e,r,n,a){const h=e*this._scale+this._offset[0],u=r*this._scale+this._offset[1],f=Math.floor(h),m=Math.floor(u),g=this._dem;return a=!!a,n?Mt(Mt(g.get(f,m,a),g.get(f,m+1,a),u-m),Mt(g.get(f+1,m,a),g.get(f+1,m+1,a),u-m),h-f):g.get(f,m,a)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Yc(1,e)*this._dem.stride}}class sp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ho(Rt,16,0),this.featureIndexArray=new gh,this.promoteId=r}insert(e,r,n,a,h,u=0){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,h,u);const m=this.grid;for(let g=0;g<r.length;g++){const x=r[g],b=[1/0,1/0,-1/0,-1/0];for(let T=0;T<x.length;T++){const I=x[T];b[0]=Math.min(b[0],I.x),b[1]=Math.min(b[1],I.y),b[2]=Math.max(b[2],I.x),b[3]=Math.max(b[3],I.y)}b[0]<Rt&&b[1]<Rt&&b[2]>=0&&b[3]>=0&&m.insert(f,b[0],b[1],b[2],b[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wo.VectorTile(new va(this.rawTileData)).layers,this.sourceLayerCoder=new Xu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,n,a){this.loadVTLayers();const h=e.params||{},u=ts(h.filter),f=e.tileResult,m=e.transform,g=f.bufferedTilespaceBounds,x=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(M,L,q,K)=>zh(f.bufferedTilespaceGeometry,M,L,q,K));x.sort(Af);let b=null;m.elevation&&x.length>0&&(b=Ql.create(m.elevation,this.tileID));const T={};let I;for(let M=0;M<x.length;M++){const L=x[M];if(L===I)continue;I=L;const q=this.featureIndexArray.get(L);let K=null;this.loadMatchingFeature(T,q,u,h.layers,h.availableImages,r,n,a,(ne,ce,ue,he=0)=>(K||(K=vo(ne)),ce.queryIntersectsFeature(f,ne,ue,K,this.z,e.transform,e.pixelPosMatrix,b,he)))}return T}loadMatchingFeature(e,r,n,a,h,u,f,m,g){const{featureIndex:x,bucketIndex:b,sourceLayerIndex:T,layoutVertexArrayOffset:I}=r,M=this.bucketLayerIDs[b];if(a&&!function(ne,ce){for(let ue=0;ue<ne.length;ue++)if(ce.indexOf(ne[ue])>=0)return!0;return!1}(a,M))return;const L=this.sourceLayerCoder.decode(T),q=this.vtLayers[L].feature(x);if(n.needGeometry){const ne=bo(q,!0);if(!n.filter(new k(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!n.filter(new k(this.tileID.overscaledZ),q))return;const K=this.getId(q,L);for(let ne=0;ne<M.length;ne++){const ce=M[ne];if(a&&a.indexOf(ce)<0)continue;const ue=u[ce];if(!ue)continue;let he={};K!==void 0&&m&&(he=m.getState(ue.sourceLayer||"_geojsonTileLayer",K));const pe=Tt({},f[ce]);pe.paint=ap(pe.paint,ue.paint,q,he,h),pe.layout=ap(pe.layout,ue.layout,q,he,h);const Le=!g||g(q,ue,he,I);if(!Le)continue;const Ae=new Wu(q,this.z,this.x,this.y,K);Ae.layer=pe;let Me=e[ce];Me===void 0&&(Me=e[ce]=[]),Me.push({featureIndex:x,feature:Ae,intersectionZ:Le})}}lookupSymbolFeatures(e,r,n,a,h,u,f,m){const g={};this.loadVTLayers();const x=ts(h);for(const b of e)this.loadMatchingFeature(g,{bucketIndex:n,sourceLayerIndex:a,featureIndex:b,layoutVertexArrayOffset:0},x,u,f,m,r);return g}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function ap(i,e,r,n,a){return st(i,(h,u)=>{const f=e instanceof re?e.get(u):null;return f&&f.evaluate?f.evaluate(r,n,a):f})}function Af(i,e){return e-i}Ze("FeatureIndex",sp,{omit:["rawTileData","sourceLayerCoder"]});class lp{constructor(e){const r={},n=[];for(const f in e){const m=e[f],g=r[f]={};for(const x in m){const b=m[+x];if(!b||b.bitmap.width===0||b.bitmap.height===0)continue;const T=b.metrics.localGlyph?2:1,I={x:0,y:0,w:b.bitmap.width+2*T,h:b.bitmap.height+2*T};n.push(I),g[x]={rect:I,metrics:b.metrics}}}const{w:a,h}=Oc(n),u=new Fn({width:a||1,height:h||1});for(const f in e){const m=e[f];for(const g in m){const x=m[+g];if(!x||x.bitmap.width===0||x.bitmap.height===0)continue;const b=r[f][g].rect,T=x.metrics.localGlyph?2:1;Fn.copy(x.bitmap,u,{x:0,y:0},{x:b.x+T,y:b.y+T},x.bitmap)}}this.image=u,this.positions=r}}Ze("GlyphAtlas",lp);class Cf{constructor(e){this.tileID=new Bi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,r,n,a,h){this.status="parsing",this.data=e,this.collisionBoxArray=new nn;const u=new Xu(Object.keys(e.layers).sort()),f=new sp(this.tileID,this.promoteId);f.bucketLayerIDs=[];const m={},g=new Qc(256,256),x={featureIndex:f,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:g,availableImages:n},b=r.familiesBySource[this.source];for(const he in b){const pe=e.layers[he];if(!pe)continue;let Le=!1,Ae=!1;for(const Se of b[he])Se[0].type==="symbol"?Le=!0:Ae=!0;if(this.isSymbolTile===!0&&!Le||this.isSymbolTile===!1&&!Ae)continue;pe.version===1&&zt(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Me=u.encode(he),Ue=[];for(let Se=0;Se<pe.length;Se++){const Re=pe.feature(Se),Pe=f.getId(Re,he);Ue.push({feature:Re,id:Pe,index:Se,sourceLayerIndex:Me})}for(const Se of b[he]){const Re=Se[0];this.isSymbolTile!==void 0&&Re.type==="symbol"!==this.isSymbolTile||Re.minzoom&&this.zoom<Math.floor(Re.minzoom)||Re.maxzoom&&this.zoom>=Re.maxzoom||Re.visibility!=="none"&&(oh(Se,this.zoom,n),(m[Re.id]=Re.createBucket({index:f.bucketLayerIDs.length,layers:Se,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Me,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(Ue,x,this.tileID.canonical),f.bucketLayerIDs.push(Se.map(Pe=>Pe.id)))}}let T,I,M,L;g.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=st(x.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(K).length?a.send("getGlyphs",{uid:this.uid,stacks:K},(he,pe)=>{T||(T=he,I=pe,ue.call(this))},void 0,!1,q):I={};const ne=Object.keys(x.iconDependencies);ne.length?a.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(he,pe)=>{T||(T=he,M=pe,ue.call(this))},void 0,!1,q):M={};const ce=Object.keys(x.patternDependencies);function ue(){if(T)return h(T);if(I&&M&&L){const he=new lp(I),pe=new fu(M,L);for(const Le in m){const Ae=m[Le];Ae instanceof Nn?(oh(Ae.layers,this.zoom,n),cf(Ae,I,he.positions,M,pe.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):Ae.hasPattern&&(Ae instanceof Rc||Ae instanceof Dc||Ae instanceof Lc)&&(oh(Ae.layers,this.zoom,n),Ae.addFeatures(x,this.tileID.canonical,pe.patternPositions))}this.status="done",h(null,{buckets:it(m).filter(Le=>!Le.isEmpty()),featureIndex:f,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:g,imageAtlas:pe,glyphMap:this.returnDependencies?I:null,iconMap:this.returnDependencies?M:null,glyphPositions:this.returnDependencies?he.positions:null})}}ce.length?a.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(he,pe)=>{T||(T=he,L=pe,ue.call(this))},void 0,!1,q):L={},ue.call(this)}}function oh(i,e,r){const n=new k(e);for(const a of i)a.recalculate(n,r)}class cp{constructor(e){this.entries={},this.scheduler=e}request(e,r,n,a){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[u,f]=h.result;return this.scheduler?this.scheduler.add(()=>{a(u,f)},r):a(u,f),()=>{}}return h.callbacks.push(a),h.cancel||(h.cancel=n((u,f)=>{h.result=[u,f];for(const m of h.callbacks)this.scheduler?this.scheduler.add(()=>{m(u,f)},r):m(u,f);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(u=>u!==a),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function hp(i,e,r){const n=JSON.stringify(i.request);return i.data&&(this.deduped.entries[n]={result:[null,i.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},a=>{const h=S(i.request,(u,f,m,g)=>{u?a(u):f&&a(null,{vectorTile:r?void 0:new wo.VectorTile(new va(f)),rawData:f,cacheControl:m,expires:g})});return()=>{h.cancel(),a()}},e)}s.ARRAY_TYPE=Xi,s.AUTH_ERR_MSG=$r,s.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Je(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=zi()?i:ie,this.scheduler=new Tf}send(i,e,r,n,a=!1,h){const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=h,this.callbacks[u]=r);const f=Qi(this.globalScope)?void 0:[];return this.target.postMessage({id:u,type:i,hasCallback:!!r,targetMapId:n,mustQueue:a,sourceMapId:this.mapId,data:uo(e,f)},f),{cancel:()=>{r&&delete this.callbacks[u],this.target.postMessage({id:u,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(e.mustQueue||zi()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),n&&n.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(po(e.error)):r(null,po(e.data)))}else{const r=Qi(this.globalScope)?void 0:[],n=e.hasCallback?(h,u)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:h?uo(h):null,data:uo(u,r)},r)}:h=>{},a=po(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,n);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],a.source)[h[1]](a,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=eh,s.Color=It,s.ColorMode=Nr,s.CullFaceMode=Tr,s.DEMData=Jl,s.DataConstantProperty=N,s.DedupedRequest=cp,s.DepthMode=Cs,s.EXTENT=Rt,s.Elevation=class{getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){e==null&&(e=null);const n=this._source();if(!n||i.y<0||i.y>1)return e;const a=n.getSource().maxzoom,h=1<<a,u=Math.floor(i.x),f=i.x-u,m=new Bi(a,u,a,Math.floor(f*h),Math.floor(i.y*h)),g=this.findDEMTileFor(m);if(!g||!g.dem)return e;const x=g.dem,b=1<<g.tileID.canonical.z,T=(f*b-g.tileID.canonical.x)*x.dim,I=(i.y*b-g.tileID.canonical.y)*x.dim,M=Math.floor(T),L=Math.floor(I);return(r?this.exaggeration():1)*Mt(Mt(x.get(M,L),x.get(M,L+1),I-L),Mt(x.get(M+1,L),x.get(M+1,L+1),I-L),T-M)}getAtTileOffset(i,e,r){const n=1<<i.canonical.z;return this.getAtPointOrZero(new As(i.wrap+(i.canonical.x+e/Rt)/n,(i.canonical.y+r/Rt)/n))}getForTilePoints(i,e,r,n){const a=Ql.create(this,i,n);return!!a&&(e.forEach(h=>{h[2]=this.exaggeration()*a.getElevationAt(h[0],h[1],r)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,a=1<<i.canonical.z-n.canonical.z;let h=i.canonical.x/a-n.canonical.x,u=i.canonical.y/a-n.canonical.y,f=0;for(let m=0;m<i.canonical.z-n.canonical.z&&!r.leaves[f];m++){h*=2,u*=2;const g=2*Math.floor(u)+Math.floor(h);f=r.childOffsets[f]+g,h%=1,u%=1}return{min:this.exaggeration()*r.minimums[f],max:this.exaggeration()*r.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Ce,s.EvaluationParameters=k,s.Event=Ve,s.Evented=Ke,s.GlyphManager=Ss,s.ImagePosition=Uc,s.LineAtlas=Qc,s.LngLat=ei,s.LngLatBounds=To,s.LocalGlyphMode=Gc,s.MAX_SAFE_INTEGER=_e,s.MercatorCoordinate=As,s.ONE_EM=di,s.OverscaledTileID=Bi,s.Properties=ke,s.RGBAImage=or,s.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!er(i))return i;const r=Ui(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!er(i))return i;const r=Ui(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!er(i))return i;const r=Ui(i);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,n){const a=Ui(i);return er(i)?(a.path=`/styles/v1${a.path}/sprite${e}${r}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${r}`,Mr(a))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!er(i))return i;const n=Ui(i);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${ki.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${bt.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${bt.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(h){for(const u of h){const f=u.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(n.params)||bt.ACCESS_TOKEN;return bt.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(i,e){const r=Ui(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${bt.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${bt.TILE_URL_VERSION}/`,"")}`;let a=r.params;return e&&(a=a.filter(h=>!h.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(i,e){const r=!!e&&er(e),n=[];for(const a of i.tiles||[])Cr(a)?n.push(this.canonicalizeTileURL(a,r)):n.push(a);return n}_makeAPIURL(i,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=Ui(bt.API_URL);if(i.protocol=n.protocol,i.authority=n.authority,i.protocol==="http"){const a=i.params.indexOf("secure");a>=0&&i.params.splice(a,1)}if(n.path!=="/"&&(i.path=`${n.path}${i.path}`),!bt.REQUIRE_ACCESS_TOKEN)return Mr(i);if(e=e||bt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(a=>a.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Mr(i)}},s.ResourceType=Wr,s.SegmentVector=Si,s.SourceCache=Eo,s.StencilMode=ih,s.StructArrayLayout1ui2=vr,s.StructArrayLayout2f1f2i16=Yt,s.StructArrayLayout2i4=St,s.StructArrayLayout2ui4=pi,s.StructArrayLayout3f12=Ti,s.StructArrayLayout3ui6=vt,s.StructArrayLayout4i8=Ut,s.Texture=Kl,s.Tile=Hu,s.Transitionable=Z,s.Uniform1f=Ml,s.Uniform1i=class extends Rn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends Rn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.Uniform3f=class extends Rn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.Uniform4f=wh,s.UniformColor=Th,s.UniformMatrix3f=class extends Rn{constructor(i,e){super(i,e),this.current=Mp}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},s.UniformMatrix4f=class extends Rn{constructor(i,e){super(i,e),this.current=Cp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.UnwrappedTileID=Zu,s.ValidationError=ge,s.VectorTileWorkerSource=class extends Ke{constructor(i,e,r,n,a){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=a||hp,this.loading={},this.loaded={},this.deduped=new cp(i.scheduler),this.isSpriteLoaded=n,this.scheduler=i.scheduler}loadTile(i,e){const r=i.uid,n=i&&i.request,a=n&&n.collectResourceTiming,h=this.loading[r]=new Cf(i);h.abort=this.loadVectorData(i,(u,f)=>{const m=!this.loading[r];if(delete this.loading[r],m||u||!f)return h.status="done",m||(this.loaded[r]=h),e(u);const g=f.rawData,x={};f.expires&&(x.expires=f.expires),f.cacheControl&&(x.cacheControl=f.cacheControl),h.vectorTile=f.vectorTile||new wo.VectorTile(new va(g));const b=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(T,I)=>{if(T||!I)return e(T);const M={};if(a){const L=$u(n);L.length>0&&(M.resourceTiming=JSON.parse(JSON.stringify(L)))}e(null,Tt({rawTileData:g.slice(0)},I,x,M))})};this.isSpriteLoaded?b():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(b,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):b()}),this.loaded=this.loaded||{},this.loaded[r]=h})}reloadTile(i,e){const r=this.loaded,n=i.uid,a=this;if(r&&r[n]){const h=r[n];h.showCollisionBoxes=i.showCollisionBoxes,h.enableTerrain=!!i.enableTerrain;const u=(f,m)=>{const g=h.reloadCallback;g&&(delete h.reloadCallback,h.parse(h.vectorTile,a.layerIndex,this.availableImages,a.actor,g)),e(f,m)};h.status==="parsing"?h.reloadCallback=u:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,u):u())}}abortTile(i,e){const r=i.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(i,e){const r=this.loaded,n=i.uid;r&&r[n]&&delete r[n],e()}},s.WritingMode=Wi,s.ZoomHistory=fl,s.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},s.addDynamicAttributes=Zc,s.altitudeFromMercatorZ=Jc,s.asyncAll=Qe,s.bezier=xe,s.bindAll=Je,s.bufferConvexPolygon=function(i,e){const r=[];for(let n=0;n<i.length;n++){const a=lt(n-1,-1,i.length-1),h=lt(n+1,-1,i.length-1),u=i[n],f=i[h],m=i[a].sub(u).unit(),g=f.sub(u).unit(),x=g.angleWithSep(m.x,m.y),b=m.add(g).unit().mult(-1*e/Math.sin(x/2));r.push(u.add(b))}return r},s.cacheEntryPossiblyAdded=function(i){Xr++,Xr>Wn&&(i.getActor().send("enforceCacheSizeLimit",zo),Xr=0)},s.clamp=Be,s.clearTileCache=function(i){const e=ie.caches.delete(mn);i&&e.catch(i).then(()=>i())},s.clipLine=Su,s.clone=function(i){var e=new Xi(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},s.clone$1=function(i){var e=new Xi(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$2=pt,s.collisionCircleLayout=Bd,s.config=bt,s.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},s.create=Dl,s.create$1=function(){var i=new Xi(16);return Xi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$2=Dh,s.createExpression=so,s.createFilter=ts,s.createLayout=He,s.createStyleLayer=function(i){return i.type==="custom"?new yf(i):new vf[i.type](i)},s.cross=function(i,e,r){var n=e[0],a=e[1],h=e[2],u=r[0],f=r[1],m=r[2];return i[0]=a*m-h*f,i[1]=h*u-n*m,i[2]=n*f-a*u,i},s.degToRad=G,s.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},s.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},s.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.ease=be,s.easeCubicInOut=ye,s.emitValidationErrors=as,s.endsWith=et,s.enforceCacheSizeLimit=function(i){kr(),Ni&&Ni.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-i;n++)e.delete(r[n])})})},s.evaluateSizeForFeature=Ol,s.evaluateSizeForZoom=vs,s.evaluateVariableOffset=ku,s.evented=w,s.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},s.exported=kt,s.exported$1=ki,s.extend=Tt,s.filterObject=at,s.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.fromQuat=function(i,e){var r=e[0],n=e[1],a=e[2],h=e[3],u=r+r,f=n+n,m=a+a,g=r*u,x=n*u,b=n*f,T=a*u,I=a*f,M=a*m,L=h*u,q=h*f,K=h*m;return i[0]=1-b-M,i[1]=x+K,i[2]=T-q,i[3]=0,i[4]=x-K,i[5]=1-g-M,i[6]=I+L,i[7]=0,i[8]=T+q,i[9]=I-L,i[10]=1-g-b,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.fromRotation=function(i,e){var r=Math.sin(e),n=Math.cos(e);return i[0]=n,i[1]=r,i[2]=0,i[3]=-r,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Q[e]},s.getAABBPointSquareDist=function(i,e,r){let n=0;for(let a=0;a<2;++a){const h=r?r[a]:0;i[a]>h&&(n+=(i[a]-h)*(i[a]-h)),e[a]<h&&(n+=(h-e[a])*(h-e[a]))}return n},s.getAnchorAlignment=Nc,s.getAnchorJustification=$c,s.getBounds=function(i){let e=1/0,r=1/0,n=-1/0,a=-1/0;for(const h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),n=Math.max(n,h.x),a=Math.max(a,h.y);return{min:new X(e,r),max:new X(n,a)}},s.getImage=te,s.getJSON=function(i,e){return R(Tt(i,{type:"json"}),e)},s.getMapSessionAPI=zs,s.getPerformanceMeasurement=$u,s.getRTLTextPluginStatus=E,s.getReferrer=cr,s.getVideo=function(i,e){const r=ie.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<i.length;n++){const a=ie.document.createElement("source");V(i[n])||(r.crossOrigin="Anonymous"),a.src=i[n],r.appendChild(a)}return{cancel:()=>{}}},s.identity=bc,s.identity$1=Nh,s.invert=function(i,e){var r=e[0],n=e[1],a=e[2],h=e[3],u=e[4],f=e[5],m=e[6],g=e[7],x=e[8],b=e[9],T=e[10],I=e[11],M=e[12],L=e[13],q=e[14],K=e[15],ne=r*f-n*u,ce=r*m-a*u,ue=r*g-h*u,he=n*m-a*f,pe=n*g-h*f,Le=a*g-h*m,Ae=x*L-b*M,Me=x*q-T*M,Ue=x*K-I*M,Se=b*q-T*L,Re=b*K-I*L,Pe=T*K-I*q,Te=ne*Pe-ce*Re+ue*Se+he*Ue-pe*Me+Le*Ae;return Te?(i[0]=(f*Pe-m*Re+g*Se)*(Te=1/Te),i[1]=(a*Re-n*Pe-h*Se)*Te,i[2]=(L*Le-q*pe+K*he)*Te,i[3]=(T*pe-b*Le-I*he)*Te,i[4]=(m*Ue-u*Pe-g*Me)*Te,i[5]=(r*Pe-a*Ue+h*Me)*Te,i[6]=(q*ue-M*Le-K*ce)*Te,i[7]=(x*Le-T*ue+I*ce)*Te,i[8]=(u*Re-f*Ue+g*Ae)*Te,i[9]=(n*Ue-r*Re-h*Ae)*Te,i[10]=(M*pe-L*ue+K*ne)*Te,i[11]=(b*ue-x*pe-I*ne)*Te,i[12]=(f*Me-u*Se-m*Ae)*Te,i[13]=(r*Se-n*Me+a*Ae)*Te,i[14]=(L*ce-M*he-q*ne)*Te,i[15]=(x*he-b*ce+T*ne)*Te,i):null},s.isMapAuthenticated=function(i){return jr.has(i)},s.isMapboxURL=er,s.latFromMercatorY=Yl,s.len=jp,s.length=Rh,s.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.loadVectorTile=hp,s.makeRequest=R,s.mercatorXfromLng=Gu,s.mercatorYfromLat=qu,s.mercatorZfromAltitude=Yc,s.mul=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},s.mul$1=Gp,s.mul$2=$p,s.multiply=Lh,s.multiply$1=Fh,s.nextPowerOfTwo=qe,s.normalize=Uh,s.normalize$1=function(i,e){var r=e[0],n=e[1],a=e[2],h=e[3],u=r*r+n*n+a*a+h*h;return u>0&&(u=1/Math.sqrt(u)),i[0]=r*u,i[1]=n*u,i[2]=a*u,i[3]=h*u,i},s.number=Mt,s.ortho=function(i,e,r,n,a,h,u){var f=1/(e-r),m=1/(n-a),g=1/(h-u);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*g,i[11]=0,i[12]=(e+r)*f,i[13]=(a+n)*m,i[14]=(u+h)*g,i[15]=1,i},s.pbf=va,s.perspective=function(i,e,r,n,a){var h,u=1/Math.tan(e/2);return i[0]=u/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(i[10]=(a+n)*(h=1/(n-a)),i[14]=2*a*n*h):(i[10]=-1,i[14]=-2*n),i},s.pick=function(i,e){const r={};for(let n=0;n<e.length;n++){const a=e[n];a in i&&(r[a]=i[a])}return r},s.plugin=z,s.pointGeometry=X,s.polygonIntersectsBox=zh,s.polygonIntersectsPolygon=Ih,s.polygonizeBounds=function(i,e,r=0,n=!0){const a=new X(r,r),h=i.sub(a),u=e.add(a),f=[h,new X(u.x,h.y),u,new X(h.x,u.y)];return n&&f.push(h),f},s.posAttributes=Ef,s.postMapLoadEvent=Xn,s.postTurnstileEvent=Co,s.potpack=Oc,s.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.radToDeg=function(i){return i*Fe},s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(i){return i({pluginStatus:d,pluginURL:_}),w.on("pluginStateChange",i),i},s.removeAuthState=function(i){jr.delete(i)},s.renderColorRamp=Sc,s.rotateX=function(i,e,r){var n=Math.sin(r),a=Math.cos(r),h=e[4],u=e[5],f=e[6],m=e[7],g=e[8],x=e[9],b=e[10],T=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*a+g*n,i[5]=u*a+x*n,i[6]=f*a+b*n,i[7]=m*a+T*n,i[8]=g*a-h*n,i[9]=x*a-u*n,i[10]=b*a-f*n,i[11]=T*a-m*n,i},s.rotateX$1=Gh,s.rotateY=function(i,e,r){var n=Math.sin(r),a=Math.cos(r),h=e[0],u=e[1],f=e[2],m=e[3],g=e[8],x=e[9],b=e[10],T=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*a-g*n,i[1]=u*a-x*n,i[2]=f*a-b*n,i[3]=m*a-T*n,i[8]=h*n+g*a,i[9]=u*n+x*a,i[10]=f*n+b*a,i[11]=m*n+T*a,i},s.rotateZ=function(i,e,r){var n=Math.sin(r),a=Math.cos(r),h=e[0],u=e[1],f=e[2],m=e[3],g=e[4],x=e[5],b=e[6],T=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*a+g*n,i[1]=u*a+x*n,i[2]=f*a+b*n,i[3]=m*a+T*n,i[4]=g*a-h*n,i[5]=x*a-u*n,i[6]=b*a-f*n,i[7]=T*a-m*n,i},s.rotateZ$1=function(i,e,r){r*=.5;var n=e[0],a=e[1],h=e[2],u=e[3],f=Math.sin(r),m=Math.cos(r);return i[0]=n*m+a*f,i[1]=a*m-n*f,i[2]=h*m+u*f,i[3]=u*m-h*f,i},s.scale=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},s.scale$1=function(i,e,r){var n=r[0],a=r[1],h=r[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.scale$2=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},s.scaleAndAdd=Oh,s.setCacheLimits=function(i,e){zo=i,Wn=e},s.setRTLTextPlugin=function(i,e,r=!1){if(d===t||d===o||d===c)throw new Error("setRTLTextPlugin cannot be called multiple times.");_=kt.resolveURL(i),d=t,p=e,v(),r||A()},s.smoothstep=function(i,e,r){return(r=Be((r-i)/(e-i),0,1))*r*(3-2*r)},s.spec=Y,s.storeAuthState=function(i,e){e?jr.add(i):jr.delete(i)},s.sub=qp,s.subtract=Bh,s.symbolSize=Fd,s.transformMat3=function(i,e,r){var n=e[0],a=e[1],h=e[2];return i[0]=n*r[0]+a*r[3]+h*r[6],i[1]=n*r[1]+a*r[4]+h*r[7],i[2]=n*r[2]+a*r[5]+h*r[8],i},s.transformMat4=pa,s.transformMat4$1=function(i,e,r){var n=e[0],a=e[1],h=e[2],u=r[3]*n+r[7]*a+r[11]*h+r[15];return i[0]=(r[0]*n+r[4]*a+r[8]*h+r[12])/(u=u||1),i[1]=(r[1]*n+r[5]*a+r[9]*h+r[13])/u,i[2]=(r[2]*n+r[6]*a+r[10]*h+r[14])/u,i},s.transformQuat=Vh,s.translate=function(i,e,r){var n,a,h,u,f,m,g,x,b,T,I,M,L=r[0],q=r[1],K=r[2];return e===i?(i[12]=e[0]*L+e[4]*q+e[8]*K+e[12],i[13]=e[1]*L+e[5]*q+e[9]*K+e[13],i[14]=e[2]*L+e[6]*q+e[10]*K+e[14],i[15]=e[3]*L+e[7]*q+e[11]*K+e[15]):(a=e[1],h=e[2],u=e[3],f=e[4],m=e[5],g=e[6],x=e[7],b=e[8],T=e[9],I=e[10],M=e[11],i[0]=n=e[0],i[1]=a,i[2]=h,i[3]=u,i[4]=f,i[5]=m,i[6]=g,i[7]=x,i[8]=b,i[9]=T,i[10]=I,i[11]=M,i[12]=n*L+f*q+b*K+e[12],i[13]=a*L+m*q+T*K+e[13],i[14]=h*L+g*q+I*K+e[14],i[15]=u*L+x*q+M*K+e[15]),i},s.triggerPluginCompletionEvent=y,s.uniqueId=Ot,s.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFog=dc,s.validateLight=ll,s.validateStyle=xr,s.values=it,s.vectorTile=wo,s.version=J,s.warnOnce=zt,s.window=ie,s.wrap=lt}),de(["./shared"],function(s){function J(R){const S=typeof R;if(S==="number"||S==="boolean"||S==="string"||R==null)return JSON.stringify(R);if(Array.isArray(R)){let V="[";for(const W of R)V+=`${J(W)},`;return`${V}]`}const C=Object.keys(R).sort();let B="{";for(let V=0;V<C.length;V++)B+=`${JSON.stringify(C[V])}:${J(R[C[V]])},`;return`${B}}`}function ee(R){let S="";for(const C of s.refProperties)S+=`/${J(R[C])}`;return S}class me{constructor(S){this.keyCache={},S&&this.replace(S)}replace(S){this._layerConfigs={},this._layers={},this.update(S,[])}update(S,C){for(const V of S){this._layerConfigs[V.id]=V;const W=this._layers[V.id]=s.createStyleLayer(V);W._featureFilter=s.createFilter(W.filter),this.keyCache[V.id]&&delete this.keyCache[V.id]}for(const V of C)delete this.keyCache[V],delete this._layerConfigs[V],delete this._layers[V];this.familiesBySource={};const B=function(V,W){const se={};for(let te=0;te<V.length;te++){const le=W&&W[V[te].id]||ee(V[te]);W&&(W[V[te].id]=le);let we=se[le];we||(we=se[le]=[]),we.push(V[te])}const ae=[];for(const te in se)ae.push(se[te]);return ae}(s.values(this._layerConfigs),this.keyCache);for(const V of B){const W=V.map(Ve=>this._layers[Ve.id]),se=W[0];if(se.visibility==="none")continue;const ae=se.source||"";let te=this.familiesBySource[ae];te||(te=this.familiesBySource[ae]={});const le=se.sourceLayer||"_geojsonTileLayer";let we=te[le];we||(we=te[le]=[]),we.push(W)}}}const{ImageBitmap:X}=s.window;class O{loadTile(S,C){const{uid:B,encoding:V,rawImageData:W,padding:se,buildQuadTree:ae}=S,te=X&&W instanceof X?this.getImageData(W,se):W;C(null,new s.DEMData(B,te,V,se<1,ae))}getImageData(S,C){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(S.width,S.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=S.width,this.offscreenCanvas.height=S.height,this.offscreenCanvasContext.drawImage(S,0,0,S.width,S.height);const B=this.offscreenCanvasContext.getImageData(-C,-C,S.width+2*C,S.height+2*C);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:B.width,height:B.height},B.data)}}var ie=function R(S,C){var B,V=S&&S.type;if(V==="FeatureCollection")for(B=0;B<S.features.length;B++)R(S.features[B],C);else if(V==="GeometryCollection")for(B=0;B<S.geometries.length;B++)R(S.geometries[B],C);else if(V==="Feature")R(S.geometry,C);else if(V==="Polygon")_e(S.coordinates,C);else if(V==="MultiPolygon")for(B=0;B<S.coordinates.length;B++)_e(S.coordinates[B],C);return S};function _e(R,S){if(R.length!==0){De(R[0],S);for(var C=1;C<R.length;C++)De(R[C],!S)}}function De(R,S){for(var C=0,B=0,V=R.length,W=V-1;B<V;W=B++)C+=(R[B][0]-R[W][0])*(R[W][1]+R[B][1]);C>=0!=!!S&&R.reverse()}const Fe=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class G{constructor(S){this._feature=S,this.extent=s.EXTENT,this.type=S.type,this.properties=S.tags,"id"in S&&!isNaN(S.id)&&(this.id=parseInt(S.id,10))}loadGeometry(){if(this._feature.type===1){const S=[];for(const C of this._feature.geometry)S.push([new s.pointGeometry(C[0],C[1])]);return S}{const S=[];for(const C of this._feature.geometry){const B=[];for(const V of C)B.push(new s.pointGeometry(V[0],V[1]));S.push(B)}return S}}toGeoJSON(S,C,B){return Fe.call(this,S,C,B)}}class Q{constructor(S){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=S.length,this._features=S}feature(S){return new G(this._features[S])}}var ye=s.vectorTile.VectorTileFeature,xe=be;function be(R,S){this.options=S||{},this.features=R,this.length=R.length}function Be(R,S){this.id=typeof R.id=="number"?R.id:void 0,this.type=R.type,this.rawGeometry=R.type===1?[R.geometry]:R.geometry,this.properties=R.tags,this.extent=S||4096}be.prototype.feature=function(R){return new Be(this.features[R],this.options.extent)},Be.prototype.loadGeometry=function(){var R=this.rawGeometry;this.geometry=[];for(var S=0;S<R.length;S++){for(var C=R[S],B=[],V=0;V<C.length;V++)B.push(new s.pointGeometry(C[V][0],C[V][1]));this.geometry.push(B)}return this.geometry},Be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var R=this.geometry,S=1/0,C=-1/0,B=1/0,V=-1/0,W=0;W<R.length;W++)for(var se=R[W],ae=0;ae<se.length;ae++){var te=se[ae];S=Math.min(S,te.x),C=Math.max(C,te.x),B=Math.min(B,te.y),V=Math.max(V,te.y)}return[S,B,C,V]},Be.prototype.toGeoJSON=ye.prototype.toGeoJSON;var lt=it,Qe=xe;function it(R){var S=new s.pbf;return function(C,B){for(var V in C.layers)B.writeMessage(3,Tt,C.layers[V])}(R,S),S.finish()}function Tt(R,S){var C;S.writeVarintField(15,R.version||1),S.writeStringField(1,R.name||""),S.writeVarintField(5,R.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(C=0;C<R.length;C++)B.feature=R.feature(C),S.writeMessage(2,ut,B);var V=B.keys;for(C=0;C<V.length;C++)S.writeStringField(3,V[C]);var W=B.values;for(C=0;C<W.length;C++)S.writeMessage(4,Je,W[C])}function ut(R,S){var C=R.feature;C.id!==void 0&&S.writeVarintField(1,C.id),S.writeMessage(2,Ot,R),S.writeVarintField(3,C.type),S.writeMessage(4,$e,C)}function Ot(R,S){var C=R.feature,B=R.keys,V=R.values,W=R.keycache,se=R.valuecache;for(var ae in C.properties){var te=W[ae];te===void 0&&(B.push(ae),W[ae]=te=B.length-1),S.writeVarint(te);var le=C.properties[ae],we=typeof le;we!=="string"&&we!=="boolean"&&we!=="number"&&(le=JSON.stringify(le));var Ve=we+":"+le,Ce=se[Ve];Ce===void 0&&(V.push(le),se[Ve]=Ce=V.length-1),S.writeVarint(Ce)}}function Ee(R,S){return(S<<3)+(7&R)}function qe(R){return R<<1^R>>31}function $e(R,S){for(var C=R.loadGeometry(),B=R.type,V=0,W=0,se=C.length,ae=0;ae<se;ae++){var te=C[ae],le=1;B===1&&(le=te.length),S.writeVarint(Ee(1,le));for(var we=B===3?te.length-1:te.length,Ve=0;Ve<we;Ve++){Ve===1&&B!==1&&S.writeVarint(Ee(2,we-1));var Ce=te[Ve].x-V,Ke=te[Ve].y-W;S.writeVarint(qe(Ce)),S.writeVarint(qe(Ke)),V+=Ce,W+=Ke}B===3&&S.writeVarint(Ee(7,1))}}function Je(R,S){var C=typeof R;C==="string"?S.writeStringField(1,R):C==="boolean"?S.writeBooleanField(7,R):C==="number"&&(R%1!=0?S.writeDoubleField(3,R):R<0?S.writeSVarintField(6,R):S.writeVarintField(5,R))}function et(R,S,C,B,V,W){if(V-B<=C)return;const se=B+V>>1;st(R,S,se,B,V,W%2),et(R,S,C,B,se-1,W+1),et(R,S,C,se+1,V,W+1)}function st(R,S,C,B,V,W){for(;V>B;){if(V-B>600){const le=V-B+1,we=C-B+1,Ve=Math.log(le),Ce=.5*Math.exp(2*Ve/3),Ke=.5*Math.sqrt(Ve*Ce*(le-Ce)/le)*(we-le/2<0?-1:1);st(R,S,C,Math.max(B,Math.floor(C-we*Ce/le+Ke)),Math.min(V,Math.floor(C+(le-we)*Ce/le+Ke)),W)}const se=S[2*C+W];let ae=B,te=V;for(at(R,S,B,C),S[2*V+W]>se&&at(R,S,B,V);ae<te;){for(at(R,S,ae,te),ae++,te--;S[2*ae+W]<se;)ae++;for(;S[2*te+W]>se;)te--}S[2*B+W]===se?at(R,S,B,te):(te++,at(R,S,te,V)),te<=C&&(B=te+1),C<=te&&(V=te-1)}}function at(R,S,C,B){pt(R,C,B),pt(S,2*C,2*B),pt(S,2*C+1,2*B+1)}function pt(R,S,C){const B=R[S];R[S]=R[C],R[C]=B}function yi(R,S,C,B){const V=R-C,W=S-B;return V*V+W*W}lt.fromVectorTileJs=it,lt.fromGeojsonVt=function(R,S){S=S||{};var C={};for(var B in R)C[B]=new xe(R[B].features,S),C[B].name=B,C[B].version=S.version,C[B].extent=S.extent;return it({layers:C})},lt.GeoJSONWrapper=Qe;const zt=R=>R[0],hi=R=>R[1];class Ji{constructor(S,C=zt,B=hi,V=64,W=Float64Array){this.nodeSize=V,this.points=S;const se=S.length<65536?Uint16Array:Uint32Array,ae=this.ids=new se(S.length),te=this.coords=new W(2*S.length);for(let le=0;le<S.length;le++)ae[le]=le,te[2*le]=C(S[le]),te[2*le+1]=B(S[le]);et(ae,te,V,0,ae.length-1,0)}range(S,C,B,V){return function(W,se,ae,te,le,we,Ve){const Ce=[0,W.length-1,0],Ke=[];let Y,ge;for(;Ce.length;){const rt=Ce.pop(),mt=Ce.pop(),ht=Ce.pop();if(mt-ht<=Ve){for(let Nt=ht;Nt<=mt;Nt++)Y=se[2*Nt],ge=se[2*Nt+1],Y>=ae&&Y<=le&&ge>=te&&ge<=we&&Ke.push(W[Nt]);continue}const At=Math.floor((ht+mt)/2);Y=se[2*At],ge=se[2*At+1],Y>=ae&&Y<=le&&ge>=te&&ge<=we&&Ke.push(W[At]);const wt=(rt+1)%2;(rt===0?ae<=Y:te<=ge)&&(Ce.push(ht),Ce.push(At-1),Ce.push(wt)),(rt===0?le>=Y:we>=ge)&&(Ce.push(At+1),Ce.push(mt),Ce.push(wt))}return Ke}(this.ids,this.coords,S,C,B,V,this.nodeSize)}within(S,C,B){return function(V,W,se,ae,te,le){const we=[0,V.length-1,0],Ve=[],Ce=te*te;for(;we.length;){const Ke=we.pop(),Y=we.pop(),ge=we.pop();if(Y-ge<=le){for(let wt=ge;wt<=Y;wt++)yi(W[2*wt],W[2*wt+1],se,ae)<=Ce&&Ve.push(V[wt]);continue}const rt=Math.floor((ge+Y)/2),mt=W[2*rt],ht=W[2*rt+1];yi(mt,ht,se,ae)<=Ce&&Ve.push(V[rt]);const At=(Ke+1)%2;(Ke===0?se-te<=mt:ae-te<=ht)&&(we.push(ge),we.push(rt-1),we.push(At)),(Ke===0?se+te>=mt:ae+te>=ht)&&(we.push(rt+1),we.push(Y),we.push(At))}return Ve}(this.ids,this.coords,S,C,B,this.nodeSize)}}const zi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:R=>R},Ai=Math.fround||(ai=new Float32Array(1),R=>(ai[0]=+R,ai[0]));var ai;class ft{constructor(S){this.options=ki(Object.create(zi),S),this.trees=new Array(this.options.maxZoom+1)}load(S){const{log:C,minZoom:B,maxZoom:V,nodeSize:W}=this.options;C&&console.time("total time");const se=`prepare ${S.length} points`;C&&console.time(se),this.points=S;let ae=[];for(let te=0;te<S.length;te++)S[te].geometry&&ae.push(Sr(S[te],te));this.trees[V+1]=new Ji(ae,Ir,_r,W,Float32Array),C&&console.timeEnd(se);for(let te=V;te>=B;te--){const le=+Date.now();ae=this._cluster(ae,te),this.trees[te]=new Ji(ae,Ir,_r,W,Float32Array),C&&console.log("z%d: %d clusters in %dms",te,ae.length,+Date.now()-le)}return C&&console.timeEnd("total time"),this}getClusters(S,C){let B=((S[0]+180)%360+360)%360-180;const V=Math.max(-90,Math.min(90,S[1]));let W=S[2]===180?180:((S[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,S[3]));if(S[2]-S[0]>=360)B=-180,W=180;else if(B>W){const we=this.getClusters([B,V,180,se],C),Ve=this.getClusters([-180,V,W,se],C);return we.concat(Ve)}const ae=this.trees[this._limitZoom(C)],te=ae.range(kt(B),ui(se),kt(W),ui(V)),le=[];for(const we of te){const Ve=ae.points[we];le.push(Ve.numPoints?Qi(Ve):this.points[Ve.index])}return le}getChildren(S){const C=this._getOriginId(S),B=this._getOriginZoom(S),V="No cluster with the specified id.",W=this.trees[B];if(!W)throw new Error(V);const se=W.points[C];if(!se)throw new Error(V);const ae=this.options.radius/(this.options.extent*Math.pow(2,B-1)),te=W.within(se.x,se.y,ae),le=[];for(const we of te){const Ve=W.points[we];Ve.parentId===S&&le.push(Ve.numPoints?Qi(Ve):this.points[Ve.index])}if(le.length===0)throw new Error(V);return le}getLeaves(S,C,B){const V=[];return this._appendLeaves(V,S,C=C||10,B=B||0,0),V}getTile(S,C,B){const V=this.trees[this._limitZoom(S)],W=Math.pow(2,S),{extent:se,radius:ae}=this.options,te=ae/se,le=(B-te)/W,we=(B+1+te)/W,Ve={features:[]};return this._addTileFeatures(V.range((C-te)/W,le,(C+1+te)/W,we),V.points,C,B,W,Ve),C===0&&this._addTileFeatures(V.range(1-te/W,le,1,we),V.points,W,B,W,Ve),C===W-1&&this._addTileFeatures(V.range(0,le,te/W,we),V.points,-1,B,W,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(S){let C=this._getOriginZoom(S)-1;for(;C<=this.options.maxZoom;){const B=this.getChildren(S);if(C++,B.length!==1)break;S=B[0].properties.cluster_id}return C}_appendLeaves(S,C,B,V,W){const se=this.getChildren(C);for(const ae of se){const te=ae.properties;if(te&&te.cluster?W+te.point_count<=V?W+=te.point_count:W=this._appendLeaves(S,te.cluster_id,B,V,W):W<V?W++:S.push(ae),S.length===B)break}return W}_addTileFeatures(S,C,B,V,W,se){for(const ae of S){const te=C[ae],le=te.numPoints;let we,Ve,Ce;if(le)we=mr(te),Ve=te.x,Ce=te.y;else{const ge=this.points[te.index];we=ge.properties,Ve=kt(ge.geometry.coordinates[0]),Ce=ui(ge.geometry.coordinates[1])}const Ke={type:1,geometry:[[Math.round(this.options.extent*(Ve*W-B)),Math.round(this.options.extent*(Ce*W-V))]],tags:we};let Y;le?Y=te.id:this.options.generateId?Y=te.index:this.points[te.index].id&&(Y=this.points[te.index].id),Y!==void 0&&(Ke.id=Y),se.features.push(Ke)}}_limitZoom(S){return Math.max(this.options.minZoom,Math.min(+S,this.options.maxZoom+1))}_cluster(S,C){const B=[],{radius:V,extent:W,reduce:se,minPoints:ae}=this.options,te=V/(W*Math.pow(2,C));for(let le=0;le<S.length;le++){const we=S[le];if(we.zoom<=C)continue;we.zoom=C;const Ve=this.trees[C+1],Ce=Ve.within(we.x,we.y,te),Ke=we.numPoints||1;let Y=Ke;for(const ge of Ce){const rt=Ve.points[ge];rt.zoom>C&&(Y+=rt.numPoints||1)}if(Y>=ae){let ge=we.x*Ke,rt=we.y*Ke,mt=se&&Ke>1?this._map(we,!0):null;const ht=(le<<5)+(C+1)+this.points.length;for(const At of Ce){const wt=Ve.points[At];if(wt.zoom<=C)continue;wt.zoom=C;const Nt=wt.numPoints||1;ge+=wt.x*Nt,rt+=wt.y*Nt,wt.parentId=ht,se&&(mt||(mt=this._map(we,!0)),se(mt,this._map(wt)))}we.parentId=ht,B.push(Oi(ge/Y,rt/Y,ht,Y,mt))}else if(B.push(we),Y>1)for(const ge of Ce){const rt=Ve.points[ge];rt.zoom<=C||(rt.zoom=C,B.push(rt))}}return B}_getOriginId(S){return S-this.points.length>>5}_getOriginZoom(S){return(S-this.points.length)%32}_map(S,C){if(S.numPoints)return C?ki({},S.properties):S.properties;const B=this.points[S.index].properties,V=this.options.map(B);return C&&V===B?ki({},V):V}}function Oi(R,S,C,B,V){return{x:Ai(R),y:Ai(S),zoom:1/0,id:C,parentId:-1,numPoints:B,properties:V}}function Sr(R,S){const[C,B]=R.geometry.coordinates;return{x:Ai(kt(C)),y:Ai(ui(B)),zoom:1/0,index:S,parentId:-1}}function Qi(R){return{type:"Feature",id:R.id,properties:mr(R),geometry:{type:"Point",coordinates:[(S=R.x,360*(S-.5)),bt(R.y)]}};var S}function mr(R){const S=R.numPoints,C=S>=1e4?`${Math.round(S/1e3)}k`:S>=1e3?Math.round(S/100)/10+"k":S;return ki(ki({},R.properties),{cluster:!0,cluster_id:R.id,point_count:S,point_count_abbreviated:C})}function kt(R){return R/360+.5}function ui(R){const S=Math.sin(R*Math.PI/180),C=.5-.25*Math.log((1+S)/(1-S))/Math.PI;return C<0?0:C>1?1:C}function bt(R){const S=(180-360*R)*Math.PI/180;return 360*Math.atan(Math.exp(S))/Math.PI-90}function ki(R,S){for(const C in S)R[C]=S[C];return R}function Ir(R){return R.x}function _r(R){return R.y}function qr(R,S,C,B){for(var V,W=B,se=C-S>>1,ae=C-S,te=R[S],le=R[S+1],we=R[C],Ve=R[C+1],Ce=S+3;Ce<C;Ce+=3){var Ke=Ao(R[Ce],R[Ce+1],te,le,we,Ve);if(Ke>W)V=Ce,W=Ke;else if(Ke===W){var Y=Math.abs(Ce-se);Y<ae&&(V=Ce,ae=Y)}}W>B&&(V-S>3&&qr(R,S,V,B),R[V+2]=W,C-V>3&&qr(R,V,C,B))}function Ao(R,S,C,B,V,W){var se=V-C,ae=W-B;if(se!==0||ae!==0){var te=((R-C)*se+(S-B)*ae)/(se*se+ae*ae);te>1?(C=V,B=W):te>0&&(C+=se*te,B+=ae*te)}return(se=R-C)*se+(ae=S-B)*ae}function Ar(R,S,C,B){var V={id:R===void 0?null:R,type:S,geometry:C,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(W){var se=W.geometry,ae=W.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")dn(W,se);else if(ae==="Polygon"||ae==="MultiLineString")for(var te=0;te<se.length;te++)dn(W,se[te]);else if(ae==="MultiPolygon")for(te=0;te<se.length;te++)for(var le=0;le<se[te].length;le++)dn(W,se[te][le])}(V),V}function dn(R,S){for(var C=0;C<S.length;C+=3)R.minX=Math.min(R.minX,S[C]),R.minY=Math.min(R.minY,S[C+1]),R.maxX=Math.max(R.maxX,S[C]),R.maxY=Math.max(R.maxY,S[C+1])}function $r(R,S,C,B){if(S.geometry){var V=S.geometry.coordinates,W=S.geometry.type,se=Math.pow(C.tolerance/((1<<C.maxZoom)*C.extent),2),ae=[],te=S.id;if(C.promoteId?te=S.properties[C.promoteId]:C.generateId&&(te=B||0),W==="Point")er(V,ae);else if(W==="MultiPoint")for(var le=0;le<V.length;le++)er(V[le],ae);else if(W==="LineString")Cr(V,ae,se,!1);else if(W==="MultiLineString"){if(C.lineMetrics){for(le=0;le<V.length;le++)Cr(V[le],ae=[],se,!1),R.push(Ar(te,"LineString",ae,S.properties));return}$n(V,ae,se,!1)}else if(W==="Polygon")$n(V,ae,se,!0);else{if(W!=="MultiPolygon"){if(W==="GeometryCollection"){for(le=0;le<S.geometry.geometries.length;le++)$r(R,{id:te,geometry:S.geometry.geometries[le],properties:S.properties},C,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(le=0;le<V.length;le++){var we=[];$n(V[le],we,se,!0),ae.push(we)}}R.push(Ar(te,W,ae,S.properties))}}function er(R,S){S.push(Ui(R[0])),S.push(Mr(R[1])),S.push(0)}function Cr(R,S,C,B){for(var V,W,se=0,ae=0;ae<R.length;ae++){var te=Ui(R[ae][0]),le=Mr(R[ae][1]);S.push(te),S.push(le),S.push(0),ae>0&&(se+=B?(V*le-te*W)/2:Math.sqrt(Math.pow(te-V,2)+Math.pow(le-W,2))),V=te,W=le}var we=S.length-3;S[2]=1,qr(S,0,we,C),S[we+2]=1,S.size=Math.abs(se),S.start=0,S.end=S.size}function $n(R,S,C,B){for(var V=0;V<R.length;V++){var W=[];Cr(R[V],W,C,B),S.push(W)}}function Ui(R){return R/360+.5}function Mr(R){var S=Math.sin(R*Math.PI/180),C=.5-.25*Math.log((1+S)/(1-S))/Math.PI;return C<0?0:C>1?1:C}function Vi(R,S,C,B,V,W,se,ae){if(B/=S,W>=(C/=S)&&se<B)return R;if(se<C||W>=B)return null;for(var te=[],le=0;le<R.length;le++){var we=R[le],Ve=we.geometry,Ce=we.type,Ke=V===0?we.minX:we.minY,Y=V===0?we.maxX:we.maxY;if(Ke>=C&&Y<B)te.push(we);else if(!(Y<C||Ke>=B)){var ge=[];if(Ce==="Point"||Ce==="MultiPoint")jn(Ve,ge,C,B,V);else if(Ce==="LineString")Zn(Ve,ge,C,B,V,!1,ae.lineMetrics);else if(Ce==="MultiLineString")fn(Ve,ge,C,B,V,!1);else if(Ce==="Polygon")fn(Ve,ge,C,B,V,!0);else if(Ce==="MultiPolygon")for(var rt=0;rt<Ve.length;rt++){var mt=[];fn(Ve[rt],mt,C,B,V,!0),mt.length&&ge.push(mt)}if(ge.length){if(ae.lineMetrics&&Ce==="LineString"){for(rt=0;rt<ge.length;rt++)te.push(Ar(we.id,Ce,ge[rt],we.tags));continue}Ce!=="LineString"&&Ce!=="MultiLineString"||(ge.length===1?(Ce="LineString",ge=ge[0]):Ce="MultiLineString"),Ce!=="Point"&&Ce!=="MultiPoint"||(Ce=ge.length===3?"Point":"MultiPoint"),te.push(Ar(we.id,Ce,ge,we.tags))}}}return te.length?te:null}function jn(R,S,C,B,V){for(var W=0;W<R.length;W+=3){var se=R[W+V];se>=C&&se<=B&&(S.push(R[W]),S.push(R[W+1]),S.push(R[W+2]))}}function Zn(R,S,C,B,V,W,se){for(var ae,te,le=Co(R),we=V===0?Mo:zs,Ve=R.start,Ce=0;Ce<R.length-3;Ce+=3){var Ke=R[Ce],Y=R[Ce+1],ge=R[Ce+2],rt=R[Ce+3],mt=R[Ce+4],ht=V===0?Ke:Y,At=V===0?rt:mt,wt=!1;se&&(ae=Math.sqrt(Math.pow(Ke-rt,2)+Math.pow(Y-mt,2))),ht<C?At>C&&(te=we(le,Ke,Y,rt,mt,C),se&&(le.start=Ve+ae*te)):ht>B?At<B&&(te=we(le,Ke,Y,rt,mt,B),se&&(le.start=Ve+ae*te)):Xn(le,Ke,Y,ge),At<C&&ht>=C&&(te=we(le,Ke,Y,rt,mt,C),wt=!0),At>B&&ht<=B&&(te=we(le,Ke,Y,rt,mt,B),wt=!0),!W&&wt&&(se&&(le.end=Ve+ae*te),S.push(le),le=Co(R)),se&&(Ve+=ae)}var Nt=R.length-3;Ke=R[Nt],Y=R[Nt+1],ge=R[Nt+2],(ht=V===0?Ke:Y)>=C&&ht<=B&&Xn(le,Ke,Y,ge),Nt=le.length-3,W&&Nt>=3&&(le[Nt]!==le[0]||le[Nt+1]!==le[1])&&Xn(le,le[0],le[1],le[2]),le.length&&S.push(le)}function Co(R){var S=[];return S.size=R.size,S.start=R.start,S.end=R.end,S}function fn(R,S,C,B,V,W){for(var se=0;se<R.length;se++)Zn(R[se],S,C,B,V,W,!1)}function Xn(R,S,C,B){R.push(S),R.push(C),R.push(B)}function Mo(R,S,C,B,V,W){var se=(W-S)/(B-S);return R.push(W),R.push(C+(V-C)*se),R.push(1),se}function zs(R,S,C,B,V,W){var se=(W-C)/(V-C);return R.push(S+(B-S)*se),R.push(W),R.push(1),se}function jr(R,S){for(var C=[],B=0;B<R.length;B++){var V,W=R[B],se=W.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")V=mn(W.geometry,S);else if(se==="MultiLineString"||se==="Polygon"){V=[];for(var ae=0;ae<W.geometry.length;ae++)V.push(mn(W.geometry[ae],S))}else if(se==="MultiPolygon")for(V=[],ae=0;ae<W.geometry.length;ae++){for(var te=[],le=0;le<W.geometry[ae].length;le++)te.push(mn(W.geometry[ae][le],S));V.push(te)}C.push(Ar(W.id,se,V,W.tags))}return C}function mn(R,S){var C=[];C.size=R.size,R.start!==void 0&&(C.start=R.start,C.end=R.end);for(var B=0;B<R.length;B+=3)C.push(R[B]+S,R[B+1],R[B+2]);return C}function Ni(R,S){if(R.transformed)return R;var C,B,V,W=1<<R.z,se=R.x,ae=R.y;for(C=0;C<R.features.length;C++){var te=R.features[C],le=te.geometry,we=te.type;if(te.geometry=[],we===1)for(B=0;B<le.length;B+=2)te.geometry.push(zr(le[B],le[B+1],S,W,se,ae));else for(B=0;B<le.length;B++){var Ve=[];for(V=0;V<le[B].length;V+=2)Ve.push(zr(le[B][V],le[B][V+1],S,W,se,ae));te.geometry.push(Ve)}}return R.transformed=!0,R}function zr(R,S,C,B,V,W){return[Math.round(C*(R*B-V)),Math.round(C*(S*B-W))]}function zo(R,S,C,B,V){for(var W=S===V.maxZoom?0:V.tolerance/((1<<S)*V.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:C,y:B,z:S,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<R.length;ae++){se.numFeatures++,Wn(se,R[ae],W,V);var te=R[ae].minX,le=R[ae].minY,we=R[ae].maxX,Ve=R[ae].maxY;te<se.minX&&(se.minX=te),le<se.minY&&(se.minY=le),we>se.maxX&&(se.maxX=we),Ve>se.maxY&&(se.maxY=Ve)}return se}function Wn(R,S,C,B){var V=S.geometry,W=S.type,se=[];if(W==="Point"||W==="MultiPoint")for(var ae=0;ae<V.length;ae+=3)se.push(V[ae]),se.push(V[ae+1]),R.numPoints++,R.numSimplified++;else if(W==="LineString")kr(se,V,R,C,!1,!1);else if(W==="MultiLineString"||W==="Polygon")for(ae=0;ae<V.length;ae++)kr(se,V[ae],R,C,W==="Polygon",ae===0);else if(W==="MultiPolygon")for(var te=0;te<V.length;te++){var le=V[te];for(ae=0;ae<le.length;ae++)kr(se,le[ae],R,C,!0,ae===0)}if(se.length){var we=S.tags||null;if(W==="LineString"&&B.lineMetrics){for(var Ve in we={},S.tags)we[Ve]=S.tags[Ve];we.mapbox_clip_start=V.start/V.size,we.mapbox_clip_end=V.end/V.size}var Ce={geometry:se,type:W==="Polygon"||W==="MultiPolygon"?3:W==="LineString"||W==="MultiLineString"?2:1,tags:we};S.id!==null&&(Ce.id=S.id),R.features.push(Ce)}}function kr(R,S,C,B,V,W){var se=B*B;if(B>0&&S.size<(V?se:B))C.numPoints+=S.length/3;else{for(var ae=[],te=0;te<S.length;te+=3)(B===0||S[te+2]>se)&&(C.numSimplified++,ae.push(S[te]),ae.push(S[te+1])),C.numPoints++;V&&function(le,we){for(var Ve=0,Ce=0,Ke=le.length,Y=Ke-2;Ce<Ke;Y=Ce,Ce+=2)Ve+=(le[Ce]-le[Y])*(le[Ce+1]+le[Y+1]);if(Ve>0===we)for(Ce=0,Ke=le.length;Ce<Ke/2;Ce+=2){var ge=le[Ce],rt=le[Ce+1];le[Ce]=le[Ke-2-Ce],le[Ce+1]=le[Ke-1-Ce],le[Ke-2-Ce]=ge,le[Ke-1-Ce]=rt}}(ae,W),R.push(ae)}}function Zr(R,S){var C=(S=this.options=function(V,W){for(var se in W)V[se]=W[se];return V}(Object.create(this.options),S)).debug;if(C&&console.time("preprocess data"),S.maxZoom<0||S.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(S.promoteId&&S.generateId)throw new Error("promoteId and generateId cannot be used together.");var B=function(V,W){var se=[];if(V.type==="FeatureCollection")for(var ae=0;ae<V.features.length;ae++)$r(se,V.features[ae],W,ae);else $r(se,V.type==="Feature"?V:{geometry:V},W);return se}(R,S);this.tiles={},this.tileCoords=[],C&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",S.indexMaxZoom,S.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(B=function(V,W){var se=W.buffer/W.extent,ae=V,te=Vi(V,1,-1-se,se,0,-1,2,W),le=Vi(V,1,1-se,2+se,0,-1,2,W);return(te||le)&&(ae=Vi(V,1,-se,1+se,0,-1,2,W)||[],te&&(ae=jr(te,1).concat(ae)),le&&(ae=ae.concat(jr(le,-1)))),ae}(B,S)).length&&this.splitTile(B,0,0,0),C&&(B.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xr(R,S,C){return 32*((1<<R)*C+S)+R}function Wr(R,S){const C=R.tileID.canonical;if(!this._geoJSONIndex)return S(null,null);const B=this._geoJSONIndex.getTile(C.z,C.x,C.y);if(!B)return S(null,null);const V=new Q(B.features);let W=lt(V);W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),S(null,{vectorTile:V,rawData:W.buffer})}Zr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zr.prototype.splitTile=function(R,S,C,B,V,W,se){for(var ae=[R,S,C,B],te=this.options,le=te.debug;ae.length;){B=ae.pop(),C=ae.pop(),S=ae.pop(),R=ae.pop();var we=1<<S,Ve=Xr(S,C,B),Ce=this.tiles[Ve];if(!Ce&&(le>1&&console.time("creation"),Ce=this.tiles[Ve]=zo(R,S,C,B,te),this.tileCoords.push({z:S,x:C,y:B}),le)){le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",S,C,B,Ce.numFeatures,Ce.numPoints,Ce.numSimplified),console.timeEnd("creation"));var Ke="z"+S;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(Ce.source=R,V){if(S===te.maxZoom||S===V)continue;var Y=1<<V-S;if(C!==Math.floor(W/Y)||B!==Math.floor(se/Y))continue}else if(S===te.indexMaxZoom||Ce.numPoints<=te.indexMaxPoints)continue;if(Ce.source=null,R.length!==0){le>1&&console.time("clipping");var ge,rt,mt,ht,At,wt,Nt=.5*te.buffer/te.extent,gr=.5-Nt,je=.5+Nt,dt=1+Nt;ge=rt=mt=ht=null,At=Vi(R,we,C-Nt,C+je,0,Ce.minX,Ce.maxX,te),wt=Vi(R,we,C+gr,C+dt,0,Ce.minX,Ce.maxX,te),R=null,At&&(ge=Vi(At,we,B-Nt,B+je,1,Ce.minY,Ce.maxY,te),rt=Vi(At,we,B+gr,B+dt,1,Ce.minY,Ce.maxY,te),At=null),wt&&(mt=Vi(wt,we,B-Nt,B+je,1,Ce.minY,Ce.maxY,te),ht=Vi(wt,we,B+gr,B+dt,1,Ce.minY,Ce.maxY,te),wt=null),le>1&&console.timeEnd("clipping"),ae.push(ge||[],S+1,2*C,2*B),ae.push(rt||[],S+1,2*C,2*B+1),ae.push(mt||[],S+1,2*C+1,2*B),ae.push(ht||[],S+1,2*C+1,2*B+1)}}},Zr.prototype.getTile=function(R,S,C){var B=this.options,V=B.extent,W=B.debug;if(R<0||R>24)return null;var se=1<<R,ae=Xr(R,S=(S%se+se)%se,C);if(this.tiles[ae])return Ni(this.tiles[ae],V);W>1&&console.log("drilling down to z%d-%d-%d",R,S,C);for(var te,le=R,we=S,Ve=C;!te&&le>0;)le--,we=Math.floor(we/2),Ve=Math.floor(Ve/2),te=this.tiles[Xr(le,we,Ve)];return te&&te.source?(W>1&&console.log("found parent tile z%d-%d-%d",le,we,Ve),W>1&&console.time("drilling down"),this.splitTile(te.source,le,we,Ve,R,S,C),W>1&&console.timeEnd("drilling down"),this.tiles[ae]?Ni(this.tiles[ae],V):null):null};class _n extends s.VectorTileWorkerSource{constructor(S,C,B,V,W){super(S,C,B,V,Wr),W&&(this.loadGeoJSON=W)}loadData(S,C){const B=S&&S.request,V=B&&B.collectResourceTiming;this.loadGeoJSON(S,(W,se)=>{if(W||!se)return C(W);if(typeof se!="object")return C(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`));{ie(se,!0);try{if(S.filter){const te=s.createExpression(S.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(we=>`${we.key}: ${we.message}`).join(", "));const le=se.features.filter(we=>te.value.evaluate({zoom:0},we));se={type:"FeatureCollection",features:le}}this._geoJSONIndex=S.cluster?new ft(function({superclusterOptions:te,clusterProperties:le}){if(!le||!te)return te;const we={},Ve={},Ce={accumulated:null,zoom:0},Ke={properties:null},Y=Object.keys(le);for(const ge of Y){const[rt,mt]=le[ge],ht=s.createExpression(mt),At=s.createExpression(typeof rt=="string"?[rt,["accumulated"],["get",ge]]:rt);we[ge]=ht.value,Ve[ge]=At.value}return te.map=ge=>{Ke.properties=ge;const rt={};for(const mt of Y)rt[mt]=we[mt].evaluate(Ce,Ke);return rt},te.reduce=(ge,rt)=>{Ke.properties=rt;for(const mt of Y)Ce.accumulated=ge[mt],ge[mt]=Ve[mt].evaluate(Ce,Ke)},te}(S)).load(se.features):function(te,le){return new Zr(te,le)}(se,S.geojsonVtOptions)}catch(te){return C(te)}this.loaded={};const ae={};if(V){const te=s.getPerformanceMeasurement(B);te&&(ae.resourceTiming={},ae.resourceTiming[S.source]=JSON.parse(JSON.stringify(te)))}C(null,ae)}})}reloadTile(S,C){const B=this.loaded;return B&&B[S.uid]?super.reloadTile(S,C):this.loadTile(S,C)}loadGeoJSON(S,C){if(S.request)s.getJSON(S.request,C);else{if(typeof S.data!="string")return C(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`));try{return C(null,JSON.parse(S.data))}catch{return C(new Error(`Input data given to '${S.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(S,C){try{C(null,this._geoJSONIndex.getClusterExpansionZoom(S.clusterId))}catch(B){C(B)}}getClusterChildren(S,C){try{C(null,this._geoJSONIndex.getChildren(S.clusterId))}catch(B){C(B)}}getClusterLeaves(S,C){try{C(null,this._geoJSONIndex.getLeaves(S.clusterId,S.limit,S.offset))}catch(B){C(B)}}}class cr{constructor(S){this.self=S,this.actor=new s.Actor(S,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:_n},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(C,B)=>{if(this.workerSourceTypes[C])throw new Error(`Worker source with name "${C}" already registered.`);this.workerSourceTypes[C]=B},this.self.registerRTLTextPlugin=C=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=C.applyArabicShaping,s.plugin.processBidirectionalText=C.processBidirectionalText,s.plugin.processStyledBidirectionalText=C.processStyledBidirectionalText}}checkIfReady(S,C,B){B()}setReferrer(S,C){this.referrer=C}spriteLoaded(S,C){this.isSpriteLoaded=C;for(const B in this.workerSources[S]){const V=this.workerSources[S][B];for(const W in V)V[W]instanceof s.VectorTileWorkerSource&&(V[W].isSpriteLoaded=C,V[W].fire(new s.Event("isSpriteLoaded")))}}setImages(S,C,B){this.availableImages[S]=C;for(const V in this.workerSources[S]){const W=this.workerSources[S][V];for(const se in W)W[se].availableImages=C}B()}enableTerrain(S,C,B){this.terrain=C,B()}setLayers(S,C,B){this.getLayerIndex(S).replace(C),B()}updateLayers(S,C,B){this.getLayerIndex(S).update(C.layers,C.removedIds),B()}loadTile(S,C,B){const V=this.enableTerrain?s.extend({enableTerrain:this.terrain},C):C;this.getWorkerSource(S,C.type,C.source).loadTile(V,B)}loadDEMTile(S,C,B){const V=this.enableTerrain?s.extend({buildQuadTree:this.terrain},C):C;this.getDEMWorkerSource(S,C.source).loadTile(V,B)}reloadTile(S,C,B){const V=this.enableTerrain?s.extend({enableTerrain:this.terrain},C):C;this.getWorkerSource(S,C.type,C.source).reloadTile(V,B)}abortTile(S,C,B){this.getWorkerSource(S,C.type,C.source).abortTile(C,B)}removeTile(S,C,B){this.getWorkerSource(S,C.type,C.source).removeTile(C,B)}removeSource(S,C,B){if(!this.workerSources[S]||!this.workerSources[S][C.type]||!this.workerSources[S][C.type][C.source])return;const V=this.workerSources[S][C.type][C.source];delete this.workerSources[S][C.type][C.source],V.removeSource!==void 0?V.removeSource(C,B):B()}loadWorkerSource(S,C,B){try{this.self.importScripts(C.url),B()}catch(V){B(V.toString())}}syncRTLPluginState(S,C,B){try{s.plugin.setState(C);const V=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&V!=null){this.self.importScripts(V);const W=s.plugin.isParsed();B(W?void 0:new Error(`RTL Text Plugin failed to import scripts from ${V}`),W)}}catch(V){B(V.toString())}}getAvailableImages(S){let C=this.availableImages[S];return C||(C=[]),C}getLayerIndex(S){let C=this.layerIndexes[S];return C||(C=this.layerIndexes[S]=new me),C}getWorkerSource(S,C,B){return this.workerSources[S]||(this.workerSources[S]={}),this.workerSources[S][C]||(this.workerSources[S][C]={}),this.workerSources[S][C][B]||(this.workerSources[S][C][B]=new this.workerSourceTypes[C]({send:(V,W,se,ae,te,le)=>{this.actor.send(V,W,se,S,te,le)},scheduler:this.actor.scheduler},this.getLayerIndex(S),this.getAvailableImages(S),this.isSpriteLoaded)),this.workerSources[S][C][B]}getDEMWorkerSource(S,C){return this.demWorkerSources[S]||(this.demWorkerSources[S]={}),this.demWorkerSources[S][C]||(this.demWorkerSources[S][C]=new O),this.demWorkerSources[S][C]}enforceCacheSizeLimit(S,C){s.enforceCacheSizeLimit(C)}getWorkerPerformanceMetrics(S,C,B){B(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new cr(self)),cr}),de(["./shared"],function(s){var J=ee;function ee(l){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var c,p,d=new Blob([""],{type:"text/javascript"}),_=URL.createObjectURL(d);try{p=new Worker(_),c=!0}catch{c=!1}return p&&p.terminate(),URL.revokeObjectURL(_),c}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var c=document.createElement("canvas");c.width=c.height=1;var p=c.getContext("2d");if(!p)return!1;var d=p.getImageData(0,0,1,1);return d&&d.width===c.width}()?(me[o=t&&t.failIfMajorPerformanceCaveat]===void 0&&(me[o]=function(c){var p,d=function(_){var y=document.createElement("canvas"),v=Object.create(ee.webGLContextAttributes);return v.failIfMajorPerformanceCaveat=_,y.getContext("webgl",v)||y.getContext("experimental-webgl",v)}(c);if(!d)return!1;try{p=d.createShader(d.VERTEX_SHADER)}catch{return!1}return!(!p||d.isContextLost())&&(d.shaderSource(p,"void main() {}"),d.compileShader(p),d.getShaderParameter(p,d.COMPILE_STATUS)===!0)}(o)),me[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(l)}var me={};function X(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let o=0;o<l.length;o++)if(!X(l[o],t[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const o in l)if(!X(l[o],t[o]))return!1;return!0}return l===t}ee.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const O={create:function(l,t,o){const c=s.window.document.createElement(l);return t!==void 0&&(c.className=t),o&&o.appendChild(c),c},createNS:function(l,t){return s.window.document.createElementNS(l,t)}},ie=s.window.document&&s.window.document.documentElement.style,_e=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect";let De;O.disableDrag=function(){ie&&_e&&(De=ie[_e],ie[_e]="none")},O.enableDrag=function(){ie&&_e&&(ie[_e]=De)},O.setTransform=function(l,t){l.style.transform=t};let Fe=!1;try{const l=Object.defineProperty({},"passive",{get(){Fe=!0}});s.window.addEventListener("test",l,l),s.window.removeEventListener("test",l,l)}catch{Fe=!1}O.addEventListener=function(l,t,o,c={}){l.addEventListener(t,o,"passive"in c&&Fe?c:c.capture)},O.removeEventListener=function(l,t,o,c={}){l.removeEventListener(t,o,"passive"in c&&Fe?c:c.capture)};const G=function(l){l.preventDefault(),l.stopPropagation(),s.window.removeEventListener("click",G,!0)};function Q(l,t,o){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new s.pointGeometry((o.clientX-t.left)*c,(o.clientY-t.top)*c)}O.suppressClick=function(){s.window.addEventListener("click",G,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",G,!0)},0)},O.mousePos=function(l,t){const o=l.getBoundingClientRect();return Q(l,o,t)},O.touchPos=function(l,t){const o=l.getBoundingClientRect(),c=[];for(let p=0;p<t.length;p++)c.push(Q(l,o,t[p]));return c},O.mouseButton=function(l){return s.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},O.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};class ye{constructor(t,o){this.pos=t,this.dir=o}intersectsPlane(t,o,c){const p=s.dot(o,this.dir);if(Math.abs(p)<1e-6)return!1;const d=s.dot(s.sub(s.create(),t,this.pos),o)/p,_=s.scaleAndAdd(s.create(),this.pos,this.dir,d);return s.copy(c,_),!0}}class xe{constructor(t,o){this.points=t,this.planes=o}static fromInvProjectionMatrix(t,o,c){const p=Math.pow(2,c),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const v=s.transformMat4([],y,t),w=1/v[3]/o*p;return s.mul(v,v,[w,w,1/v[3],w])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const v=s.sub([],d[y[0]],d[y[1]]),w=s.sub([],d[y[2]],d[y[1]]),E=s.normalize([],s.cross([],v,w)),A=-s.dot(E,d[y[1]]);return E.concat(A)});return new xe(d,_)}}class be{constructor(t,o){this.min=t,this.max=o,this.center=s.scale([],s.add([],this.min,this.max),.5)}quadrant(t){const o=[t%2==0,t<2],c=s.clone(this.min),p=s.clone(this.max);for(let d=0;d<o.length;d++)c[d]=o[d]?this.min[d]:this.center[d],p[d]=o[d]?this.center[d]:this.max[d];return p[2]=this.max[2],new be(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let p=0;p<t.planes.length;p++){const d=t.planes[p];let _=0;for(let y=0;y<o.length;y++)_+=s.dot$1(d,o[y])>=0;if(_===0)return 0;_!==o.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const v=t.points[y][p]-this.min[p];d=Math.min(d,v),_=Math.max(_,v)}if(_<0||d>this.max[p]-this.min[p])return 0}return 1}}function Be(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class lt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,callback:c}of this.requestors)this._notify(o,c);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,o){this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let c=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(o.content,o)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,o){if(!t)return!0;let c=0;for(const p of t){if(p[0]<c||p[1]<p[0]||o<p[1])return!1;c=p[1]}return!0}_validateContent(t,o){return!(t&&(t.length!==4||t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,o){o.version=this.images[t].version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,o){let c=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(c=!1);this.isLoaded()||c?this._notify(t,o):this.requestors.push({ids:t,callback:o})}_notify(t,o){const c={};for(const p of t){this.images[p]||this.fire(new s.Event("styleimagemissing",{id:p}));const d=this.images[p];d?c[p]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:Boolean(d.userImage&&d.userImage.render)}:s.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,c)}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],c=this.getImage(t);if(!c)return null;if(o&&o.position.version===c.version)return o.position;if(o)o.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},d=new s.ImagePosition(p,c);this.patterns[t]={bin:p,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:o,h:c}=s.potpack(t),p=this.atlasImage;p.resize({width:o||1,height:c||1});for(const d in this.patterns){const{bin:_}=this.patterns[d],y=_.x+1,v=_.y+1,w=this.images[d].data,E=w.width,A=w.height;s.RGBAImage.copy(w,p,{x:0,y:0},{x:y,y:v},{width:E,height:A}),s.RGBAImage.copy(w,p,{x:0,y:A-1},{x:y,y:v-1},{width:E,height:1}),s.RGBAImage.copy(w,p,{x:0,y:0},{x:y,y:v+A},{width:E,height:1}),s.RGBAImage.copy(w,p,{x:E-1,y:0},{x:y-1,y:v},{width:1,height:A}),s.RGBAImage.copy(w,p,{x:0,y:0},{x:y+E,y:v},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const c=this.images[o];Be(c)&&this.updateImage(o,c)}}}const Qe=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(l,t){return function([o,c,p]){const d=s.degToRad(c+90),_=s.degToRad(p);return{x:o*Math.cos(d)*Math.sin(_),y:o*Math.sin(d)*Math.sin(_),z:o*Math.cos(_),azimuthal:c,polar:p}}(l.expression.evaluate(t))}interpolate(l,t,o){return{x:s.number(l.x,t.x,o),y:s.number(l.y,t.y,o),z:s.number(l.z,t.z,o),azimuthal:s.number(l.azimuthal,t.azimuthal,o),polar:s.number(l.polar,t.polar,o)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),it="-transition";class Tt extends s.Evented{constructor(t){super(),this._transitionable=new s.Transitionable(Qe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(s.validateLight,t,o))for(const c in t){const p=t[c];s.endsWith(c,it)?this._transitionable.setTransition(c.slice(0,-it.length),p):this._transitionable.setValue(c,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,c){return(!c||c.validate!==!1)&&s.emitValidationErrors(this,t.call(s.validateStyle,s.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const ut=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Ot="-transition";class Ee extends s.Evented{constructor(t){super(),this._transitionable=new s.Transitionable(ut),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const o in t){const c=t[o];s.endsWith(o,Ot)?this._transitionable.setTransition(o.slice(0,-Ot.length),c):this._transitionable.setValue(o,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function qe(l,t,o,c){const p=s.smoothstep(45,65,o),[d,_]=$e(l,c),y=s.length(t);let v=1-Math.min(1,Math.exp((y-d)/(_-d)*-6));return v*=v*v,v=Math.min(1,1.00747*v),v*p*l.alpha}function $e(l,t){const o=.5/Math.tan(.5*t);return[l.range[0]+o,l.range[1]+o]}const Je=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"])}),et="-transition";class st extends s.Evented{constructor(t){super(),this._transitionable=new s.Transitionable(Je),this.set(t),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t){if(!this._validate(s.validateFog,t))for(const o in t){const c=t[o];s.endsWith(o,et)?this._transitionable.setTransition(o.slice(0,-et.length),c):this._transitionable.setValue(o,c)}}getOpacity(t){const o=this.properties&&this.properties.get("color")||1;return s.smoothstep(45,65,t)*o.a}getOpacityAtLatLng(t,o){return function(c,p,d){const _=s.MercatorCoordinate.fromLngLat(p),y=d.elevation?d.elevation.getAtPointOrZero(_):0,v=[_.x,_.y,y];return s.transformMat4$1(v,v,d.mercatorFogMatrix),qe(c,v,d.pitch,d._fov)}(this.state,t,o)}getFovAdjustedRange(t){return $e(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,c){return(!c||c.validate!==!1)&&s.emitValidationErrors(this,t.call(s.validateStyle,s.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class at{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const c=this.workerPool.acquire(this.id);for(let p=0;p<c.length;p++){const d=new at.Actor(c[p],o,this.id);d.name=`Worker ${p}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,o,c){s.asyncAll(this.actors,(p,d)=>{p.send(t,o,d)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pt(l,t,o){return t*(s.EXTENT/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}at.Actor=s.Actor;class yi{constructor(t,o,c,p){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(d=>p.pointCoordinate3D(d)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,o){let c,p;if(t instanceof s.pointGeometry||typeof t[0]=="number"){const d=s.pointGeometry.convert(t);c=[s.pointGeometry.convert(t)],p=o.isPointAboveHorizon(d)}else{const d=s.pointGeometry.convert(t[0]),_=s.pointGeometry.convert(t[1]);c=[d,_],p=s.polygonizeBounds(d,_).every(y=>o.isPointAboveHorizon(y))}return new yi(c,o.getCameraPoint(),p,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],p=s.polygonizeBounds(o,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<c.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?p[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(p[3]=this.cameraPoint)),s.bufferConvexPolygon(p,t)}containsTile(t,o,c){const p=t.queryPadding+1,d=c?this._bufferedCameraMercator(p,o).map(k=>t.tileID.getTilePoint(k)):this._bufferedScreenMercator(p,o).map(k=>t.tileID.getTilePoint(k)),_=this.screenGeometryMercator.map(k=>t.tileID.getTileVec3(k)),y=_.map(k=>new s.pointGeometry(k[0],k[1])),v=o.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),w=t.tileID.getTileVec3(v),E=_.map(k=>{const D=s.sub(k,k,w);return s.normalize(D,D),new ye(w,D)}),A=pt(t,1,o.zoom);if(s.polygonIntersectsBox(d,0,0,s.EXTENT,s.EXTENT))return{queryGeometry:this,tilespaceGeometry:y,tilespaceRays:E,bufferedTilespaceGeometry:d,bufferedTilespaceBounds:(z=s.getBounds(d),z.min.x=s.clamp(z.min.x,0,s.EXTENT),z.min.y=s.clamp(z.min.y,0,s.EXTENT),z.max.x=s.clamp(z.max.x,0,s.EXTENT),z.max.y=s.clamp(z.max.y,0,s.EXTENT),z),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:A};var z}_bufferedScreenMercator(t,o){const c=zt(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{const p=this.bufferedScreenGeometry(t).map(d=>o.pointCoordinate3D(d));return this._screenRaycastCache[c]=p,p}}_bufferedCameraMercator(t,o){const c=zt(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{const p=this.bufferedCameraGeometry(t).map(d=>o.pointCoordinate3D(d));return this._cameraRaycastCache[c]=p,p}}}function zt(l){return 100*l|0}function hi(l,t,o){const c=function(p,d){if(p)return o(p);if(d){const _=s.pick(s.extend(d,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(_.vectorLayers=d.vector_layers,_.vectorLayerIds=_.vectorLayers.map(y=>y.id)),_.tiles=t.canonicalizeTileset(_,l.url),o(null,_)}};return l.url?s.getJSON(t.transformRequest(t.normalizeSourceURL(l.url),s.ResourceType.Source),c):s.exported.frame(()=>c(null,l))}class Ji{constructor(t,o,c){this.bounds=s.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),c=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*o),p=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*o),d=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*o),_=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*o);return t.x>=c&&t.x<d&&t.y>=p&&t.y<_}}class zi{constructor(t,o,c){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ai={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ai{constructor(t,o,c,p){this.length=o.length,this.attributes=c,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let c=0;c<this.attributes.length;c++){const p=o.attributes[this.attributes[c].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,o,c){for(let p=0;p<this.attributes.length;p++){const d=this.attributes[p],_=o.attributes[d.name];_!==void 0&&t.vertexAttribPointer(_,d.components,t[Ai[d.type]],!1,this.itemSize,d.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ft{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Oi extends ft{getDefault(){return s.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Sr extends ft{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Qi extends ft{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class mr extends ft{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class kt extends ft{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ui extends ft{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class bt extends ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ki extends ft{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ir extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class _r extends ft{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class qr extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ao extends ft{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ar extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class dn extends ft{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class $r extends ft{getDefault(){return s.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class er extends ft{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Cr extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class $n extends ft{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ui extends ft{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Mr extends ft{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Vi extends ft{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class jn extends ft{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zn extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Co extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fn extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Xn extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Mo extends ft{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class zs extends ft{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class jr extends ft{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class mn extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ni extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class zr extends ft{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class zo extends zr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Wn extends zr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kr extends Wn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Zr{constructor(t,o,c,p){this.context=t,this.width=o,this.height=c;const d=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new zo(t,d),p&&(this.depthAttachment=new Wn(t,d))}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Xr{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Oi(this),this.clearDepth=new Sr(this),this.clearStencil=new Qi(this),this.colorMask=new mr(this),this.depthMask=new kt(this),this.stencilMask=new ui(this),this.stencilFunc=new bt(this),this.stencilOp=new ki(this),this.stencilTest=new Ir(this),this.depthRange=new _r(this),this.depthTest=new qr(this),this.depthFunc=new Ao(this),this.blend=new Ar(this),this.blendFunc=new dn(this),this.blendColor=new $r(this),this.blendEquation=new er(this),this.cullFace=new Cr(this),this.cullFaceSide=new $n(this),this.frontFace=new Ui(this),this.program=new Mr(this),this.activeTexture=new Vi(this),this.viewport=new jn(this),this.bindFramebuffer=new Zn(this),this.bindRenderbuffer=new Co(this),this.bindTexture=new fn(this),this.bindVertexBuffer=new Xn(this),this.bindElementBuffer=new Mo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new zs(this),this.pixelStoreUnpack=new jr(this),this.pixelStoreUnpackPremultiplyAlpha=new mn(this),this.pixelStoreUnpackFlipY=new Ni(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new zi(this,t,o)}createVertexBuffer(t,o,c){return new ai(this,t,o,c)}createRenderbuffer(t,o,c){const p=this.gl,d=p.createRenderbuffer();return this.bindRenderbuffer.set(d),p.renderbufferStorage(p.RENDERBUFFER,t,o,c),this.bindRenderbuffer.set(null),d}createFramebuffer(t,o,c){return new Zr(this,t,o,c)}clear({color:t,depth:o,stencil:c}){const p=this.gl;let d=0;t&&(d|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(d|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),c!==void 0&&(d|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){X(t.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Wr extends s.Evented{constructor(t,o,c,p){super(),this.id=t,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},o),s.extend(this,s.pick(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hi(this._options,this.map._requestManager,(t,o)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.ErrorEvent(t)):o&&(s.extend(this,o),o.bounds&&(this.tileBounds=new Ji(o.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(o.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const c=s.exported.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=s.getImage(this.map._requestManager.transformRequest(p,s.ResourceType.Tile),(d,_,y,v)=>{if(delete t.request,t.aborted)t.state="unloaded",o(null);else if(d)t.state="errored",o(d);else if(_){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:y,expires:v});const w=this.map.painter.context,E=w.gl;t.texture=this.map.painter.getTileTexture(_.width),t.texture?t.texture.update(_,{useMipmap:!0}):(t.texture=new s.Texture(w,_,E.RGBA,{useMipmap:!0}),t.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),t.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),o(null)}})}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o()}unloadTile(t,o){t.texture&&this.map.painter.saveTileTexture(t.texture),o()}hasTransition(){return!1}}let _n;var cr=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class R extends s.Evented{constructor(t,o,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}load(t,o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(c,p)=>{this._loaded=!0,c?this.fire(new s.ErrorEvent(c)):p&&(this.image=p,t&&(this.coordinates=t),o&&o(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const o=t.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(p){let d=1/0,_=1/0,y=-1/0,v=-1/0;for(const z of p)d=Math.min(d,z.x),_=Math.min(_,z.y),y=Math.max(y,z.x),v=Math.max(v,z.y);const w=Math.max(y-d,v-_),E=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),A=Math.pow(2,E);return new s.CanonicalTileID(E,Math.floor((d+y)/2*A),Math.floor((_+v)/2*A))}(o),this.minzoom=this.maxzoom=this.tileID.z;const c=o.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,o=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,cr.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(t,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const S={vector:class extends s.Evented{constructor(l,t,o,c){if(super(),this.id=l,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(t,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hi(this._options,this.map._requestManager,(l,t)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new s.ErrorEvent(l)):t&&(s.extend(this,t),t.bounds&&(this.tileBounds=new Ji(t.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l();const t=this.map.style._getSourceCaches(this.id);for(const o of t)o.clearTiles();this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(l,t){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(o,s.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(c.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=t:l.request=l.actor.send("reloadTile",c,p.bind(this));else if(l.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",c,p.bind(this),void 0,!0);else{const d=s.loadVectorTile.call({deduped:this._deduped},c,(_,y)=>{_||!y?p.call(this,_):(c.data={cacheControl:y.cacheControl,expires:y.expires,rawData:y.rawData.slice(0)},l.actor&&l.actor.send("loadTile",c,p.bind(this),void 0,!0))},!0);l.request={cancel:d}}function p(d,_){return delete l.request,l.aborted?t(null):d&&d.status!==404?t(d):(_&&_.resourceTiming&&(l.resourceTiming=_.resourceTiming),this.map._refreshExpiredTiles&&_&&l.setExpiryData(_),l.loadVectorData(_,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Wr,"raster-dem":class extends Wr{constructor(l,t,o,c){super(l,t,o,c),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(p,d){p&&(l.state="errored",t(p)),d&&(l.dem=d,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=s.getImage(this.map._requestManager.transformRequest(o,s.ResourceType.Tile),function(p,d,_,y){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(p)l.state="errored",t(p);else if(d){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:_,expires:y});const v=s.window.ImageBitmap&&d instanceof s.window.ImageBitmap&&(_n==null&&(_n=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),_n),w=1-(d.width-s.prevPowerOfTwo(d.width))/2;w<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const E=v?d:s.exported.getImageData(d,w),A={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:E,encoding:this.encoding,padding:w};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",A,c.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const t=l.canonical,o=Math.pow(2,t.z),c=(t.x-1+o)%o,p=t.x===0?l.wrap-1:l.wrap,d=(t.x+1+o)%o,_=t.x+1===o?l.wrap+1:l.wrap,y={};return y[new s.OverscaledTileID(l.overscaledZ,p,t.z,c,t.y).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,_,t.z,d,t.y).key]={backfilled:!1},t.y>0&&(y[new s.OverscaledTileID(l.overscaledZ,p,t.z,c,t.y-1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,_,t.z,d,t.y-1).key]={backfilled:!1}),t.y+1<o&&(y[new s.OverscaledTileID(l.overscaledZ,p,t.z,c,t.y+1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,_,t.z,d,t.y+1).key]={backfilled:!1}),y}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends s.Evented{constructor(l,t,o,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(c),this._data=t.data,this._options=s.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},t),this}getClusterLeaves(l,t,o,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:t,offset:o},c),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=s.extend({},this.workerOptions),t=this._data;typeof t=="string"?(l.request=this.map._requestManager.transformRequest(s.exported.resolveURL(t),s.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(o,c)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new s.ErrorEvent(o));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&c&&c.resourceTiming&&c.resourceTiming[this.id]&&(p.resourceTiming=c.resourceTiming[this.id]),this.fire(new s.Event("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,t){const o=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(o,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(c,p)=>(delete l.request,l.unloadVectorData(),l.aborted?t(null):c?t(c):(l.loadVectorData(p,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends R{constructor(l,t,o,c){super(l,t,o,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.ResourceType.Source).url);s.getVideo(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new s.ErrorEvent(t)):o&&(this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,cr.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(l,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const o in this.tiles){const c=this.tiles[o];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:R,canvas:class extends R{constructor(l,t,o,c){super(l,t,o,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(d=>typeof d!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context,o=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,cr.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(t,this.canvas,o.RGBA,{premultiply:!0});for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}},C=function(l,t,o,c){const p=new S[t.type](l,t,o,c);if(p.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${p.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],p),p};function B(l,t){const o=s.identity([]);return s.scale$1(o,o,[.5*l.width,.5*-l.height,1]),s.translate(o,o,[1,-1,0]),s.multiply(o,o,l.calculateProjMatrix(t.toUnwrapped()))}function V(l,t,o,c,p,d,_,y=!1){const v=l.tilesIn(c,_,y);v.sort(se);const w=[];for(const A of v)w.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(t,o,l._state,A,p,d,B(l.transform,A.tile.tileID),y)});const E=function(A){const z={},k={};for(const D of A){const F=D.queryResults,Z=D.wrappedTileID,P=k[Z]=k[Z]||{};for(const U in F){const $=F[U],H=P[U]=P[U]||{},re=z[U]=z[U]||[];for(const N of $)H[N.featureIndex]||(H[N.featureIndex]=!0,re.push(N))}}return z}(w);for(const A in E)E[A].forEach(z=>{const k=z.feature,D=l.getFeatureState(k.layer["source-layer"],k.id);k.source=k.layer.source,k.layer["source-layer"]&&(k.sourceLayer=k.layer["source-layer"]),k.state=D});return E}function W(l,t){const o=l.getRenderableIds().map(d=>l.getTileByID(d)),c=[],p={};for(let d=0;d<o.length;d++){const _=o[d],y=_.tileID.canonical.key;p[y]||(p[y]=!0,_.querySourceFeatures(c,t))}return c}function se(l,t){const o=l.tileID,c=t.tileID;return o.overscaledZ-c.overscaledZ||o.canonical.y-c.canonical.y||o.wrap-c.wrap||o.canonical.x-c.canonical.x}function ae(){return ps.workerClass!=null?new ps.workerClass:new s.window.Worker(ps.workerUrl)}const te="mapboxgl_preloaded_worker_pool";class le{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<le.workerCount;)this.workers.push(new ae);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[te]}numActive(){return Object.keys(this.active).length}}let we;function Ve(){return we||(we=new le),we}function Ce(l,t){const o={};for(const c in l)c!=="ref"&&(o[c]=l[c]);return s.refProperties.forEach(c=>{c in t&&(o[c]=t[c])}),o}function Ke(l){l=l.slice();const t=Object.create(null);for(let o=0;o<l.length;o++)t[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=Ce(l[o],t[l[o].ref]));return l}le.workerCount=2;const Y={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function ge(l,t,o){o.push({command:Y.addSource,args:[l,t[l]]})}function rt(l,t,o){t.push({command:Y.removeSource,args:[l]}),o[l]=!0}function mt(l,t,o,c){rt(l,o,c),ge(l,t,o)}function ht(l,t,o){let c;for(c in l[o])if(l[o].hasOwnProperty(c)&&c!=="data"&&!X(l[o][c],t[o][c]))return!1;for(c in t[o])if(t[o].hasOwnProperty(c)&&c!=="data"&&!X(l[o][c],t[o][c]))return!1;return!0}function At(l,t,o,c,p,d){let _;for(_ in t=t||{},l=l||{})l.hasOwnProperty(_)&&(X(l[_],t[_])||o.push({command:d,args:[c,_,t[_],p]}));for(_ in t)t.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&(X(l[_],t[_])||o.push({command:d,args:[c,_,t[_],p]}))}function wt(l){return l.id}function Nt(l,t){return l[t.id]=t,l}class gr{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.clamp(t,0,1);let o=1,c=this._distances[o];const p=t*this.paddedLength+this.padding;for(;c<p&&o<this._distances.length;)c=this._distances[++o];const d=o-1,_=this._distances[d],y=c-_,v=y>0?(p-_)/y:0;return this.points[d].mult(1-v).add(this.points[o].mult(v))}}class je{constructor(t,o,c){const p=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(o/c);for(let _=0;_<this.xCellCount*this.yCellCount;_++)p.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,c,p,d){this._forEachCell(o,c,p,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(d)}insertCircle(t,o,c,p){this._forEachCell(o-p,c-p,o+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(c),this.circles.push(p)}_insertBoxCell(t,o,c,p,d,_){this.boxCells[d].push(_)}_insertCircleCell(t,o,c,p,d,_){this.circleCells[d].push(_)}_query(t,o,c,p,d,_){if(c<0||t>this.width||p<0||o>this.height)return!d&&[];const y=[];if(t<=0&&o<=0&&this.width<=c&&this.height<=p){if(d)return!0;for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const w=this.circles[3*v],E=this.circles[3*v+1],A=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:w-A,y1:E-A,x2:w+A,y2:E+A})}return _?y.filter(_):y}return this._forEachCell(t,o,c,p,this._queryCell,y,{hitTest:d,seenUids:{box:{},circle:{}}},_),d?y.length>0:y}_queryCircle(t,o,c,p,d){const _=t-c,y=t+c,v=o-c,w=o+c;if(y<0||_>this.width||w<0||v>this.height)return!p&&[];const E=[];return this._forEachCell(_,v,y,w,this._queryCellCircle,E,{hitTest:p,circle:{x:t,y:o,radius:c},seenUids:{box:{},circle:{}}},d),p?E.length>0:E}query(t,o,c,p,d){return this._query(t,o,c,p,!1,d)}hitTest(t,o,c,p,d){return this._query(t,o,c,p,!0,d)}hitTestCircle(t,o,c,p){return this._queryCircle(t,o,c,!0,p)}_queryCell(t,o,c,p,d,_,y,v){const w=y.seenUids,E=this.boxCells[d];if(E!==null){const z=this.bboxes;for(const k of E)if(!w.box[k]){w.box[k]=!0;const D=4*k;if(t<=z[D+2]&&o<=z[D+3]&&c>=z[D+0]&&p>=z[D+1]&&(!v||v(this.boxKeys[k]))){if(y.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[k],x1:z[D],y1:z[D+1],x2:z[D+2],y2:z[D+3]})}}}const A=this.circleCells[d];if(A!==null){const z=this.circles;for(const k of A)if(!w.circle[k]){w.circle[k]=!0;const D=3*k;if(this._circleAndRectCollide(z[D],z[D+1],z[D+2],t,o,c,p)&&(!v||v(this.circleKeys[k]))){if(y.hitTest)return _.push(!0),!0;{const F=z[D],Z=z[D+1],P=z[D+2];_.push({key:this.circleKeys[k],x1:F-P,y1:Z-P,x2:F+P,y2:Z+P})}}}}}_queryCellCircle(t,o,c,p,d,_,y,v){const w=y.circle,E=y.seenUids,A=this.boxCells[d];if(A!==null){const k=this.bboxes;for(const D of A)if(!E.box[D]){E.box[D]=!0;const F=4*D;if(this._circleAndRectCollide(w.x,w.y,w.radius,k[F+0],k[F+1],k[F+2],k[F+3])&&(!v||v(this.boxKeys[D])))return _.push(!0),!0}}const z=this.circleCells[d];if(z!==null){const k=this.circles;for(const D of z)if(!E.circle[D]){E.circle[D]=!0;const F=3*D;if(this._circlesCollide(k[F],k[F+1],k[F+2],w.x,w.y,w.radius)&&(!v||v(this.circleKeys[D])))return _.push(!0),!0}}}_forEachCell(t,o,c,p,d,_,y,v){const w=this._convertToXCellCoord(t),E=this._convertToYCellCoord(o),A=this._convertToXCellCoord(c),z=this._convertToYCellCoord(p);for(let k=w;k<=A;k++)for(let D=E;D<=z;D++)if(d.call(this,t,o,c,p,this.xCellCount*D+k,_,y,v))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,c,p,d,_){const y=p-t,v=d-o,w=c+_;return w*w>y*y+v*v}_circleAndRectCollide(t,o,c,p,d,_,y){const v=(_-p)/2,w=Math.abs(t-(p+v));if(w>v+c)return!1;const E=(y-d)/2,A=Math.abs(o-(d+E));if(A>E+c)return!1;if(w<=v||A<=E)return!0;const z=w-v,k=A-E;return z*z+k*k<=c*c}}function dt(l,t,o,c,p){const d=s.create$1();return t?(s.scale$1(d,d,[1/p,1/p,1]),o||s.rotateZ(d,d,c.angle)):s.multiply(d,c.labelPlaneMatrix,l),d}function _t(l,t,o,c,p){if(t){const d=s.clone$1(l);return s.scale$1(d,d,[p,p,1]),o||s.rotateZ(d,d,-c.angle),d}return c.glCoordMatrix}function ri(l,t,o=0){const c=[l.x,l.y,o,1];o?s.transformMat4(c,c,t):xn(c,c,t);const p=c[3];return{point:new s.pointGeometry(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Hr(l,t){return Math.min(.5+l/t*.5,1.5)}function gt(l,t){const o=l[0]/l[3],c=l[1]/l[3];return o>=-t[0]&&o<=t[0]&&c>=-t[1]&&c<=t[1]}function ko(l,t,o,c,p,d,_,y,v){const w=c?l.textSizeData:l.iconSizeData,E=s.evaluateSizeForZoom(w,o.transform.zoom),A=[256/o.width*2+1,256/o.height*2+1],z=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;z.clear();const k=l.lineVertexArray,D=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,F=o.transform.width/o.transform.height;let Z=!1;for(let P=0;P<D.length;P++){const U=D.get(P);if(U.hidden||U.writingMode===s.WritingMode.vertical&&!Z){yr(U.numGlyphs,z);continue}Z=!1;const $=v?v({x:U.anchorX,y:U.anchorY}):0,H=[U.anchorX,U.anchorY,$,1];if(s.transformMat4(H,H,t),!gt(H,A)){yr(U.numGlyphs,z);continue}const re=Hr(o.transform.cameraToCenterDistance,H[3]),N=s.evaluateSizeForFeature(w,E,U),oe=_?N/re:N*re,ve=new s.pointGeometry(U.anchorX,U.anchorY),Ie=ri(ve,p,$);if(Ie.signedDistanceFromCamera<=0){yr(U.numGlyphs,z);continue}const j=Ie.point;let ke={};const ze=_?null:v,Ye=Pi(U,oe,!1,y,t,p,d,l.glyphOffsetArray,k,z,j,ve,ke,F,ze);Z=Ye.useVertical,ze&&Ye.needsFlipping&&(ke={}),(Ye.notEnoughRoom||Z||Ye.needsFlipping&&Pi(U,oe,!0,y,t,p,d,l.glyphOffsetArray,k,z,j,ve,ke,F,ze).notEnoughRoom)&&yr(U.numGlyphs,z)}c?l.text.dynamicLayoutVertexBuffer.updateData(z):l.icon.dynamicLayoutVertexBuffer.updateData(z)}function gn(l,t,o,c,p,d,_,y,v,w,E,A,z){const k=y.glyphStartIndex+y.numGlyphs,D=y.lineStartIndex,F=y.lineStartIndex+y.lineLength,Z=t.getoffsetX(y.glyphStartIndex),P=t.getoffsetX(k-1),U=Po(l*Z,o,c,p,d,_,y.segment,D,F,v,w,E,A,z,!0);if(!U)return null;const $=Po(l*P,o,c,p,d,_,y.segment,D,F,v,w,E,A,z,!0);return $?{first:U,last:$}:null}function yn(l,t,o,c){return l===s.WritingMode.horizontal&&Math.abs(o.y-t.y)>Math.abs(o.x-t.x)*c?{useVertical:!0}:(l===s.WritingMode.vertical?t.y<o.y:t.x>o.x)?{needsFlipping:!0}:null}function Pi(l,t,o,c,p,d,_,y,v,w,E,A,z,k,D){const F=t/24,Z=l.lineOffsetX*F,P=l.lineOffsetY*F;let U;if(l.numGlyphs>1){const $=l.glyphStartIndex+l.numGlyphs,H=l.lineStartIndex,re=l.lineStartIndex+l.lineLength,N=gn(F,y,Z,P,o,E,A,l,v,d,z,D);if(!N)return{notEnoughRoom:!0};const oe=ri(N.first.point,_).point,ve=ri(N.last.point,_).point;if(c&&!o){const Ie=yn(l.writingMode,oe,ve,k);if(Ie)return Ie}U=[N.first];for(let Ie=l.glyphStartIndex+1;Ie<$-1;Ie++)U.push(Po(F*y.getoffsetX(Ie),Z,P,o,E,A,l.segment,H,re,v,d,z,D));U.push(N.last)}else{if(c&&!o){const H=ri(A,p).point,re=l.lineStartIndex+l.segment+1,N=new s.pointGeometry(v.getx(re),v.gety(re)),oe=ri(N,p),ve=oe.signedDistanceFromCamera>0?oe.point:Wt(A,N,H,1,p),Ie=yn(l.writingMode,H,ve,k);if(Ie)return Ie}const $=Po(F*y.getoffsetX(l.glyphStartIndex),Z,P,o,E,A,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,v,d,z,D);if(!$)return{notEnoughRoom:!0};U=[$]}for(const $ of U)s.addDynamicAttributes(w,$.point,$.angle);return{}}function Wt(l,t,o,c,p,d){const _=l.add(l.sub(t)._unit()),y=ri(_,p,d?d(_):0).point,v=o.sub(y);return o.add(v._mult(c/v.mag()))}function Po(l,t,o,c,p,d,_,y,v,w,E,A,z,k,D){const F=c?l-t:l+t;let Z=F>0?1:-1,P=0;c&&(Z*=-1,P=Math.PI),Z<0&&(P+=Math.PI);let U=Z>0?y+_:y+_+1,$=p,H=p,re=0,N=0;const oe=Math.abs(F),ve=[],Ie=[];let j=d;const ke=()=>{const nt=U-Z;return re===0?d:new s.pointGeometry(w.getx(nt),w.gety(nt))},ze=()=>Wt(ke(),j,H,oe-re+1,E,z);for(;re+N<=oe;){if(U+=Z,U<y||U>=v)return null;if(H=$,ve.push($),k&&Ie.push(j||ke()),$=A[U],$===void 0){j=new s.pointGeometry(w.getx(U),w.gety(U));const nt=ri(j,E,z?z(j):0);$=nt.signedDistanceFromCamera>0?A[U]=nt.point:ze()}else j=null;re+=N,N=H.dist($)}D&&z&&(j=j||new s.pointGeometry(w.getx(U),w.gety(U)),A[U]=$=A[U]===void 0?$:ze(),N=H.dist($));const Ye=(oe-re)/N,We=$.sub(H),Ge=We.mult(Ye)._add(H);o&&Ge._add(We._unit()._perp()._mult(o*Z));const He=P+Math.atan2($.y-H.y,$.x-H.x);return ve.push(Ge),k&&(j=j||new s.pointGeometry(w.getx(U),w.gety(U)),Ie.push(function(nt,St,Ut){const jt=1-Ut;return new s.pointGeometry(nt.x*jt+St.x*Ut,nt.y*jt+St.y*Ut)}(Ie.length>0?Ie[Ie.length-1]:j,j,Ye))),{point:Ge,angle:He,path:ve,tilePath:Ie}}const Hn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function yr(l,t){for(let o=0;o<l;o++){const c=t.length;t.resize(c+4),t.float32.set(Hn,3*c)}}function xn(l,t,o){const c=t[0],p=t[1];return l[0]=o[0]*c+o[4]*p+o[12],l[1]=o[1]*c+o[5]*p+o[13],l[3]=o[3]*c+o[7]*p+o[15],l}const Gi=100;class za{constructor(t,o,c=new je(t.width+200,t.height+200,25),p=new je(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Gi,this.screenBottomBoundary=t.height+Gi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,c,p,d,_,y){const v=this.projectAndGetPerspectiveRatio(_,o.anchorPointX,o.anchorPointY,o.elevation,o.tileID),w=d*v.perspectiveRatio,E=(o.x1*t+c.x-o.padding)*w+v.point.x,A=(o.y1*t+c.y-o.padding)*w+v.point.y,z=(o.x2*t+c.x+o.padding)*w+v.point.x,k=(o.y2*t+c.y+o.padding)*w+v.point.y,D=v.perspectiveRatio<=.55||v.aboveHorizon;return!this.isInsideGrid(E,A,z,k)||!p&&this.grid.hitTest(E,A,z,k,y)||D?{box:[],offscreen:!1}:{box:[E,A,z,k],offscreen:this.isOffscreen(E,A,z,k)}}placeCollisionCircles(t,o,c,p,d,_,y,v,w,E,A,z,k,D){const F=[],Z=this.transform.elevation,P=Z?ze=>Z.getAtTileOffset(D,ze.x,ze.y):ze=>0,U=new s.pointGeometry(o.anchorX,o.anchorY),$=P(U),H=this.projectAndGetPerspectiveRatio(_,U.x,U.y,$,D),{perspectiveRatio:re}=H,N=(E?d/re:d*re)/s.ONE_EM,oe=ri(U,y,$).point,ve=H.signedDistanceFromCamera>0?gn(N,p,o.lineOffsetX*N,o.lineOffsetY*N,!1,oe,U,o,c,y,{},Z&&!E?P:null,E&&!!Z):null;let Ie=!1,j=!1,ke=!0;if(ve&&!H.aboveHorizon){const ze=.5*z*re+k,Ye=new s.pointGeometry(-100,-100),We=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ge=new gr,He=ve.first,nt=ve.last;let St=[];for(let xt=He.path.length-1;xt>=1;xt--)St.push(He.path[xt]);for(let xt=1;xt<nt.path.length;xt++)St.push(nt.path[xt]);const Ut=2.5*ze;if(v){const xt=St.map(Z?(Ct,Kt)=>{const ir=P(Kt<He.path.length-1?He.tilePath[He.path.length-1-Kt]:nt.tilePath[Kt-He.path.length+2]);return ri(Ct,v,ir)}:Ct=>ri(Ct,v));St=xt.some(Ct=>Ct.signedDistanceFromCamera<=0)?[]:xt.map(Ct=>Ct.point)}let jt=[];if(St.length>0){const xt=St[0].clone(),Ct=St[0].clone();for(let Kt=1;Kt<St.length;Kt++)xt.x=Math.min(xt.x,St[Kt].x),xt.y=Math.min(xt.y,St[Kt].y),Ct.x=Math.max(Ct.x,St[Kt].x),Ct.y=Math.max(Ct.y,St[Kt].y);jt=xt.x>=Ye.x&&Ct.x<=We.x&&xt.y>=Ye.y&&Ct.y<=We.y?[St]:Ct.x<Ye.x||xt.x>We.x||Ct.y<Ye.y||xt.y>We.y?[]:s.clipLine([St],Ye.x,Ye.y,We.x,We.y)}for(const xt of jt){Ge.reset(xt,.25*ze);let Ct=0;Ct=Ge.length<=.5*ze?1:Math.ceil(Ge.paddedLength/Ut)+1;for(let Kt=0;Kt<Ct;Kt++){const ir=Kt/Math.max(Ct-1,1),Ti=Ge.lerp(ir),Ei=Ti.x+Gi,rr=Ti.y+Gi;F.push(Ei,rr,ze,0);const nr=Ei-ze,Yt=rr-ze,ni=Ei+ze,vt=rr+ze;if(ke=ke&&this.isOffscreen(nr,Yt,ni,vt),j=j||this.isInsideGrid(nr,Yt,ni,vt),!t&&this.grid.hitTestCircle(Ei,rr,ze,A)&&(Ie=!0,!w))return{circles:[],offscreen:!1,collisionDetected:Ie}}}}return{circles:!w&&Ie||!j?[]:F,offscreen:ke,collisionDetected:Ie}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let c=1/0,p=1/0,d=-1/0,_=-1/0;for(const E of t){const A=new s.pointGeometry(E.x+Gi,E.y+Gi);c=Math.min(c,A.x),p=Math.min(p,A.y),d=Math.max(d,A.x),_=Math.max(_,A.y),o.push(A)}const y=this.grid.query(c,p,d,_).concat(this.ignoredGrid.query(c,p,d,_)),v={},w={};for(const E of y){const A=E.key;if(v[A.bucketInstanceId]===void 0&&(v[A.bucketInstanceId]={}),v[A.bucketInstanceId][A.featureIndex])continue;const z=[new s.pointGeometry(E.x1,E.y1),new s.pointGeometry(E.x2,E.y1),new s.pointGeometry(E.x2,E.y2),new s.pointGeometry(E.x1,E.y2)];s.polygonIntersectsPolygon(o,z)&&(v[A.bucketInstanceId][A.featureIndex]=!0,w[A.bucketInstanceId]===void 0&&(w[A.bucketInstanceId]=[]),w[A.bucketInstanceId].push(A.featureIndex))}return w}insertCollisionBox(t,o,c,p,d){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:d},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,c,p,d){const _=o?this.ignoredGrid:this.grid,y={bucketInstanceId:c,featureIndex:p,collisionGroupID:d};for(let v=0;v<t.length;v+=4)_.insertCircle(y,t[v],t[v+1],t[v+2])}projectAndGetPerspectiveRatio(t,o,c,p,d){const _=[o,c,p||0,1];let y=!1;if(p||this.transform.pitch>0){s.transformMat4(_,_,t);let v=!1;this.fogState&&d&&(v=function(w,E,A,z,k,D){const F=D.calculateFogTileMatrix(k),Z=[E,A,z];return s.transformMat4$1(Z,Z,F),qe(w,Z,D.pitch,D._fov)}(this.fogState,o,c,p||0,d.toUnwrapped(),this.transform)>.9),y=_[2]>_[3]||v}else xn(_,_,t);return{point:new s.pointGeometry((_[0]/_[3]+1)/2*this.transform.width+Gi,(-_[1]/_[3]+1)/2*this.transform.height+Gi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/_[3]*.5,1.5),signedDistanceFromCamera:_[3],aboveHorizon:y}}isOffscreen(t,o,c,p){return c<Gi||t>=this.screenRightBoundary||p<Gi||o>this.screenBottomBoundary}isInsideGrid(t,o,c,p){return c>=0&&t<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=s.identity([]);return s.translate(t,t,[-100,-100,0]),t}}class It{constructor(t,o,c,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Kr{constructor(t,o,c,p,d){this.text=new It(t?t.text:null,o,c,d),this.icon=new It(t?t.icon:null,o,p,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Do{constructor(t,o,c){this.text=t,this.icon=o,this.skipFade=c}}class Ci{constructor(){this.invProjMatrix=s.create$1(),this.viewportMatrix=s.create$1(),this.circles=[]}}class qi{constructor(t,o,c,p,d){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=d}}class ka{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:c=>c.collisionGroupID===o}}return this.collisionGroups[t]}}function Kn(l,t,o,c,p){const{horizontalAlign:d,verticalAlign:_}=s.getAnchorAlignment(l),y=-(d-.5)*t,v=-(_-.5)*o,w=s.evaluateVariableOffset(l,c);return new s.pointGeometry(y+w[0]*p,v+w[1]*p)}function Jt(l,t,o,c,p){const d=new s.pointGeometry(l,t);return o&&d._rotate(c?p:-p),d}class Yn{constructor(t,o,c,p,d){this.transform=t.clone(),this.collisionIndex=new za(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new ka(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,c,p){const d=c.getBucket(o),_=c.latestFeatureIndex;if(!d||!_||o.id!==d.layerIds[0])return;const y=c.collisionBoxArray,v=d.layers[0].layout,w=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),E=c.tileSize/s.EXTENT,A=this.transform.calculateProjMatrix(c.tileID.toUnwrapped()),z=v.get("text-pitch-alignment")==="map",k=v.get("text-rotation-alignment")==="map",D=pt(c,1,this.transform.zoom),F=dt(A,z,k,this.transform,D);let Z=null;if(z){const U=_t(A,z,k,this.transform,D);Z=s.multiply([],this.transform.labelPlaneMatrix,U)}this.retainedQueryData[d.bucketInstanceId]=new qi(d.bucketInstanceId,_,d.sourceLayerIndex,d.index,c.tileID);const P={bucket:d,layout:v,posMatrix:A,textLabelPlaneMatrix:F,labelToScreenMatrix:Z,scale:w,textPixelRatio:E,holdingForFade:c.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(d.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(p)for(const U of d.sortKeyRanges){const{sortKey:$,symbolInstanceStart:H,symbolInstanceEnd:re}=U;t.push({sortKey:$,symbolInstanceStart:H,symbolInstanceEnd:re,parameters:P})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:P})}attemptAnchorPlacement(t,o,c,p,d,_,y,v,w,E,A,z,k,D,F,Z,P,U){const $=[z.textOffset0,z.textOffset1],H=D.getSymbolInstanceTextSize(P,z,this.transform.zoom,k),re=Kn(t,c,p,$,d),N=this.collisionIndex.placeCollisionBox(H,o,Jt(re.x,re.y,_,y,this.transform.angle),A,v,w,E.predicate);if((!Z||this.collisionIndex.placeCollisionBox(D.getSymbolInstanceIconSize(U,this.transform.zoom,k),Z,Jt(re.x,re.y,_,y,this.transform.angle),A,v,w,E.predicate).box.length!==0)&&N.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[z.crossTileID].anchor),this.variableOffsets[z.crossTileID]={textOffset:$,width:c,height:p,anchor:t,textBoxScale:d,prevAnchor:oe},this.markUsedJustification(D,t,z,F),D.allowVerticalPlacement&&(this.markUsedOrientation(D,F,z),this.placedOrientations[z.crossTileID]=F),{shift:re,placedGlyphBoxes:N}}}placeLayerBucketPart(t,o,c){const{bucket:p,layout:d,posMatrix:_,textLabelPlaneMatrix:y,labelToScreenMatrix:v,textPixelRatio:w,holdingForFade:E,collisionBoxArray:A,partiallyEvaluatedTextSize:z,partiallyEvaluatedIconSize:k,collisionGroup:D}=t.parameters,F=d.get("text-optional"),Z=d.get("icon-optional"),P=d.get("text-allow-overlap"),U=d.get("icon-allow-overlap"),$=d.get("text-rotation-alignment")==="map",H=d.get("text-pitch-alignment")==="map",re=d.get("icon-text-fit")!=="none",N=d.get("symbol-z-order")==="viewport-y",oe=P&&(U||!p.hasIconData()||Z),ve=U&&(P||!p.hasTextData()||F);!p.collisionArrays&&A&&p.deserializeCollisionBoxes(A),c&&p.updateCollisionDebugBuffers(this.transform.zoom,A);const Ie=(j,ke,ze)=>{if(o[j.crossTileID])return;if(E)return void(this.placements[j.crossTileID]=new Do(!1,!1,!1));let Ye=!1,We=!1,Ge=!0,He=null,nt={box:null,offscreen:null},St={box:null,offscreen:null},Ut=null,jt=null,xt=null,Ct=0,Kt=0,ir=0;ze.textFeatureIndex?Ct=ze.textFeatureIndex:j.useRuntimeCollisionCircles&&(Ct=j.featureIndex),ze.verticalTextFeatureIndex&&(Kt=ze.verticalTextFeatureIndex);const Ti=Yt=>{Yt.tileID=this.retainedQueryData[p.bucketInstanceId].tileID,(this.transform.elevation||Yt.elevation)&&(Yt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[p.bucketInstanceId].tileID,Yt.anchorPointX,Yt.anchorPointY):0)},Ei=ze.textBox;if(Ei){Ti(Ei);const Yt=vt=>{let Qt=s.WritingMode.horizontal;if(p.allowVerticalPlacement&&!vt&&this.prevPlacement){const xi=this.prevPlacement.placedOrientations[j.crossTileID];xi&&(this.placedOrientations[j.crossTileID]=xi,Qt=xi,this.markUsedOrientation(p,Qt,j))}return Qt},ni=(vt,Qt)=>{if(p.allowVerticalPlacement&&j.numVerticalGlyphVertices>0&&ze.verticalTextBox){for(const xi of p.writingModes)if(xi===s.WritingMode.vertical?(nt=Qt(),St=nt):nt=vt(),nt&&nt.box&&nt.box.length)break}else nt=vt()};if(d.get("text-variable-anchor")){let vt=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]){const Gt=this.prevPlacement.variableOffsets[j.crossTileID];vt.indexOf(Gt.anchor)>0&&(vt=vt.filter(Ri=>Ri!==Gt.anchor),vt.unshift(Gt.anchor))}const Qt=(Gt,Ri,Ln)=>{const pi=j.textBoxScale,vr=(Gt.x2-Gt.x1)*pi+2*Gt.padding,aa=(Gt.y2-Gt.y1)*pi+2*Gt.padding,ds=re&&!U?Ri:null;ds&&Ti(ds);let nn={box:[],offscreen:!1};const Il=P?2*vt.length:vt.length;for(let yo=0;yo<Il;++yo){const fs=this.attemptAnchorPlacement(vt[yo%vt.length],Gt,vr,aa,pi,$,H,w,_,D,yo>=vt.length,j,ke,p,Ln,ds,z,k);if(fs&&(nn=fs.placedGlyphBoxes,nn&&nn.box&&nn.box.length)){Ye=!0,He=fs.shift;break}}return nn};ni(()=>Qt(Ei,ze.iconBox,s.WritingMode.horizontal),()=>{const Gt=ze.verticalTextBox;return Gt&&Ti(Gt),p.allowVerticalPlacement&&!(nt&&nt.box&&nt.box.length)&&j.numVerticalGlyphVertices>0&&Gt?Qt(Gt,ze.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),nt&&(Ye=nt.box,Ge=nt.offscreen);const xi=Yt(nt&&nt.box);if(!Ye&&this.prevPlacement){const Gt=this.prevPlacement.variableOffsets[j.crossTileID];Gt&&(this.variableOffsets[j.crossTileID]=Gt,this.markUsedJustification(p,Gt.anchor,j,xi))}}else{const vt=(Qt,xi)=>{const Gt=p.getSymbolInstanceTextSize(z,j,this.transform.zoom,ke),Ri=this.collisionIndex.placeCollisionBox(Gt,Qt,new s.pointGeometry(0,0),P,w,_,D.predicate);return Ri&&Ri.box&&Ri.box.length&&(this.markUsedOrientation(p,xi,j),this.placedOrientations[j.crossTileID]=xi),Ri};ni(()=>vt(Ei,s.WritingMode.horizontal),()=>{const Qt=ze.verticalTextBox;return p.allowVerticalPlacement&&j.numVerticalGlyphVertices>0&&Qt?(Ti(Qt),vt(Qt,s.WritingMode.vertical)):{box:null,offscreen:null}}),Yt(nt&&nt.box&&nt.box.length)}}if(Ut=nt,Ye=Ut&&Ut.box&&Ut.box.length>0,Ge=Ut&&Ut.offscreen,j.useRuntimeCollisionCircles){const Yt=p.text.placedSymbolArray.get(j.centerJustifiedTextSymbolIndex),ni=s.evaluateSizeForFeature(p.textSizeData,z,Yt),vt=d.get("text-padding");jt=this.collisionIndex.placeCollisionCircles(P,Yt,p.lineVertexArray,p.glyphOffsetArray,ni,_,y,v,c,H,D.predicate,j.collisionCircleDiameter,vt,this.retainedQueryData[p.bucketInstanceId].tileID),Ye=P||jt.circles.length>0&&!jt.collisionDetected,Ge=Ge&&jt.offscreen}if(ze.iconFeatureIndex&&(ir=ze.iconFeatureIndex),ze.iconBox){const Yt=ni=>{Ti(ni);const vt=re&&He?Jt(He.x,He.y,$,H,this.transform.angle):new s.pointGeometry(0,0),Qt=p.getSymbolInstanceIconSize(k,this.transform.zoom,ke);return this.collisionIndex.placeCollisionBox(Qt,ni,vt,U,w,_,D.predicate)};St&&St.box&&St.box.length&&ze.verticalIconBox?(xt=Yt(ze.verticalIconBox),We=xt.box.length>0):(xt=Yt(ze.iconBox),We=xt.box.length>0),Ge=Ge&&xt.offscreen}const rr=F||j.numHorizontalGlyphVertices===0&&j.numVerticalGlyphVertices===0,nr=Z||j.numIconVertices===0;if(rr||nr?nr?rr||(We=We&&Ye):Ye=We&&Ye:We=Ye=We&&Ye,Ye&&Ut&&Ut.box&&this.collisionIndex.insertCollisionBox(Ut.box,d.get("text-ignore-placement"),p.bucketInstanceId,St&&St.box&&Kt?Kt:Ct,D.ID),We&&xt&&this.collisionIndex.insertCollisionBox(xt.box,d.get("icon-ignore-placement"),p.bucketInstanceId,ir,D.ID),jt&&(Ye&&this.collisionIndex.insertCollisionCircles(jt.circles,d.get("text-ignore-placement"),p.bucketInstanceId,Ct,D.ID),c)){const Yt=p.bucketInstanceId;let ni=this.collisionCircleArrays[Yt];ni===void 0&&(ni=this.collisionCircleArrays[Yt]=new Ci);for(let vt=0;vt<jt.circles.length;vt+=4)ni.circles.push(jt.circles[vt+0]),ni.circles.push(jt.circles[vt+1]),ni.circles.push(jt.circles[vt+2]),ni.circles.push(jt.collisionDetected?1:0)}this.placements[j.crossTileID]=new Do(Ye||oe,We||ve,Ge||p.justReloaded),o[j.crossTileID]=!0};if(N){const j=p.getSortedSymbolIndexes(this.transform.angle);for(let ke=j.length-1;ke>=0;--ke){const ze=j[ke];Ie(p.symbolInstances.get(ze),ze,p.collisionArrays[ze])}}else for(let j=t.symbolInstanceStart;j<t.symbolInstanceEnd;j++)Ie(p.symbolInstances.get(j),j,p.collisionArrays[j]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){const j=this.collisionCircleArrays[p.bucketInstanceId];s.invert(j.invProjMatrix,_),j.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(t,o,c,p){let d;d=p===s.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(o)];const _=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const y of _)y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=d>=0&&y!==d?0:c.crossTileID)}markUsedOrientation(t,o,c){const p=o===s.WritingMode.horizontal||o===s.WritingMode.horizontalOnly?o:0,d=o===s.WritingMode.vertical?o:0,_=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const y of _)t.text.placedSymbolArray.get(y).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let c=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const p=o?o.symbolFadeChange(t):1,d=o?o.opacities:{},_=o?o.variableOffsets:{},y=o?o.placedOrientations:{};for(const v in this.placements){const w=this.placements[v],E=d[v];E?(this.opacities[v]=new Kr(E,p,w.text,w.icon),c=c||w.text!==E.text.placed||w.icon!==E.icon.placed):(this.opacities[v]=new Kr(null,p,w.text,w.icon,w.skipFade),c=c||w.text||w.icon)}for(const v in d){const w=d[v];if(!this.opacities[v]){const E=new Kr(w,p,!1,!1);E.isHidden()||(this.opacities[v]=E,c=c||w.text.placed||w.icon.placed)}}for(const v in _)this.variableOffsets[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.variableOffsets[v]=_[v]);for(const v in y)this.placedOrientations[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.placedOrientations[v]=y[v]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const c={};for(const p of o){const d=p.getBucket(t);d&&p.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,c,p.collisionBoxArray)}}updateBucketOpacities(t,o,c){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0].layout,d=new Kr(null,0,!1,!1,!0),_=p.get("text-allow-overlap"),y=p.get("icon-allow-overlap"),v=p.get("text-variable-anchor"),w=p.get("text-rotation-alignment")==="map",E=p.get("text-pitch-alignment")==="map",A=p.get("icon-text-fit")!=="none",z=new Kr(null,0,_&&(y||!t.hasIconData()||p.get("icon-optional")),y&&(_||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const k=(D,F,Z)=>{for(let P=0;P<F/4;P++)D.opacityVertexArray.emplaceBack(Z)};for(let D=0;D<t.symbolInstances.length;D++){const F=t.symbolInstances.get(D),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:P,crossTileID:U}=F;let $=this.opacities[U];o[U]?$=d:$||($=z,this.opacities[U]=$),o[U]=!0;const H=F.numIconVertices>0,re=this.placedOrientations[F.crossTileID],N=re===s.WritingMode.vertical,oe=re===s.WritingMode.horizontal||re===s.WritingMode.horizontalOnly;if(Z>0||P>0){const ve=Pa($.text);k(t.text,Z,N?Qn:ve),k(t.text,P,oe?Qn:ve);const Ie=$.text.isHidden();[F.rightJustifiedTextSymbolIndex,F.centerJustifiedTextSymbolIndex,F.leftJustifiedTextSymbolIndex].forEach(ze=>{ze>=0&&(t.text.placedSymbolArray.get(ze).hidden=Ie||N?1:0)}),F.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(F.verticalPlacedTextSymbolIndex).hidden=Ie||oe?1:0);const j=this.variableOffsets[F.crossTileID];j&&this.markUsedJustification(t,j.anchor,F,re);const ke=this.placedOrientations[F.crossTileID];ke&&(this.markUsedJustification(t,"left",F,ke),this.markUsedOrientation(t,ke,F))}if(H){const ve=Pa($.icon),Ie=!(A&&F.verticalPlacedIconSymbolIndex&&N);F.placedIconSymbolIndex>=0&&(k(t.icon,F.numIconVertices,Ie?ve:Qn),t.icon.placedSymbolArray.get(F.placedIconSymbolIndex).hidden=$.icon.isHidden()),F.verticalPlacedIconSymbolIndex>=0&&(k(t.icon,F.numVerticalIconVertices,Ie?Qn:ve),t.icon.placedSymbolArray.get(F.verticalPlacedIconSymbolIndex).hidden=$.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ve=t.collisionArrays[D];if(ve){let Ie=new s.pointGeometry(0,0);if(ve.textBox||ve.verticalTextBox){let ke=!0;if(v){const ze=this.variableOffsets[U];ze?(Ie=Kn(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textBoxScale),w&&Ie._rotate(E?this.transform.angle:-this.transform.angle)):ke=!1}ve.textBox&&hr(t.textCollisionBox.collisionVertexArray,$.text.placed,!ke||N,Ie.x,Ie.y),ve.verticalTextBox&&hr(t.textCollisionBox.collisionVertexArray,$.text.placed,!ke||oe,Ie.x,Ie.y)}const j=Boolean(!oe&&ve.verticalIconBox);ve.iconBox&&hr(t.iconCollisionBox.collisionVertexArray,$.icon.placed,j,A?Ie.x:0,A?Ie.y:0),ve.verticalIconBox&&hr(t.iconCollisionBox.collisionVertexArray,$.icon.placed,!j,A?Ie.x:0,A?Ie.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const D=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=D.invProjMatrix,t.placementViewportMatrix=D.viewportMatrix,t.collisionCircleArray=D.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const c=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function hr(l,t,o,c,p){l.emplaceBack(t?1:0,o?1:0,c||0,p||0),l.emplaceBack(t?1:0,o?1:0,c||0,p||0),l.emplaceBack(t?1:0,o?1:0,c||0,p||0),l.emplaceBack(t?1:0,o?1:0,c||0,p||0)}const _i=Math.pow(2,25),ks=Math.pow(2,24),tr=Math.pow(2,17),Jn=Math.pow(2,16),Lo=Math.pow(2,9),ic=Math.pow(2,8),Pr=Math.pow(2,1);function Pa(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,o=Math.floor(127*l.opacity);return o*_i+t*ks+o*tr+t*Jn+o*Lo+t*ic+o*Pr+t}const Qn=0;class $i{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,c,p,d){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(_,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((y,v)=>y.sortKey-v.sortKey));this._currentPartIndex<_.length;)if(o.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,d())return!0;return!1}}class Ro{constructor(t,o,c,p,d,_,y,v){this.placement=new Yn(t,d,_,y,v),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,o,c){const p=s.exported.now(),d=()=>{const _=s.exported.now()-p;return!this._forceFullPlacement&&_>2};for(;this._currentPlacementIndex>=0;){const _=o[t[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=y)&&(!_.maxzoom||_.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new $i(_)),this._inProgressLayer.continuePlacement(c[_.source],this.placement,this._showCollisionBoxes,_,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Dr=512/s.EXTENT/2;class Ps{constructor(t,o,c){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(let p=0;p<o.length;p++){const d=o.get(p),_=d.key;this.indexedSymbolInstances[_]||(this.indexedSymbolInstances[_]=[]),this.indexedSymbolInstances[_].push({crossTileID:d.crossTileID,coord:this.getScaledCoordinates(d,t)})}}getScaledCoordinates(t,o){const c=Dr/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*s.EXTENT+t.anchorX)*c),y:Math.floor((o.canonical.y*s.EXTENT+t.anchorY)*c)}}findMatches(t,o,c){const p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let d=0;d<t.length;d++){const _=t.get(d);if(_.crossTileID)continue;const y=this.indexedSymbolInstances[_.key];if(!y)continue;const v=this.getScaledCoordinates(_,o);for(const w of y)if(Math.abs(w.coord.x-v.x)<=p&&Math.abs(w.coord.y-v.y)<=p&&!c[w.crossTileID]){c[w.crossTileID]=!0,_.crossTileID=w.crossTileID;break}}}}class Bo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const c in this.indexes){const p=this.indexes[c],d={};for(const _ in p){const y=p[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),d[y.tileID.key]=y}this.indexes[c]=d}this.lng=t}addBucket(t,o,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<o.symbolInstances.length;d++)o.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const _=this.indexes[d];if(Number(d)>t.overscaledZ)for(const y in _){const v=_[y];v.tileID.isChildOf(t)&&v.findMatches(o.symbolInstances,t,p)}else{const y=_[t.scaledTo(Number(d)).key];y&&y.findMatches(o.symbolInstances,t,p)}}for(let d=0;d<o.symbolInstances.length;d++){const _=o.symbolInstances.get(d);_.crossTileID||(_.crossTileID=c.generate(),p[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ps(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const c in o.indexedSymbolInstances)for(const p of o.indexedSymbolInstances[c])delete this.usedCrossTileIDs[t][p.crossTileID]}removeStaleBuckets(t){let o=!1;for(const c in this.indexes){const p=this.indexes[c];for(const d in p)t[p[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[d]),delete p[d],o=!0)}return o}}class Da{constructor(){this.layerIndexes={},this.crossTileIDs=new Bo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,c){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new rc);let d=!1;const _={};p.handleWrapJump(c);for(const y of o){const v=y.getBucket(t);v&&t.id===v.layerIds[0]&&(v.bucketInstanceId||(v.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(y.tileID,v,this.crossTileIDs)&&(d=!0),_[v.bucketInstanceId]=!0)}return p.removeStaleBuckets(_)&&(d=!0),d}pruneUnusedLayers(t){const o={};t.forEach(c=>{o[c]=!0});for(const c in this.layerIndexes)o[c]||delete this.layerIndexes[c]}}const vn=(l,t)=>s.emitValidationErrors(l,t&&t.filter(o=>o.identifier!=="source.canvas")),nc=s.pick(Y,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),La=s.pick(Y,["setCenter","setZoom","setBearing","setPitch"]),oc=function(){const l={},t=s.spec.$version;for(const o in s.spec.$root){const c=s.spec.$root[o];if(c.required){let p=null;p=o==="version"?t:c.type==="array"?[]:{},p!=null&&(l[o]=p)}}return l}(),Ra={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ur extends s.Evented{constructor(t,o={}){super(),this.map=t,this.dispatcher=new at(Ve(),this),this.imageManager=new lt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(t._requestManager,o.localFontFamily?s.LocalGlyphMode.all:o.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new Da,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const c=this;this._rtlTextPluginCallback=ur.registerForPluginStateChange(p=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(d,_)=>{if(s.triggerPluginCompletionEvent(d),_&&_.every(y=>y))for(const y in c._sourceCaches){const v=c._sourceCaches[y],w=v.getSource().type;w!=="vector"&&w!=="geojson"||v.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const d=this.getSource(p.sourceId);if(d&&d.vectorLayerIds)for(const _ in this._layers){const y=this._layers[_];y.source===d.id&&this._validateLayer(y)}})}loadURL(t,o={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const c=typeof o.validate=="boolean"?o.validate:!s.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,o.accessToken);const p=this.map._requestManager.transformRequest(t,s.ResourceType.Style);this._request=s.getJSON(p,(d,_)=>{this._request=null,d?this.fire(new s.ErrorEvent(d)):_&&this._load(_,c)})}loadJSON(t,o={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(oc,!1)}_updateLayerCount(t,o){const c=o?1:-1;t.is3D()&&(this._num3DLayers+=c),t.type==="circle"&&(this._numCircleLayers+=c),t.type==="symbol"&&(this._numSymbolLayers+=c)}_load(t,o){if(o&&vn(this,s.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const p in t.sources)this.addSource(p,t.sources[p],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const c=Ke(this.stylesheet.layers);this._order=c.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of c)p=s.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize(),this._updateLayerCount(p,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Tt(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(o,c,p){let d,_,y;const v=s.exported.devicePixelRatio>1?"@2x":"";let w=s.getJSON(c.transformRequest(c.normalizeSpriteURL(o,v,".json"),s.ResourceType.SpriteJSON),(z,k)=>{w=null,y||(y=z,d=k,A())}),E=s.getImage(c.transformRequest(c.normalizeSpriteURL(o,v,".png"),s.ResourceType.SpriteImage),(z,k)=>{E=null,y||(y=z,_=k,A())});function A(){if(y)p(y);else if(d&&_){const z=s.exported.getImageData(_),k={};for(const D in d){const{width:F,height:Z,x:P,y:U,sdf:$,pixelRatio:H,stretchX:re,stretchY:N,content:oe}=d[D],ve=new s.RGBAImage({width:F,height:Z});s.RGBAImage.copy(z,ve,{x:P,y:U},{x:0,y:0},{width:F,height:Z}),k[D]={data:ve,pixelRatio:H,sdf:$,stretchX:re,stretchY:N,content:oe}}p(null,k)}}return{cancel(){w&&(w.cancel(),w=null),E&&(E.cancel(),E=null)}}}(t,this.map._requestManager,(o,c)=>{if(this._spriteRequest=null,o)this.fire(new s.ErrorEvent(o));else if(c)for(const p in c)this.imageManager.addImage(p,c[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(t){const o=this.getSource(t.source);if(!o)return;const c=t.sourceLayer;c&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(c)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${c}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const o=[];for(const c of t){const p=this._layers[c];p.type!=="custom"&&o.push(p.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Ra[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const o=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(p.length||d.length)&&this._updateWorkerLayers(p,d);for(const _ in this._updatedSources){const y=this._updatedSources[_];y==="reload"?this._reloadSource(_):y==="clear"&&this._clearSource(_)}this._updateTilesForChangedImages();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const c={};for(const p in this._sourceCaches){const d=this._sourceCaches[p];c[p]=d.used,d.used=!1}for(const p of this._order){const d=this._layers[p];if(d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)){const y=this._getLayerSourceCache(d);y&&(y.used=!0)}const _=this.map.painter;if(_){const y=d.getProgramIds();if(!y)continue;const v=d.getProgramConfiguration(t.zoom);for(const w of y)_.useProgram(w,v)}}for(const p in c){const d=this._sourceCaches[p];c[p]!==d.used&&d.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),vn(this,s.validateStyle(t)))return!1;(t=s.clone$2(t)).layers=Ke(t.layers);const o=function(p,d){if(!p)return[{command:Y.setStyle,args:[d]}];let _=[];try{if(!X(p.version,d.version))return[{command:Y.setStyle,args:[d]}];X(p.center,d.center)||_.push({command:Y.setCenter,args:[d.center]}),X(p.zoom,d.zoom)||_.push({command:Y.setZoom,args:[d.zoom]}),X(p.bearing,d.bearing)||_.push({command:Y.setBearing,args:[d.bearing]}),X(p.pitch,d.pitch)||_.push({command:Y.setPitch,args:[d.pitch]}),X(p.sprite,d.sprite)||_.push({command:Y.setSprite,args:[d.sprite]}),X(p.glyphs,d.glyphs)||_.push({command:Y.setGlyphs,args:[d.glyphs]}),X(p.transition,d.transition)||_.push({command:Y.setTransition,args:[d.transition]}),X(p.light,d.light)||_.push({command:Y.setLight,args:[d.light]}),X(p.fog,d.fog)||_.push({command:Y.setFog,args:[d.fog]});const y={},v=[];(function(A,z,k,D){let F;for(F in z=z||{},A=A||{})A.hasOwnProperty(F)&&(z.hasOwnProperty(F)||rt(F,k,D));for(F in z)z.hasOwnProperty(F)&&(A.hasOwnProperty(F)?X(A[F],z[F])||(A[F].type==="geojson"&&z[F].type==="geojson"&&ht(A,z,F)?k.push({command:Y.setGeoJSONSourceData,args:[F,z[F].data]}):mt(F,z,k,D)):ge(F,z,k))})(p.sources,d.sources,v,y);const w=[];p.layers&&p.layers.forEach(A=>{y[A.source]?_.push({command:Y.removeLayer,args:[A.id]}):w.push(A)});let E=p.terrain;E&&y[E.source]&&(_.push({command:Y.setTerrain,args:[void 0]}),E=void 0),_=_.concat(v),X(E,d.terrain)||_.push({command:Y.setTerrain,args:[d.terrain]}),function(A,z,k){z=z||[];const D=(A=A||[]).map(wt),F=z.map(wt),Z=A.reduce(Nt,{}),P=z.reduce(Nt,{}),U=D.slice(),$=Object.create(null);let H,re,N,oe,ve,Ie,j;for(H=0,re=0;H<D.length;H++)N=D[H],P.hasOwnProperty(N)?re++:(k.push({command:Y.removeLayer,args:[N]}),U.splice(U.indexOf(N,re),1));for(H=0,re=0;H<F.length;H++)N=F[F.length-1-H],U[U.length-1-H]!==N&&(Z.hasOwnProperty(N)?(k.push({command:Y.removeLayer,args:[N]}),U.splice(U.lastIndexOf(N,U.length-re),1)):re++,Ie=U[U.length-H],k.push({command:Y.addLayer,args:[P[N],Ie]}),U.splice(U.length-H,0,N),$[N]=!0);for(H=0;H<F.length;H++)if(N=F[H],oe=Z[N],ve=P[N],!$[N]&&!X(oe,ve))if(X(oe.source,ve.source)&&X(oe["source-layer"],ve["source-layer"])&&X(oe.type,ve.type)){for(j in At(oe.layout,ve.layout,k,N,null,Y.setLayoutProperty),At(oe.paint,ve.paint,k,N,null,Y.setPaintProperty),X(oe.filter,ve.filter)||k.push({command:Y.setFilter,args:[N,ve.filter]}),X(oe.minzoom,ve.minzoom)&&X(oe.maxzoom,ve.maxzoom)||k.push({command:Y.setLayerZoomRange,args:[N,ve.minzoom,ve.maxzoom]}),oe)oe.hasOwnProperty(j)&&j!=="layout"&&j!=="paint"&&j!=="filter"&&j!=="metadata"&&j!=="minzoom"&&j!=="maxzoom"&&(j.indexOf("paint.")===0?At(oe[j],ve[j],k,N,j.slice(6),Y.setPaintProperty):X(oe[j],ve[j])||k.push({command:Y.setLayerProperty,args:[N,j,ve[j]]}));for(j in ve)ve.hasOwnProperty(j)&&!oe.hasOwnProperty(j)&&j!=="layout"&&j!=="paint"&&j!=="filter"&&j!=="metadata"&&j!=="minzoom"&&j!=="maxzoom"&&(j.indexOf("paint.")===0?At(oe[j],ve[j],k,N,j.slice(6),Y.setPaintProperty):X(oe[j],ve[j])||k.push({command:Y.setLayerProperty,args:[N,j,ve[j]]}))}else k.push({command:Y.removeLayer,args:[N]}),Ie=U[U.lastIndexOf(N)+1],k.push({command:Y.addLayer,args:[ve,Ie]})}(w,d.layers,_)}catch(y){console.warn("Unable to compute style diff:",y),_=[{command:Y.setStyle,args:[d]}]}return _}(this.serialize(),t).filter(p=>!(p.command in La));if(o.length===0)return!1;const c=o.filter(p=>!(p.command in nc));if(c.length>0)throw new Error(`Unimplemented: ${c.map(p=>p.command).join(", ")}.`);return o.forEach(p=>{p.command!=="setTransition"&&this[p.command].apply(this,p.args)}),this.stylesheet=t,!0}addImage(t,o){if(this.getImage(t))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,o),this._afterImageUpdated(t)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,o,c={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(s.validateStyle.source,`sources.${t}`,o,null,c))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const p=C(t,o,this.dispatcher,this);p.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:p.serialize(),sourceId:t}));const d=_=>{const y=(_?"symbol:":"other:")+t,v=this._sourceCaches[y]=new s.SourceCache(y,p,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[t]=v,v.style=this,v.onAdd(this.map)};d(!1),o.type!=="vector"&&o.type!=="geojson"||d(!0),p.onAdd&&p.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const o=this.getSource(t);if(o===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new s.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new s.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const c=this._getSourceCaches(t);for(const p of c)delete this._sourceCaches[p.id],delete this._updatedSources[p.id],p.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getSource(t).setData(o),this._changed=!0}getSource(t){const o=this._getSourceCache(t);return o&&o.getSource()}addLayer(t,o,c={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${p}" already exists on this map`)));let d;if(t.type==="custom"){if(vn(this,s.validateCustomStyleLayer(t)))return;d=s.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=s.clone$2(t),t=s.extend(t,{source:p})),this._validate(s.validateStyle.layer,`layers.${p}`,t,{arrayIndex:-1},c))return;d=s.createStyleLayer(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0)}const _=o?this._order.indexOf(o):this._order.length;if(o&&_===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(_,0,p),this._layerOrderChanged=!0,this._layers[p]=d;const y=this._getLayerSourceCache(d);if(this._removedLayers[p]&&d.source&&y&&d.type!=="custom"){const v=this._removedLayers[p];delete this._removedLayers[p],v.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",y.pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===o)return;const c=this._order.indexOf(t);this._order.splice(c,1);const p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o)return void this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,c){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===o&&p.maxzoom===c||(o!=null&&(p.minzoom=o),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,o,c={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!X(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(s.validateStyle.filter,`layers.${p.id}.filter`,o,null,c)||(p.filter=s.clone$2(o),this._updateLayer(p)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return s.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,o,c,p={}){this._checkLoaded();const d=this.getLayer(t);d?X(d.getLayoutProperty(o),c)||(d.setLayoutProperty(o,c,p),this._updateLayer(d)):this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,o){const c=this.getLayer(t);if(c)return c.getLayoutProperty(o);this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,o,c,p={}){this._checkLoaded();const d=this.getLayer(t);d?X(d.getPaintProperty(o),c)||(d.setPaintProperty(o,c,p)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,o){return this.getLayer(t).getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const c=t.source,p=t.sourceLayer,d=this.getSource(c);if(d===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const _=d.type;if(_==="geojson"&&p)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!p)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const y=this._getSourceCaches(c);for(const v of y)v.setFeatureState(p,t.id,o)}removeFeatureState(t,o){this._checkLoaded();const c=t.source,p=this.getSource(c);if(p===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const d=p.type,_=d==="vector"?t.sourceLayer:void 0;if(d==="vector"&&!_)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const y=this._getSourceCaches(c);for(const v of y)v.removeFeatureState(_,t.id,o)}getFeatureState(t){this._checkLoaded();const o=t.source,c=t.sourceLayer,p=this.getSource(o);if(p!==void 0){if(p.type!=="vector"||c)return t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(c,t.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const o in this._sourceCaches){const c=this._sourceCaches[o].getSource();t[c.id]||(t[c.id]=c.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const o=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",o.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const o=_=>this._layers[_].type==="fill-extrusion",c={},p=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(o(y)){c[y]=_;for(const v of t){const w=v[y];if(w)for(const E of w)p.push(E)}}}p.sort((_,y)=>y.intersectionZ-_.intersectionZ);const d=[];for(let _=this._order.length-1;_>=0;_--){const y=this._order[_];if(o(y))for(let v=p.length-1;v>=0;v--){const w=p[v].feature;if(c[w.layer.id]<_)break;d.push(w),p.pop()}else for(const v of t){const w=v[y];if(w)for(const E of w)d.push(E.feature)}}return d}queryRenderedFeatures(t,o,c){o&&o.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",o.filter,null,o);const p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const v of o.layers){const w=this._layers[v];if(!w)return this.fire(new s.ErrorEvent(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];p[w.source]=!0}}const d=[];o.availableImages=this._availableImages;const _=o&&o.layers?o.layers.some(v=>{const w=this.getLayer(v);return w&&w.is3D()}):this.has3DLayers(),y=yi.createFromScreenPoints(t,c);for(const v in this._sourceCaches){const w=this._sourceCaches[v].getSource().id;o.layers&&!p[w]||d.push(V(this._sourceCaches[v],this._layers,this._serializedLayers,y,o,c,_,!!this.map._showQueryGeometry))}return this.placement&&d.push(function(v,w,E,A,z,k,D){const F={},Z=k.queryRenderedSymbols(A),P=[];for(const U of Object.keys(Z).map(Number))P.push(D[U]);P.sort(se);for(const U of P){const $=U.featureIndex.lookupSymbolFeatures(Z[U.bucketInstanceId],w,U.bucketIndex,U.sourceLayerIndex,z.filter,z.layers,z.availableImages,v);for(const H in $){const re=F[H]=F[H]||[],N=$[H];N.sort((oe,ve)=>{const Ie=U.featureSortOrder;if(Ie){const j=Ie.indexOf(oe.featureIndex);return Ie.indexOf(ve.featureIndex)-j}return ve.featureIndex-oe.featureIndex});for(const oe of N)re.push(oe)}}for(const U in F)F[U].forEach($=>{const H=$.feature,re=E(v[U]).getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=re});return F}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),y.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,o){o&&o.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",o.filter,null,o);const c=this._getSourceCaches(t);let p=[];for(const d of c)p=p.concat(W(d,o));return p}addSourceType(t,o,c){return ur.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(ur.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const _ in t)if(!X(t[_],c[_])){p=!0;break}if(!p)return;const d={now:s.exported.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,o),this.light.updateTransitions(d)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(typeof t.source=="object"){const o="terrain-dem-src";this.addSource(o,t.source),t=s.clone$2(t),t=s.extend(t,{source:o})}if(!this._validate(s.validateStyle.terrain,"terrain",t)){if(this.terrain){const o=this.terrain,c=o.get();for(const p in t)if(!X(t[p],c[p])){o.set(t),this.stylesheet.terrain=t;const d={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(d);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const o=this.fog=new st(t);this.stylesheet.fog=t;const c={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,c=o.get();for(const p in t)if(!X(t[p],c[p])){o.set(t),this.stylesheet.fog=t;const d={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(d);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(c=>this.isLayerDraped(this._layers[c])),o=this._order.filter(c=>!this.isLayerDraped(this._layers[c]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t){const o=this.terrain=new Ee(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const c={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(c)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_validate(t,o,c,p,d={}){return(!d||d.validate!==!1)&&vn(this,t.call(s.validateStyle,s.extend({key:o,style:this.serialize(),value:c,styleSpec:s.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const o=this._getSourceCaches(t);for(const c of o)c.clearTiles()}_reloadSource(t){const o=this._getSourceCaches(t);for(const c of o)c.resume(),c.reload()}_updateSources(t){for(const o in this._sourceCaches)this._sourceCaches[o].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,c,p,d=!1){let _=!1,y=!1;const v={};for(const w of this._order){const E=this._layers[w];if(E.type!=="symbol")continue;if(!v[E.source]){const z=this._getLayerSourceCache(E);if(!z)continue;v[E.source]=z.getRenderableIds(!0).map(k=>z.getTileByID(k)).sort((k,D)=>D.tileID.overscaledZ-k.tileID.overscaledZ||(k.tileID.isLessThan(D.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(E,v[E.source],t.center.lng);_=_||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),d=d||this._layerOrderChanged||c===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ro(t,this._order,d,o,c,p,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,v),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),y=!0),_&&this.pauseablePlacement.placement.setStale()),y||_)for(const w of this._order){const E=this._layers[w];E.type==="symbol"&&this.placement.updateLayerOpacities(E,v[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o,c){this.imageManager.getImages(o.icons,c),this._updateTilesForChangedImages();const p=d=>{d&&d.setDependencies(o.tileID.key,o.type,o.icons)};p(this._otherSourceCaches[o.source]),p(this._symbolSourceCaches[o.source])}getGlyphs(t,o,c){this.glyphManager.getGlyphs(o.stacks,c)}getResource(t,o,c){return s.makeRequest(o,c)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}ur.getSourceType=function(l){return S[l]},ur.setSourceType=function(l,t){S[l]=t},ur.registerForPluginStateChange=s.registerForPluginStateChange;var Fo=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Ds="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let eo={},bn={};eo=Et("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef TERRAIN
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),bn=Et(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec3 fog_apply_from_vert(vec3 color,float fog_opac) {return mix(color,u_fog_color.rgb,fog_opac);}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb/=alpha;color.rgb=fog_apply(color.rgb,pos);color.rgb*=alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Ls=Et(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Lr=Fo;var Oo={background:Et(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Et(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Et(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Et("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Et(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Et(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Et("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Et("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Et("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Et(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Et(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Et(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Et(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Et(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;
#ifdef TERRAIN
vec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);gl_Position=u_matrix*vec4(pos,1);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Et(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;
#ifdef TERRAIN
vec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);
#else
vec3 p=vec3(pos_nx.xy,z);gl_Position=u_matrix*vec4(p,1);
#endif
vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Et(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Et(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Et(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),lineGradient:Et(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Et(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),lineSDF:Et(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dash_from
#pragma mapbox: initialize mediump vec4 dash_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dash_from
#pragma mapbox: initialize mediump vec4 dash_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float widthA=dash_from.z*fromScale;float widthB=dash_to.z*toScale;float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*(tileZoomRatio/widthA)/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*(tileZoomRatio/widthB)/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Et(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Et(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}`),symbolSDF:Et(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Et(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrainRaster:Et(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color.rgb=fog_dither(fog_apply_from_vert(color.rgb,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Et(`#ifdef GL_ES
precision highp float;
#endif
vec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Et(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ds),skyboxGradient:Et(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ds),skyboxCapture:Et(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}")};function Et(l,t,o){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,d=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_=l.match(p),y=t.match(p),v=Fo.match(p);let w=y?y.concat(_):_;o||(eo.staticUniforms&&(w=eo.staticUniforms.concat(w)),bn.staticUniforms&&(w=bn.staticUniforms.concat(w))),w&&(w=w.concat(v));const E={};return{fragmentSource:l=l.replace(c,(A,z,k,D,F)=>(E[F]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${k} ${D} ${F};
#else
uniform ${k} ${D} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${k} ${D} ${F} = u_${F};
#endif
`)),vertexSource:t=t.replace(c,(A,z,k,D,F)=>{const Z=D==="float"?"vec2":"vec4",P=F.match(/color/)?"color":Z;return E[F]?z==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${k} ${Z} a_${F};
varying ${k} ${D} ${F};
#else
uniform ${k} ${D} u_${F};
#endif
`:P==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${k} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${P}(a_${F}, u_${F}_t);
#else
    ${k} ${D} ${F} = u_${F};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${k} ${Z} a_${F};
#else
uniform ${k} ${D} u_${F};
#endif
`:P==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${D} ${F} = a_${F};
#else
    ${k} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${D} ${F} = unpack_mix_${P}(a_${F}, u_${F}_t);
#else
    ${k} ${D} ${F} = u_${F};
#endif
`}),staticAttributes:d,staticUniforms:w}}class Uo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,o,c,p,d,_,y,v){this.context=t;let w=this.boundPaintVertexBuffers.length!==p.length;for(let E=0;!w&&E<p.length;E++)this.boundPaintVertexBuffers[E]!==p[E]&&(w=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===o&&this.boundLayoutVertexBuffer===c&&!w&&this.boundIndexBuffer===d&&this.boundVertexOffset===_&&this.boundDynamicVertexBuffer===y&&this.boundDynamicVertexBuffer2===v?(t.bindVertexArrayOES.set(this.vao),y&&y.bind(),d&&d.dynamicDraw&&d.bind(),v&&v.bind()):this.freshBind(o,c,p,d,_,y,v)}freshBind(t,o,c,p,d,_,y){let v;const w=t.numAttributes,E=this.context,A=E.gl;if(E.extVertexArrayObject)this.vao&&this.destroy(),this.vao=E.extVertexArrayObject.createVertexArrayOES(),E.bindVertexArrayOES.set(this.vao),v=0,this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=y;else{v=E.currentNumAttributes||0;for(let z=w;z<v;z++)A.disableVertexAttribArray(z)}o.enableAttributes(A,t);for(const z of c)z.enableAttributes(A,t);_&&_.enableAttributes(A,t),y&&y.enableAttributes(A,t),o.bind(),o.setVertexAttribPointers(A,t,d);for(const z of c)z.bind(),z.setVertexAttribPointers(A,t,d);_&&(_.bind(),_.setVertexAttribPointers(A,t,d)),p&&p.bind(),y&&(y.bind(),y.setVertexAttribPointers(A,t,d)),E.currentNumAttributes=w}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Vo(l,t){const o=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new s.MercatorCoordinate(0,c/o).toLngLat().lat,new s.MercatorCoordinate(0,(c+1)/o).toLngLat().lat]}function No(l,t,o,c,p,d,_){const y=l.context,v=y.gl,w=o.fbo;if(!w)return;l.prepareDrawTile(t);const E=l.useProgram("hillshade");y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,w.colorAttachment.get());const A=((z,k,D,F)=>{const Z=D.paint.get("hillshade-shadow-color"),P=D.paint.get("hillshade-highlight-color"),U=D.paint.get("hillshade-accent-color");let $=D.paint.get("hillshade-illumination-direction")*(Math.PI/180);D.paint.get("hillshade-illumination-anchor")==="viewport"&&($-=z.transform.angle);const H=!z.options.moving;return{u_matrix:F||z.transform.calculateProjMatrix(k.tileID.toUnwrapped(),H),u_image:0,u_latrange:Vo(0,k.tileID),u_light:[D.paint.get("hillshade-exaggeration"),$],u_shadow:Z,u_highlight:P,u_accent:U}})(l,o,c,l.terrain?t.projMatrix:null);l.prepareDrawProgram(y,E,t.toUnwrapped()),E.draw(y,v.TRIANGLES,p,d,_,s.CullFaceMode.disabled,A,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}function Go(l,t,o){if(!t.needsDEMTextureUpload)return;const c=l.context,p=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(o.stride);const d=o.getPixels();t.demTexture?t.demTexture.update(d,{premultiply:!1}):t.demTexture=new s.Texture(c,d,p.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function qo(l,t,o,c,p,d){const _=l.context,y=_.gl;if(!t.dem)return;const v=t.dem;if(_.activeTexture.set(y.TEXTURE1),Go(l,t,v),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const w=v.dim;_.activeTexture.set(y.TEXTURE0);let E=t.fbo;if(!E){const A=new s.Texture(_,{width:w,height:w,data:null},y.RGBA);A.bind(y.LINEAR,y.CLAMP_TO_EDGE),E=t.fbo=_.createFramebuffer(w,w,!0),E.colorAttachment.set(A.texture)}_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,w,w]),l.useProgram("hillshadePrepare").draw(_,y.TRIANGLES,c,p,d,s.CullFaceMode.disabled,((A,z)=>{const k=z.stride,D=s.create$1();return s.ortho(D,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(D,D,[0,-s.EXTENT,0]),{u_matrix:D,u_image:1,u_dimension:[k,k],u_zoom:A.overscaledZ,u_unpack:z.unpackVector}})(t.tileID,v),o.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),t.needsHillshadePrepare=!1}const wn=(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_image0:new s.Uniform1i(l,t.u_image0),u_skirt_height:new s.Uniform1f(l,t.u_skirt_height)}),Mt=(l,t)=>({u_matrix:l,u_image0:0,u_skirt_height:t}),Tn=new class{constructor(){this.operations={}}newMorphing(l,t,o,c,p){if(l in this.operations){const d=this.operations[l];d.to.tileID.key!==o.tileID.key&&(d.queued=o)}else this.operations[l]={startTime:c,phase:0,duration:p,from:t,to:o,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const o=this.operations[t];for(o.phase=(l-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Rs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Bs(l,t,o,c,p){const d=l.context,_=d.gl;let y,v;const w=l.options.showTerrainWireframe?2:0,E=(F,Z)=>{if(v===F)return;const P=[Rs[F]];Z&&P.push(Rs[w]),y=l.useProgram("terrainRaster",null,P),v=F},A=l.colorModeForRenderPass(),z=new s.DepthMode(_.LEQUAL,s.DepthMode.ReadWrite,l.depthRangeFor3D);Tn.update(p);const k=l.transform,D=6*Math.pow(1.5,22-k.zoom)*t.exaggeration();(w?[!1,!0]:[!1]).forEach(F=>{v=-1;const Z=F?_.LINES:_.TRIANGLES,[P,U]=F?t.getWirefameBuffer():[t.gridIndexBuffer,t.gridSegments];for(const re of c){const N=o.getTile(re),oe=s.StencilMode.disabled,ve=t.prevTerrainTileForTile[re.key],Ie=t.terrainTileForTile[re.key];H=Ie,($=ve)!=null&&H!=null&&$.hasData()&&H.hasData()&&$.demTexture!=null&&H.demTexture!=null&&$.tileID.key!==H.tileID.key&&Tn.newMorphing(re.key,ve,Ie,p,250),d.activeTexture.set(_.TEXTURE0),N.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST);const j=Tn.getMorphValuesForProxy(re.key),ke=j?1:0;let ze;j&&(ze={morphing:{srcDemTile:j.from,dstDemTile:j.to,phase:s.easeCubicInOut(j.phase)}});const Ye=Mt(re.projMatrix,Ba(re.canonical,k.renderWorldCopies)?D/10:D);E(ke,F),t.setupElevationDraw(N,y,ze),l.prepareDrawProgram(d,y,re.toUnwrapped()),y.draw(d,Z,z,oe,A,s.CullFaceMode.backCCW,Ye,"terrain_raster",t.gridBuffer,P,U)}var $,H})}function Ba(l,t){const o=1<<l.z;return!t&&(l.x===0||l.x===o-1)||l.y===0||l.y===o-1}const to=l=>({u_matrix:l});function Fs(l,t,o,c,p){if(p>0){const d=s.exported.now(),_=(d-l.timeAdded)/p,y=t?(d-t.timeAdded)/p:-1,v=o.getSource(),w=c.coveringZoomLevel({tileSize:v.tileSize,roundZoom:v.roundZoom}),E=!t||Math.abs(t.tileID.overscaledZ-w)>Math.abs(l.tileID.overscaledZ-w),A=E&&l.refreshedUponExpiration?1:s.clamp(E?_:1-y,0,1);return l.refreshedUponExpiration&&_>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-A}:{opacity:A,mix:0}}return{opacity:1,mix:0}}class sc extends s.SourceCache{constructor(t){const o=C("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new at(Ve(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,c){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((d,_)=>{if(d[_.key]="",!this._tiles[_.key]){const y=new s.Tile(_,this._source.tileSize*_.overscaleFactor(),t.tileZoom);y.state="loaded",this._tiles[_.key]=y}return d},{});for(const d in this._tiles)d in p||(this.freeFBO(d),this._tiles[d].state="unloaded",delete this._tiles[d])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const c=Object.values(o);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Fa extends s.OverscaledTileID{constructor(t,o,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=c}}class Os extends s.Elevation{constructor(t,o){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,p,d]=function(v){const w=new s.StructArrayLayout4i8,E=new s.StructArrayLayout3ui6,A=131;w.reserve(17161),E.reserve(33800);const z=s.EXTENT/128,k=s.EXTENT+z/2,D=k+z;for(let Z=-z;Z<D;Z+=z)for(let P=-z;P<D;P+=z){const U=P<0||P>k||Z<0||Z>k?24575:0,$=s.clamp(Math.round(P),0,s.EXTENT),H=s.clamp(Math.round(Z),0,s.EXTENT);w.emplaceBack($+U,H,$,H)}const F=(Z,P)=>{const U=P*A+Z;E.emplaceBack(U+1,U,U+A),E.emplaceBack(U+A,U+A+1,U+1)};for(let Z=1;Z<129;Z++)for(let P=1;P<129;P++)F(P,Z);return[0,129].forEach(Z=>{for(let P=0;P<130;P++)F(P,Z),F(Z,P)}),[w,E,32768]}(),_=t.context;this.gridBuffer=_.createVertexBuffer(c,cr.members),this.gridIndexBuffer=_.createIndexBuffer(p),this.gridSegments=s.SegmentVector.simpleSegment(0,0,c.length,p.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,c.length,d),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new sc(o.map),this.orthoMatrix=s.create$1(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const y=_.gl;this._overlapStencilMode=new s.StencilMode({func:y.GEQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,o,c){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const p=t.terrain.properties;this.sourceCache=t._getSourceCache(p.get("source")),this._exaggeration=p.get("exaggeration");const d=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const _=this.sourceCache.getSource().tileSize/128,y=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(o,_*y,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,d(),this._initializing=!0),d(),o.updateElevation(!c),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.painter.options;this.renderCached=(p.zooming||p.moving||p.rotating||!!this.forceRenderCached)&&!this._invalidateRenderCache,this._invalidateRenderCache=!1;const d=this.proxyCoords=o.getIds().map(w=>{const E=o.getTileByID(w).tileID;return E.projMatrix=c.calculateProjMatrix(E.toUnwrapped()),E});(function(w,E){const A=E.transform.pointCoordinate(E.transform.getCameraPoint()),z=new s.pointGeometry(A.x,A.y);w.sort((k,D)=>{if(D.overscaledZ-k.overscaledZ)return D.overscaledZ-k.overscaledZ;const F=new s.pointGeometry(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),Z=new s.pointGeometry(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),P=z.mult(1<<k.canonical.z);return P.x-=.5,P.y-=.5,P.distSqr(F)-P.distSqr(Z)})})(d,this.painter),this._previousZoom=c.zoom;const _=this.proxyToSource||{};this.proxyToSource={},d.forEach(w=>{this.proxyToSource[w.key]={}}),this.terrainTileForTile={};const y=this._style._sourceCaches;for(const w in y){const E=y[w];if(!E.used||(E!==this.sourceCache&&(this._findCoveringTileCache[E.id]={}),this._setupProxiedCoordsForOrtho(E,t[w],_),E.usedForTerrain))continue;const A=t[w];E.getSource().reparseOverscaled&&this._assignTerrainTiles(A)}this.proxiedCoords[o.id]=d.map(w=>new Fa(w,w.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const v={};this._visibleDemTiles=[];for(const w of this.proxyCoords){const E=this.terrainTileForTile[w.key];if(!E)continue;const A=E.tileID.key;A in v||(this._visibleDemTiles.push(E),v[A]=A)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;const c=this._findTileCoveringTileID(o,this.sourceCache);c&&(this.terrainTileForTile[o.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const c in this.terrainTileForTile){const p=this.terrainTileForTile[c],d=p.dem;!d||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),Go(this.painter,p,d))}}_prepareDemTileUniforms(t,o,c,p){if(!o||o.demTexture==null)return!1;const d=t.tileID.canonical,_=Math.pow(2,o.tileID.canonical.z-d.z),y=p||"";return c[`u_dem_tl${y}`]=[d.x*_%1,d.y*_%1],c[`u_dem_scale${y}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const o=this._visibleDemTiles.reduce((c,p)=>{if(!p.dem)return c;const d=p.dem.tree.minimums[0];return d>0&&t++,c+d},0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const c=this._getLoadedAreaMinimum(),p={width:1,height:1,data:new Uint8Array(s.DEMData.pack(c,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let d=this._emptyDEMTexture;return d?d.update(p,{premultiply:!1}):d=this._emptyDEMTexture=new s.Texture(t,p,o.RGBA,{premultiply:!1}),d}setupElevationDraw(t,o,c){const p=this.painter.context,d=p.gl,_=(y=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(y),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var y;_.u_dem_size=this.sourceCache.getSource().tileSize,_.u_exaggeration=this.exaggeration();let v=null,w=null,E=1;if(c&&c.morphing&&this._useVertexMorphing){const A=c.morphing.srcDemTile,z=c.morphing.dstDemTile;E=c.morphing.phase,A&&z&&(this._prepareDemTileUniforms(t,A,_,"_prev")&&(w=A),this._prepareDemTileUniforms(t,z,_)&&(v=z))}if(w&&v?(p.activeTexture.set(d.TEXTURE2),v.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),p.activeTexture.set(d.TEXTURE4),w.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),_.u_dem_lerp=E):(v=this.terrainTileForTile[t.tileID.key],p.activeTexture.set(d.TEXTURE2),(this._prepareDemTileUniforms(t,v,_)?v.demTexture:this.emptyDEMTexture).bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST)),c&&c.useDepthForOcclusion&&(p.activeTexture.set(d.TEXTURE3),this._depthTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),_.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),c&&c.useMeterToDem&&v){const A=(1<<v.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=A}c&&c.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),o.setTerrainUniformValues(p,_)}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,c=this.painter.context,p=this.proxySourceCache,d=this.proxiedCoords[p.id],_=()=>{c.bindFramebuffer.set(null),c.viewport.set([0,0,o.width,o.height]),this.renderingToTexture=!1},y=this._drapedRenderBatches.shift();let v=[];const w=o.style.order;let E=0;for(let A=0;A<d.length;A++){const z=d[A],k=p.getTileByID(z.proxyTileKey),D=p.proxyCachedFBO[z.key]?p.proxyCachedFBO[z.key][t]:void 0;let F,Z;if(F=this.currentFBO=D!==void 0?p.renderCache[D]:this.pool[E++],k.texture=F.tex,D===void 0||F.dirty){c.bindFramebuffer.set(F.fb.framebuffer),this.renderedToTile=!1,F.dirty&&(c.clear({color:s.Color.transparent}),F.dirty=!1);for(let P=y.start;P<=y.end;++P){const U=o.style._layers[w[P]];if(U.isHidden(o.transform.zoom))continue;const $=o.style._getLayerSourceCache(U),H=$?this.proxyToSource[z.key][$.id]:[z];if(!H)continue;const re=H;c.viewport.set([0,0,F.fb.width,F.fb.height]),Z!==($?$.id:null)&&(this._setupStencil(H,U,$),Z=$?$.id:null),o.renderLayer(o,$,U,re)}F.dirty=this.renderedToTile,this.renderedToTile&&v.push(k.tileID),E===5&&(E=0,v.length>0&&(_(),Bs(o,this,p,v,this._updateTimestamp),this.renderingToTexture=!0,v=[]))}else v.push(k.tileID)}return _(),v.length>0&&Bs(o,this,p,v,this._updateTimestamp),y.end+1}postRender(){}renderCacheEfficiency(t){const o=t.order.length;if(o===0)return{efficiency:100};let c,p=0,d=0,_=!1;for(let y=0;y<o;++y){const v=t._layers[t.order[y]];this._style.isLayerDraped(v)?(_&&++p,++d):_||(_=!0,c=v.id)}return d===0?{efficiency:100}:{efficiency:100*(1-p/d),firstUndrapedLayer:c}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,c){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(d=>d.dem).map(d=>{const _=d.tileID,y=Math.pow(2,_.overscaledZ),{x:v,y:w}=_.canonical,E=v/y,A=(v+1)/y,z=w/y,k=(w+1)/y;return{minx:E,miny:z,maxx:A,maxy:k,t:d.dem.tree.raycastRoot(E,z,A,k,t,o,c),tile:d}});p.sort((d,_)=>(d.t!==null?d.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE));for(const d of p){if(d.t==null)return null;const _=d.tile.dem.tree.raycast(d.minx,d.miny,d.maxx,d.maxy,t,o,c);if(_!=null)return _}return null}_createFBO(){const t=this.painter.context,o=t.gl,c=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const p=new s.Texture(t,{width:c[0],height:c[1],data:null},o.RGBA);p.bind(o.LINEAR,o.CLAMP_TO_EDGE);const d=t.createFramebuffer(c[0],c[1],!1);return d.colorAttachment.set(p.texture),d.depthAttachment=new kr(t,d.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,d.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):d.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:d,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(!this.renderCached||this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const o=this._style._layers[t],c=o.isHidden(this.painter.transform.zoom),p=o.getCrossfadeParameters(),d=!!p&&p.t!==1,_=o.hasTransition();return o.type!=="custom"&&!c&&(d||_)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o]._source instanceof Wr){t=!0;break}if(t)for(let o=0;o<this._style.order.length;++o){const c=this._style._layers[this._style.order[o]],p=c.isHidden(this.painter.transform.zoom),d=this._style._getLayerSourceCache(c);if(c.type!=="raster"||p||!d)continue;const _=c.paint.get("raster-fade-duration");for(const y of this.proxyCoords){const v=this.proxyToSource[y.key][d.id];if(v)for(const w of v){const E=Fs(d.getTile(w),d.findLoadedParent(w,0),d,this.painter.transform,_);(E.opacity!==1||E.mix!==0)&&this._clearRenderCacheForTile(d.id,w)}}}}_setupDrapedRenderBatches(){const t=this._style.order,o=t.length;if(o===0)return;const c=[];let p,d=0,_=this._style._layers[t[d]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++d<o;)_=this._style._layers[t[d]];for(;d<o;++d){const y=this._style._layers[t[d]];y.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(y)?p===void 0&&(p=d):p!==void 0&&(c.push({start:p,end:d-1}),p=void 0))}p!==void 0&&c.push({start:p,end:d-1}),this._drapedRenderBatches=c}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()){if(o.renderCache.length>o.renderCachePool.length){const d=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let _=0;_<d.length;++_){const y=Object.values(d[_]);o.renderCachePool.push(...y)}}return}this._clearRasterFadeFromRenderCache();const c=this.proxyCoords,p=this._tilesDirty;for(let d=c.length-1;d>=0;d--){const _=c[d];if(o.getTileByID(_.key),o.proxyCachedFBO[_.key]!==void 0){const y=t[_.key],v=this.proxyToSource[_.key];let w=0;for(const E in v){const A=v[E],z=y[E];if(!z||z.length!==A.length||A.some((k,D)=>k!==z[D]||p[E]&&p[E].hasOwnProperty(k.key))){w=-1;break}++w}for(const E in o.proxyCachedFBO[_.key])o.renderCache[o.proxyCachedFBO[_.key][E]].dirty=w<0||w!==Object.values(y).length}else for(let y=0;y<this._drapedRenderBatches.length;++y){const v=this._drapedRenderBatches[y];let w=o.renderCachePool.pop();w===void 0&&o.renderCache.length<50&&(w=o.renderCache.length,o.renderCache.push(this._createFBO())),w!==void 0&&(o.proxyCachedFBO[_.key]===void 0&&(o.proxyCachedFBO[_.key]={}),o.proxyCachedFBO[_.key][v.start]=w,o.renderCache[w].dirty=!0)}}this._tilesDirty={}}_setupStencil(t,o,c){if(!c||!this._sourceTilesOverlap[c.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const p=this.painter.context,d=p.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let _;if(o.isTileClipped())_=t.length,this._overlapStencilMode.test={func:d.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);_=1,this._overlapStencilMode.test={func:d.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+_>255&&(p.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=_,this._overlapStencilMode.ref=this._stencilRef,o.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(t,o){const c=this.painter,p=this.painter.context,d=p.gl;c._tileClippingMaskIDs={},p.setColorMode(s.ColorMode.disabled),p.setDepthMode(s.DepthMode.disabled);const _=c.useProgram("clippingMask");for(const y of t){const v=c._tileClippingMaskIDs[y.key]=--o;_.draw(p,d.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:d.ALWAYS,mask:0},v,255,d.KEEP,d.KEEP,d.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,to(y.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const c=[t.x,t.y,1,1];s.transformMat4(c,c,o.pixelMatrixInverse),s.scale$2(c,c,1/c[3]),c[0]/=o.worldSize,c[1]/=o.worldSize;const p=o._camera.position,d=s.mercatorZfromAltitude(1,o.center.lat),_=[p[0],p[1],p[2]/d,0],y=s.subtract([],c.slice(0,3),_);s.normalize(y,y);const v=this.raycast(_,y,this._exaggeration);return v!==null&&v?(s.scaleAndAdd(_,_,y,v),_[3]=_[2],_[2]*=d,_):null}drawDepth(){const t=this.painter,o=t.context,c=this.proxySourceCache,p=Math.ceil(t.width),d=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===d||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const _=o.gl,y=o.createFramebuffer(p,d,!0);o.activeTexture.set(_.TEXTURE0);const v=new s.Texture(o,{width:p,height:d,data:null},_.RGBA);v.bind(_.NEAREST,_.CLAMP_TO_EDGE),y.colorAttachment.set(v.texture);const w=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,p,d);y.depthAttachment.set(w),this._depthFBO=y,this._depthTexture=v}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,p,d]),function(_,y,v,w){const E=_.context,A=E.gl;E.clear({depth:1});const z=_.useProgram("terrainDepth"),k=new s.DepthMode(A.LESS,s.DepthMode.ReadWrite,_.depthRangeFor3D);for(const D of w){const F=v.getTile(D),Z=Mt(D.projMatrix,0);y.setupElevationDraw(F,z),z.draw(E,A.TRIANGLES,k,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,Z,"terrain_depth",y.gridBuffer,y.gridIndexBuffer,y.gridNoSkirtSegments)}}(t,this,c,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,o,c){if(t.getSource()instanceof R)return this._setupProxiedCoordsForImageSource(t,o,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],d=this.proxyCoords;for(let y=0;y<d.length;y++){const v=d[y],w=this._findTileCoveringTileID(v,t);if(w){const E=this._createProxiedId(v,w,c[v.key]&&c[v.key][t.id]);p.push(E),this.proxyToSource[v.key][t.id]=[E]}}let _=!1;for(let y=0;y<o.length;y++){const v=t.getTile(o[y]);if(!v||!v.hasData())continue;const w=this._findTileCoveringTileID(v.tileID,this.proxySourceCache);if(w&&w.tileID.canonical.z!==v.tileID.canonical.z){const E=this.proxyToSource[w.tileID.key][t.id],A=this._createProxiedId(w.tileID,v,c[w.tileID.key]&&c[w.tileID.key][t.id]);E?E.splice(E.length-1,0,A):this.proxyToSource[w.tileID.key][t.id]=[A],p.push(A),_=!0}}this._sourceTilesOverlap[t.id]=_}_setupProxiedCoordsForImageSource(t,o,c){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],d=this.proxyCoords,_=t.getSource(),y=new s.pointGeometry(_.tileID.x,_.tileID.y)._div(1<<_.tileID.z),v=_.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((E,A)=>(E.min.x=Math.min(E.min.x,A.x-y.x),E.min.y=Math.min(E.min.y,A.y-y.y),E.max.x=Math.max(E.max.x,A.x-y.x),E.max.y=Math.max(E.max.y,A.y-y.y),E),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),w=(E,A)=>{const z=E.wrap+E.canonical.x/(1<<E.canonical.z),k=E.canonical.y/(1<<E.canonical.z),D=s.EXTENT/(1<<E.canonical.z),F=A.wrap+A.canonical.x/(1<<A.canonical.z),Z=A.canonical.y/(1<<A.canonical.z);return z+D<F+v.min.x||z>F+v.max.x||k+D<Z+v.min.y||k>Z+v.max.y};for(let E=0;E<d.length;E++){const A=d[E];for(let z=0;z<o.length;z++){const k=t.getTile(o[z]);if(!k||!k.hasData()||w(A,k.tileID))continue;const D=this._createProxiedId(A,k,c[A.key]&&c[A.key][t.id]),F=this.proxyToSource[A.key][t.id];F?F.push(D):this.proxyToSource[A.key][t.id]=[D],p.push(D)}}}_createProxiedId(t,o,c){let p=this.orthoMatrix;if(c){const d=c.find(_=>_.key===o.tileID.key);if(d)return d}if(o.tileID.key!==t.key){const d=t.canonical.z-o.tileID.canonical.z;let _,y,v;p=s.create$1();const w=o.tileID.wrap-t.wrap<<t.overscaledZ;d>0?(_=s.EXTENT>>d,y=_*((o.tileID.canonical.x<<d)-t.canonical.x+w),v=_*((o.tileID.canonical.y<<d)-t.canonical.y)):(_=s.EXTENT<<-d,y=s.EXTENT*(o.tileID.canonical.x-(t.canonical.x+w<<-d)),v=s.EXTENT*(o.tileID.canonical.y-(t.canonical.y<<-d))),s.ortho(p,0,_,0,_,0,1),s.translate(p,p,[y,v,0])}return new Fa(o.tileID,t.key,p)}_findTileCoveringTileID(t,o){let c=o.getTile(t);if(c&&c.hasData())return c;const p=this._findCoveringTileCache[o.id],d=p[t.key];if(c=d?o.getTileByID(d):null,c&&c.hasData()||d===null)return c;let _=c?c.tileID:t,y=_.overscaledZ;const v=o.getSource().minzoom,w=[];if(!d){const A=o.getSource().maxzoom;if(t.canonical.z>=A){const z=t.canonical.z-A;o.getSource().reparseOverscaled?(y=Math.max(t.canonical.z+2,o.transform.tileZoom),_=new s.OverscaledTileID(y,t.wrap,A,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(y=A,_=new s.OverscaledTileID(y,t.wrap,A,t.canonical.x>>z,t.canonical.y>>z))}_.key!==t.key&&(w.push(_.key),c=o.getTile(_))}const E=A=>{w.forEach(z=>{p[z]=A}),w.length=0};for(y-=1;y>=v&&(!c||!c.hasData());y--){c&&E(c.tileID.key);const A=_.calculateScaledKey(y);if(c=o.getTileByID(A),c&&c.hasData())break;const z=p[A];if(z===null)break;z===void 0?w.push(A):c=o.getTileByID(z)}return E(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(t,o){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(o){let c,p,d;const _=new s.StructArrayLayout2ui4,y=131;for(p=1;p<129;p++){for(c=1;c<129;c++)d=p*y+c,_.emplaceBack(d,d+1),_.emplaceBack(d,d+y),_.emplaceBack(d+1,d+y),p===128&&_.emplaceBack(d+y,d+y+1);_.emplaceBack(d+1,d+1+y)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function $o(l){const t=[];for(let o=0;o<l.length;o++){if(l[o]===null)continue;const c=l[o].split(" ");t.push(c.pop())}return t}class jo{static cacheKey(t,o,c){let p=`${t}${c?c.cacheKey:""}`;for(const d of o)p+=`/${d}`;return p}constructor(t,o,c,p,d,_){const y=t.gl;this.program=y.createProgram();const v=$o(c.staticAttributes),w=p?p.getBinderAttributes():[],E=v.concat(w),A=c.staticUniforms?$o(c.staticUniforms):[],z=p?p.getBinderUniforms():[],k=A.concat(z),D=[];for(const re of k)D.indexOf(re)<0&&D.push(re);let F=p?p.defines():[];F=F.concat(_.map(re=>`#define ${re}`));const Z=F.concat(Ls.fragmentSource,Lr,bn.fragmentSource,c.fragmentSource).join(`
`),P=F.concat(Ls.vertexSource,Lr,bn.vertexSource,eo.vertexSource,c.vertexSource).join(`
`),U=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(U,Z),y.compileShader(U),y.attachShader(this.program,U);const $=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource($,P),y.compileShader($),y.attachShader(this.program,$),this.attributes={};const H={};this.numAttributes=E.length;for(let re=0;re<this.numAttributes;re++)E[re]&&(y.bindAttribLocation(this.program,re,E[re]),this.attributes[E[re]]=re);y.linkProgram(this.program),y.deleteShader($),y.deleteShader(U);for(let re=0;re<D.length;re++){const N=D[re];if(N&&!H[N]){const oe=y.getUniformLocation(this.program,N);oe&&(H[N]=oe)}}this.fixedUniforms=d(t,H),this.binderUniforms=p?p.getUniforms(t,H):[],_.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((re,N)=>({u_dem:new s.Uniform1i(re,N.u_dem),u_dem_prev:new s.Uniform1i(re,N.u_dem_prev),u_dem_unpack:new s.Uniform4f(re,N.u_dem_unpack),u_dem_tl:new s.Uniform2f(re,N.u_dem_tl),u_dem_scale:new s.Uniform1f(re,N.u_dem_scale),u_dem_tl_prev:new s.Uniform2f(re,N.u_dem_tl_prev),u_dem_scale_prev:new s.Uniform1f(re,N.u_dem_scale_prev),u_dem_size:new s.Uniform1f(re,N.u_dem_size),u_dem_lerp:new s.Uniform1f(re,N.u_dem_lerp),u_exaggeration:new s.Uniform1f(re,N.u_exaggeration),u_depth:new s.Uniform1i(re,N.u_depth),u_depth_size_inv:new s.Uniform2f(re,N.u_depth_size_inv),u_meter_to_dem:new s.Uniform1f(re,N.u_meter_to_dem),u_label_plane_matrix_inv:new s.UniformMatrix4f(re,N.u_label_plane_matrix_inv)}))(t,H)),_.indexOf("FOG")!==-1&&(this.fogUniforms=((re,N)=>({u_fog_matrix:new s.UniformMatrix4f(re,N.u_fog_matrix),u_fog_range:new s.Uniform2f(re,N.u_fog_range),u_fog_color:new s.Uniform4f(re,N.u_fog_color),u_fog_horizon_blend:new s.Uniform1f(re,N.u_fog_horizon_blend),u_fog_temporal_offset:new s.Uniform1f(re,N.u_fog_temporal_offset)}))(t,H))}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in o)c[p].set(o[p])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in o)c[p].location&&c[p].set(o[p])}}draw(t,o,c,p,d,_,y,v,w,E,A,z,k,D,F,Z){const P=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(p),t.setColorMode(d),t.setCullFace(_);for(const $ in this.fixedUniforms)this.fixedUniforms[$].set(y[$]);D&&D.setUniforms(t,this.binderUniforms,z,{zoom:k});const U={[P.LINES]:2,[P.TRIANGLES]:3,[P.LINE_STRIP]:1}[o];for(const $ of A.get()){const H=$.vaos||($.vaos={});(H[v]||(H[v]=new Uo)).bind(t,this,w,D?D.getPaintVertexBuffers():[],E,$.vertexOffset,F,Z),P.drawElements(o,$.primitiveLength*U,P.UNSIGNED_SHORT,$.primitiveOffset*U*2)}}}function Zo(l,t,o){const c=1/pt(o,1,t.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),d=o.tileSize*Math.pow(2,t.transform.tileZoom)/p,_=d*(o.tileID.canonical.x+o.tileID.wrap*p),y=d*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[c,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y]}}const Us=(l,t,o,c)=>{const p=t.style.light,d=p.properties.get("position"),_=[d.x,d.y,d.z],y=s.create$2();p.properties.get("anchor")==="viewport"&&(s.fromRotation(y,-t.transform.angle),s.transformMat3(_,_,y));const v=p.properties.get("color");return{u_matrix:l,u_lightpos:_,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_vertical_gradient:+o,u_opacity:c}},Oa=(l,t,o,c,p,d,_)=>s.extend(Us(l,t,o,c),Zo(d,t,_),{u_height_factor:-Math.pow(2,p.overscaledZ)/_.tileSize/8}),Ua=l=>({u_matrix:l}),En=(l,t,o,c)=>s.extend(Ua(l),Zo(o,t,c)),io=(l,t)=>({u_matrix:l,u_world:t}),Va=(l,t,o,c,p)=>s.extend(En(l,t,o,c),{u_world:p}),Di=(l,t,o,c)=>{const p=l.transform;let d;if(c.paint.get("circle-pitch-alignment")==="map"){const _=pt(o,1,p.zoom);d=[_,_]}else d=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_matrix:l.translatePosMatrix(t.projMatrix,o,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:d}},Vs=l=>{const t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Xo=(l,t,o)=>{const c=s.EXTENT/o.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/c,t.pixelsToGLUnits[1]/c]}},ro=(l,t,o=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:o}),Ns=(l,t,o,c)=>({u_matrix:l,u_extrude_scale:pt(t,1,o),u_intensity:c}),no=(l,t,o,c)=>{const p=l.transform;return{u_matrix:$s(l,t,o,c),u_ratio:1/pt(t,1,p.zoom),u_device_pixel_ratio:s.exported.devicePixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Wo=(l,t,o,c,p)=>s.extend(no(l,t,o,c),{u_image:0,u_image_height:p}),Gs=(l,t,o,c,p)=>{const d=l.transform,_=oo(t,d);return{u_matrix:$s(l,t,o,p),u_texsize:t.imageAtlasTexture.size,u_ratio:1/pt(t,1,d.zoom),u_device_pixel_ratio:s.exported.devicePixelRatio,u_image:0,u_scale:[_,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},qs=(l,t,o,c,p)=>{const d=oo(t,l.transform);return s.extend(no(l,t,o,p),{u_texsize:t.lineAtlasTexture.size,u_scale:[d,c.fromScale,c.toScale],u_image:0,u_mix:c.t})};function oo(l,t){return 1/pt(l,1,t.tileZoom)}function $s(l,t,o,c){return l.translatePosMatrix(c||t.tileID.projMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Na=(l,t,o,c,p)=>{return{u_matrix:l,u_tl_parent:t,u_scale_parent:o,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(_=p.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(d=p.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Sn(p.paint.get("raster-hue-rotate"))};var d,_};function Sn(l){l*=Math.PI/180;const t=Math.sin(l),o=Math.cos(l);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Ga=(l,t,o,c,p,d,_,y,v,w)=>{const E=p.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:E.cameraToCenterDistance,u_pitch:E.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:E.width/E.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:_,u_coord_matrix:y,u_is_text:+v,u_pitch_with_map:+c,u_texsize:w,u_texture:0}},qa=(l,t,o,c,p,d,_,y,v,w,E)=>{const{cameraToCenterDistance:A,_pitch:z}=p.transform;return s.extend(Ga(l,t,o,c,p,d,_,y,v,w),{u_gamma_scale:c?A*Math.cos(p.terrain?0:z):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+E})},ac=(l,t,o,c,p,d,_,y,v,w)=>s.extend(qa(l,t,o,c,p,d,_,y,!0,v,!0),{u_texsize_icon:w,u_texture_icon:1}),lc=(l,t,o)=>({u_matrix:l,u_opacity:t,u_color:o}),cc=(l,t,o,c,p,d)=>s.extend(function(_,y,v,w){const E=v.imageManager.getPattern(_.from.toString()),A=v.imageManager.getPattern(_.to.toString()),{width:z,height:k}=v.imageManager.getPixelSize(),D=Math.pow(2,w.tileID.overscaledZ),F=w.tileSize*Math.pow(2,v.transform.tileZoom)/D,Z=F*(w.tileID.canonical.x+w.tileID.wrap*D),P=F*w.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[z,k],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/pt(w,1,v.transform.tileZoom),u_pixel_coord_upper:[Z>>16,P>>16],u_pixel_coord_lower:[65535&Z,65535&P]}}(c,d,o,p),{u_matrix:l,u_opacity:t}),hc={fillExtrusion:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_lightpos:new s.Uniform3f(l,t.u_lightpos),u_lightintensity:new s.Uniform1f(l,t.u_lightintensity),u_lightcolor:new s.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,t.u_vertical_gradient),u_opacity:new s.Uniform1f(l,t.u_opacity)}),fillExtrusionPattern:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_lightpos:new s.Uniform3f(l,t.u_lightpos),u_lightintensity:new s.Uniform1f(l,t.u_lightintensity),u_lightcolor:new s.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(l,t.u_vertical_gradient),u_height_factor:new s.Uniform1f(l,t.u_height_factor),u_image:new s.Uniform1i(l,t.u_image),u_texsize:new s.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,t.u_scale),u_fade:new s.Uniform1f(l,t.u_fade),u_opacity:new s.Uniform1f(l,t.u_opacity)}),fill:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix)}),fillPattern:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_image:new s.Uniform1i(l,t.u_image),u_texsize:new s.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,t.u_scale),u_fade:new s.Uniform1f(l,t.u_fade)}),fillOutline:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_world:new s.Uniform2f(l,t.u_world)}),fillOutlinePattern:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_world:new s.Uniform2f(l,t.u_world),u_image:new s.Uniform1i(l,t.u_image),u_texsize:new s.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(l,t.u_scale),u_fade:new s.Uniform1f(l,t.u_fade)}),circle:(l,t)=>({u_camera_to_center_distance:new s.Uniform1f(l,t.u_camera_to_center_distance),u_extrude_scale:new s.Uniform2f(l,t.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(l,t.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(l,t.u_matrix)}),collisionBox:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_camera_to_center_distance:new s.Uniform1f(l,t.u_camera_to_center_distance),u_extrude_scale:new s.Uniform2f(l,t.u_extrude_scale)}),collisionCircle:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_inv_matrix:new s.UniformMatrix4f(l,t.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(l,t.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(l,t.u_viewport_size)}),debug:(l,t)=>({u_color:new s.UniformColor(l,t.u_color),u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_overlay:new s.Uniform1i(l,t.u_overlay),u_overlay_scale:new s.Uniform1f(l,t.u_overlay_scale)}),clippingMask:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix)}),heatmap:(l,t)=>({u_extrude_scale:new s.Uniform1f(l,t.u_extrude_scale),u_intensity:new s.Uniform1f(l,t.u_intensity),u_matrix:new s.UniformMatrix4f(l,t.u_matrix)}),heatmapTexture:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_world:new s.Uniform2f(l,t.u_world),u_image:new s.Uniform1i(l,t.u_image),u_color_ramp:new s.Uniform1i(l,t.u_color_ramp),u_opacity:new s.Uniform1f(l,t.u_opacity)}),hillshade:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_image:new s.Uniform1i(l,t.u_image),u_latrange:new s.Uniform2f(l,t.u_latrange),u_light:new s.Uniform2f(l,t.u_light),u_shadow:new s.UniformColor(l,t.u_shadow),u_highlight:new s.UniformColor(l,t.u_highlight),u_accent:new s.UniformColor(l,t.u_accent)}),hillshadePrepare:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_image:new s.Uniform1i(l,t.u_image),u_dimension:new s.Uniform2f(l,t.u_dimension),u_zoom:new s.Uniform1f(l,t.u_zoom),u_unpack:new s.Uniform4f(l,t.u_unpack)}),line:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_ratio:new s.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,t.u_units_to_pixels)}),lineGradient:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_ratio:new s.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,t.u_units_to_pixels),u_image:new s.Uniform1i(l,t.u_image),u_image_height:new s.Uniform1f(l,t.u_image_height)}),linePattern:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_texsize:new s.Uniform2f(l,t.u_texsize),u_ratio:new s.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,t.u_device_pixel_ratio),u_image:new s.Uniform1i(l,t.u_image),u_units_to_pixels:new s.Uniform2f(l,t.u_units_to_pixels),u_scale:new s.Uniform3f(l,t.u_scale),u_fade:new s.Uniform1f(l,t.u_fade)}),lineSDF:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_texsize:new s.Uniform2f(l,t.u_texsize),u_ratio:new s.Uniform1f(l,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(l,t.u_units_to_pixels),u_image:new s.Uniform1i(l,t.u_image),u_scale:new s.Uniform3f(l,t.u_scale),u_mix:new s.Uniform1f(l,t.u_mix)}),raster:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_tl_parent:new s.Uniform2f(l,t.u_tl_parent),u_scale_parent:new s.Uniform1f(l,t.u_scale_parent),u_buffer_scale:new s.Uniform1f(l,t.u_buffer_scale),u_fade_t:new s.Uniform1f(l,t.u_fade_t),u_opacity:new s.Uniform1f(l,t.u_opacity),u_image0:new s.Uniform1i(l,t.u_image0),u_image1:new s.Uniform1i(l,t.u_image1),u_brightness_low:new s.Uniform1f(l,t.u_brightness_low),u_brightness_high:new s.Uniform1f(l,t.u_brightness_high),u_saturation_factor:new s.Uniform1f(l,t.u_saturation_factor),u_contrast_factor:new s.Uniform1f(l,t.u_contrast_factor),u_spin_weights:new s.Uniform3f(l,t.u_spin_weights)}),symbolIcon:(l,t)=>({u_is_size_zoom_constant:new s.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,t.u_size_t),u_size:new s.Uniform1f(l,t.u_size),u_camera_to_center_distance:new s.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,t.u_pitch),u_rotate_symbol:new s.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,t.u_fade_change),u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new s.Uniform1i(l,t.u_is_text),u_pitch_with_map:new s.Uniform1i(l,t.u_pitch_with_map),u_texsize:new s.Uniform2f(l,t.u_texsize),u_texture:new s.Uniform1i(l,t.u_texture)}),symbolSDF:(l,t)=>({u_is_size_zoom_constant:new s.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,t.u_size_t),u_size:new s.Uniform1f(l,t.u_size),u_camera_to_center_distance:new s.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,t.u_pitch),u_rotate_symbol:new s.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,t.u_fade_change),u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new s.Uniform1i(l,t.u_is_text),u_pitch_with_map:new s.Uniform1i(l,t.u_pitch_with_map),u_texsize:new s.Uniform2f(l,t.u_texsize),u_texture:new s.Uniform1i(l,t.u_texture),u_gamma_scale:new s.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,t.u_is_halo)}),symbolTextAndIcon:(l,t)=>({u_is_size_zoom_constant:new s.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(l,t.u_size_t),u_size:new s.Uniform1f(l,t.u_size),u_camera_to_center_distance:new s.Uniform1f(l,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(l,t.u_pitch),u_rotate_symbol:new s.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(l,t.u_fade_change),u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new s.Uniform1i(l,t.u_is_text),u_pitch_with_map:new s.Uniform1i(l,t.u_pitch_with_map),u_texsize:new s.Uniform2f(l,t.u_texsize),u_texsize_icon:new s.Uniform2f(l,t.u_texsize_icon),u_texture:new s.Uniform1i(l,t.u_texture),u_texture_icon:new s.Uniform1i(l,t.u_texture_icon),u_gamma_scale:new s.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(l,t.u_is_halo)}),background:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_opacity:new s.Uniform1f(l,t.u_opacity),u_color:new s.UniformColor(l,t.u_color)}),backgroundPattern:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_opacity:new s.Uniform1f(l,t.u_opacity),u_image:new s.Uniform1i(l,t.u_image),u_pattern_tl_a:new s.Uniform2f(l,t.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(l,t.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(l,t.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(l,t.u_pattern_br_b),u_texsize:new s.Uniform2f(l,t.u_texsize),u_mix:new s.Uniform1f(l,t.u_mix),u_pattern_size_a:new s.Uniform2f(l,t.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(l,t.u_pattern_size_b),u_scale_a:new s.Uniform1f(l,t.u_scale_a),u_scale_b:new s.Uniform1f(l,t.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(l,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(l,t.u_tile_units_to_pixels)}),terrainRaster:wn,terrainDepth:wn,skybox:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_sun_direction:new s.Uniform3f(l,t.u_sun_direction),u_cubemap:new s.Uniform1i(l,t.u_cubemap),u_opacity:new s.Uniform1f(l,t.u_opacity),u_temporal_offset:new s.Uniform1f(l,t.u_temporal_offset)}),skyboxGradient:(l,t)=>({u_matrix:new s.UniformMatrix4f(l,t.u_matrix),u_color_ramp:new s.Uniform1i(l,t.u_color_ramp),u_center_direction:new s.Uniform3f(l,t.u_center_direction),u_radius:new s.Uniform1f(l,t.u_radius),u_opacity:new s.Uniform1f(l,t.u_opacity),u_temporal_offset:new s.Uniform1f(l,t.u_temporal_offset)}),skyboxCapture:(l,t)=>({u_matrix_3f:new s.UniformMatrix3f(l,t.u_matrix_3f),u_sun_direction:new s.Uniform3f(l,t.u_sun_direction),u_sun_intensity:new s.Uniform1f(l,t.u_sun_intensity),u_color_tint_r:new s.Uniform4f(l,t.u_color_tint_r),u_color_tint_m:new s.Uniform4f(l,t.u_color_tint_m),u_luminance:new s.Uniform1f(l,t.u_luminance)})};let In;function Ho(l,t,o,c,p,d,_){const y=l.context,v=y.gl,w=l.useProgram("collisionBox"),E=[];let A=0,z=0;for(let $=0;$<c.length;$++){const H=c[$],re=t.getTile(H),N=re.getBucket(o);if(!N)continue;let oe=H.projMatrix;p[0]===0&&p[1]===0||(oe=l.translatePosMatrix(H.projMatrix,re,p,d));const ve=_?N.textCollisionBox:N.iconCollisionBox,Ie=N.collisionCircleArray;if(Ie.length>0){const j=s.create$1(),ke=oe;s.mul$1(j,N.placementInvProjMatrix,l.transform.glCoordMatrix),s.mul$1(j,j,N.placementViewportMatrix),E.push({circleArray:Ie,circleOffset:z,transform:ke,invTransform:j}),A+=Ie.length/4,z=A}ve&&(l.terrain&&l.terrain.setupElevationDraw(re,w),w.draw(y,v.LINES,s.DepthMode.disabled,s.StencilMode.disabled,l.colorModeForRenderPass(),s.CullFaceMode.disabled,Xo(oe,l.transform,re),o.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,null,l.transform.zoom,null,ve.collisionVertexBuffer,ve.collisionVertexBufferExt))}if(!_||!E.length)return;const k=l.useProgram("collisionCircle"),D=new s.StructArrayLayout2f1f2i16;D.resize(4*A),D._trim();let F=0;for(const $ of E)for(let H=0;H<$.circleArray.length/4;H++){const re=4*H,N=$.circleArray[re+0],oe=$.circleArray[re+1],ve=$.circleArray[re+2],Ie=$.circleArray[re+3];D.emplace(F++,N,oe,ve,Ie,0),D.emplace(F++,N,oe,ve,Ie,1),D.emplace(F++,N,oe,ve,Ie,2),D.emplace(F++,N,oe,ve,Ie,3)}(!In||In.length<2*A)&&(In=function($){const H=2*$,re=new s.StructArrayLayout3ui6;re.resize(H),re._trim();for(let N=0;N<H;N++){const oe=6*N;re.uint16[oe+0]=4*N+0,re.uint16[oe+1]=4*N+1,re.uint16[oe+2]=4*N+2,re.uint16[oe+3]=4*N+2,re.uint16[oe+4]=4*N+3,re.uint16[oe+5]=4*N+0}return re}(A));const Z=y.createIndexBuffer(In,!0),P=y.createVertexBuffer(D,s.collisionCircleLayout.members,!0);for(const $ of E){const H={u_matrix:$.transform,u_inv_matrix:$.invTransform,u_camera_to_center_distance:(U=l.transform).cameraToCenterDistance,u_viewport_size:[U.width,U.height]};k.draw(y,v.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,l.colorModeForRenderPass(),s.CullFaceMode.disabled,H,o.id,P,Z,s.SegmentVector.simpleSegment(0,2*$.circleOffset,$.circleArray.length,$.circleArray.length/2),null,l.transform.zoom,null,null,null)}var U;P.destroy(),Z.destroy()}const Yr=s.identity(new Float32Array(16));function $a(l,t,o,c,p,d){const{horizontalAlign:_,verticalAlign:y}=s.getAnchorAlignment(l),v=-(_-.5)*t,w=-(y-.5)*o,E=s.evaluateVariableOffset(l,c);return new s.pointGeometry((v/p+E[0])*d,(w/p+E[1])*d)}function ja(l,t,o,c,p,d,_,y,v,w,E,A){const z=l.text.placedSymbolArray,k=l.text.dynamicLayoutVertexArray,D=l.icon.dynamicLayoutVertexArray,F={};k.clear();for(let Z=0;Z<z.length;Z++){const P=z.get(Z),U=l.allowVerticalPlacement&&!P.placedOrientation,$=P.hidden||!P.crossTileID||U?null:c[P.crossTileID];if($){const H=new s.pointGeometry(P.anchorX,P.anchorY),re=A(H),N=ri(H,o?y:_,re),oe=Hr(d.cameraToCenterDistance,N.signedDistanceFromCamera);let ve=p.evaluateSizeForFeature(l.textSizeData,w,P)*oe/s.ONE_EM;o&&(ve*=l.tilePixelRatio/v);const{width:Ie,height:j,anchor:ke,textOffset:ze,textBoxScale:Ye}=$,We=$a(ke,Ie,j,ze,Ye,ve),Ge=o?ri(H.add(We),_,re).point:N.point.add(t?We.rotate(-d.angle):We),He=l.allowVerticalPlacement&&P.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let nt=0;nt<P.numGlyphs;nt++)s.addDynamicAttributes(k,Ge,He);E&&P.associatedIconIndex>=0&&(F[P.associatedIconIndex]={shiftedAnchor:Ge,angle:He})}else yr(P.numGlyphs,k)}if(E){D.clear();const Z=l.icon.placedSymbolArray;for(let P=0;P<Z.length;P++){const U=Z.get(P);if(U.hidden)yr(U.numGlyphs,D);else{const $=F[P];if($)for(let H=0;H<U.numGlyphs;H++)s.addDynamicAttributes(D,$.shiftedAnchor,$.angle);else yr(U.numGlyphs,D)}}l.icon.dynamicLayoutVertexBuffer.updateData(D)}l.text.dynamicLayoutVertexBuffer.updateData(k)}function js(l,t,o){return o.iconsInText&&t?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Rr(l,t,o,c,p,d,_,y,v,w,E,A){const z=l.context,k=z.gl,D=l.transform,F=y==="map",Z=v==="map",P=F&&o.layout.get("symbol-placement")!=="point",U=F&&!Z&&!P,$=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let H=!1;const re=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),N=o.layout.get("text-variable-anchor"),oe=[],ve=l.terrain&&Z?["PITCH_WITH_MAP_TERRAIN"]:null;for(const Ie of c){const j=t.getTile(Ie),ke=j.getBucket(o);if(!ke)continue;const ze=p?ke.text:ke.icon;if(!ze||!ze.segments.get().length)continue;const Ye=ze.programConfigurations.get(o.id),We=p||ke.sdfIcons,Ge=p?ke.textSizeData:ke.iconSizeData,He=Z||D.pitch!==0,nt=l.useProgram(js(We,p,ke),Ye,ve),St=s.evaluateSizeForZoom(Ge,D.zoom);let Ut,jt,xt,Ct,Kt=[0,0],ir=null;if(p){if(jt=j.glyphAtlasTexture,xt=k.LINEAR,Ut=j.glyphAtlasTexture.size,ke.iconsInText){Kt=j.imageAtlasTexture.size,ir=j.imageAtlasTexture;const pi=Ge.kind==="composite"||Ge.kind==="camera";Ct=He||l.options.rotating||l.options.zooming||pi?k.LINEAR:k.NEAREST}}else{const pi=o.layout.get("icon-size").constantOr(0)!==1||ke.iconsNeedLinear;jt=j.imageAtlasTexture,xt=We||l.options.rotating||l.options.zooming||pi||He?k.LINEAR:k.NEAREST,Ut=j.imageAtlasTexture.size}const Ti=pt(j,1,l.transform.zoom),Ei=dt(Ie.projMatrix,Z,F,l.transform,Ti),rr=l.terrain&&Z&&P?s.invert(new Float32Array(16),Ei):Yr,nr=_t(Ie.projMatrix,Z,F,l.transform,Ti),Yt=N&&ke.hasTextData(),ni=o.layout.get("icon-text-fit")!=="none"&&Yt&&ke.hasIconData();if(P){const pi=D.elevation;ko(ke,Ie.projMatrix,l,p,Ei,nr,Z,w,pi?vr=>pi.getAtTileOffset(Ie,vr.x,vr.y):null)}const vt=l.translatePosMatrix(Ie.projMatrix,j,d,_),Qt=P||p&&N||ni?Yr:Ei,xi=l.translatePosMatrix(nr,j,d,_,!0),Gt=We&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ri;Ri=We?ke.iconsInText?ac(Ge.kind,St,U,Z,l,vt,Qt,xi,Ut,Kt):qa(Ge.kind,St,U,Z,l,vt,Qt,xi,p,Ut,!0):Ga(Ge.kind,St,U,Z,l,vt,Qt,xi,p,Ut);const Ln={program:nt,buffers:ze,uniformValues:Ri,atlasTexture:jt,atlasTextureIcon:ir,atlasInterpolation:xt,atlasInterpolationIcon:Ct,isSDF:We,hasHalo:Gt,tile:j,labelPlaneMatrixInv:rr};if($&&ke.canOverlap){H=!0;const pi=ze.segments.get();for(const vr of pi)oe.push({segments:new s.SegmentVector([vr]),sortKey:vr.sortKey,state:Ln})}else oe.push({segments:ze.segments,sortKey:0,state:Ln})}H&&oe.sort((Ie,j)=>Ie.sortKey-j.sortKey);for(const Ie of oe){const j=Ie.state;if(l.terrain&&l.terrain.setupElevationDraw(j.tile,j.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:j.labelPlaneMatrixInv}),z.activeTexture.set(k.TEXTURE0),j.atlasTexture.bind(j.atlasInterpolation,k.CLAMP_TO_EDGE),j.atlasTextureIcon&&(z.activeTexture.set(k.TEXTURE1),j.atlasTextureIcon&&j.atlasTextureIcon.bind(j.atlasInterpolationIcon,k.CLAMP_TO_EDGE)),j.isSDF){const ke=j.uniformValues;j.hasHalo&&(ke.u_is_halo=1,Zs(j.buffers,Ie.segments,o,l,j.program,re,E,A,ke)),ke.u_is_halo=0}Zs(j.buffers,Ie.segments,o,l,j.program,re,E,A,j.uniformValues)}}function Zs(l,t,o,c,p,d,_,y,v){const w=c.context;p.draw(w,w.gl.TRIANGLES,d,_,y,s.CullFaceMode.disabled,v,o.id,l.layoutVertexBuffer,l.indexBuffer,t,o.paint,c.transform.zoom,l.programConfigurations.get(o.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Jr(l,t,o,c,p,d,_){const y=l.context.gl,v=o.paint.get("fill-pattern"),w=v&&v.constantOr(1),E=o.getCrossfadeParameters();let A,z,k,D,F;_?(z=w&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",A=y.LINES):(z=w?"fillPattern":"fill",A=y.TRIANGLES);for(const Z of c){const P=t.getTile(Z);if(w&&!P.patternsLoaded())continue;const U=P.getBucket(o);if(!U)continue;l.prepareDrawTile(Z);const $=U.programConfigurations.get(o.id),H=l.useProgram(z,$);w&&(l.context.activeTexture.set(y.TEXTURE0),P.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),$.updatePaintBuffers(E));const re=v.constantOr(null);if(re&&P.imageAtlas){const oe=P.imageAtlas,ve=oe.patternPositions[re.to.toString()],Ie=oe.patternPositions[re.from.toString()];ve&&Ie&&$.setConstantPatternPositions(ve,Ie)}const N=l.translatePosMatrix(Z.projMatrix,P,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(_){D=U.indexBuffer2,F=U.segments2;const oe=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[y.drawingBufferWidth,y.drawingBufferHeight];k=z==="fillOutlinePattern"&&w?Va(N,l,E,P,oe):io(N,oe)}else D=U.indexBuffer,F=U.segments,k=w?En(N,l,E,P):Ua(N);l.prepareDrawProgram(l.context,H,Z.toUnwrapped()),H.draw(l.context,A,p,l.stencilModeForClipping(Z),d,s.CullFaceMode.disabled,k,o.id,U.layoutVertexBuffer,D,F,o.paint,l.transform.zoom,$)}}function Br(l,t,o,c,p,d,_){const y=l.context,v=y.gl,w=o.paint.get("fill-extrusion-pattern"),E=w.constantOr(1),A=o.getCrossfadeParameters(),z=o.paint.get("fill-extrusion-opacity");for(const k of c){const D=t.getTile(k),F=D.getBucket(o);if(!F)continue;const Z=F.programConfigurations.get(o.id),P=l.useProgram(E?"fillExtrusionPattern":"fillExtrusion",Z);if(l.terrain){const N=l.terrain;if(!F.enableTerrain)continue;if(N.setupElevationDraw(D,P,{useMeterToDem:!0}),Za(y,t,k,F,o,N),!F.centroidVertexBuffer){const oe=P.attributes.a_centroid_pos;oe!==void 0&&v.vertexAttrib2f(oe,0,0)}}E&&(l.context.activeTexture.set(v.TEXTURE0),D.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),Z.updatePaintBuffers(A));const U=w.constantOr(null);if(U&&D.imageAtlas){const N=D.imageAtlas,oe=N.patternPositions[U.to.toString()],ve=N.patternPositions[U.from.toString()];oe&&ve&&Z.setConstantPatternPositions(oe,ve)}const $=l.translatePosMatrix(k.projMatrix,D,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),H=o.paint.get("fill-extrusion-vertical-gradient"),re=E?Oa($,l,H,z,k,A,D):Us($,l,H,z);l.prepareDrawProgram(y,P,k.toUnwrapped()),P.draw(y,y.gl.TRIANGLES,p,d,_,s.CullFaceMode.backCCW,re,o.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,o.paint,l.transform.zoom,Z,l.terrain?F.centroidVertexBuffer:null)}}function Za(l,t,o,c,p,d){const _=[P=>{let U=P.canonical.x-1,$=P.wrap;return U<0&&(U=(1<<P.canonical.z)-1,$--),new s.OverscaledTileID(P.overscaledZ,$,P.canonical.z,U,P.canonical.y)},P=>{let U=P.canonical.x+1,$=P.wrap;return U===1<<P.canonical.z&&(U=0,$++),new s.OverscaledTileID(P.overscaledZ,$,P.canonical.z,U,P.canonical.y)},P=>new s.OverscaledTileID(P.overscaledZ,P.wrap,P.canonical.z,P.canonical.x,(P.canonical.y===0?1<<P.canonical.z:P.canonical.y)-1),P=>new s.OverscaledTileID(P.overscaledZ,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y===(1<<P.canonical.z)-1?0:P.canonical.y+1)],y=P=>{const U=t.getSource().maxzoom,$=oe=>{const ve=t.getTileByID(oe);if(ve&&ve.hasData())return ve.getBucket(p)};let H,re,N;return(P.overscaledZ===P.canonical.z||P.overscaledZ>=U)&&(H=$(P.key)),P.overscaledZ>=U&&(re=$(P.calculateScaledKey(P.overscaledZ+1))),P.overscaledZ>U&&(N=$(P.calculateScaledKey(P.overscaledZ-1))),H||re||N},v=[0,0,0],w=(P,U)=>(v[0]=Math.min(P.min.y,U.min.y),v[1]=Math.max(P.max.y,U.max.y),v[2]=s.EXTENT-U.min.x>P.max.x?U.min.x-s.EXTENT:P.max.x,v),E=(P,U)=>(v[0]=Math.min(P.min.x,U.min.x),v[1]=Math.max(P.max.x,U.max.x),v[2]=s.EXTENT-U.min.y>P.max.y?U.min.y-s.EXTENT:P.max.y,v),A=[(P,U)=>w(P,U),(P,U)=>w(U,P),(P,U)=>E(P,U),(P,U)=>E(U,P)],z=new s.pointGeometry(0,0);let k,D,F;const Z=(P,U,$,H,re)=>{const N=[[H?$:P,H?P:$,0],[H?$:U,H?U:$,0]],oe=re<0?s.EXTENT+re:re,ve=[H?oe:(P+U)/2,H?(P+U)/2:oe,0];return $===0&&re<0||$!==0&&re>0?d.getForTilePoints(F,[ve],!0,D):N.push(ve),d.getForTilePoints(o,N,!0,k),Math.max(N[0][2],N[1][2],ve[2])/d.exaggeration()};for(let P=0;P<4;P++){const U=c.borders[P];if(U.length===0&&(c.borderDone[P]=!0),c.borderDone[P])continue;const $=F=_[P](o),H=y($);if(!H||!H.enableTerrain||(D=d.findDEMTileFor($),!D||!D.dem))continue;if(!k){const ve=d.findDEMTileFor(o);if(!ve||!ve.dem)return;k=ve}const re=(P<2?1:5)-P,N=H.borders[re];let oe=0;for(let ve=0;ve<U.length;ve++){const Ie=c.featuresOnBorder[U[ve]],j=Ie.borders[P];let ke;for(;oe<N.length&&(ke=H.featuresOnBorder[N[oe]],!(ke.borders[re][1]>j[0]+3));)H.borderDone[re]||H.encodeCentroid(void 0,ke,!1),oe++;if(ke&&oe<N.length){const ze=oe;let Ye=0;for(;!(ke.borders[re][0]>j[1]-3)&&(Ye++,++oe!==N.length);)ke=H.featuresOnBorder[N[oe]];if(ke=H.featuresOnBorder[N[ze]],Ie.intersectsCount()>1||ke.intersectsCount()>1||Ye!==1){Ye!==1&&(oe=ze),c.encodeCentroid(void 0,Ie,!1),H.borderDone[re]||H.encodeCentroid(void 0,ke,!1);continue}const We=A[P](Ie,ke),Ge=P%2?s.EXTENT-1:0;z.x=Z(We[0],Math.min(s.EXTENT-1,We[1]),Ge,P<2,We[2]),z.y=0,c.encodeCentroid(z,Ie,!1),H.borderDone[re]||H.encodeCentroid(z,ke,!1)}else c.encodeCentroid(void 0,Ie,!1)}c.borderDone[P]=c.needsCentroidUpdate=!0,H.borderDone[re]||(H.borderDone[re]=H.needsCentroidUpdate=!0)}(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const Xs=new s.Color(1,0,0,1),Pt=new s.Color(0,1,0,1),Ko=new s.Color(0,0,1,1),uc=new s.Color(1,0,1,1),Xa=new s.Color(0,1,1,1);function An(l,t,o,c){Yo(l,0,t+o/2,l.transform.width,o,c)}function Wa(l,t,o,c){Yo(l,t-o/2,0,o,l.transform.height,c)}function Yo(l,t,o,c,p,d){const _=l.context,y=_.gl;y.enable(y.SCISSOR_TEST),y.scissor(t*s.exported.devicePixelRatio,o*s.exported.devicePixelRatio,c*s.exported.devicePixelRatio,p*s.exported.devicePixelRatio),_.clear({color:d}),y.disable(y.SCISSOR_TEST)}function Ha(l,t,o){const c=l.context,p=c.gl,d=o.projMatrix,_=l.useProgram("debug"),y=t.getTileByID(o.key);l.terrain&&l.terrain.setupElevationDraw(y,_);const v=s.DepthMode.disabled,w=s.StencilMode.disabled,E=l.colorModeForRenderPass(),A="$debug";c.activeTexture.set(p.TEXTURE0),l.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),_.draw(c,p.LINE_STRIP,v,w,E,s.CullFaceMode.disabled,ro(d,s.Color.red),A,l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);const z=y.latestRawTileData,k=Math.floor((z&&z.byteLength||0)/1024),D=t.getTile(o).tileSize,F=512/Math.min(D,512)*(o.overscaledZ/l.transform.zoom)*.5;let Z=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Z+=` => ${o.overscaledZ}`),function(P,U){P.initDebugOverlayCanvas();const $=P.debugOverlayCanvas,H=P.context.gl,re=P.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,$.width,$.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(U,5,5),re.strokeText(U,5,5),P.debugOverlayTexture.update($),P.debugOverlayTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE)}(l,`${Z} ${k}kb`),_.draw(c,p.TRIANGLES,v,w,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,ro(d,s.Color.transparent,F),A,l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}const pc=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ws}=pc;function ji(l,t,o,c){l.emplaceBack(t,o,c)}class so{constructor(t){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,ji(this.vertexArray,-1,-1,1),ji(this.vertexArray,1,-1,1),ji(this.vertexArray,-1,1,1),ji(this.vertexArray,1,1,1),ji(this.vertexArray,-1,-1,-1),ji(this.vertexArray,1,-1,-1),ji(this.vertexArray,-1,1,-1),ji(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ws),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Fr(l,t,o,c,p,d){const _=l.gl,y=t.paint.get("sky-atmosphere-color"),v=t.paint.get("sky-atmosphere-halo-color"),w=t.paint.get("sky-atmosphere-sun-intensity"),E=((A,z,k,D,F)=>({u_matrix_3f:A,u_sun_direction:z,u_sun_intensity:k,u_color_tint_r:[D.r,D.g,D.b,D.a],u_color_tint_m:[F.r,F.g,F.b,F.a],u_luminance:5e-5}))(s.fromMat4([],c),p,w,y,v);_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+d,t.skyboxTexture,0),o.draw(l,_.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,E,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Jo={symbol:function(l,t,o,c,p){if(l.renderPass!=="translucent")return;const d=s.StencilMode.disabled,_=l.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(y,v,w,E,A,z,k){const D=v.transform,F=A==="map",Z=z==="map";for(const P of y){const U=E.getTile(P),$=U.getBucket(w);if(!$||!$.text||!$.text.segments.get().length)continue;const H=s.evaluateSizeForZoom($.textSizeData,D.zoom),re=pt(U,1,v.transform.zoom),N=dt(P.projMatrix,Z,F,v.transform,re),oe=w.layout.get("icon-text-fit")!=="none"&&$.hasIconData();if(H){const ve=Math.pow(2,D.zoom-U.tileID.overscaledZ),Ie=D.elevation;ja($,F,Z,k,s.symbolSize,D,N,P.projMatrix,ve,H,oe,Ie?j=>Ie.getAtTileOffset(P,j.x,j.y):j=>0)}}}(c,l,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),p),o.paint.get("icon-opacity").constantOr(1)!==0&&Rr(l,t,o,c,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),d,_),o.paint.get("text-opacity").constantOr(1)!==0&&Rr(l,t,o,c,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),d,_),t.map.showCollisionBoxes&&(Ho(l,t,o,c,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Ho(l,t,o,c,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,o,c){if(l.renderPass!=="translucent")return;const p=o.paint.get("circle-opacity"),d=o.paint.get("circle-stroke-width"),_=o.paint.get("circle-stroke-opacity"),y=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(p.constantOr(1)===0&&(d.constantOr(1)===0||_.constantOr(1)===0))return;const v=l.context,w=v.gl,E=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),A=s.StencilMode.disabled,z=l.colorModeForRenderPass(),k=[];for(let D=0;D<c.length;D++){const F=c[D],Z=t.getTile(F),P=Z.getBucket(o);if(!P)continue;const U=P.programConfigurations.get(o.id),$=Vs(o),H={programConfiguration:U,program:l.useProgram("circle",U,$),layoutVertexBuffer:P.layoutVertexBuffer,indexBuffer:P.indexBuffer,uniformValues:Di(l,F,Z,o),tile:Z};if(y){const re=P.segments.get();for(const N of re)k.push({segments:new s.SegmentVector([N]),sortKey:N.sortKey,state:H})}else k.push({segments:P.segments,sortKey:0,state:H})}y&&k.sort((D,F)=>D.sortKey-F.sortKey);for(const D of k){const{programConfiguration:F,program:Z,layoutVertexBuffer:P,indexBuffer:U,uniformValues:$,tile:H}=D.state,re=D.segments;l.terrain&&l.terrain.setupElevationDraw(H,Z,{useDepthForOcclusion:!0}),l.prepareDrawProgram(v,Z,H.tileID.toUnwrapped()),Z.draw(v,w.TRIANGLES,E,A,z,s.CullFaceMode.disabled,$,o.id,P,U,re,o.paint,l.transform.zoom,F)}},heatmap:function(l,t,o,c){if(o.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const p=l.context,d=p.gl,_=s.StencilMode.disabled,y=new s.ColorMode([d.ONE,d.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(v,w,E){const A=v.gl;v.activeTexture.set(A.TEXTURE1),v.viewport.set([0,0,w.width/4,w.height/4]);let z=E.heatmapFbo;if(z)A.bindTexture(A.TEXTURE_2D,z.colorAttachment.get()),v.bindFramebuffer.set(z.framebuffer);else{const k=A.createTexture();A.bindTexture(A.TEXTURE_2D,k),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),z=E.heatmapFbo=v.createFramebuffer(w.width/4,w.height/4,!1),function(D,F,Z,P){const U=D.gl;U.texImage2D(U.TEXTURE_2D,0,U.RGBA,F.width/4,F.height/4,0,U.RGBA,D.extRenderToTextureHalfFloat?D.extTextureHalfFloat.HALF_FLOAT_OES:U.UNSIGNED_BYTE,null),P.colorAttachment.set(Z)}(v,w,k,z)}})(p,l,o),p.clear({color:s.Color.transparent});for(let v=0;v<c.length;v++){const w=c[v];if(t.hasRenderableParent(w))continue;const E=t.getTile(w),A=E.getBucket(o);if(!A)continue;const z=A.programConfigurations.get(o.id),k=l.useProgram("heatmap",z),{zoom:D}=l.transform;l.terrain&&l.terrain.setupElevationDraw(E,k),l.prepareDrawProgram(p,k,w.toUnwrapped()),k.draw(p,d.TRIANGLES,s.DepthMode.disabled,_,y,s.CullFaceMode.disabled,Ns(w.projMatrix,E,D,o.paint.get("heatmap-intensity")),o.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,o.paint,l.transform.zoom,z)}p.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(p,d){const _=p.context,y=_.gl,v=d.heatmapFbo;if(!v)return;_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,v.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1);let w=d.colorRampTexture;w||(w=d.colorRampTexture=new s.Texture(_,d.colorRamp,y.RGBA)),w.bind(y.LINEAR,y.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(_,y.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,p.colorModeForRenderPass(),s.CullFaceMode.disabled,((E,A,z,k)=>{const D=s.create$1();s.ortho(D,0,E.width,E.height,0,0,1);const F=E.context.gl;return{u_matrix:D,u_world:[F.drawingBufferWidth,F.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:A.paint.get("heatmap-opacity")}})(p,d),d.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,d.paint,p.transform.zoom)}(l,o))},line:function(l,t,o,c){if(l.renderPass!=="translucent")return;const p=o.paint.get("line-opacity"),d=o.paint.get("line-width");if(p.constantOr(1)===0||d.constantOr(1)===0)return;const _=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),y=l.colorModeForRenderPass(),v=o.paint.get("line-dasharray"),w=v.constantOr(1),E=o.layout.get("line-cap"),A=o.paint.get("line-pattern"),z=A.constantOr(1),k=o.paint.get("line-gradient"),D=o.getCrossfadeParameters(),F=z?"linePattern":w?"lineSDF":k?"lineGradient":"line",Z=l.context,P=Z.gl;for(const U of c){const $=t.getTile(U);if(z&&!$.patternsLoaded())continue;const H=$.getBucket(o);if(!H)continue;l.prepareDrawTile(U);const re=H.programConfigurations.get(o.id),N=l.useProgram(F,re),oe=A.constantOr(null);if(oe&&$.imageAtlas){const ze=$.imageAtlas,Ye=ze.patternPositions[oe.to.toString()],We=ze.patternPositions[oe.from.toString()];Ye&&We&&re.setConstantPatternPositions(Ye,We)}const ve=v.constantOr(null),Ie=E.constantOr(null);if(!z&&ve&&Ie&&$.lineAtlas){const ze=$.lineAtlas,Ye=ze.getDash(ve.to,Ie),We=ze.getDash(ve.from,Ie);Ye&&We&&re.setConstantPatternPositions(Ye,We)}const j=l.terrain?U.projMatrix:null,ke=z?Gs(l,$,o,D,j):w?qs(l,$,o,D,j):k?Wo(l,$,o,j,H.lineClipsArray.length):no(l,$,o,j);if(z)Z.activeTexture.set(P.TEXTURE0),$.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),re.updatePaintBuffers(D);else if(w)Z.activeTexture.set(P.TEXTURE0),$.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),re.updatePaintBuffers(D);else if(k){const ze=H.gradients[o.id];let Ye=ze.texture;if(o.gradientVersion!==ze.version){let We=256;if(o.stepInterpolant){const Ge=t.getSource().maxzoom,He=U.canonical.z===Ge?Math.ceil(1<<l.transform.maxZoom-U.canonical.z):1;We=s.clamp(s.nextPowerOfTwo(H.maxLineLength/s.EXTENT*1024*He),256,Z.maxTextureSize)}ze.gradient=s.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:ze.gradient||void 0,clips:H.lineClipsArray}),ze.texture?ze.texture.update(ze.gradient):ze.texture=new s.Texture(Z,ze.gradient,P.RGBA),ze.version=o.gradientVersion,Ye=ze.texture}Z.activeTexture.set(P.TEXTURE0),Ye.bind(o.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}l.prepareDrawProgram(Z,N,U.toUnwrapped()),N.draw(Z,P.TRIANGLES,_,l.stencilModeForClipping(U),y,s.CullFaceMode.disabled,ke,o.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,o.paint,l.transform.zoom,re,H.layoutVertexBuffer2)}},fill:function(l,t,o,c){const p=o.paint.get("fill-color"),d=o.paint.get("fill-opacity");if(d.constantOr(1)===0)return;const _=l.colorModeForRenderPass(),y=o.paint.get("fill-pattern"),v=l.opaquePassEnabledForLayer()&&!y.constantOr(1)&&p.constantOr(s.Color.transparent).a===1&&d.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===v){const w=l.depthModeForSublayer(1,l.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);Jr(l,t,o,c,w,_,!1)}if(l.renderPass==="translucent"&&o.paint.get("fill-antialias")){const w=l.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);Jr(l,t,o,c,w,_,!0)}},"fill-extrusion":function(l,t,o,c){const p=o.paint.get("fill-extrusion-opacity");if(p!==0&&l.renderPass==="translucent"){const d=new s.DepthMode(l.context.gl.LEQUAL,s.DepthMode.ReadWrite,l.depthRangeFor3D);if(p!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))Br(l,t,o,c,d,s.StencilMode.disabled,s.ColorMode.disabled),Br(l,t,o,c,d,l.stencilModeFor3D(),l.colorModeForRenderPass());else{const _=l.colorModeForRenderPass();Br(l,t,o,c,d,s.StencilMode.disabled,_)}}},hillshade:function(l,t,o,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const p=l.context,d=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),_=l.colorModeForRenderPass(),y=l.terrain&&l.terrain.renderingToTexture,[v,w]=l.renderPass!=="translucent"||y?[{},c]:l.stencilConfigForOverlap(c);for(const E of w){const A=t.getTile(E);if(A.needsHillshadePrepare&&l.renderPass==="offscreen")qo(l,A,o,d,s.StencilMode.disabled,_);else if(l.renderPass==="translucent"){const z=y&&l.terrain?l.terrain.stencilModeForRTTOverlap(E):v[E.overscaledZ];No(l,E,A,o,d,z,_)}}p.viewport.set([0,0,l.width,l.height])},raster:function(l,t,o,c,p,d){if(l.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!c.length)return;const _=l.context,y=_.gl,v=t.getSource(),w=l.useProgram("raster"),E=l.colorModeForRenderPass(),A=l.terrain&&l.terrain.renderingToTexture,[z,k]=v instanceof R||A?[{},c]:l.stencilConfigForOverlap(c),D=k[k.length-1].overscaledZ,F=!l.options.moving;for(const Z of k){const P=A?s.DepthMode.disabled:l.depthModeForSublayer(Z.overscaledZ-D,o.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,y.LESS),U=Z.toUnwrapped(),$=t.getTile(Z);if(A&&(!$||!$.hasData()))continue;const H=A?Z.projMatrix:l.transform.calculateProjMatrix(U,F),re=l.terrain&&A?l.terrain.stencilModeForRTTOverlap(Z):z[Z.overscaledZ],N=d?0:o.paint.get("raster-fade-duration");$.registerFadeDuration(N);const oe=t.findLoadedParent(Z,0),ve=Fs($,oe,t,l.transform,N);let Ie,j;l.terrain&&l.terrain.prepareDrawTile(Z);const ke=o.paint.get("raster-resampling")==="nearest"?y.NEAREST:y.LINEAR;_.activeTexture.set(y.TEXTURE0),$.texture.bind(ke,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(y.TEXTURE1),oe?(oe.texture.bind(ke,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),Ie=Math.pow(2,oe.tileID.overscaledZ-$.tileID.overscaledZ),j=[$.tileID.canonical.x*Ie%1,$.tileID.canonical.y*Ie%1]):$.texture.bind(ke,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST);const ze=Na(H,j||[0,0],Ie||1,ve,o);l.prepareDrawProgram(_,w,U),v instanceof R?w.draw(_,y.TRIANGLES,P,s.StencilMode.disabled,E,s.CullFaceMode.disabled,ze,o.id,v.boundsBuffer,l.quadTriangleIndexBuffer,v.boundsSegments):w.draw(_,y.TRIANGLES,P,re,E,s.CullFaceMode.disabled,ze,o.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,t,o,c){const p=o.paint.get("background-color"),d=o.paint.get("background-opacity");if(d===0)return;const _=l.context,y=_.gl,v=l.transform,w=v.tileSize,E=o.paint.get("background-pattern");if(l.isPatternMissing(E))return;const A=!E&&p.a===1&&d===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==A)return;const z=s.StencilMode.disabled,k=l.depthModeForSublayer(0,A==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),D=l.colorModeForRenderPass(),F=l.useProgram(E?"backgroundPattern":"background"),Z=c||v.coveringTiles({tileSize:w});E&&(_.activeTexture.set(y.TEXTURE0),l.imageManager.bind(l.context));const P=o.getCrossfadeParameters();for(const U of Z){const $=U.toUnwrapped(),H=c?U.projMatrix:l.transform.calculateProjMatrix($);l.prepareDrawTile(U);const re=E?cc(H,d,l,E,{tileID:U,tileSize:w},P):lc(H,d,p);l.prepareDrawProgram(_,F,$),F.draw(_,y.TRIANGLES,k,z,D,s.CullFaceMode.disabled,re,o.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}},sky:function(l,t,o){const c=o.paint.get("sky-opacity");if(c===0)return;const p=l.context,d=o.paint.get("sky-type"),_=new s.DepthMode(p.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),y=l.frameCounter/1e3%1;d==="atmosphere"?l.renderPass==="offscreen"?o.needsSkyboxCapture(l)&&(function(v,w,E,A){const z=v.context,k=z.gl;let D=w.skyboxFbo;if(!D){D=w.skyboxFbo=z.createFramebuffer(32,32,!1),w.skyboxGeometry=new so(z),w.skyboxTexture=z.gl.createTexture(),k.bindTexture(k.TEXTURE_CUBE_MAP,w.skyboxTexture),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MAG_FILTER,k.LINEAR);for(let U=0;U<6;++U)k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+U,0,k.RGBA,32,32,0,k.RGBA,k.UNSIGNED_BYTE,null)}z.bindFramebuffer.set(D.framebuffer),z.viewport.set([0,0,32,32]);const F=w.getCenter(v,!0),Z=v.useProgram("skyboxCapture"),P=new Float64Array(16);s.identity(P),s.rotateY(P,P,.5*-Math.PI),Fr(z,w,Z,P,F,0),s.identity(P),s.rotateY(P,P,.5*Math.PI),Fr(z,w,Z,P,F,1),s.identity(P),s.rotateX(P,P,.5*-Math.PI),Fr(z,w,Z,P,F,2),s.identity(P),s.rotateX(P,P,.5*Math.PI),Fr(z,w,Z,P,F,3),s.identity(P),Fr(z,w,Z,P,F,4),s.identity(P),s.rotateY(P,P,Math.PI),Fr(z,w,Z,P,F,5),z.viewport.set([0,0,v.width,v.height])}(l,o),o.markSkyboxValid(l)):l.renderPass==="sky"&&function(v,w,E,A,z){const k=v.context,D=k.gl,F=v.transform,Z=v.useProgram("skybox");k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_CUBE_MAP,w.skyboxTexture);const P=((U,$,H,re,N)=>({u_matrix:U,u_sun_direction:$,u_cubemap:0,u_opacity:re,u_temporal_offset:N}))(F.skyboxMatrix,w.getCenter(v,!1),0,A,z);v.prepareDrawProgram(k,Z),Z.draw(k,D.TRIANGLES,E,s.StencilMode.disabled,v.colorModeForRenderPass(),s.CullFaceMode.backCW,P,"skybox",w.skyboxGeometry.vertexBuffer,w.skyboxGeometry.indexBuffer,w.skyboxGeometry.segment)}(l,o,_,c,y):d==="gradient"&&l.renderPass==="sky"&&function(v,w,E,A,z){const k=v.context,D=k.gl,F=v.transform,Z=v.useProgram("skyboxGradient");w.skyboxGeometry||(w.skyboxGeometry=new so(k)),k.activeTexture.set(D.TEXTURE0);let P=w.colorRampTexture;P||(P=w.colorRampTexture=new s.Texture(k,w.colorRamp,D.RGBA)),P.bind(D.LINEAR,D.CLAMP_TO_EDGE);const U=(($,H,re,N,oe)=>({u_matrix:$,u_color_ramp:0,u_center_direction:H,u_radius:s.degToRad(re),u_opacity:N,u_temporal_offset:oe}))(F.skyboxMatrix,w.getCenter(v,!1),w.paint.get("sky-gradient-radius"),A,z);v.prepareDrawProgram(k,Z),Z.draw(k,D.TRIANGLES,E,s.StencilMode.disabled,v.colorModeForRenderPass(),s.CullFaceMode.backCW,U,"skyboxGradient",w.skyboxGeometry.vertexBuffer,w.skyboxGeometry.indexBuffer,w.skyboxGeometry.segment)}(l,o,_,c,y)},debug:function(l,t,o){for(let c=0;c<o.length;c++)Ha(l,t,o[c])},custom:function(l,t,o){const c=l.context,p=o.implementation;if(l.renderPass==="offscreen"){const d=p.prerender;d&&(l.setCustomLayerDefaults(),c.setColorMode(l.colorModeForRenderPass()),d.call(p,c.gl,l.transform.customLayerMatrix()),c.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),c.setColorMode(l.colorModeForRenderPass()),c.setStencilMode(s.StencilMode.disabled);const d=p.renderingMode==="3d"?new s.DepthMode(l.context.gl.LEQUAL,s.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,s.DepthMode.ReadOnly);c.setDepthMode(d),p.render(c.gl,l.transform.customLayerMatrix()),c.setDirty(),l.setBaseState(),c.bindFramebuffer.set(null)}}};class Ka{constructor(t,o){this.context=new Xr(t),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Da,this.gpuTimers={},this.frameCounter=0}updateTerrain(t,o){const c=!!t&&!!t.terrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Os(this,t));const p=this._terrain;this.transform.elevation=c?p:null,p.update(t,this.transform,o)}_updateFog(t){const o=t.fog;if(!o||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,p]=o.getFovAdjustedRange(this.transform._fov),d=c+.78*(p-c);this.transform.fogCullDistSq=d*d}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,o){if(this.width=t*s.exported.devicePixelRatio,this.height=o*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._layers[c].resize()}setup(){const t=this.context,o=new s.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(s.EXTENT,0),o.emplaceBack(0,s.EXTENT),o.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(o,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const c=new s.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(s.EXTENT,0),c.emplaceBack(0,s.EXTENT),c.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=t.createVertexBuffer(c,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const p=new s.StructArrayLayout4i8;p.emplaceBack(0,0,0,0),p.emplaceBack(s.EXTENT,0,s.EXTENT,0),p.emplaceBack(0,s.EXTENT,0,s.EXTENT),p.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(p,cr.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const _=new s.StructArrayLayout1ui2;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(_);const y=new s.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y),this.emptyTexture=new s.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=s.create$1();const v=this.context.gl;this.stencilClearMode=new s.StencilMode({func:v.ALWAYS,mask:0},0,255,v.ZERO,v.ZERO,v.ZERO),this.loadTimeStamps.push(s.window.performance.now())}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=s.create$1();s.ortho(c,0,this.width,this.height,0,0,1),s.scale$1(c,c,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,o.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,to(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,o,c){if(!(o&&this.currentStencilSource!==o.id&&t.isTileClipped()&&c&&c.length))return;this.currentStencilSource=o.id;const p=this.context,d=p.gl;this.nextStencilID+c.length>256&&this.clearStencil(),p.setColorMode(s.ColorMode.disabled),p.setDepthMode(s.DepthMode.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of c){const v=this._tileClippingMaskIDs[y.key]=this.nextStencilID++;_.draw(p,d.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:d.ALWAYS,mask:0},v,255,d.KEEP,d.KEEP,d.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,to(y.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new s.StencilMode({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new s.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,c=t.sort((_,y)=>y.overscaledZ-_.overscaledZ),p=c[c.length-1].overscaledZ,d=c[0].overscaledZ-p+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const _={};for(let y=0;y<d;y++)_[y+p]=new s.StencilMode({func:o.GEQUAL,mask:255},y+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=d,[_,c]}return[{[p]:s.StencilMode.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([t.CONSTANT_COLOR,t.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(t,o,c){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new s.DepthMode(c||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){this.style=t,this.options=o,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const c=this.style.order,p=this.style._sourceCaches;for(const w in p){const E=p[w];E.used&&E.prepare(this.context)}const d={},_={},y={};for(const w in p){const E=p[w];d[w]=E.getVisibleCoordinates(),_[w]=d[w].slice().reverse(),y[w]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let w=0;w<c.length;w++)if(this.style._layers[c[w]].is3D()){this.opaquePassCutoff=w;break}if(this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const w of c){const E=this.style._layers[w],A=t._getLayerSourceCache(E);if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const z=A?_[A.id]:void 0;(E.type==="custom"||E.isSky()||z&&z.length)&&this.renderLayer(this,A,E,z)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let v=s.Color.transparent;if(this.style.fog&&(v=this.style.fog.properties.get("color")),this.context.clear({color:o.showOverdrawInspector?s.Color.black:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const w=this.style._layers[c[this.currentLayer]],E=t._getLayerSourceCache(w);if(w.isSky())continue;const A=E?_[E.id]:void 0;this._renderTileClippingMasks(w,E,A),this.renderLayer(this,E,w,A)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const w=this.style._layers[c[this.currentLayer]],E=t._getLayerSourceCache(w);w.isSky()&&this.renderLayer(this,E,w,E?_[E.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;){const w=this.style._layers[c[this.currentLayer]],E=t._getLayerSourceCache(w);if(w.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(w)){if(w.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const A=E?(w.type==="symbol"?y:_)[E.id]:void 0;this._renderTileClippingMasks(w,E,E?d[E.id]:void 0),this.renderLayer(this,E,w,A),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let w=null;s.values(this.style._layers).forEach(E=>{const A=t._getLayerSourceCache(E);A&&!E.isHidden(this.transform.zoom)&&(!w||w.getSource().maxzoom<A.getSource().maxzoom)&&(w=A)}),w&&this.options.showTileBoundaries&&Jo.debug(this,w,w.getVisibleCoordinates())}this.options.showPadding&&function(w){const E=w.transform.padding;An(w,w.transform.height-(E.top||0),3,Xs),An(w,E.bottom||0,3,Pt),Wa(w,E.left||0,3,Ko),Wa(w,w.transform.width-(E.right||0),3,uc);const A=w.transform.centerPoint;(function(z,k,D,F){Yo(z,k-1,D-10,2,20,F),Yo(z,k-10,D-1,20,2,F)})(w,A.x,w.transform.height-A.y,Xa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%s.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,o,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||p&&p.length)&&(this.id=c.id,this.gpuTimingStart(c),Jo[c.type](t,o,c,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let c=this.gpuTimers[t.id];c||(c=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),c.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,c.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const o={};for(const c in t){const p=t[c],d=this.context.extTimerQuery,_=d.getQueryObjectEXT(p.query,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(p.query),o[c]=_}return o}translatePosMatrix(t,o,c,p,d){if(!c[0]&&!c[1])return t;const _=d?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(_){const w=Math.sin(_),E=Math.cos(_);c=[c[0]*E-c[1]*w,c[0]*w+c[1]*E]}const y=[d?c[0]:pt(o,c[0],this.transform.zoom),d?c[1]:pt(o,c[1],this.transform.zoom),0],v=new Float32Array(16);return s.translate(v,t,y),v}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!o||!c}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,o=this.style&&this.style.fog,c=[];return this.terrain&&!this.terrain.renderingToTexture&&c.push("TERRAIN"),o&&!t&&o.getOpacity(this.transform.pitch)!==0&&c.push("FOG"),t&&c.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&c.push("OVERDRAW_INSPECTOR"),c}useProgram(t,o,c){this.cache=this.cache||{};const p=c||[],d=this.currentGlobalDefines().concat(p),_=jo.cacheKey(t,d,o);return this.cache[_]||(this.cache[_]=new jo(this.context,t,Oo[t],o,hc[t],d)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,o,c){if(this.terrain&&this.terrain.renderingToTexture)return;const p=this.style.fog;if(p){const d=p.getOpacity(this.transform.pitch);d!==0&&o.setFogUniformValues(t,((_,y,v,w)=>{const E=y.properties.get("color"),A=_.frameCounter/1e3%1,z=[E.r/E.a,E.g/E.a,E.b/E.a,w];return{u_fog_matrix:v?_.transform.calculateFogTileMatrix(v):_.identityMat,u_fog_range:y.getFovAdjustedRange(_.transform._fov),u_fog_color:z,u_fog_horizon_blend:y.properties.get("horizon-blend"),u_fog_temporal_offset:A}})(this,p,c,d))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}}class Cn{constructor(t=0,o=0,c=0,p=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=c,this.right=p}interpolate(t,o,c){return o.top!=null&&t.top!=null&&(this.top=s.number(t.top,o.top,c)),o.bottom!=null&&t.bottom!=null&&(this.bottom=s.number(t.bottom,o.bottom,c)),o.left!=null&&t.left!=null&&(this.left=s.number(t.left,o.left,c)),o.right!=null&&t.right!=null&&(this.right=s.number(t.right,o.right,c)),this}getCenter(t,o){const c=s.clamp((this.left+t-this.right)/2,0,t),p=s.clamp((this.top+o-this.bottom)/2,0,o);return new s.pointGeometry(c,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Cn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Or(l,t){return[l[4*t],l[4*t+1],l[4*t+2],l[4*t+3]]}function Zi(l,t,o){l[4*t+0]=o[0],l[4*t+1]=o[1],l[4*t+2]=o[2],l[4*t+3]=o[3]}function Qo(l,t){const o=Or(l,3);s.fromQuat(l,t),Zi(l,3,o)}function Hs(l,t){Zi(l,3,[t[0],t[1],t[2],1])}function es(l,t){const o=s.identity$1([]);return s.rotateZ$1(o,o,-t),s.rotateX$1(o,o,-l),o}function Ur(l,t){const o=[l[0],l[1],0],c=[t[0],t[1],0];if(s.length(o)>=1e-15){const _=s.normalize([],o);s.scale(c,_,s.dot(c,_)),t[0]=c[0],t[1]=c[1]}const p=s.cross([],t,l);if(s.len(p)<1e-15)return null;const d=Math.atan2(-p[1],p[0]);return es(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),d)}class ao{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(o){if(!o)return;const c=Array.isArray(o)?new s.MercatorCoordinate(o[0],o[1],o[2]):o;return c.x=s.wrap(c.x,0,1),c}(t):t}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;const c=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(t)):0,p=this.position,d=s.MercatorCoordinate.fromLngLat(t,c),_=[d.x-p.x,d.y-p.y,d.z-p.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Ur(_,o)}setPitchBearing(t,o){this.orientation=es(s.degToRad(t),s.degToRad(-o))}}class lo{constructor(t,o){this._transform=s.identity([]),this._orientation=s.identity$1([]),o&&(this._orientation=o,Qo(this._transform,this._orientation)),t&&Hs(this._transform,t)}get mercatorPosition(){const t=this.position;return new s.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=Or(this._transform,3);return[t[0],t[1],t[2]]}set position(t){Hs(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,Qo(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=es(t,o),Qo(this._transform,this._orientation)}forward(){const t=Or(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Or(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Or(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const c=new Float64Array(16);return s.invert(c,this.getWorldToCamera(t,o)),c}getWorldToCameraPosition(t,o,c){const p=this.position;s.scale(p,p,-t);const d=new Float64Array(16);return s.fromScaling(d,[c,c,c]),s.translate(d,d,p),d[10]*=o,d}getWorldToCamera(t,o){const c=new Float64Array(16),p=new Float64Array(4),d=this.position;return s.conjugate(p,this._orientation),s.scale(d,d,-t),s.fromQuat(c,p),s.translate(c,c,d),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=o,c[9]*=o,c[10]*=o,c[11]*=o,c}getCameraToClipPerspective(t,o,c,p){const d=new Float64Array(16);return s.perspective(d,t,o,c,p),d}getDistanceToElevation(t){const o=t===0?0:s.mercatorZfromAltitude(t,this.position[1]),c=this.forward();return(o-this.position[2])/c[2]}clone(){return new lo([...this.position],[...this.orientation])}}class Ks{constructor(t,o,c,p,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||d,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=c==null?0:c,this._maxPitch=p==null?60:p,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Cn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new lo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new Ks(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const o=-s.wrap(t,-180,180)*Math.PI/180;var c;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(c=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c),function(p,d,_){var y=d[0],v=d[1],w=d[2],E=d[3],A=Math.sin(_),z=Math.cos(_);p[0]=y*z+w*A,p[1]=v*z+E*A,p[2]=y*-A+w*z,p[3]=v*-A+E*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=s.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(this.center),-1);return t===-1?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,o=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(o+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let p=0,d=0;for(let _=0;_<o.length;_++){const y=new s.pointGeometry(o[_][0]*this.width,c+o[_][1]*(this.height-c)),v=t.pointCoordinate(y);if(!v)continue;const w=1/Math.hypot(v[0]-this._camera.position[0],v[1]-this._camera.position[1]);p+=v[3]*w,d+=w}return d===0?NaN:p/d}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const t=this._cameraZoom,o=this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(this.center)),c=s.mercatorZfromAltitude(o,this.center.lat),p=this._mercatorZfromZoom(t),d=this._mercatorZfromZoom(this._maxZoom),_=Math.max(p-c,d);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const p=s.length(s.sub([],this._camera.position,c));return s.clamp(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!s.exactEquals(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];s.exactEquals$1(c,this._camera.position)||(this._setCameraPosition(c),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new ao;return o.position=new s.MercatorCoordinate(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this._renderWorldCopies,o}_setCameraOrientation(t){if(!s.length$1(t))return!1;s.normalize$1(t,t);const o=s.transformQuat([],[0,0,-1],t),c=s.transformQuat([],[0,-1,0],t);if(c[2]<0)return!1;const p=Ur(o,c);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=s.clamp(t[2],p/c,p/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,c){this._unmodified=!1,this._edgeInsets.interpolate(t,o,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new s.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new s.pointGeometry(0,0)),p=this.pointCoordinate(new s.pointGeometry(this.width,0)),d=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),_=this.pointCoordinate(new s.pointGeometry(0,this.height)),y=Math.floor(Math.min(c.x,p.x,d.x,_.x)),v=Math.floor(Math.max(c.x,p.x,d.x,_.x)),w=1;for(let E=y-w;E<=v+w;E++)E!==0&&o.push(new s.UnwrappedTileID(E,t))}return o}coveringTiles(t){let o=this.coveringZoomLevel(t);const c=o,p=this.elevation&&!t.isTerrainDEM;if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const d=s.MercatorCoordinate.fromLngLat(this.center),_=1<<o,y=[_*d.x,_*d.y,0],v=xe.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o),w=this.pointCoordinate(this.getCameraPoint()),E=_*s.mercatorZfromAltitude(1,this.center.lat),A=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),z=[_*w.x,_*w.y,A],k=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),D=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?o:0,F=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Z=t.isTerrainDEM?-F:this._elevation?this._elevation.getMinElevationBelowMSL():0,P=j=>({aabb:new be([j*_,0,Z],[(j+1)*_,_,F]),zoom:0,x:0,y:0,wrap:j,fullyVisible:!1}),U=[],$=[],H=o,re=t.reparseOverscaled?c:o,N=j=>{if(!this._elevation||!j.tileID)return;const ke=this._elevation.getMinMaxForTile(j.tileID),ze=j.aabb;ke?(ze.min[2]=ke.min,ze.max[2]=ke.max,ze.center[2]=(ze.min[2]+ze.max[2])/2):(j.shouldSplit=Ie(j),j.shouldSplit||(ze.min[2]=ze.max[2]=ze.center[2]=this._centerAltitude))},oe=j=>j*j,ve=oe((A-this._centerAltitude)*E),Ie=j=>{if(j.zoom<D)return!0;if(j.zoom===H)return!1;if(j.shouldSplit!=null)return j.shouldSplit;const ke=j.aabb.distanceX(z),ze=j.aabb.distanceY(z);let Ye=ve;p&&(Ye=oe(j.aabb.distanceZ(z)*E));const We=ke*ke+ze*ze+Ye;return We<oe((1<<H-j.zoom)*k*((Ge,He)=>{if(He*oe(.707)<Ge)return 1;const nt=Math.sqrt(He/Ge);return nt/(1.4144271570014144+(Math.pow(1.1,nt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ye,ve),We))};if(this._renderWorldCopies)for(let j=1;j<=3;j++)U.push(P(-j)),U.push(P(j));for(U.push(P(0));U.length>0;){const j=U.pop(),ke=j.x,ze=j.y;let Ye=j.fullyVisible;if(!Ye){const We=j.aabb.intersects(v);if(We===0)continue;Ye=We===2}if(j.zoom!==H&&Ie(j))for(let We=0;We<4;We++){const Ge=(ke<<1)+We%2,He=(ze<<1)+(We>>1),nt={aabb:j.aabb.quadrant(We),zoom:j.zoom+1,x:Ge,y:He,wrap:j.wrap,fullyVisible:Ye,tileID:void 0,shouldSplit:void 0};p&&(nt.tileID=new s.OverscaledTileID(j.zoom+1===H?re:j.zoom+1,j.wrap,j.zoom+1,Ge,He),N(nt)),U.push(nt)}else{const We=j.zoom===H?re:j.zoom;if(t.minzoom&&t.minzoom>We)continue;const Ge=y[0]-(.5+ke+(j.wrap<<j.zoom))*(1<<o-j.zoom),He=y[1]-.5-ze,nt=j.tileID?j.tileID:new s.OverscaledTileID(We,j.wrap,j.zoom,ke,ze);$.push({tileID:nt,distanceSq:Ge*Ge+He*He})}}if(this.fogCullDistSq){const j=this.fogCullDistSq;$.splice(0,$.length,...$.filter(ke=>{const ze=[0,0,0,1],Ye=[s.EXTENT,s.EXTENT,0,1],We=this.calculateFogTileMatrix(ke.tileID.toUnwrapped());s.transformMat4(ze,ze,We),s.transformMat4(Ye,Ye,We);const Ge=s.getAABBPointSquareDist(ze,Ye);if(Ge===0)return!0;let He=!1;const nt=this.horizonLineFromTop();if(Ge>j&&nt!==0){const St=this.calculateProjMatrix(ke.tileID.toUnwrapped());let Ut;p&&this._elevation&&(Ut=this._elevation.getMinMaxForTile(ke.tileID)),Ut||(Ut={min:Z,max:F});const jt=s.furthestTileCorner(this.bearing),xt=[jt[0]*s.EXTENT,jt[1]*s.EXTENT,Ut.max];s.transformMat4$1(xt,xt,St),He=(1-xt[1])*this.height*.5<nt}return Ge<j||He}))}return $.sort((j,ke)=>j.distanceSq-ke.distanceSq).map(j=>j.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=s.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.pointGeometry(s.mercatorXfromLng(t.lng)*this.worldSize,s.mercatorYfromLat(o)*this.worldSize)}unproject(t){return new s.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,o){const c=this.pointCoordinate(o),p=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),_=new s.MercatorCoordinate(d.x-(c.x-p.x),d.y-(c.y-p.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(t){this.center=this.coordinateLocation(t),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t){return s.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t.toLngLat()}pointRayIntersection(t,o){const c=o!=null?o:this._centerAltitude,p=[t.x,t.y,0,1],d=[t.x,t.y,1,1];s.transformMat4(p,p,this.pixelMatrixInverse),s.transformMat4(d,d,this.pixelMatrixInverse);const _=d[3];s.scale$2(p,p,1/p[3]),s.scale$2(d,d,1/_);const y=p[2],v=d[2];return{p0:p,p1:d,t:y===v?0:(c-y)/(v-y)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return s.transformMat4(o,o,this.pixelMatrixInverse),s.transformMat4(c,c,this.pixelMatrixInverse),s.scale$2(o,o,1/o[3]),s.scale$2(c,c,1/c[3]),o[2]=s.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,c[2]=s.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,s.scale$2(o,o,1/this.worldSize),s.scale$2(c,c,1/this.worldSize),new ye([o[0],o[1],o[2]],s.normalize([],s.sub([],c,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:c,t:p}=t,d=s.mercatorZfromAltitude(o[2],this._center.lat),_=s.mercatorZfromAltitude(c[2],this._center.lat);return new s.MercatorCoordinate(s.number(o[0],c[0],p)/this.worldSize,s.number(o[1],c[1],p)/this.worldSize,s.number(d,_,p))}pointCoordinate(t){const o=this.horizonLineFromTop(!1),c=new s.pointGeometry(t.x,Math.max(o,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(c))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const o=this.elevation;let c=this.elevation.pointCoordinate(t);if(c)return new s.MercatorCoordinate(c[0],c[1],c[2]);let p=0,d=this.horizonLineFromTop();if(t.y>d)return this.pointCoordinate(t);const _=.02*d,y=t.clone();for(let v=0;v<10&&d-p>_;v++){y.y=s.number(p,d,.66);const w=o.pointCoordinate(y);w?(d=y.y,c=w):p=y.y}return c?new s.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const o=this.horizonLineFromTop();return t.y<o}}_coordinatePoint(t,o){const c=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return s.transformMat4(p,p,this.pixelMatrix),p[3]>0?new s.pointGeometry(p[0]/p[3],p[1]/p[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():new s.LngLatBounds().extend(this.pointLocation(new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){const t=this.elevation,o=t.visibleDemTiles.reduce((p,d)=>{if(d.dem){const _=d.dem.tree;p.min=Math.min(p.min,_.minimums[0]),p.max=Math.max(p.max,_.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});o.min*=t.exaggeration(),o.max*=t.exaggeration();const c=this.horizonLineFromTop();return[new s.pointGeometry(0,c),new s.pointGeometry(this.width,c),new s.pointGeometry(this.width,this.height),new s.pointGeometry(0,this.height)].reduce((p,d)=>p.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(d,o.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(d,o.max)))),new s.LngLatBounds)}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,c=this.height/2-.97*o;return t?Math.max(0,c):c}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,o){const c=t.canonical,p=o/this.zoomScale(c.z),d=c.x+Math.pow(2,c.z)*t.wrap,_=s.identity(new Float64Array(16));return s.translate(_,_,[d*p,c.y*p,0]),s.scale$1(_,_,[p/s.EXTENT,p/s.EXTENT,1]),_}calculateFogTileMatrix(t){const o=t.key,c=this._fogTileMatrixCache;if(c[o])return c[o];const p=this.calculatePosMatrix(t,this.cameraWorldSize);return s.multiply(p,this.worldToFogMatrix,p),c[o]=new Float32Array(p),c[o]}calculateProjMatrix(t,o=!1){const c=t.key,p=o?this._alignedProjMatrixCache:this._projMatrixCache;if(p[c])return p[c];const d=this.calculatePosMatrix(t,this.worldSize);return s.multiply(d,o?this.alignedProjMatrix:this.projMatrix,d),p[c]=new Float32Array(d),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const o=this._camera.position,c=this._camera.forward();if(o[2]<=0||c[2]>=0)return;const p=s.mercatorZfromAltitude(1,this._center.lat);o[2]/=p,c[2]/=p,s.normalize(c,c);const d=t.raycast(o,c,t.exaggeration());if(d){const _=s.scaleAndAdd([],o,c,d),y=new s.MercatorCoordinate(_[0],_[1],s.mercatorZfromAltitude(_[2],s.latFromMercatorY(_[1]))),v=this._camera.position,w=y.z+s.length([y.x-v[0],y.y-v[1],y.z-v[2]]);this._cameraZoom=this._zoomFromMercatorZ(w),this._centerAltitude=y.toAltitude(),this._center=y.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const o=t.getAtPointOrZero(this._camera.mercatorPosition),c=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),p=s.mercatorZfromAltitude(o,this._center.lat),d=this._camera.position[2]-p;if(d<c){const _=s.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),y=this._camera.mercatorPosition,v=[_.x-y.x,_.y-y.y,_.z-y.z],w=s.length(v);v[2]-=c-d;const E=s.length(v);if(E===0)return;s.scale(v,v,w/E),this._camera.position=[_.x-v[0],_.y-v[1],_.z-v[2]],this._camera.orientation=Ur(v,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,o,c,p,d=-90,_=90,y=-180,v=180;const w=this.size,E=this._unmodified;if(this.latRange){const k=this.latRange;d=s.mercatorYfromLat(k[1])*this.worldSize,_=s.mercatorYfromLat(k[0])*this.worldSize,t=_-d<w.y?w.y/(_-d):0}if(this.lngRange){const k=this.lngRange;y=s.mercatorXfromLng(k[0])*this.worldSize,v=s.mercatorXfromLng(k[1])*this.worldSize,o=v-y<w.x?w.x/(v-y):0}const A=this.point,z=Math.max(o||0,t||0);if(z)return this.center=this.unproject(new s.pointGeometry(o?(v+y)/2:A.x,t?(_+d)/2:A.y)),this.zoom+=this.scaleZoom(z),this._unmodified=E,void(this._constraining=!1);if(this.latRange){const k=A.y,D=w.y/2;k-D<d&&(p=d+D),k+D>_&&(p=_-D)}if(this.lngRange){const k=A.x,D=w.x/2;k-D<y&&(c=y+D),k+D>v&&(c=v-D)}c===void 0&&p===void 0||(this.center=this.unproject(new s.pointGeometry(c!==void 0?c:A.x,p!==void 0?p:A.y))),this._constrainCameraAltitude(),this._unmodified=E,this._constraining=!1}_minZoomForBounds(){const t=(p,d)=>Math.log2(p/(this.tileSize*Math.abs(d[1]-d[0])));let o=0;if(this.latRange){const p=this.latRange;o=t(this.height,[s.mercatorYfromLat(p[0]),s.mercatorYfromLat(p[1])])}let c=0;if(this.lngRange){const p=this.lngRange;c=t(this.width,[s.mercatorXfromLng(p[0]),s.mercatorXfromLng(p[1])])}return Math.max(o,c)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const o=this.pixelsPerMeter;this._updateCameraState();const c=Math.PI/2+this._pitch,p=this.fovAboveCenter,d=this.elevation?this.elevation.getMinElevationBelowMSL()*o:0,_=(this._camera.position[2]*this.worldSize-d)/Math.cos(this._pitch),y=Math.sin(p)*_/Math.sin(s.clamp(Math.PI-c-p,.01,Math.PI-.01)),v=this.point,w=v.x,E=v.y,A=Math.cos(Math.PI/2-this._pitch)*y+_,z=Math.min(1.01*A,_*(1/this._horizonShift)),k=this.height/50,D=this._camera.getWorldToCamera(this.worldSize,o),F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,k,z);F[8]=2*-t.x/this.width,F[9]=2*t.y/this.height;let Z=s.mul$1([],F,D);this.mercatorMatrix=s.scale$1([],Z,[this.worldSize,this.worldSize,this.worldSize/o]),this.projMatrix=Z,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const P=new Float32Array(16);s.identity(P),s.scale$1(P,P,[1,-1,1]),s.rotateX(P,P,this._pitch),s.rotateZ(P,P,this.angle);const U=s.perspective(new Float32Array(16),this._fov,this.width/this.height,k,z),$=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-t.x/this.width,U[9]=2*(t.y+$)/this.height,this.skyboxMatrix=s.multiply(P,U,P);const H=this.width%2/2,re=this.height%2/2,N=Math.cos(this.angle),oe=Math.sin(this.angle),ve=w-Math.round(w)+N*H+oe*re,Ie=E-Math.round(E)+N*re+oe*H,j=new Float64Array(Z);if(s.translate(j,j,[ve>.5?ve-1:ve,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=j,Z=s.create$1(),s.scale$1(Z,Z,[this.width/2,-this.height/2,1]),s.translate(Z,Z,[1,-1,0]),this.labelPlaneMatrix=Z,Z=s.create$1(),s.scale$1(Z,Z,[1,-1,1]),s.translate(Z,Z,[-1,-1,0]),s.scale$1(Z,Z,[2/this.width,2/this.height,1]),this.glCoordMatrix=Z,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),Z=s.invert(new Float64Array(16),this.pixelMatrix),!Z)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Z,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,o=this.cameraPixelsPerMeter,c=this._camera.position,p=1/this.height,d=[t,t,o];s.scale(d,d,p),s.scale(c,c,-1),s.multiply$1(c,c,d);const _=s.create$1();s.translate(_,_,c),s.scale$1(_,_,d),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,p)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),o=this.cameraToCenterDistance,c=this.point,p=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-s.mercatorZfromAltitude(this._centerAltitude,this.center.lat),d=this.cameraToCenterDistance/p;this._camera.position=[c.x/this.worldSize-t[0]*o/d,c.y/this.worldSize-t[1]*o/d,s.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*o/d]}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=t[2];let p=1;c>0&&(p=Math.min((o-this._camera.position[2])/c,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,t,p),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:c,bearing:p}=this._camera.getPitchBearing(),d=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat),_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),y=Math.max((t[2]-d)/Math.cos(c),_),v=this._zoomFromMercatorZ(y);s.scaleAndAdd(t,t,o,y),this._pitch=s.clamp(c,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(p,-Math.PI,Math.PI),this._setZoom(s.clamp(v,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new s.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(t,o){const c=Math.min(t.x,o.x),p=Math.max(t.x,o.x),d=Math.min(t.y,o.y),_=Math.max(t.y,o.y),y=[new s.pointGeometry(c,d),new s.pointGeometry(p,_),new s.pointGeometry(c,_),new s.pointGeometry(p,d)],v=this._renderWorldCopies?-3:0,w=this._renderWorldCopies?4:1;for(const E of y){const A=this.pointRayIntersection(E);if(A.t<0)return!0;const z=this.rayIntersectionCoordinate(A);if(z.x<v||z.y<0||z.x>w||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,o){const c=s.length(s.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(c)+o;return c-this._mercatorZfromZoom(p)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,t))}}class ts{constructor(t){this._hashName=t&&encodeURIComponent(t),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(o,c){let p=!1,d=null;const _=()=>{d=null,p&&(o(),d=setTimeout(_,300),p=!1)};return()=>(p=!0,d||_(),d)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const o=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,p),_=Math.round(o.lng*d)/d,y=Math.round(o.lat*d)/d,v=this._map.getBearing(),w=this._map.getPitch();let E="";if(E+=t?`/${_}/${y}/${c}`:`${c}/${y}/${_}`,(v||w)&&(E+="/"+Math.round(10*v)/10),w&&(E+=`/${Math.round(w)}`),this._hashName){const A=this._hashName;let z=!1;const k=s.window.location.hash.slice(1).split("&").map(D=>{const F=D.split("=")[0];return F===A?(z=!0,`${F}=${E}`):D}).filter(D=>D);return z||k.push(`${A}=${E}`),`#${k.join("&")}`}return`#${E}`}_getCurrentHash(){const t=s.window.location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(o=c)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(o=>isNaN(o))){const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:o,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,t)}}const is={linearity:.3,easing:s.bezier(0,0,.3,1)},Ya=s.extend({deceleration:2500,maxSpeed:1400},is),rs=s.extend({deceleration:20,maxSpeed:1400},is),Ys=s.extend({deceleration:1e3,maxSpeed:360},is),Ja=s.extend({deceleration:1e3,maxSpeed:90},is);class Qa{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=s.exported.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)o.zoom+=d.zoomDelta||0,o.bearing+=d.bearingDelta||0,o.pitch+=d.pitchDelta||0,d.panDelta&&o.pan._add(d.panDelta),d.around&&(o.around=d.around),d.pinchAround&&(o.pinchAround=d.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){const d=Mn(o.pan.mag(),c,s.extend({},Ya,t||{}));p.offset=o.pan.mult(d.amount/o.pan.mag()),p.center=this._map.transform.center,Qr(p,d)}if(o.zoom){const d=Mn(o.zoom,c,rs);p.zoom=this._map.transform.zoom+d.amount,Qr(p,d)}if(o.bearing){const d=Mn(o.bearing,c,Ys);p.bearing=this._map.transform.bearing+s.clamp(d.amount,-179,179),Qr(p,d)}if(o.pitch){const d=Mn(o.pitch,c,Ja);p.pitch=this._map.transform.pitch+d.amount,Qr(p,d)}if(p.zoom||p.bearing){const d=o.pinchAround===void 0?o.around:o.pinchAround;p.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),s.extend(p,{noMoveStart:!0})}}function Qr(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Mn(l,t,o){const{maxSpeed:c,linearity:p,deceleration:d}=o,_=s.clamp(l*p/(t/1e3),-c,c),y=Math.abs(_)/(d*p);return{easing:o.easing,duration:1e3*y,amount:_*(y/2)}}class Li extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,c,p={}){const d=O.mousePos(o.getCanvasContainer(),c),_=o.unproject(d);super(t,s.extend({point:d,lngLat:_,originalEvent:c},p)),this._defaultPrevented=!1,this.target=o}}class co extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,c){const p=t==="touchend"?c.changedTouches:c.touches,d=O.touchPos(o.getCanvasContainer(),p),_=d.map(v=>o.unproject(v)),y=d.reduce((v,w,E,A)=>v.add(w.div(A.length)),new s.pointGeometry(0,0));super(t,{points:d,point:y,lngLats:_,lngLat:o.unproject(y),originalEvent:c}),this._defaultPrevented=!1}}class el extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class tl{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new el(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new Li(t.type,this._map,t))}mouseup(t){this._map.fire(new Li(t.type,this._map,t))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Li(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Li(t.type,this._map,t))}mouseover(t){this._map.fire(new Li(t.type,this._map,t))}mouseout(t){this._map.fire(new Li(t.type,this._map,t))}touchstart(t){return this._firePreventable(new co(t.type,this._map,t))}touchmove(t){this._map.fire(new co(t.type,this._map,t))}touchend(t){this._map.fire(new co(t.type,this._map,t))}touchcancel(t){this._map.fire(new co(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class il{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Li(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Li(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zn{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(O.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const c=o;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=O.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(p.x,c.x),_=Math.max(p.x,c.x),y=Math.min(p.y,c.y),v=Math.max(p.y,c.y);this._map._requestDomTask(()=>{this._box&&(O.setTransform(this._box,`translate(${d}px,${y}px)`),this._box.style.width=_-d+"px",this._box.style.height=v-y+"px")})}mouseupWindow(t,o){if(!this._active||t.button!==0)return;const c=this._startPos,p=o;if(this.reset(),O.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(c,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(O.remove(this._box),this._box=null),O.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new s.Event(t,{originalEvent:o}))}}function ns(l,t){const o={};for(let c=0;c<l.length;c++)o[l[c].identifier]=t[c];return o}class rl{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,o,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){const d=new s.pointGeometry(0,0);for(const _ of p)d._add(_);return d.div(p.length)}(o),this.touches=ns(c,o)))}touchmove(t,o,c){if(this.aborted||!this.centroid)return;const p=ns(c,o);for(const d in this.touches){const _=this.touches[d],y=p[d];(!y||y.dist(_)>30)&&(this.aborted=!0)}}touchend(t,o,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class os{constructor(t){this.singleTap=new rl(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,o,c){this.singleTap.touchstart(t,o,c)}touchmove(t,o,c){this.singleTap.touchmove(t,o,c)}touchend(t,o,c){const p=this.singleTap.touchend(t,o,c);if(p){const d=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(p)<30;if(d&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class nl{constructor(){this._zoomIn=new os({numTouches:1,numTaps:2}),this._zoomOut=new os({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,c){this._zoomIn.touchstart(t,o,c),this._zoomOut.touchstart(t,o,c)}touchmove(t,o,c){this._zoomIn.touchmove(t,o,c),this._zoomOut.touchmove(t,o,c)}touchend(t,o,c){const p=this._zoomIn.touchend(t,o,c),d=this._zoomOut.touchend(t,o,c);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(p)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ol={0:1,2:2};class ss{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const c=O.mouseButton(t);this._correctButton(t,c)&&(this._lastPoint=o,this._eventButton=c)}mousemoveWindow(t,o){const c=this._lastPoint;if(c){if(t.preventDefault(),function(p,d){const _=ol[d];return p.buttons===void 0||(p.buttons&_)!==_}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(c,o)}}mouseupWindow(t){this._lastPoint&&O.mouseButton(t)===this._eventButton&&(this._moved&&O.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wi extends ss{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class sl extends ss{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){const c=.8*(o.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){t.preventDefault()}}class pr extends ss{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){const c=-.5*(o.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){t.preventDefault()}}class al{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(t,o,c){return this._calculateTransform(t,o,c)}touchmove(t,o,c){if(this._active&&!(c.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,o,c)}touchend(t,o,c){this._calculateTransform(t,o,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,c){c.length>0&&(this._active=!0);const p=ns(c,o),d=new s.pointGeometry(0,0),_=new s.pointGeometry(0,0);let y=0;for(const w in p){const E=p[w],A=this._touches[w];A&&(d._add(E),_._add(E.sub(A)),y++,p[w]=E)}if(this._touches=p,y<this._minTouches||!_.mag())return;const v=_.div(y);return this._sum._add(v),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(y),panDelta:v}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,o,c){return{}}touchstart(t,o,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,c){if(!this._firstTwoTouches)return;t.preventDefault();const[p,d]=this._firstTwoTouches,_=xr(c,o,p),y=xr(c,o,d);if(!_||!y)return;const v=this._aroundCenter?null:_.add(y).div(2);return this._move([_,y],v,t)}touchend(t,o,c){if(!this._firstTwoTouches)return;const[p,d]=this._firstTwoTouches,_=xr(c,o,p),y=xr(c,o,d);_&&y||(this._active&&O.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xr(l,t,o){for(let c=0;c<l.length;c++)if(l[c].identifier===o)return t[c]}function ll(l,t){return Math.log(l/t)/Math.LN2}class dc extends dr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ll(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ll(this._distance,c),pinchAround:o}}}function cl(l,t){return 180*l.angleWith(t)/Math.PI}class fc extends dr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cl(this._vector,c),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,c=cl(t,this._startVector);return Math.abs(c)<o}}function as(l){return Math.abs(l.y)>Math.abs(l.x)}class ho extends dr{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,as(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,c){const p=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(p,d,c.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+d.y)/2*-.5}}gestureBeginsVertically(t,o,c){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,d=o.mag()>=2;if(!p&&!d)return;if(!p||!d)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const _=t.y>0==o.y>0;return as(t)&&as(o)&&_}}const fr={panStep:100,bearingStep:15,pitchStep:10};class hl{constructor(){const t=fr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,c=0,p=0,d=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:y=>{const v=y.getZoom();y.easeTo({duration:300,easeId:"keyboardHandler",easing:ul,zoom:o?Math.round(v)+o*(t.shiftKey?2:1):v,bearing:y.getBearing()+c*this._bearingStep,pitch:y.getPitch()+p*this._pitchStep,offset:[-d*this._panStep,-_*this._panStep],center:y.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ul(l){return l*(2-l)}const kn=4.000244140625;class Ze{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let o=t.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=s.exported.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,o!==0&&o%kn==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=O.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,o=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const v=this._type==="wheel"&&Math.abs(this._delta)>kn?this._wheelZoomRate:this._defaultZoomRate;let w=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&w!==0&&(w=1/w);const E=o(),A=Math.pow(2,E),z=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):A;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(z*w))),this._type==="wheel"&&(this._startZoom=o(),this._easing=this._smoothOutEasing(200)),this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:o(),p=this._startZoom,d=this._easing;let _,y=!1;if(this._type==="wheel"&&p&&d){const v=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),w=d(v);_=s.number(p,c,w),v<1?this._frameId||(this._frameId=!0):y=!0}else _=c,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:_-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=s.ease;if(this._prevEase){const c=this._prevEase,p=(s.exported.now()-c.start)/c.duration,d=c.easing(p+.01)-c.easing(p),_=.27/Math.sqrt(d*d+1e-4)*.01,y=Math.sqrt(.0729-_*_);o=s.bezier(_,y,.25,1)}return this._prevEase={start:s.exported.now(),duration:t,easing:o},o}reset(){this._active=!1}}class pl{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dl{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,o){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uo{constructor(){this._tap=new os({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,o,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=o[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,o,c))}touchmove(t,o,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=o[0],d=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,o,c)}touchend(t,o,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,o,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class po{constructor(t,o,c){this._el=t,this._mousePan=o,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fl{constructor(t,o,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ml{constructor(t,o,c,p){this._el=t,this._touchZoom=o,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fo=l=>l.zoom||l.drag||l.pitch||l.rotate;class _l extends s.Event{}class gl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const c=s.sub([],o,t);this.radius=s.length(c[2]<0?s.div([],c,this.constants):[c[0],c[1],0])}projectRay(t){s.div(t,t,this.constants),s.normalize(t,t),s.mul$2(t,t,this.constants);const o=s.scale([],t,this.radius);if(o[2]>0){const c=s.scale([],[0,0,1],s.dot(o,[0,0,1])),p=s.scale([],s.normalize([],[o[0],o[1],0]),this.radius),d=s.add([],o,s.scale([],s.sub([],s.add([],p,c),o),2));o[0]=d[0],o[1]=d[1]}return o}}function mo(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class yl{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qa(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new gl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.bindAll(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[p,d,_]of this._listeners)O.addEventListener(p,d,p===s.window.document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,o,c]of this._listeners)O.removeEventListener(t,o,t===s.window.document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const o=this._map,c=o.getCanvasContainer();this._add("mapEvent",new tl(o,t));const p=o.boxZoom=new zn(o,t);this._add("boxZoom",p);const d=new nl,_=new dl;o.doubleClickZoom=new pl(_,d),this._add("tapZoom",d),this._add("clickZoom",_);const y=new uo;this._add("tapDragZoom",y);const v=o.touchPitch=new ho;this._add("touchPitch",v);const w=new sl(t),E=new pr(t);o.dragRotate=new fl(t,w,E),this._add("mouseRotate",w,["mousePitch"]),this._add("mousePitch",E,["mouseRotate"]);const A=new wi(t),z=new al(t);o.dragPan=new po(c,A,z),this._add("mousePan",A),this._add("touchPan",z,["touchZoom","touchRotate"]);const k=new fc,D=new dc;o.touchZoomRotate=new ml(c,D,k,y),this._add("touchRotate",k,["touchPan","touchZoom"]),this._add("touchZoom",D,["touchPan","touchRotate"]),this._add("blockableMapEvent",new il(o));const F=o.scrollZoom=new Ze(o,this);this._add("scrollZoom",F,["mousePan"]);const Z=o.keyboard=new hl;this._add("keyboard",Z);for(const P of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[P]&&o[P].enable(t[P])}_add(t,o,c){this._handlers.push({handlerName:t,handler:o,allowed:c}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(fo(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,o,c){for(const p in t)if(p!==c&&(!o||o.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const c of t)this._el.contains(c.target)&&o.push(c);return o}handleEvent(t,o){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const c=t.type==="renderFrame",p=c?void 0:t,d={needsRenderFrame:!1},_={},y={},v=t.touches?this._getMapTouches(t.touches):void 0,w=v?O.touchPos(this._el,v):c?void 0:O.mousePos(this._el,t);for(const{handlerName:z,handler:k,allowed:D}of this._handlers){if(!k.isEnabled())continue;let F;this._blockedByActive(y,D,z)?k.reset():k[o||t.type]&&(F=k[o||t.type](t,w,v),this.mergeHandlerResult(d,_,F,z,p),F&&F.needsRenderFrame&&this._triggerRenderFrame()),(F||k.isActive())&&(y[z]=k)}const E={};for(const z in this._previousActiveHandlers)y[z]||(E[z]=p);this._previousActiveHandlers=y,(Object.keys(E).length||mo(d))&&(this._changes.push([d,_,E]),this._triggerRenderFrame()),(Object.keys(y).length||mo(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:A}=d;A&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],A(this._map))}mergeHandlerResult(t,o,c,p,d){if(!c)return;s.extend(t,c);const _={handlerName:p,originalEvent:c.originalEvent||d};c.zoomDelta!==void 0&&(o.zoom=_),c.panDelta!==void 0&&(o.drag=_),c.pitchDelta!==void 0&&(o.pitch=_),c.bearingDelta!==void 0&&(o.rotate=_)}_applyChanges(){const t={},o={},c={};for(const[p,d,_]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new s.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),s.extend(o,d),s.extend(c,_);this._updateMapTransform(t,o,c),this._changes=[]}_updateMapTransform(t,o,c){const p=this._map,d=p.transform,_=U=>[U.x,U.y,U.z];if((U=>{const $=this._eventsInProgress.drag;return $&&!this._handlersById[$.handlerName].isActive()})()&&!mo(t)){const U=d.zoom;d.cameraElevationReference="sea",d.recenterOnTerrain(),d.cameraElevationReference="ground",U!==d.zoom&&this._map._update(!0)}if(!mo(t))return this._fireEvents(o,c,!0);let{panDelta:y,zoomDelta:v,bearingDelta:w,pitchDelta:E,around:A,aroundCoord:z,pinchAround:k}=t;k!==void 0&&(A=k),(U=>o.drag&&!this._eventsInProgress.drag)()&&A&&(this._dragOrigin=_(d.pointCoordinate3D(A)),this._trackingEllipsoid.setup(d._camera.position,this._dragOrigin)),d.cameraElevationReference="sea",p._stop(!0),A=A||p.transform.centerPoint,w&&(d.bearing+=w),E&&(d.pitch+=E),d._updateCameraState();const D=[0,0,0];if(y){const U=d.screenPointToMercatorRay(A),$=d.screenPointToMercatorRay(A.sub(y)),H=this._trackingEllipsoid.projectRay(U.dir),re=this._trackingEllipsoid.projectRay($.dir);D[0]=re[0]-H[0],D[1]=re[1]-H[1]}const F=d.zoom,Z=[0,0,0];if(v){const U=_(z||d.pointCoordinate3D(A)),$={dir:s.normalize([],s.sub([],U,d._camera.position))},H=d.screenPointToMercatorRay(d.centerPoint);if($.dir[2]<0){const re=s.altitudeFromMercatorZ(U[2],U[1]),N=d.rayIntersectionCoordinate(d.pointRayIntersection(d.centerPoint,re)),oe=d.zoomDeltaToMovement(_(N),v)*(H.dir[2]/$.dir[2]);s.scale(Z,$.dir,oe)}else if(d._terrainEnabled()){const re=d.zoomDeltaToMovement(U,v);s.scale(Z,$.dir,re)}}const P=s.add(D,D,Z);d._translateCameraConstrained(P),v&&Math.abs(d.zoom-F)>1e-4&&d.recenterOnTerrain(),d.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,c,!0)}_fireEvents(t,o,c){const p=fo(this._eventsInProgress),d=fo(t),_={};for(const E in t){const{originalEvent:A}=t[E];this._eventsInProgress[E]||(_[`${E}start`]=A),this._eventsInProgress[E]=t[E]}!p&&d&&this._fireEvent("movestart",d.originalEvent);for(const E in _)this._fireEvent(E,_[E]);d&&this._fireEvent("move",d.originalEvent);for(const E in t){const{originalEvent:A}=t[E];this._fireEvent(E,A)}const y={};let v;for(const E in this._eventsInProgress){const{handlerName:A,originalEvent:z}=this._eventsInProgress[E];this._handlersById[A].isActive()||(delete this._eventsInProgress[E],v=o[A]||z,y[`${E}end`]=v)}for(const E in y)this._fireEvent(E,y[E]);const w=fo(this._eventsInProgress);if(c&&(p||d)&&!w){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;E?(A(E.bearing||this._map.getBearing())&&(E.bearing=0),this._map.easeTo(E,{originalEvent:v})):(this._map.fire(new s.Event("moveend",{originalEvent:v})),A(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new s.Event(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new _l("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Js extends s.Evented{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,c){return t=s.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,s.extend({offset:t},o),c)}panTo(t,o,c){return this.easeTo(s.extend({center:t},o),c)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,c){return this.easeTo(s.extend({zoom:t},o),c)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,c){return this.easeTo(s.extend({bearing:t},o),c)}resetNorth(t,o){return this.rotateTo(0,s.extend({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=s.LngLatBounds.convert(t);const c=o&&o.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,o)}_extendCameraOptions(t){const o={top:0,bottom:0,right:0,left:0};if(typeof(t=s.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const c=t.padding;t.padding={top:c,bottom:c,right:c,left:c}}return t.padding=s.extend(o,t.padding),t}_cameraForBoxAndBearing(t,o,c,p){const d=this._extendCameraOptions(p),_=this.transform,y=_.padding,v=_.project(s.LngLat.convert(t)),w=_.project(s.LngLat.convert(o)),E=v.rotate(-s.degToRad(c)),A=w.rotate(-s.degToRad(c)),z=new s.pointGeometry(Math.max(E.x,A.x),Math.max(E.y,A.y)),k=new s.pointGeometry(Math.min(E.x,A.x),Math.min(E.y,A.y)),D=z.sub(k),F=(_.width-(y.left+y.right+d.padding.left+d.padding.right))/D.x,Z=(_.height-(y.top+y.bottom+d.padding.top+d.padding.bottom))/D.y;if(Z<0||F<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const P=Math.min(_.scaleZoom(_.scale*Math.min(F,Z)),d.maxZoom),U=typeof d.offset.x=="number"?new s.pointGeometry(d.offset.x,d.offset.y):s.pointGeometry.convert(d.offset),$=new s.pointGeometry((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(c*Math.PI/180),H=U.add($).mult(_.scale/_.zoomScale(P));return{center:_.unproject(v.add(w).div(2).sub(H)),zoom:P,bearing:c}}_cameraForBox(t,o,c,p,d){const _=this._extendCameraOptions(d);c=c||0,p=p||0,t=s.LngLat.convert(t),o=s.LngLat.convert(o);const y=this.transform.clone();y.padding=_.padding;const v=this.getFreeCameraOptions(),w=new s.LngLat(.5*(t.lng+o.lng),.5*(t.lat+o.lat)),E=.5*(c+p);if(y._camera.position[2]<s.mercatorZfromAltitude(E,w.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v.lookAtPoint(w),y.setFreeCameraOptions(v);const A=s.MercatorCoordinate.fromLngLat(t),z=s.MercatorCoordinate.fromLngLat(o),k=y.pointRayIntersection(y.centerPoint,E),D=[(F=y.rayIntersectionCoordinate(k)).x,F.y,F.z];var F;const Z=y.screenPointToMercatorRay(y.centerPoint);let P,U=0;do{const $=Math.floor(y.zoom),H=1<<$,re=Math.min(H*A.x,H*z.x),N=Math.min(H*A.y,H*z.y),oe=Math.max(H*A.x,H*z.x),ve=Math.max(H*A.y,H*z.y),Ie=new be([re,N,c],[oe,ve,p]),j=xe.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,$);if(Ie.intersects(j)!==2){P&&(y._camera.position=s.scaleAndAdd([],y._camera.position,Z.dir,-P),y._updateStateFromCamera());break}const ke=s.sub([],y._camera.position,D);P=.5*s.length(ke),y._camera.position=s.scaleAndAdd([],y._camera.position,Z.dir,P);try{y._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++U<10);return{center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}}fitBounds(t,o,c){return this._fitInternal(this.cameraForBounds(t,o),o,c)}_raycastElevationBox(t,o){const c=this.transform.elevation;if(!c)return;const p=new s.pointGeometry(t.x,o.y),d=new s.pointGeometry(o.x,t.y),_=c.pointCoordinate(t);if(!_)return;const y=c.pointCoordinate(o);if(!y)return;const v=c.pointCoordinate(p);if(!v)return;const w=c.pointCoordinate(d);if(!w)return;const E=new s.MercatorCoordinate(_[0],_[1]).toLngLat(),A=new s.MercatorCoordinate(y[0],y[1]).toLngLat(),z=new s.MercatorCoordinate(v[0],v[1]).toLngLat(),k=new s.MercatorCoordinate(w[0],w[1]).toLngLat(),D=Math.min(E.lng,Math.min(A.lng,Math.min(z.lng,k.lng))),F=Math.min(E.lat,Math.min(A.lat,Math.min(z.lat,k.lat))),Z=Math.max(E.lng,Math.max(A.lng,Math.max(z.lng,k.lng))),P=Math.max(E.lat,Math.max(A.lat,Math.max(z.lat,k.lat))),U=Math.min(_[3],Math.min(y[3],Math.min(v[3],w[3]))),$=Math.max(_[3],Math.max(y[3],Math.max(v[3],w[3])));return{minLngLat:new s.LngLat(D,F),maxLngLat:new s.LngLat(Z,P),minAltitude:U,maxAltitude:$}}fitScreenCoordinates(t,o,c,p,d){let _,y,v,w;const E=s.pointGeometry.convert(t),A=s.pointGeometry.convert(o),z=this._raycastElevationBox(E,A);if(z)_=z.minLngLat,y=z.maxLngLat,v=z.minAltitude,w=z.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(E,A))return this;_=this.transform.pointLocation(E),y=this.transform.pointLocation(A)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(t)),this.transform.pointLocation(s.pointGeometry.convert(o)),c,p):this._cameraForBox(_,y,v,w,p),p,d)}_fitInternal(t,o,c){return t?(delete(o=s.extend(t,o)).padding,o.linear?this.easeTo(o,c):this.flyTo(o,c)):this}jumpTo(t,o){this.stop();const c=this.transform;let p=!1,d=!1,_=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(p=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=s.LngLat.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(d=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(_=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this.fire(new s.Event("movestart",o)).fire(new s.Event("move",o)),p&&this.fire(new s.Event("zoomstart",o)).fire(new s.Event("zoom",o)).fire(new s.Event("zoomend",o)),d&&this.fire(new s.Event("rotatestart",o)).fire(new s.Event("rotate",o)).fire(new s.Event("rotateend",o)),_&&this.fire(new s.Event("pitchstart",o)).fire(new s.Event("pitch",o)).fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){this.stop();const c=this.transform,p=c.zoom,d=c.pitch,_=c.bearing;c.setFreeCameraOptions(t);const y=p!==c.zoom,v=d!==c.pitch,w=_!==c.bearing;return this.fire(new s.Event("movestart",o)).fire(new s.Event("move",o)),y&&this.fire(new s.Event("zoomstart",o)).fire(new s.Event("zoom",o)).fire(new s.Event("zoomend",o)),w&&this.fire(new s.Event("rotatestart",o)).fire(new s.Event("rotate",o)).fire(new s.Event("rotateend",o)),v&&this.fire(new s.Event("pitchstart",o)).fire(new s.Event("pitch",o)).fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=s.extend({offset:[0,0],duration:500,easing:s.ease},t)).animate===!1||!t.essential&&s.exported.prefersReducedMotion)&&(t.duration=0);const c=this.transform,p=this.getZoom(),d=this.getBearing(),_=this.getPitch(),y=this.getPadding(),v="zoom"in t?+t.zoom:p,w="bearing"in t?this._normalizeBearing(t.bearing,d):d,E="pitch"in t?+t.pitch:_,A="padding"in t?t.padding:c.padding,z=s.pointGeometry.convert(t.offset);let k=c.centerPoint.add(z);const D=c.pointLocation(k),F=s.LngLat.convert(t.center||D);this._normalizeCenter(F);const Z=c.project(D),P=c.project(F).sub(Z),U=c.zoomScale(v-p);let $,H;t.around&&($=s.LngLat.convert(t.around),H=c.locationPoint($));const re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||v!==p,this._rotating=this._rotating||d!==w,this._pitching=this._pitching||E!==_,this._padding=!c.isPaddingEqual(A),this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,re),this._ease(N=>{if(this._zooming&&(c.zoom=s.number(p,v,N)),this._rotating&&(c.bearing=s.number(d,w,N)),this._pitching&&(c.pitch=s.number(_,E,N)),this._padding&&(c.interpolatePadding(y,A,N),k=c.centerPoint.add(z)),$)c.setLocationAtPoint($,H);else{const oe=c.zoomScale(c.zoom-p),ve=v>p?Math.min(2,U):Math.max(.5,U),Ie=Math.pow(ve,1-N),j=c.unproject(Z.add(P.mult(N*Ie)).mult(oe));c.setLocationAtPoint(c.renderWorldCopies?j.wrap():j,k)}this._fireMoveEvents(o)},N=>{c.recenterOnTerrain(),this._afterEase(o,N)},t),this}_prepareEase(t,o,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||c.moving||this.fire(new s.Event("movestart",t)),this._zooming&&!c.zooming&&this.fire(new s.Event("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new s.Event("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new s.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.Event("move",t)),this._zooming&&this.fire(new s.Event("zoom",t)),this._rotating&&this.fire(new s.Event("rotate",t)),this._pitching&&this.fire(new s.Event("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId,this.transform.cameraElevationReference="ground";const c=this._zooming,p=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new s.Event("zoomend",t)),p&&this.fire(new s.Event("rotateend",t)),d&&this.fire(new s.Event("pitchend",t)),this.fire(new s.Event("moveend",t))}flyTo(t,o){if(!t.essential&&s.exported.prefersReducedMotion){const Ge=s.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ge,o)}this.stop(),t=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},t);const c=this.transform,p=this.getZoom(),d=this.getBearing(),_=this.getPitch(),y=this.getPadding(),v="zoom"in t?s.clamp(+t.zoom,c.minZoom,c.maxZoom):p,w="bearing"in t?this._normalizeBearing(t.bearing,d):d,E="pitch"in t?+t.pitch:_,A="padding"in t?t.padding:c.padding,z=c.zoomScale(v-p),k=s.pointGeometry.convert(t.offset);let D=c.centerPoint.add(k);const F=c.pointLocation(D),Z=s.LngLat.convert(t.center||F);this._normalizeCenter(Z);const P=c.project(F),U=c.project(Z).sub(P);let $=t.curve;const H=Math.max(c.width,c.height),re=H/z,N=U.mag();if("minZoom"in t){const Ge=s.clamp(Math.min(t.minZoom,p,v),c.minZoom,c.maxZoom),He=H/c.zoomScale(Ge-p);$=Math.sqrt(He/N*2)}const oe=$*$;function ve(Ge){const He=(re*re-H*H+(Ge?-1:1)*oe*oe*N*N)/(2*(Ge?re:H)*oe*N);return Math.log(Math.sqrt(He*He+1)-He)}function Ie(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function j(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const ke=ve(0);let ze=function(Ge){return j(ke)/j(ke+$*Ge)},Ye=function(Ge){return H*((j(ke)*(Ie(He=ke+$*Ge)/j(He))-Ie(ke))/oe)/N;var He},We=(ve(1)-ke)/$;if(Math.abs(N)<1e-6||!isFinite(We)){if(Math.abs(H-re)<1e-6)return this.easeTo(t,o);const Ge=re<H?-1:1;We=Math.abs(Math.log(re/H))/$,Ye=function(){return 0},ze=function(He){return Math.exp(Ge*$*He)}}return t.duration="duration"in t?+t.duration:1e3*We/("screenSpeed"in t?+t.screenSpeed/$:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==w,this._pitching=E!==_,this._padding=!c.isPaddingEqual(A),this._prepareEase(o,!1),this._ease(Ge=>{const He=Ge*We,nt=1/ze(He);c.zoom=Ge===1?v:p+c.scaleZoom(nt),this._rotating&&(c.bearing=s.number(d,w,Ge)),this._pitching&&(c.pitch=s.number(_,E,Ge)),this._padding&&(c.interpolatePadding(y,A,Ge),D=c.centerPoint.add(k));const St=Ge===1?Z:c.unproject(P.add(U.mult(Ye(He))).mult(nt));c.setLocationAtPoint(c.renderWorldCopies?St.wrap():St,D),c._updateCenterElevation(),this._fireMoveEvents(o)},()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,o,c){c.animate===!1||c.duration===0?(t(1),o()):(this._easeStart=s.exported.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=s.wrap(t,-180,180);const c=Math.abs(t-o);return Math.abs(t-360-o)<c&&(t-=360),Math.abs(t+360-o)<c&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const c=t.lng-o.center.lng;t.lng+=c>180?-360:c<-180?360:0}}class ls{constructor(t={}){this.options=t,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact;return this._map=t,this._container=O.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=O.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=O.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){O.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const c=this._map._getUIString(`AttributionControl.${o}`);t.title=c,t.setAttribute("aria-label",c)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(t){const c=o.reduce((p,d,_)=>(d.value&&(p+=`${d.key}=${d.value}${_<o.length-1?"&":""}`),p),"?");t.href=`${s.config.FEEDBACK_URL}/${c}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const o=this._map.style._sourceCaches;for(const p in o){const d=o[p];if(d.used){const _=d.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t.sort((p,d)=>p.length-d.length),t=t.filter((p,d)=>{for(let _=d+1;_<t.length;_++)if(t[_].indexOf(p)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class _o{constructor(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=O.create("div","mapboxgl-ctrl");const o=O.create("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){O.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const c=t[o].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Qs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,c=o?this._queue.concat(o):this._queue;for(const p of c)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const c of o)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ea(l,t,o){if(l=new s.LngLat(l.lng,l.lat),t){const c=new s.LngLat(l.lng-360,l.lat),p=new s.LngLat(l.lng+360,l.lat),d=360*Math.ceil(Math.abs(l.lng-o.center.lng)/360),_=o.locationPoint(l).distSqr(t),y=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint(c).distSqr(t)<_&&(y||Math.abs(c.lng-o.center.lng)<d)?l=c:o.locationPoint(p).distSqr(t)<_&&(y||Math.abs(p.lng-o.center.lng)<d)&&(l=p)}for(;Math.abs(l.lng-o.center.lng)>180;){const c=o.locationPoint(l);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;l.lng>o.center.lng?l.lng-=360:l.lng+=360}return l}const cs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ta(l,t,o){const c=l.classList;for(const p in cs)c.remove(`mapboxgl-${o}-anchor-${p}`);c.add(`mapboxgl-${o}-anchor-${t}`)}class hs extends s.Evented{constructor(t,o){if(super(),(t instanceof s.window.HTMLElement||o)&&(t=s.extend({element:t},o)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=O.create("div"),this._element.setAttribute("aria-label","Map marker");const c=O.createNS("http://www.w3.org/2000/svg","svg"),p=41,d=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${p}px`),c.setAttributeNS(null,"width",`${d}px`),c.setAttributeNS(null,"viewBox",`0 0 ${d} ${p}`);const _=O.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const y=O.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const v=O.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const w=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const U of w){const $=O.createNS("http://www.w3.org/2000/svg","ellipse");$.setAttributeNS(null,"opacity","0.04"),$.setAttributeNS(null,"cx","10.5"),$.setAttributeNS(null,"cy","5.80029008"),$.setAttributeNS(null,"rx",U.rx),$.setAttributeNS(null,"ry",U.ry),v.appendChild($)}const E=O.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const A=O.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(A);const z=O.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const k=O.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(k);const D=O.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(6.0, 7.0)"),D.setAttributeNS(null,"fill","#FFFFFF");const F=O.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Z=O.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");const P=O.createNS("http://www.w3.org/2000/svg","circle");P.setAttributeNS(null,"fill","#FFFFFF"),P.setAttributeNS(null,"cx","5.5"),P.setAttributeNS(null,"cy","5.5"),P.setAttributeNS(null,"r","5.4999962"),F.appendChild(Z),F.appendChild(P),y.appendChild(v),y.appendChild(E),y.appendChild(z),y.appendChild(D),y.appendChild(F),c.appendChild(y),c.setAttributeNS(null,"height",p*this._scale+"px"),c.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(c),this._offset=s.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),ta(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),O.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const o=t.code,c=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,c=this._element;this._popup&&(o===c||c.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const o=this._map.unproject(t);let c=!1;if(this._map.getTerrain()){const d=this._map.getFreeCameraOptions();if(d.position){const _=d.position.toLngLat();c=_.distanceTo(o)<.9*_.distanceTo(this._lngLat)}}const p=(1-this._map._queryFogOpacity(o))*(c?.2:1);this._element.style.opacity=`${p}`,this._popup&&this._popup._setOpacity(`${p}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const o=this._map.transform;return!!t&&t.x>=0&&t.x<o.width&&t.y>=0&&t.y<o.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ea(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let o="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?o=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(o=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let c="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?c="rotateX(0deg)":this._pitchAlignment==="map"&&(c=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&O.setTransform(this._element,`${cs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${c} ${o}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,o=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&o._rotate(t.angle),this._pitchAlignment==="map"&&(o.y*=Math.cos(t._pitch)),o}getOffset(){return this._offset}setOffset(t){return this._offset=s.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class xl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=s.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,c){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+c}}const vl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Pn,HTMLElement:bl,ImageBitmap:en}=s.window,wl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function us(l){l.parentNode&&l.parentNode.removeChild(l)}const ia={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tl{constructor(t,o,c=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new sl({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new pr({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),O.addEventListener(o,"mousedown",this.mousedown),O.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),O.addEventListener(o,"touchmove",this.touchmove),O.addEventListener(o,"touchend",this.touchend),O.addEventListener(o,"touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),O.disableDrag()}move(t,o){const c=this.map,p=this.mouseRotate.mousemoveWindow(t,o);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){const d=this.mousePitch.mousemoveWindow(t,o);d&&d.pitchDelta&&c.setPitch(c.getPitch()+d.pitchDelta)}}off(){const t=this.element;O.removeEventListener(t,"mousedown",this.mousedown),O.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),O.removeEventListener(t,"touchmove",this.touchmove),O.removeEventListener(t,"touchend",this.touchend),O.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){O.enableDrag(),O.removeEventListener(s.window,"mousemove",this.mousemove),O.removeEventListener(s.window,"mouseup",this.mouseup)}mousedown(t){this.down(s.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),O.mousePos(this.element,t)),O.addEventListener(s.window,"mousemove",this.mousemove),O.addEventListener(s.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,O.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=O.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=O.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ra={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let tn,Dn=0,rn=!1;const na={maxWidth:100,unit:"metric"};function El(l,t,o){const c=o&&o.maxWidth||100,p=l._container.clientHeight/2,d=l.unproject([0,p]),_=l.unproject([c,p]),y=d.distanceTo(_);if(o&&o.unit==="imperial"){const v=3.2808*y;v>5280?go(t,c,v/5280,l._getUIString("ScaleControl.Miles"),l):go(t,c,v,l._getUIString("ScaleControl.Feet"),l)}else o&&o.unit==="nautical"?go(t,c,y/1852,l._getUIString("ScaleControl.NauticalMiles"),l):y>=1e3?go(t,c,y/1e3,l._getUIString("ScaleControl.Kilometers"),l):go(t,c,y,l._getUIString("ScaleControl.Meters"),l)}function go(l,t,o,c,p){const d=function(y){const v=Math.pow(10,`${Math.floor(y)}`.length-1);let w=y/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A}(w),v*w}(o),_=d/o;p._requestDomTask(()=>{l.style.width=t*_+"px",l.innerHTML=`${d}&nbsp;${c}`})}const oa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Sl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sa(l){if(l){if(typeof l=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(l,2)));return{center:new s.pointGeometry(0,0),top:new s.pointGeometry(0,l),"top-left":new s.pointGeometry(t,t),"top-right":new s.pointGeometry(-t,t),bottom:new s.pointGeometry(0,-l),"bottom-left":new s.pointGeometry(t,-t),"bottom-right":new s.pointGeometry(-t,-t),left:new s.pointGeometry(l,0),right:new s.pointGeometry(-l,0)}}if(l instanceof s.pointGeometry||Array.isArray(l)){const t=s.pointGeometry.convert(l);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.pointGeometry.convert(l.center||[0,0]),top:s.pointGeometry.convert(l.top||[0,0]),"top-left":s.pointGeometry.convert(l["top-left"]||[0,0]),"top-right":s.pointGeometry.convert(l["top-right"]||[0,0]),bottom:s.pointGeometry.convert(l.bottom||[0,0]),"bottom-left":s.pointGeometry.convert(l["bottom-left"]||[0,0]),"bottom-right":s.pointGeometry.convert(l["bottom-right"]||[0,0]),left:s.pointGeometry.convert(l.left||[0,0]),right:s.pointGeometry.convert(l.right||[0,0])}}return sa(new s.pointGeometry(0,0))}const ps={version:s.version,supported:J,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Js{constructor(l){if((l=s.extend({},wl,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ks(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._renderTaskQueue=new Qs,this._domRenderTaskQueue=new Qs,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},vl,l.locale),this._clickTolerance=l.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new xl(0),this._requestManager=new s.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,typeof l.container=="string"){if(this._container=s.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof bl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yl(this,l),this._hash=l.hash&&new ts(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,s.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.attributionControl&&this.addControl(new ls({customAttribution:l.customAttribution})),this._logoControl=new _o,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new s.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new s.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(o,c.firstChild):c.appendChild(o),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}resize(l){const t=this._containerDimensions(),o=t[0],c=t[1];this._resizeCanvas(o,c),this.transform.resize(o,c),this.painter.resize(o,c);const p=!this._moving;return p&&(this.stop(),this.fire(new s.Event("movestart",l)).fire(new s.Event("move",l))),this.fire(new s.Event("resize",l)),p&&this.fire(new s.Event("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(l){return this.transform.setMaxBounds(s.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l==null?-2:l)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l&&this.setZoom(l),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l==null?22:l)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l&&this.setZoom(l),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l==null?0:l)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l&&this.setPitch(l),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l==null?85:l)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l&&this.setPitch(l),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this._update()}project(l){return this.transform.locationPoint3D(s.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(s.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(l,t,o){if(l==="mouseenter"||l==="mouseover"){let c=!1;return{layer:t,listener:o,delegates:{mousemove:d=>{const _=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];_.length?c||(c=!0,o.call(this,new Li(l,this,d.originalEvent,{features:_}))):c=!1},mouseout:()=>{c=!1}}}}if(l==="mouseleave"||l==="mouseout"){let c=!1;return{layer:t,listener:o,delegates:{mousemove:_=>{(this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[]).length?c=!0:c&&(c=!1,o.call(this,new Li(l,this,_.originalEvent)))},mouseout:_=>{c&&(c=!1,o.call(this,new Li(l,this,_.originalEvent)))}}}}{const c=p=>{const d=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];d.length&&(p.features=d,o.call(this,p),delete p.features)};return{layer:t,listener:o,delegates:{[l]:c}}}}on(l,t,o){if(o===void 0)return super.on(l,t);const c=this._createDelegatedListener(l,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const p in c.delegates)this.on(p,c.delegates[p]);return this}once(l,t,o){if(o===void 0)return super.once(l,t);const c=this._createDelegatedListener(l,t,o);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(l,t,o){return o===void 0?super.off(l,t):(this._delegatedListeners&&this._delegatedListeners[l]&&(c=>{const p=this._delegatedListeners[l];for(let d=0;d<p.length;d++){const _=p[d];if(_.layer===t&&_.listener===o){for(const y in _.delegates)this.off(y,_.delegates[y]);return p.splice(d,1),this}}})(),this)}queryRenderedFeatures(l,t){return this.style?(t!==void 0||l===void 0||l instanceof s.pointGeometry||Array.isArray(l)||(t=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(l,t){return this.style.querySourceFeatures(l,t)}setStyle(l,t){return(t=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),l&&(this.style=new ur(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ur(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,t){if(typeof l=="string"){const o=this._requestManager.normalizeStyleURL(l),c=this._requestManager.transformRequest(o,s.ResourceType.Style);s.getJSON(c,(p,d)=>{p?this.fire(new s.ErrorEvent(p)):d&&this._updateDiff(d,t)})}else typeof l=="object"&&this._updateDiff(l,t)}_updateDiff(l,t){try{this.style.setState(l)&&this._update(!0)}catch(o){s.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(l,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")}addSource(l,t){return this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)}isSourceLoaded(l){const t=this.style&&this.style._getSourceCaches(l);if(t.length!==0)return t.every(o=>o.loaded());this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${l}'`)))}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const t in l){const o=l[t]._tiles;for(const c in o){const p=o[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(l,t,o){return this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,o)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,t,{pixelRatio:o=1,sdf:c=!1,stretchX:p,stretchY:d,content:_}={}){if(this._lazyInitEmptyStyle(),t instanceof Pn||en&&t instanceof en){const{width:y,height:v,data:w}=s.exported.getImageData(t);this.style.addImage(l,{data:new s.RGBAImage({width:y,height:v},w),pixelRatio:o,stretchX:p,stretchY:d,content:_,sdf:c,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:y,height:v,data:w}=t,E=t;this.style.addImage(l,{data:new s.RGBAImage({width:y,height:v},new Uint8Array(w)),pixelRatio:o,stretchX:p,stretchY:d,content:_,sdf:c,version:0,userImage:E}),E.onAdd&&E.onAdd(this,l)}}}updateImage(l,t){const o=this.style.getImage(l);if(!o)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof Pn||en&&t instanceof en?s.exported.getImageData(t):t,{width:p,height:d,data:_}=c;return p===void 0||d===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):p!==o.data.width||d!==o.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(o.data.replace(_,!(t instanceof Pn||en&&t instanceof en)),void this.style.updateImage(l,o))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){s.getImage(this._requestManager.transformRequest(l,s.ResourceType.Image),(o,c)=>{t(o,c instanceof Pn?s.exported.getImageData(c):c)})}listImages(){return this.style.listImages()}addLayer(l,t){return this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)}moveLayer(l,t){return this.style.moveLayer(l,t),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,t,o){return this.style.setLayerZoomRange(l,t,o),this._update(!0)}setFilter(l,t,o={}){return this.style.setFilter(l,t,o),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,t,o,c={}){return this.style.setPaintProperty(l,t,o,c),this._update(!0)}getPaintProperty(l,t){return this.style.getPaintProperty(l,t)}setLayoutProperty(l,t,o,c={}){return this.style.setLayoutProperty(l,t,o,c),this._update(!0)}getLayoutProperty(l,t){return this.style.getLayoutProperty(l,t)}setLight(l,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(l),this.transform):0}queryTerrainElevation(l,t){const o=this.transform.elevation;return o?(t=s.extend({},{exaggerated:!0},t),o.getAtPoint(s.MercatorCoordinate.fromLngLat(l),null,t.exaggerated)):null}setFeatureState(l,t){return this.style.setFeatureState(l,t),this._update()}removeFeatureState(l,t){return this.style.removeFeatureState(l,t),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let l=0,t=0;return this._container&&(l=this._container.clientWidth||400,t=this._container.clientHeight||300),[l,t]}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=O.create("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=O.create("div","mapboxgl-canvas-container",l);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=O.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions();this._resizeCanvas(o[0],o[1]);const c=this._controlContainer=O.create("div","mapboxgl-control-container",l),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{p[d]=O.create("div",`mapboxgl-ctrl-${d}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const o=s.exported.devicePixelRatio||1;this._canvas.width=o*l,this._canvas.height=o*t,this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const l=s.extend({},J.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);t?(s.storeAuthState(t,!0),this.painter=new Ka(t,this.transform),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(t)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.isMoving()&&this.loaded()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;const o=this.painter.context.extTimerQuery,c=s.exported.now();this.listens("gpu-timing-frame")&&(t=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,t));let p=this._updateAverageElevation(c);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;let d=!1;const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,w=s.exported.now();this.style.zoomHistory.update(v,w);const E=new s.EvaluationParameters(v,{now:w,fadeDuration:_,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=E.crossFadingFactor();A===1&&A===this._crossFadingFactor||(d=!0,this._crossFadingFactor=A),this.style.update(E)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const v=s.exported.now()-c;o.endQueryEXT(o.TIME_ELAPSED_EXT,t),setTimeout(()=>{const w=o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(t),this.fire(new s.Event("gpu-timing-frame",{cpuTime:v,gpuTime:w}))},50)}if(this.listens("gpu-timing-layer")){const v=this.painter.collectGpuTimers();setTimeout(()=>{const w=this.painter.queryGpuTimers(v);this.fire(new s.Event("gpu-timing-layer",{layerTimes:w}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty||p;if(y||this._repaint)this.triggerRepaint();else{const v=!this.isMoving()&&this.loaded();if(v&&(p=this._updateAverageElevation(c,!0)),p)this.triggerRepaint();else if(this._triggerFrame(!1),v&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const w=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:w})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,this._authenticate()),this}_updateAverageElevation(l,t=!1){const o=c=>(this.transform.averageElevation=c,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const c=this.transform.averageElevation;let p=this.transform.sampleAverageElevation();isNaN(p)?p=0:this._averageElevationLastSampledAt=l;const d=Math.abs(c-p);if(d>1)this._averageElevation.easeTo(p,l,300);else if(d>1e-4)return this._averageElevation.jumpTo(p),o(p)}return!!this._averageElevation.isEasing(l)&&o(this._averageElevation.getValue(l))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===s.AUTH_ERR_MSG||l.status===401)){const t=this.painter.context.gl;s.storeAuthState(t,!1),this._logoControl instanceof _o&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,c=o.createFramebuffer();function p(d){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,d,0);const _=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,_),_}return o.bindFramebuffer(o.FRAMEBUFFER,c),this._canvasPixelComparison(p(l),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(l,t,o){let c=o[1]-o[0];const p=l.length/4;for(let d=0;d<t.length;d++){const _=t[d];let y=0;for(let v=0;v<_.length;v+=4)_[v]===l[v]&&_[v+1]===l[v+1]&&_[v+2]===l[v+2]&&_[v+3]===l[v+3]&&(y+=1);c+=(o[d+2]-o[d+1])*(1-y/p)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),us(this._canvasContainer),us(this._controlContainer),us(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=s.exported.frame(t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}_setCacheLimits(l,t){s.setCacheLimits(l,t)}get version(){return s.version}},NavigationControl:class{constructor(l){this.options=s.extend({},ia,l),this._container=O.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),O.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),O.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=O.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const l=this._map.getZoom(),t=l===this._map.getMaxZoom(),o=l===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())}_rotateCompassArrow(){const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){O.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(l,t){const o=O.create("button",l,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(l,t){const o=this._map._getUIString(`NavigationControl.${t}`);l.title=o,l.setAttribute("aria-label",o)}},GeolocateControl:class extends s.Evented{constructor(l){super(),this.options=s.extend({},ra,l),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(l){var t;return this._map=l,this._container=O.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,tn!==void 0?t(tn):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(o=>{tn=o.state!=="denied",t(tn)}):(tn=!!s.window.navigator.geolocation,t(tn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),O.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Dn=0,rn=!1}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),o=l.coords;return t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",l)),this._finish()}}_updateCamera(l){const t=new s.LngLat(l.coords.longitude,l.coords.latitude),o=l.coords.accuracy,c=this._map.getBearing(),p=s.extend({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),p,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new s.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map._container.clientHeight/2,t=this._map.unproject([0,l]),o=this._map.unproject([100,l]),c=t.distanceTo(o)/100,p=Math.ceil(2*this._accuracy/c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&rn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=O.create("button","mapboxgl-ctrl-geolocate",this._container),O.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",l===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new hs(this._dotElement),this._circleElement=O.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Dn--,rn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Dn++,Dn>1?(l={maximumAge:6e5,timeout:0},rn=!0):(l=this.options.positionOptions,rn=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ls,ScaleControl:class{constructor(l){this.options=s.extend({},na,l),s.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){El(this._map,this._container,this.options)}onAdd(l){return this._map=l,this._container=O.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){O.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(l){this.options.unit=l,El(this._map,this._container,this.options)}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof s.window.HTMLElement?this._container=l.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=O.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){O.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=O.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);O.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(l){super(),this.options=s.extend(Object.create(oa),l),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&O.remove(this._content),this._container&&(O.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(s.window.document.createTextNode(l))}setHTML(l){const t=s.window.document.createDocumentFragment(),o=s.window.document.createElement("body");let c;for(o.innerHTML=l;c=o.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=O.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(l),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(l){this._container&&this._container.classList.add(l)}removeClassName(l){this._container&&this._container.classList.remove(l)}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){if(this._container)return this._container.classList.toggle(l)}_createCloseButton(){this.options.closeButton&&(this._closeButton=O.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(l){this._update(l.point)}_onMouseMove(l){this._update(l.point)}_onDrag(l){this._update(l.point)}_update(l){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=O.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=O.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(d=>this._container.classList.add(d)),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ea(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!l))return;const t=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);let o=this.options.anchor;const c=sa(this.options.offset);if(!o){const d=this._container.offsetWidth,_=this._container.offsetHeight;let y;y=t.y+c.bottom.y<_?["top"]:t.y>this._map.transform.height-_?["bottom"]:[],t.x<d/2?y.push("left"):t.x>this._map.transform.width-d/2&&y.push("right"),o=y.length===0?"bottom":y.join("-")}const p=t.add(c[o]).round();this._map._requestDomTask(()=>{this._container&&o&&(O.setTransform(this._container,`${cs[o]} translate(${p.x}px,${p.y}px)`),ta(this._container,o,"popup"))})}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(Sl);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._content&&(this._content.style.opacity=l),this._tip&&(this._tip.style.opacity=l)}},Marker:hs,Style:ur,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:ao,Evented:s.Evented,config:s.config,prewarm:function(){Ve().acquire(te)},clearPrewarmedResources:function(){const l=we;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(te),we=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(l){s.config.ACCESS_TOKEN=l},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(l){s.config.API_URL=l},get workerCount(){return le.workerCount},set workerCount(l){le.workerCount=l},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){s.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return ps});var fe=ot;return fe})})(bp);var Aa=bp.exports,Tp={exports:{}};(function(qn,pn){(function(Oe){qn.exports=Oe()})(function(){return function(){function Oe(Ne,ot,de){function fe(ee,me){if(!ot[ee]){if(!Ne[ee]){var X=typeof ec=="function"&&ec;if(!me&&X)return X(ee,!0);if(s)return s(ee,!0);var O=new Error("Cannot find module '"+ee+"'");throw O.code="MODULE_NOT_FOUND",O}var ie=ot[ee]={exports:{}};Ne[ee][0].call(ie.exports,function(_e){return fe(Ne[ee][1][_e]||_e)},ie,ie.exports,Oe,Ne,ot,de)}return ot[ee].exports}for(var s=typeof ec=="function"&&ec,J=0;J<de.length;J++)fe(de[J]);return fe}return Oe}()({1:[function(Oe,Ne,ot){function de(s){this.origin=s.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=s.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=s,this.send=this.send.bind(this),this.countries=s.countries?s.countries.split(","):null,this.types=s.types?s.types.split(","):null,this.bbox=s.bbox?s.bbox:null,this.language=s.language?s.language.split(","):null,this.limit=s.limit?+s.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(s),this.eventQueue=new Array,this.flushInterval=s.flushInterval||1e3,this.maxQueueSize=s.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}var fe=Oe("nanoid");de.prototype={select:function(s,J){var ee=this.getSelectedIndex(s,J),me=this.getEventPayload("search.select",J);if(me.resultIndex=ee,me.resultPlaceName=s.place_name,me.resultId=s.id,(ee!==this.lastSentIndex||me.queryString!==this.lastSentInput)&&ee!=-1&&(this.lastSentIndex=ee,this.lastSentInput=me.queryString,me.queryString))return this.push(me)},start:function(s){var J=this.getEventPayload("search.start",s);if(J.queryString)return this.push(J)},keyevent:function(s,J){if(s.key&&!s.metaKey&&[9,27,37,39,13,38,40].indexOf(s.keyCode)===-1){var ee=this.getEventPayload("search.keystroke",J);if(ee.lastAction=s.key,ee.queryString)return this.push(ee)}},send:function(s,J){if(this.enableEventLogging){var ee=this.getRequestOptions(s);this.request(ee,function(me){return me?this.handleError(me,J):J?J():void 0}.bind(this))}else if(J)return J()},getRequestOptions:function(s){return Array.isArray(s)||(s=[s]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}},getEventPayload:function(s,J){var ee;ee=J.options.proximity?[J.options.proximity.longitude,J.options.proximity.latitude]:null;var me=J._map?J._map.getZoom():void 0,X={event:s,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:J.options.autocomplete,fuzzyMatch:J.options.fuzzyMatch,proximity:ee,limit:J.options.limit,routing:J.options.routing,worldview:J.options.worldview,mapZoom:me,keyboardLocale:this.locale};return s==="search.select"?X.queryString=J.inputString:s!="search.select"&&J._inputEl?X.queryString=J._inputEl.value:X.queryString=J.inputString,X},request:function(s,J){var ee=new XMLHttpRequest;ee.onreadystatechange=function(){if(this.readyState==4)return J(this.status==204?null:this.statusText)},ee.open(s.method,s.host+"/"+s.path,!0);for(var me in s.headers){var X=s.headers[me];ee.setRequestHeader(me,X)}ee.send(s.body)},handleError:function(s,J){if(J)return J(s)},generateSessionID:function(){return fe()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(s,J){if(J._typeahead){var ee=J._typeahead.data,me=s.id;return ee.map(function(X){return X.id}).indexOf(me)}},shouldEnableLogging:function(s){return s.enableEventLogging!==!1&&(!s.origin||s.origin.indexOf("api.mapbox.com")!=-1)&&!s.localGeocoder&&!s.filter},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(s,J){this.eventQueue.push(s),(this.eventQueue.length>=this.maxQueueSize||J)&&this.flush()},remove:function(){this.flush()}},Ne.exports=de},{nanoid:30}],2:[function(Oe,Ne,ot){Ne.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},{}],3:[function(Oe,Ne,ot){function de(G){this._eventEmitter=new ee,this.options=J({},this.options,G),this.inputString="",this.fresh=!0,this.lastSelected=null}var fe=Oe("suggestions"),s=Oe("lodash.debounce"),J=Oe("xtend"),ee=Oe("events").EventEmitter,me=Oe("./exceptions"),X=Oe("@mapbox/mapbox-sdk"),O=Oe("@mapbox/mapbox-sdk/services/geocoding"),ie=Oe("./events"),_e=Oe("./localization"),De=Oe("subtag");const Fe={FORWARD:0,LOCAL:1,REVERSE:2};de.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(G){return G.place_name},render:function(G){var Q=G.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+Q[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+Q.splice(1,Q.length).join(",")+"</div></div>"}},addTo:function(G){function Q(ye,xe){if(!document.body.contains(xe))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const be=ye.onAdd();xe.appendChild(be)}if(G._controlContainer)G.addControl(this);else if(G instanceof HTMLElement)Q(this,G);else{if(typeof G!="string")throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");const ye=document.querySelectorAll(G);if(ye.length===0)throw new Error("Element ",G,"not found.");if(ye.length>1)throw new Error("Geocoder can only be added to a single html element");Q(this,ye[0])}},onAdd:function(G){if(G&&typeof G!="string"&&(this._map=G),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=O(X({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ie(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var Q=this.container=document.createElement("div");Q.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var ye=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",s(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(Be){this.eventManager.keyevent(Be,this)}.bind(this));var xe=document.createElement("div");xe.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var be=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(be),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),xe.appendChild(this._clearEl),xe.appendChild(this._loadingEl),Q.appendChild(ye),Q.appendChild(this._inputEl),Q.appendChild(xe),this._typeahead=new fe(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),Q},createIcon:function(G,Q){var ye=document.createElementNS("http://www.w3.org/2000/svg","svg");if(ye.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+G),ye.setAttribute("viewBox","0 0 18 18"),ye.setAttribute("xml:space","preserve"),ye.setAttribute("width",18),ye.setAttribute("height",18),"innerHTML"in ye)ye.innerHTML=Q;else{var xe=document.createElement("div");xe.innerHTML="<svg>"+Q.valueOf().toString()+"</svg>";var be=xe.firstChild,Be=be.firstChild;ye.appendChild(Be)}return ye},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(G){var Q=(G.clipboardData||window.clipboardData).getData("text");Q.length>=this.options.minLength&&this._geocode(Q)},_onKeyDown:function(G){if(G.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(G),this._inputEl.blur();var Q=G.target&&G.target.shadowRoot?G.target.shadowRoot.activeElement:G.target;if(!(Q&&Q.value))return this.fresh=!0,G.keyCode!==9&&this.clear(G),this._clearEl.style.display="none";G.metaKey||[9,27,37,39,13,38,40].indexOf(G.keyCode)!==-1||Q.value.length>=this.options.minLength&&this._geocode(Q.value)},_showButton:function(){this._typeahead.selected&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(G){this.options.clearOnBlur&&this._clearOnBlur(G),this.options.collapsed&&this._collapse()},_onChange:function(){var G=this._typeahead.selected;if(G&&JSON.stringify(G)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var Q;if(G.properties&&me[G.properties.short_code])Q=J({},this.options.flyTo),this._map&&this._map.fitBounds(me[G.properties.short_code].bbox,Q);else if(G.bbox){var ye=G.bbox;Q=J({},this.options.flyTo),this._map&&this._map.fitBounds([[ye[0],ye[1]],[ye[2],ye[3]]],Q)}else{var xe={zoom:this.options.zoom};Q=J({},xe,this.options.flyTo),G.center?Q.center=G.center:G.geometry&&G.geometry.type&&G.geometry.type==="Point"&&G.geometry.coordinates&&(Q.center=G.geometry.coordinates),this._map&&this._map.flyTo(Q)}}this.options.marker&&this._mapboxgl&&this._handleMarker(G),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(G),this._eventEmitter.emit("result",{result:G}),this.eventManager.select(G,this)}},_requestType:function(G,Q){const ye=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return G.localGeocoderOnly?Fe.LOCAL:G.reverseGeocode&&ye.test(Q)?Fe.REVERSE:Fe.FORWARD},_setupConfig:function(G,Q){const ye=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],xe=/[\s,]+/;var be=this,Be=ye.reduce(function(Qe,it){if(be.options[it]===void 0||be.options[it]===null)return Qe;["countries","types","language"].indexOf(it)>-1?Qe[it]=be.options[it].split(xe):Qe[it]=be.options[it];const Tt=typeof be.options[it].longitude=="number"&&typeof be.options[it].latitude=="number";if(it==="proximity"&&Tt){const ut=be.options[it].longitude,Ot=be.options[it].latitude;Qe[it]=[ut,Ot]}return Qe},{});switch(G){case Fe.REVERSE:var lt=Q.split(xe).map(function(Qe){return parseFloat(Qe,10)}).reverse();Be.types&&Be.types[0],Be=J(Be,{query:lt,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(Qe){Qe in Be&&delete Be[Qe]});break;case Fe.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(Q)&&(Q=Q.replace(/,/g," ")),Be=J(Be,{query:Q})}return Be},_geocode:function(G){this.inputString=G,this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:G});const Q=this._requestType(this.options,G),ye=this._setupConfig(Q,G);var xe;switch(Q){case Fe.LOCAL:xe=Promise.resolve();break;case Fe.FORWARD:xe=this.geocoderService.forwardGeocode(ye).send();break;case Fe.REVERSE:xe=this.geocoderService.reverseGeocode(ye).send()}var be=this.options.localGeocoder?this.options.localGeocoder(G)||[]:[],Be=[],lt=null;return xe.catch(function(Qe){lt=Qe}.bind(this)).then(function(Qe){this._loadingEl.style.display="none";var it={};return Qe?Qe.statusCode=="200"&&(it=Qe.body,it.request=Qe.request,it.headers=Qe.headers):it={type:"FeatureCollection",features:[]},it.config=ye,this.fresh&&(this.eventManager.start(this),this.fresh=!1),it.features=it.features?be.concat(it.features):be,this.options.externalGeocoder?(Be=this.options.externalGeocoder(G,it.features)||[],Be.then(function(Tt){return it.features=it.features?Tt.concat(it.features):Tt,it},function(){return it})):it}.bind(this)).then(function(Qe){if(lt)throw lt;this.options.filter&&Qe.features.length&&(Qe.features=Qe.features.filter(this.options.filter)),Qe.features.length?(this._clearEl.style.display="block",this._eventEmitter.emit("results",Qe),this._typeahead.update(Qe.features)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",Qe))}.bind(this)).catch(function(Qe){this._loadingEl.style.display="none",be.length&&this.options.localGeocoder||Be.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(be)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:be}),this._eventEmitter.emit("error",{error:Qe})}.bind(this)),xe},_clear:function(G){G&&G.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(G){this._clear(G),this._inputEl.focus()},_clearOnBlur:function(G){var Q=this;G.relatedTarget&&Q._clear(G)},_onQueryResult:function(G){var Q=G.body;if(Q.features.length){var ye=Q.features[0];this._typeahead.selected=ye,this._inputEl.value=ye.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var G=this._map.getCenter().wrap();this.setProximity({longitude:G.lng,latitude:G.lat})}else this.setProximity(null)},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(G){return this._geocode(G).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderMessage:function(G){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(G)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var G=this.options.language.split(",")[0],Q=De.language(G),ye=_e.placeholder[Q];if(ye)return ye}return"Search"},setInput:function(G){return this._inputEl.value=G,this._typeahead.selected=null,this._typeahead.clear(),G.length>=this.options.minLength&&this._geocode(G),this},setProximity:function(G){return this.options.proximity=G,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(G){return G&&typeof G=="function"&&(this._typeahead.render=G),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(G){var Q=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=G||this.options.language||Q,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(G){return this.options.zoom=G,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(G){return this.options.flyTo=G,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(G){return this.placeholder=G||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(G){return this.options.bbox=G,this},getCountries:function(){return this.options.countries},setCountries:function(G){return this.options.countries=G,this},getTypes:function(){return this.options.types},setTypes:function(G){return this.options.types=G,this},getMinLength:function(){return this.options.minLength},setMinLength:function(G){return this.options.minLength=G,this._typeahead&&(this._typeahead.options.minLength=G),this},getLimit:function(){return this.options.limit},setLimit:function(G){return this.options.limit=G,this._typeahead&&(this._typeahead.options.limit=G),this},getFilter:function(){return this.options.filter},setFilter:function(G){return this.options.filter=G,this},setOrigin:function(G){return this.options.origin=G,this.geocoderService=O(X({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAutocomplete:function(G){return this.options.autocomplete=G,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(G){return this.options.fuzzyMatch=G,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(G){return this.options.routing=G,this},getRouting:function(){return this.options.routing},setWorldview:function(G){return this.options.worldview=G,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(G){if(this._map){this._removeMarker();var Q={color:"#4668F2"},ye=J({},Q,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(ye),G.center?this.mapMarker.setLngLat(G.center).addTo(this._map):G.geometry&&G.geometry.type&&G.geometry.type==="Point"&&G.geometry.coordinates&&this.mapMarker.setLngLat(G.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(G,Q){return this._eventEmitter.on(G,Q),this},off:function(G,Q){return this._eventEmitter.removeListener(G,Q),this.eventManager.remove(),this}},Ne.exports=de},{"./events":1,"./exceptions":2,"./localization":4,"@mapbox/mapbox-sdk":6,"@mapbox/mapbox-sdk/services/geocoding":17,events:26,"lodash.debounce":29,subtag:32,suggestions:33,xtend:36}],4:[function(Oe,Ne,ot){var de={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"};Ne.exports={placeholder:de}},{}],5:[function(Oe,Ne,ot){function de(Q){var ye=Array.isArray(Q),xe=function(be){return ye?Q[be]:Q};return function(be){var Be=fe(G.plainArray,be);if(Be)return Be;if(ye&&be.length!==Q.length)return"an array with "+Q.length+" items";for(var lt=0;lt<be.length;lt++)if(Be=fe(xe(lt),be[lt]))return[lt].concat(Be)}}function fe(Q,ye){if(ye!=null||Q.hasOwnProperty("__required")){var xe=Q(ye);return xe?Array.isArray(xe)?xe:[xe]:void 0}}function s(Q,ye){var xe=Q.length,be=Q[xe-1],Be=Q.slice(0,xe-1);return Be.length===0&&(Be=[Fe]),ye=De(ye,{path:Be}),typeof be=="function"?be(ye):X(ye,ee(be))}function J(Q){return Q.length<2?Q[0]:Q.length===2?Q.join(" or "):Q.slice(0,-1).join(", ")+", or "+Q.slice(-1)}function ee(Q){return"must be "+me(Q)+"."}function me(Q){return/^an? /.test(Q)?Q:/^[aeiou]/i.test(Q)?"an "+Q:/^[a-z]/i.test(Q)?"a "+Q:Q}function X(Q,ye){var xe=O(Q.path),be=Q.path.join(".")+" "+ye;return(xe?"Item at position ":"")+be}function O(Q){return typeof Q[Q.length-1]=="number"||typeof Q[0]=="number"}function ie(Q){return Object.keys(Q||{}).map(function(ye){return{key:ye,value:Q[ye]}})}var _e=Oe("is-plain-obj"),De=Oe("xtend"),Fe="value",G={};G.assert=function(Q,ye){return ye=ye||{},function(xe){var be=fe(Q,xe);if(be){var Be=s(be,ye);throw ye.apiName&&(Be=ye.apiName+": "+Be),new Error(Be)}}},G.shape=function(Q){var ye=ie(Q);return function(xe){var be=fe(G.plainObject,xe);if(be)return be;for(var Be,lt,Qe=[],it=0;it<ye.length;it++)Be=ye[it].key,lt=ye[it].value,(be=fe(lt,xe[Be]))&&Qe.push([Be].concat(be));return Qe.length<2?Qe[0]:function(Tt){Qe=Qe.map(function(Ot){return"- "+Ot[0]+": "+s(Ot,Tt).split(`
`).join(`
  `)});var ut=Tt.path.join(".");return"The following properties"+(ut===Fe?"":" of "+ut)+` have invalid values:
  `+Qe.join(`
  `)}}},G.strictShape=function(Q){var ye=G.shape(Q);return function(xe){var be=ye(xe);if(be)return be;var Be=Object.keys(xe).reduce(function(lt,Qe){return Q[Qe]===void 0&&lt.push(Qe),lt},[]);return Be.length!==0?function(){return"The following keys are invalid: "+Be.join(", ")}:void 0}},G.arrayOf=function(Q){return de(Q)},G.tuple=function(){return de(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},G.required=function(Q){function ye(xe){return xe==null?function(be){return X(be,O(be.path)?"cannot be undefined/null.":"is required.")}:Q.apply(this,arguments)}return ye.__required=!0,ye},G.oneOfType=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(ye){var xe=Q.map(function(be){return fe(be,ye)}).filter(Boolean);if(xe.length===Q.length)return xe.every(function(be){return be.length===1&&typeof be[0]=="string"})?J(xe.map(function(be){return be[0]})):xe.reduce(function(be,Be){return Be.length>be.length?Be:be})}},G.equal=function(Q){return function(ye){if(ye!==Q)return JSON.stringify(Q)}},G.oneOf=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),ye=Q.map(function(xe){return G.equal(xe)});return G.oneOfType.apply(this,ye)},G.range=function(Q){var ye=Q[0],xe=Q[1];return function(be){if(fe(G.number,be)||be<ye||be>xe)return"number between "+ye+" & "+xe+" (inclusive)"}},G.any=function(){},G.boolean=function(Q){if(typeof Q!="boolean")return"boolean"},G.number=function(Q){if(typeof Q!="number")return"number"},G.plainArray=function(Q){if(!Array.isArray(Q))return"array"},G.plainObject=function(Q){if(!_e(Q))return"object"},G.string=function(Q){if(typeof Q!="string")return"string"},G.func=function(Q){if(typeof Q!="function")return"function"},G.validate=fe,G.processMessage=s,Ne.exports=G},{"is-plain-obj":28,xtend:36}],6:[function(Oe,Ne,ot){var de=Oe("./lib/client");Ne.exports=de},{"./lib/client":7}],7:[function(Oe,Ne,ot){function de(ee){J.call(this,ee)}function fe(ee){return new de(ee)}var s=Oe("./browser-layer"),J=Oe("../classes/mapi-client");de.prototype=Object.create(J.prototype),de.prototype.constructor=de,de.prototype.sendRequest=s.browserSend,de.prototype.abortRequest=s.browserAbort,Ne.exports=fe},{"../classes/mapi-client":9,"./browser-layer":8}],8:[function(Oe,Ne,ot){function de(Fe){var G=De[Fe.id];G&&(G.abort(),delete De[Fe.id])}function fe(Fe,G){return new X(Fe,{body:G.response,headers:_e(G.getAllResponseHeaders()),statusCode:G.status})}function s(Fe){var G=Fe.total,Q=Fe.loaded;return{total:G,transferred:Q,percent:100*Q/G}}function J(Fe,G){return new Promise(function(Q,ye){G.onprogress=function(Be){Fe.emitter.emit(ie.EVENT_PROGRESS_DOWNLOAD,s(Be))};var xe=Fe.file;xe&&(G.upload.onprogress=function(Be){Fe.emitter.emit(ie.EVENT_PROGRESS_UPLOAD,s(Be))}),G.onerror=function(Be){ye(Be)},G.onabort=function(){var Be=new O({request:Fe,type:ie.ERROR_REQUEST_ABORTED});ye(Be)},G.onload=function(){if(delete De[Fe.id],G.status<200||G.status>=400){var Be=new O({request:Fe,body:G.response,statusCode:G.status});return void ye(Be)}Q(G)};var be=Fe.body;typeof be=="string"?G.send(be):be?G.send(JSON.stringify(be)):xe?G.send(xe):G.send(),De[Fe.id]=G}).then(function(Q){return fe(Fe,Q)})}function ee(Fe,G){var Q=Fe.url(G),ye=new window.XMLHttpRequest;return ye.open(Fe.method,Q),Object.keys(Fe.headers).forEach(function(xe){ye.setRequestHeader(xe,Fe.headers[xe])}),ye}function me(Fe){return Promise.resolve().then(function(){var G=ee(Fe,Fe.client.accessToken);return J(Fe,G)})}var X=Oe("../classes/mapi-response"),O=Oe("../classes/mapi-error"),ie=Oe("../constants"),_e=Oe("../helpers/parse-headers"),De={};Ne.exports={browserAbort:de,sendRequestXhr:J,browserSend:me,createRequestXhr:ee}},{"../classes/mapi-error":10,"../classes/mapi-response":12,"../constants":13,"../helpers/parse-headers":14}],9:[function(Oe,Ne,ot){function de(ee){if(!ee||!ee.accessToken)throw new Error("Cannot create a client without an access token");fe(ee.accessToken),this.accessToken=ee.accessToken,this.origin=ee.origin||J.API_ORIGIN}var fe=Oe("@mapbox/parse-mapbox-token"),s=Oe("./mapi-request"),J=Oe("../constants");de.prototype.createRequest=function(ee){return new s(this,ee)},Ne.exports=de},{"../constants":13,"./mapi-request":11,"@mapbox/parse-mapbox-token":23}],10:[function(Oe,Ne,ot){function de(s){var J,ee=s.type||fe.ERROR_HTTP;if(s.body)try{J=JSON.parse(s.body)}catch{J=s.body}else J=null;var me=s.message||null;me||(typeof J=="string"?me=J:J&&typeof J.message=="string"?me=J.message:ee===fe.ERROR_REQUEST_ABORTED&&(me="Request aborted")),this.message=me,this.type=ee,this.statusCode=s.statusCode||null,this.request=s.request,this.body=J}var fe=Oe("../constants");Ne.exports=de},{"../constants":13}],11:[function(Oe,Ne,ot){function de(O,ie){if(!O)throw new Error("MapiRequest requires a client");if(!ie||!ie.path||!ie.method)throw new Error("MapiRequest requires an options object with path and method properties");var _e={};ie.body&&(_e["content-type"]="application/json");var De=s(_e,ie.headers),Fe=Object.keys(De).reduce(function(G,Q){return G[Q.toLowerCase()]=De[Q],G},{});this.id=X++,this._options=ie,this.emitter=new J,this.client=O,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=ie.path,this.method=ie.method,this.origin=ie.origin||O.origin,this.query=ie.query||{},this.params=ie.params||{},this.body=ie.body||null,this.file=ie.file||null,this.encoding=ie.encoding||"utf8",this.sendFileAs=ie.sendFileAs||null,this.headers=Fe}var fe=Oe("@mapbox/parse-mapbox-token"),s=Oe("xtend"),J=Oe("eventemitter3"),ee=Oe("../helpers/url-utils"),me=Oe("../constants"),X=1;de.prototype.url=function(O){var ie=ee.prependOrigin(this.path,this.origin);ie=ee.appendQueryObject(ie,this.query);var _e=this.params,De=O==null?this.client.accessToken:O;if(De){ie=ee.appendQueryParam(ie,"access_token",De);var Fe=fe(De).user;_e=s({ownerId:Fe},_e)}return ie=ee.interpolateRouteParams(ie,_e),ie},de.prototype.send=function(){var O=this;if(O.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return O.sent=!0,O.client.sendRequest(O).then(function(ie){return O.response=ie,O.emitter.emit(me.EVENT_RESPONSE,ie),ie},function(ie){throw O.error=ie,O.emitter.emit(me.EVENT_ERROR,ie),ie})},de.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},de.prototype.eachPage=function(O){function ie(G){function Q(){delete Fe._nextPageRequest;var ye=G.nextPage();ye&&(Fe._nextPageRequest=ye,De(ye))}O(null,G,Q)}function _e(G){O(G,null,function(){})}function De(G){G.send().then(ie,_e)}var Fe=this;De(this)},de.prototype.clone=function(){return this._extend()},de.prototype._extend=function(O){var ie=s(this._options,O);return new de(this.client,ie)},Ne.exports=de},{"../constants":13,"../helpers/url-utils":16,"@mapbox/parse-mapbox-token":23,eventemitter3:25,xtend:36}],12:[function(Oe,Ne,ot){function de(s,J){this.request=s,this.headers=J.headers,this.rawBody=J.body,this.statusCode=J.statusCode;try{this.body=JSON.parse(J.body||"{}")}catch{this.body=J.body}this.links=fe(this.headers.link)}var fe=Oe("../helpers/parse-link-header");de.prototype.hasNextPage=function(){return!!this.links.next},de.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Ne.exports=de},{"../helpers/parse-link-header":15}],13:[function(Oe,Ne,ot){Ne.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},{}],14:[function(Oe,Ne,ot){function de(s){var J=s.indexOf(":");return{name:s.substring(0,J).trim().toLowerCase(),value:s.substring(J+1).trim()}}function fe(s){var J={};return s&&s.trim().split(/[\r|\n]+/).forEach(function(ee){var me=de(ee);J[me.name]=me.value}),J}Ne.exports=fe},{}],15:[function(Oe,Ne,ot){function de(J){var ee=J.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return ee?{key:ee[1],value:ee[2]}:null}function fe(J){var ee=J.match(/<?([^>]*)>(.*)/);if(!ee)return null;var me=ee[1],X=ee[2].split(";"),O=null,ie=X.reduce(function(_e,De){var Fe=de(De);return Fe?Fe.key==="rel"?(O||(O=Fe.value),_e):(_e[Fe.key]=Fe.value,_e):_e},{});return O?{url:me,rel:O,params:ie}:null}function s(J){return J?J.split(/,\s*</).reduce(function(ee,me){var X=fe(me);return X&&X.rel.split(/\s+/).forEach(function(O){ee[O]||(ee[O]={url:X.url,params:X.params})}),ee},{}):{}}Ne.exports=s},{}],16:[function(Oe,Ne,ot){function de(X){return X.map(encodeURIComponent).join(",")}function fe(X){return Array.isArray(X)?de(X):encodeURIComponent(String(X))}function s(X,O,ie){if(ie===!1||ie===null)return X;var _e=/\?/.test(X)?"&":"?",De=encodeURIComponent(O);return ie!==void 0&&ie!==""&&ie!==!0&&(De+="="+fe(ie)),""+X+_e+De}function J(X,O){if(!O)return X;var ie=X;return Object.keys(O).forEach(function(_e){var De=O[_e];De!==void 0&&(Array.isArray(De)&&(De=De.filter(function(Fe){return Fe!=null}).join(",")),ie=s(ie,_e,De))}),ie}function ee(X,O){if(!O||X.slice(0,4)==="http")return X;var ie=X[0]==="/"?"":"/";return""+O.replace(/\/$/,"")+ie+X}function me(X,O){return O?X.replace(/\/:([a-zA-Z0-9]+)/g,function(ie,_e){var De=O[_e];if(De===void 0)throw new Error("Unspecified route parameter "+_e);return"/"+fe(De)}):X}Ne.exports={appendQueryObject:J,appendQueryParam:s,prependOrigin:ee,interpolateRouteParams:me}},{}],17:[function(Oe,Ne,ot){var de=Oe("xtend"),fe=Oe("./service-helpers/validator"),s=Oe("./service-helpers/pick"),J=Oe("./service-helpers/stringify-booleans"),ee=Oe("./service-helpers/create-service-factory"),me={},X=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];me.forwardGeocode=function(O){fe.assertShape({query:fe.required(fe.string),mode:fe.oneOf("mapbox.places","mapbox.places-permanent"),countries:fe.arrayOf(fe.string),proximity:fe.coordinates,types:fe.arrayOf(fe.oneOf(X)),autocomplete:fe.boolean,bbox:fe.arrayOf(fe.number),limit:fe.number,language:fe.arrayOf(fe.string),routing:fe.boolean,fuzzyMatch:fe.boolean,worldview:fe.string})(O),O.mode=O.mode||"mapbox.places";var ie=J(de({country:O.countries},s(O,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:s(O,["mode","query"]),query:ie})},me.reverseGeocode=function(O){fe.assertShape({query:fe.required(fe.coordinates),mode:fe.oneOf("mapbox.places","mapbox.places-permanent"),countries:fe.arrayOf(fe.string),types:fe.arrayOf(fe.oneOf(X)),bbox:fe.arrayOf(fe.number),limit:fe.number,language:fe.arrayOf(fe.string),reverseMode:fe.oneOf("distance","score"),routing:fe.boolean,worldview:fe.string})(O),O.mode=O.mode||"mapbox.places";var ie=J(de({country:O.countries},s(O,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:s(O,["mode","query"]),query:ie})},Ne.exports=ee(me)},{"./service-helpers/create-service-factory":18,"./service-helpers/pick":20,"./service-helpers/stringify-booleans":21,"./service-helpers/validator":22,xtend:36}],18:[function(Oe,Ne,ot){function de(J){return function(ee){var me;me=fe.prototype.isPrototypeOf(ee)?ee:s(ee);var X=Object.create(J);return X.client=me,X}}var fe=Oe("../../lib/classes/mapi-client"),s=Oe("../../lib/client");Ne.exports=de},{"../../lib/classes/mapi-client":9,"../../lib/client":7}],19:[function(Oe,Ne,ot){function de(fe,s){return Object.keys(fe).reduce(function(J,ee){return J[ee]=s(ee,fe[ee]),J},{})}Ne.exports=de},{}],20:[function(Oe,Ne,ot){function de(fe,s){var J=function(ee,me){return s.indexOf(ee)!==-1&&me!==void 0};return typeof s=="function"&&(J=s),Object.keys(fe).filter(function(ee){return J(ee,fe[ee])}).reduce(function(ee,me){return ee[me]=fe[me],ee},{})}Ne.exports=de},{}],21:[function(Oe,Ne,ot){function de(s){return fe(s,function(J,ee){return typeof ee=="boolean"?JSON.stringify(ee):ee})}var fe=Oe("./object-map");Ne.exports=de},{"./object-map":19}],22:[function(Oe,Ne,ot){(function(de){(function(){function fe(O){if(typeof window!="undefined")return O instanceof de.Blob||O instanceof de.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(typeof O!="string"&&O.pipe===void 0)return"Filename or Readable stream"}function s(O,ie){return X.assert(X.strictShape(O),ie)}function J(O){if(typeof O=="boolean")return"date";try{var ie=new Date(O);if(ie.getTime&&isNaN(ie.getTime()))return"date"}catch{return"date"}}function ee(O){return X.tuple(X.number,X.number)(O)}var me=Oe("xtend"),X=Oe("@mapbox/fusspot");Ne.exports=me(X,{file:fe,date:J,coordinates:ee,assertShape:s})}).call(this)}).call(this,typeof Io!="undefined"?Io:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"@mapbox/fusspot":5,xtend:36}],23:[function(Oe,Ne,ot){function de(me){if(ee[me])return ee[me];var X=me.split("."),O=X[0],ie=X[1];if(!ie)throw new Error("Invalid token");var _e=fe(ie),De={usage:O,user:_e.u};return s(_e,"a")&&(De.authorization=_e.a),s(_e,"exp")&&(De.expires=1e3*_e.exp),s(_e,"iat")&&(De.created=1e3*_e.iat),s(_e,"scopes")&&(De.scopes=_e.scopes),s(_e,"client")&&(De.client=_e.client),s(_e,"ll")&&(De.lastLogin=_e.ll),s(_e,"iu")&&(De.impersonator=_e.iu),ee[me]=De,De}function fe(me){try{return JSON.parse(J.decode(me))}catch{throw new Error("Invalid token")}}function s(me,X){return Object.prototype.hasOwnProperty.call(me,X)}var J=Oe("base-64"),ee={};Ne.exports=de},{"base-64":24}],24:[function(Oe,Ne,ot){(function(de){(function(){(function(fe){var s=typeof ot=="object"&&ot,J=typeof Ne=="object"&&Ne&&Ne.exports==s&&Ne,ee=typeof de=="object"&&de;ee.global!==ee&&ee.window!==ee||(fe=ee);var me=function(Q){this.message=Q};me.prototype=new Error,me.prototype.name="InvalidCharacterError";var X=function(Q){throw new me(Q)},O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ie=/[\t\n\f\r ]/g,_e=function(Q){Q=String(Q).replace(ie,"");var ye=Q.length;ye%4==0&&(Q=Q.replace(/==?$/,""),ye=Q.length),(ye%4==1||/[^+a-zA-Z0-9\/]/.test(Q))&&X("Invalid character: the string to be decoded is not correctly encoded.");for(var xe,be,Be=0,lt="",Qe=-1;++Qe<ye;)be=O.indexOf(Q.charAt(Qe)),xe=Be%4?64*xe+be:be,Be++%4&&(lt+=String.fromCharCode(255&xe>>(-2*Be&6)));return lt},De=function(Q){Q=String(Q),/[^\0-\xFF]/.test(Q)&&X("The string to be encoded contains characters outside of the Latin1 range.");for(var ye,xe,be,Be,lt=Q.length%3,Qe="",it=-1,Tt=Q.length-lt;++it<Tt;)ye=Q.charCodeAt(it)<<16,xe=Q.charCodeAt(++it)<<8,be=Q.charCodeAt(++it),Be=ye+xe+be,Qe+=O.charAt(Be>>18&63)+O.charAt(Be>>12&63)+O.charAt(Be>>6&63)+O.charAt(63&Be);return lt==2?(ye=Q.charCodeAt(it)<<8,xe=Q.charCodeAt(++it),Be=ye+xe,Qe+=O.charAt(Be>>10)+O.charAt(Be>>4&63)+O.charAt(Be<<2&63)+"="):lt==1&&(Be=Q.charCodeAt(it),Qe+=O.charAt(Be>>2)+O.charAt(Be<<4&63)+"=="),Qe},Fe={encode:De,decode:_e,version:"0.1.0"};if(s&&!s.nodeType)if(J)J.exports=Fe;else for(var G in Fe)Fe.hasOwnProperty(G)&&(s[G]=Fe[G]);else fe.base64=Fe})(this)}).call(this)}).call(this,typeof Io!="undefined"?Io:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],25:[function(Oe,Ne,ot){function de(){}function fe(O,ie,_e){this.fn=O,this.context=ie,this.once=_e||!1}function s(O,ie,_e,De,Fe){if(typeof _e!="function")throw new TypeError("The listener must be a function");var G=new fe(_e,De||O,Fe),Q=X?X+ie:ie;return O._events[Q]?O._events[Q].fn?O._events[Q]=[O._events[Q],G]:O._events[Q].push(G):(O._events[Q]=G,O._eventsCount++),O}function J(O,ie){--O._eventsCount==0?O._events=new de:delete O._events[ie]}function ee(){this._events=new de,this._eventsCount=0}var me=Object.prototype.hasOwnProperty,X="~";Object.create&&(de.prototype=Object.create(null),new de().__proto__||(X=!1)),ee.prototype.eventNames=function(){var O,ie,_e=[];if(this._eventsCount===0)return _e;for(ie in O=this._events)me.call(O,ie)&&_e.push(X?ie.slice(1):ie);return Object.getOwnPropertySymbols?_e.concat(Object.getOwnPropertySymbols(O)):_e},ee.prototype.listeners=function(O){var ie=X?X+O:O,_e=this._events[ie];if(!_e)return[];if(_e.fn)return[_e.fn];for(var De=0,Fe=_e.length,G=new Array(Fe);De<Fe;De++)G[De]=_e[De].fn;return G},ee.prototype.listenerCount=function(O){var ie=X?X+O:O,_e=this._events[ie];return _e?_e.fn?1:_e.length:0},ee.prototype.emit=function(O,ie,_e,De,Fe,G){var Q=X?X+O:O;if(!this._events[Q])return!1;var ye,xe,be=this._events[Q],Be=arguments.length;if(be.fn){switch(be.once&&this.removeListener(O,be.fn,void 0,!0),Be){case 1:return be.fn.call(be.context),!0;case 2:return be.fn.call(be.context,ie),!0;case 3:return be.fn.call(be.context,ie,_e),!0;case 4:return be.fn.call(be.context,ie,_e,De),!0;case 5:return be.fn.call(be.context,ie,_e,De,Fe),!0;case 6:return be.fn.call(be.context,ie,_e,De,Fe,G),!0}for(xe=1,ye=new Array(Be-1);xe<Be;xe++)ye[xe-1]=arguments[xe];be.fn.apply(be.context,ye)}else{var lt,Qe=be.length;for(xe=0;xe<Qe;xe++)switch(be[xe].once&&this.removeListener(O,be[xe].fn,void 0,!0),Be){case 1:be[xe].fn.call(be[xe].context);break;case 2:be[xe].fn.call(be[xe].context,ie);break;case 3:be[xe].fn.call(be[xe].context,ie,_e);break;case 4:be[xe].fn.call(be[xe].context,ie,_e,De);break;default:if(!ye)for(lt=1,ye=new Array(Be-1);lt<Be;lt++)ye[lt-1]=arguments[lt];be[xe].fn.apply(be[xe].context,ye)}}return!0},ee.prototype.on=function(O,ie,_e){return s(this,O,ie,_e,!1)},ee.prototype.once=function(O,ie,_e){return s(this,O,ie,_e,!0)},ee.prototype.removeListener=function(O,ie,_e,De){var Fe=X?X+O:O;if(!this._events[Fe])return this;if(!ie)return J(this,Fe),this;var G=this._events[Fe];if(G.fn)G.fn!==ie||De&&!G.once||_e&&G.context!==_e||J(this,Fe);else{for(var Q=0,ye=[],xe=G.length;Q<xe;Q++)(G[Q].fn!==ie||De&&!G[Q].once||_e&&G[Q].context!==_e)&&ye.push(G[Q]);ye.length?this._events[Fe]=ye.length===1?ye[0]:ye:J(this,Fe)}return this},ee.prototype.removeAllListeners=function(O){var ie;return O?(ie=X?X+O:O,this._events[ie]&&J(this,ie)):(this._events=new de,this._eventsCount=0),this},ee.prototype.off=ee.prototype.removeListener,ee.prototype.addListener=ee.prototype.on,ee.prefixed=X,ee.EventEmitter=ee,Ne!==void 0&&(Ne.exports=ee)},{}],26:[function(Oe,Ne,ot){function de(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=lt(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function fe(Ee){return Ee._maxListeners===void 0?de.defaultMaxListeners:Ee._maxListeners}function s(Ee,qe,$e){if(qe)Ee.call($e);else for(var Je=Ee.length,et=Q(Ee,Je),st=0;st<Je;++st)et[st].call($e)}function J(Ee,qe,$e,Je){if(qe)Ee.call($e,Je);else for(var et=Ee.length,st=Q(Ee,et),at=0;at<et;++at)st[at].call($e,Je)}function ee(Ee,qe,$e,Je,et){if(qe)Ee.call($e,Je,et);else for(var st=Ee.length,at=Q(Ee,st),pt=0;pt<st;++pt)at[pt].call($e,Je,et)}function me(Ee,qe,$e,Je,et,st){if(qe)Ee.call($e,Je,et,st);else for(var at=Ee.length,pt=Q(Ee,at),yi=0;yi<at;++yi)pt[yi].call($e,Je,et,st)}function X(Ee,qe,$e,Je){if(qe)Ee.apply($e,Je);else for(var et=Ee.length,st=Q(Ee,et),at=0;at<et;++at)st[at].apply($e,Je)}function O(Ee,qe,$e,Je){var et,st,at;if(typeof $e!="function")throw new TypeError('"listener" argument must be a function');if(st=Ee._events,st?(st.newListener&&(Ee.emit("newListener",qe,$e.listener?$e.listener:$e),st=Ee._events),at=st[qe]):(st=Ee._events=lt(null),Ee._eventsCount=0),at){if(typeof at=="function"?at=st[qe]=Je?[$e,at]:[at,$e]:Je?at.unshift($e):at.push($e),!at.warned&&(et=fe(Ee))&&et>0&&at.length>et){at.warned=!0;var pt=new Error("Possible EventEmitter memory leak detected. "+at.length+' "'+String(qe)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');pt.name="MaxListenersExceededWarning",pt.emitter=Ee,pt.type=qe,pt.count=at.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",pt.name,pt.message)}}else at=st[qe]=$e,++Ee._eventsCount;return Ee}function ie(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var Ee=new Array(arguments.length),qe=0;qe<Ee.length;++qe)Ee[qe]=arguments[qe];this.listener.apply(this.target,Ee)}}function _e(Ee,qe,$e){var Je={fired:!1,wrapFn:void 0,target:Ee,type:qe,listener:$e},et=it.call(ie,Je);return et.listener=$e,Je.wrapFn=et,et}function De(Ee,qe,$e){var Je=Ee._events;if(!Je)return[];var et=Je[qe];return et?typeof et=="function"?$e?[et.listener||et]:[et]:$e?ye(et):Q(et,et.length):[]}function Fe(Ee){var qe=this._events;if(qe){var $e=qe[Ee];if(typeof $e=="function")return 1;if($e)return $e.length}return 0}function G(Ee,qe){for(var $e=qe,Je=$e+1,et=Ee.length;Je<et;$e+=1,Je+=1)Ee[$e]=Ee[Je];Ee.pop()}function Q(Ee,qe){for(var $e=new Array(qe),Je=0;Je<qe;++Je)$e[Je]=Ee[Je];return $e}function ye(Ee){for(var qe=new Array(Ee.length),$e=0;$e<qe.length;++$e)qe[$e]=Ee[$e].listener||Ee[$e];return qe}function xe(Ee){var qe=function(){};return qe.prototype=Ee,new qe}function be(Ee){var qe=[];for(var $e in Ee)Object.prototype.hasOwnProperty.call(Ee,$e)&&qe.push($e);return $e}function Be(Ee){var qe=this;return function(){return qe.apply(Ee,arguments)}}var lt=Object.create||xe,Qe=Object.keys||be,it=Function.prototype.bind||Be;Ne.exports=de,de.EventEmitter=de,de.prototype._events=void 0,de.prototype._maxListeners=void 0;var Tt,ut=10;try{var Ot={};Object.defineProperty&&Object.defineProperty(Ot,"x",{value:0}),Tt=Ot.x===0}catch{Tt=!1}Tt?Object.defineProperty(de,"defaultMaxListeners",{enumerable:!0,get:function(){return ut},set:function(Ee){if(typeof Ee!="number"||Ee<0||Ee!==Ee)throw new TypeError('"defaultMaxListeners" must be a positive number');ut=Ee}}):de.defaultMaxListeners=ut,de.prototype.setMaxListeners=function(Ee){if(typeof Ee!="number"||Ee<0||isNaN(Ee))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=Ee,this},de.prototype.getMaxListeners=function(){return fe(this)},de.prototype.emit=function(Ee){var qe,$e,Je,et,st,at,pt=Ee==="error";if(at=this._events)pt=pt&&at.error==null;else if(!pt)return!1;if(pt){if(arguments.length>1&&(qe=arguments[1]),qe instanceof Error)throw qe;var yi=new Error('Unhandled "error" event. ('+qe+")");throw yi.context=qe,yi}if(!($e=at[Ee]))return!1;var zt=typeof $e=="function";switch(Je=arguments.length){case 1:s($e,zt,this);break;case 2:J($e,zt,this,arguments[1]);break;case 3:ee($e,zt,this,arguments[1],arguments[2]);break;case 4:me($e,zt,this,arguments[1],arguments[2],arguments[3]);break;default:for(et=new Array(Je-1),st=1;st<Je;st++)et[st-1]=arguments[st];X($e,zt,this,et)}return!0},de.prototype.addListener=function(Ee,qe){return O(this,Ee,qe,!1)},de.prototype.on=de.prototype.addListener,de.prototype.prependListener=function(Ee,qe){return O(this,Ee,qe,!0)},de.prototype.once=function(Ee,qe){if(typeof qe!="function")throw new TypeError('"listener" argument must be a function');return this.on(Ee,_e(this,Ee,qe)),this},de.prototype.prependOnceListener=function(Ee,qe){if(typeof qe!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(Ee,_e(this,Ee,qe)),this},de.prototype.removeListener=function(Ee,qe){var $e,Je,et,st,at;if(typeof qe!="function")throw new TypeError('"listener" argument must be a function');if(!(Je=this._events))return this;if(!($e=Je[Ee]))return this;if($e===qe||$e.listener===qe)--this._eventsCount==0?this._events=lt(null):(delete Je[Ee],Je.removeListener&&this.emit("removeListener",Ee,$e.listener||qe));else if(typeof $e!="function"){for(et=-1,st=$e.length-1;st>=0;st--)if($e[st]===qe||$e[st].listener===qe){at=$e[st].listener,et=st;break}if(et<0)return this;et===0?$e.shift():G($e,et),$e.length===1&&(Je[Ee]=$e[0]),Je.removeListener&&this.emit("removeListener",Ee,at||qe)}return this},de.prototype.removeAllListeners=function(Ee){var qe,$e,Je;if(!($e=this._events))return this;if(!$e.removeListener)return arguments.length===0?(this._events=lt(null),this._eventsCount=0):$e[Ee]&&(--this._eventsCount==0?this._events=lt(null):delete $e[Ee]),this;if(arguments.length===0){var et,st=Qe($e);for(Je=0;Je<st.length;++Je)(et=st[Je])!=="removeListener"&&this.removeAllListeners(et);return this.removeAllListeners("removeListener"),this._events=lt(null),this._eventsCount=0,this}if(typeof(qe=$e[Ee])=="function")this.removeListener(Ee,qe);else if(qe)for(Je=qe.length-1;Je>=0;Je--)this.removeListener(Ee,qe[Je]);return this},de.prototype.listeners=function(Ee){return De(this,Ee,!0)},de.prototype.rawListeners=function(Ee){return De(this,Ee,!1)},de.listenerCount=function(Ee,qe){return typeof Ee.listenerCount=="function"?Ee.listenerCount(qe):Fe.call(Ee,qe)},de.prototype.listenerCount=Fe,de.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],27:[function(Oe,Ne,ot){(function(){var de=this,fe={};ot!==void 0?Ne.exports=fe:de.fuzzy=fe,fe.simpleFilter=function(s,J){return J.filter(function(ee){return fe.test(s,ee)})},fe.test=function(s,J){return fe.match(s,J)!==null},fe.match=function(s,J,ee){ee=ee||{};var me,X=0,O=[],ie=J.length,_e=0,De=0,Fe=ee.pre||"",G=ee.post||"",Q=ee.caseSensitive&&J||J.toLowerCase();s=ee.caseSensitive&&s||s.toLowerCase();for(var ye=0;ye<ie;ye++)me=J[ye],Q[ye]===s[X]?(me=Fe+me+G,X+=1,De+=1+De):De=0,_e+=De,O[O.length]=me;return X===s.length?(_e=Q===s?1/0:_e,{rendered:O.join(""),score:_e}):null},fe.filter=function(s,J,ee){return J&&J.length!==0?typeof s!="string"?J:(ee=ee||{},J.reduce(function(me,X,O,ie){var _e=X;ee.extract&&(_e=ee.extract(X));var De=fe.match(s,_e,ee);return De!=null&&(me[me.length]={string:De.rendered,score:De.score,index:O,original:X}),me},[]).sort(function(me,X){var O=X.score-me.score;return O||me.index-X.index})):[]}})()},{}],28:[function(Oe,Ne,ot){var de=Object.prototype.toString;Ne.exports=function(fe){var s;return de.call(fe)==="[object Object]"&&((s=Object.getPrototypeOf(fe))===null||s===Object.getPrototypeOf({}))}},{}],29:[function(Oe,Ne,ot){(function(de){(function(){function fe(ut,Ot,Ee){function qe(kt){var ui=hi,bt=Ji;return hi=Ji=void 0,Oi=kt,Ai=ut.apply(bt,ui)}function $e(kt){return Oi=kt,ai=setTimeout(st,Ot),Sr?qe(kt):Ai}function Je(kt){var ui=kt-ft,bt=kt-Oi,ki=Ot-ui;return Qi?it(ki,zi-bt):ki}function et(kt){var ui=kt-ft,bt=kt-Oi;return ft===void 0||ui>=Ot||ui<0||Qi&&bt>=zi}function st(){var kt=Tt();if(et(kt))return at(kt);ai=setTimeout(st,Je(kt))}function at(kt){return ai=void 0,mr&&hi?qe(kt):(hi=Ji=void 0,Ai)}function pt(){ai!==void 0&&clearTimeout(ai),Oi=0,hi=ft=Ji=ai=void 0}function yi(){return ai===void 0?Ai:at(Tt())}function zt(){var kt=Tt(),ui=et(kt);if(hi=arguments,Ji=this,ft=kt,ui){if(ai===void 0)return $e(ft);if(Qi)return ai=setTimeout(st,Ot),qe(ft)}return ai===void 0&&(ai=setTimeout(st,Ot)),Ai}var hi,Ji,zi,Ai,ai,ft,Oi=0,Sr=!1,Qi=!1,mr=!0;if(typeof ut!="function")throw new TypeError(X);return Ot=me(Ot)||0,s(Ee)&&(Sr=!!Ee.leading,Qi="maxWait"in Ee,zi=Qi?Qe(me(Ee.maxWait)||0,Ot):zi,mr="trailing"in Ee?!!Ee.trailing:mr),zt.cancel=pt,zt.flush=yi,zt}function s(ut){var Ot=typeof ut;return!!ut&&(Ot=="object"||Ot=="function")}function J(ut){return!!ut&&typeof ut=="object"}function ee(ut){return typeof ut=="symbol"||J(ut)&&lt.call(ut)==ie}function me(ut){if(typeof ut=="number")return ut;if(ee(ut))return O;if(s(ut)){var Ot=typeof ut.valueOf=="function"?ut.valueOf():ut;ut=s(Ot)?Ot+"":Ot}if(typeof ut!="string")return ut===0?ut:+ut;ut=ut.replace(_e,"");var Ee=Fe.test(ut);return Ee||G.test(ut)?Q(ut.slice(2),Ee?2:8):De.test(ut)?O:+ut}var X="Expected a function",O=NaN,ie="[object Symbol]",_e=/^\s+|\s+$/g,De=/^[-+]0x[0-9a-f]+$/i,Fe=/^0b[01]+$/i,G=/^0o[0-7]+$/i,Q=parseInt,ye=typeof de=="object"&&de&&de.Object===Object&&de,xe=typeof self=="object"&&self&&self.Object===Object&&self,be=ye||xe||Function("return this")(),Be=Object.prototype,lt=Be.toString,Qe=Math.max,it=Math.min,Tt=function(){return be.Date.now()};Ne.exports=fe}).call(this)}).call(this,typeof Io!="undefined"?Io:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],30:[function(Oe,Ne,ot){(function(de){(function(){if(de.env.NODE_ENV!=="production"){if(typeof navigator!="undefined"&&navigator.product==="ReactNative")throw new Error("React Native does not have a built-in secure random generator. If you don\u2019t need unpredictable IDs, you can use `nanoid/non-secure`. For secure ID install `expo-random` locally and use `nanoid/async`.");if(typeof self=="undefined"||!self.crypto&&!self.msCrypto)throw new Error("Your browser does not have secure random generator. If you don\u2019t need unpredictable IDs, you can use nanoid/non-secure.")}for(var fe=self.crypto||self.msCrypto,s="-_",J=36;J--;)s+=J.toString(36);for(J=36;J---10;)s+=J.toString(36).toUpperCase();Ne.exports=function(ee){var me="",X=fe.getRandomValues(new Uint8Array(ee||21));for(J=ee||21;J--;)me+=s[63&X[J]];return me}}).call(this)}).call(this,Oe("_process"))},{_process:31}],31:[function(Oe,Ne,ot){function de(){throw new Error("setTimeout has not been defined")}function fe(){throw new Error("clearTimeout has not been defined")}function s(xe){if(ie===setTimeout)return setTimeout(xe,0);if((ie===de||!ie)&&setTimeout)return ie=setTimeout,setTimeout(xe,0);try{return ie(xe,0)}catch{try{return ie.call(null,xe,0)}catch{return ie.call(this,xe,0)}}}function J(xe){if(_e===clearTimeout)return clearTimeout(xe);if((_e===fe||!_e)&&clearTimeout)return _e=clearTimeout,clearTimeout(xe);try{return _e(xe)}catch{try{return _e.call(null,xe)}catch{return _e.call(this,xe)}}}function ee(){Q&&Fe&&(Q=!1,Fe.length?G=Fe.concat(G):ye=-1,G.length&&me())}function me(){if(!Q){var xe=s(ee);Q=!0;for(var be=G.length;be;){for(Fe=G,G=[];++ye<be;)Fe&&Fe[ye].run();ye=-1,be=G.length}Fe=null,Q=!1,J(xe)}}function X(xe,be){this.fun=xe,this.array=be}function O(){}var ie,_e,De=Ne.exports={};(function(){try{ie=typeof setTimeout=="function"?setTimeout:de}catch{ie=de}try{_e=typeof clearTimeout=="function"?clearTimeout:fe}catch{_e=fe}})();var Fe,G=[],Q=!1,ye=-1;De.nextTick=function(xe){var be=new Array(arguments.length-1);if(arguments.length>1)for(var Be=1;Be<arguments.length;Be++)be[Be-1]=arguments[Be];G.push(new X(xe,be)),G.length!==1||Q||s(me)},X.prototype.run=function(){this.fun.apply(null,this.array)},De.title="browser",De.browser=!0,De.env={},De.argv=[],De.version="",De.versions={},De.on=O,De.addListener=O,De.once=O,De.off=O,De.removeListener=O,De.removeAllListeners=O,De.emit=O,De.prependListener=O,De.prependOnceListener=O,De.listeners=function(xe){return[]},De.binding=function(xe){throw new Error("process.binding is not supported")},De.cwd=function(){return"/"},De.chdir=function(xe){throw new Error("process.chdir is not supported")},De.umask=function(){return 0}},{}],32:[function(Oe,Ne,ot){(function(de,fe,s){Ne!==void 0&&Ne.exports?Ne.exports=s():de.subtag=s()})(this,0,function(){function de(O){return O.match(X)||[]}function fe(O){return de(O).filter(function(ie,_e){return ie&&_e})}function s(O){return O=de(O),{language:O[1]||me,extlang:O[2]||me,script:O[3]||me,region:O[4]||me}}function J(O,ie,_e){Object.defineProperty(O,ie,{value:_e,enumerable:!0})}function ee(O,ie,_e){function De(Fe){return de(Fe)[O]||me}J(De,"pattern",ie),J(s,_e,De)}var me="",X=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;return ee(1,/^[a-zA-Z]{2,3}$/,"language"),ee(2,/^[a-zA-Z]{3}$/,"extlang"),ee(3,/^[a-zA-Z]{4}$/,"script"),ee(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),J(s,"split",fe),s})},{}],33:[function(Oe,Ne,ot){var de=Oe("./src/suggestions");Ne.exports=de,typeof window!="undefined"&&(window.Suggestions=de)},{"./src/suggestions":35}],34:[function(Oe,Ne,ot){var de=function(fe){return this.component=fe,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,fe.el.parentNode.insertBefore(this.wrapper,fe.el.nextSibling),this};de.prototype.show=function(){this.element.style.display="block"},de.prototype.hide=function(){this.element.style.display="none"},de.prototype.add=function(fe){this.items.push(fe)},de.prototype.clear=function(){this.items=[],this.active=0},de.prototype.isEmpty=function(){return!this.items.length},de.prototype.isVisible=function(){return this.element.style.display==="block"},de.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0)return void this.hide();for(var fe=0;fe<this.items.length;fe++)this.drawItem(this.items[fe],this.active===fe);this.show()},de.prototype.drawItem=function(fe,s){var J=document.createElement("li"),ee=document.createElement("a");s&&(J.className+=" active"),ee.innerHTML=fe.string,J.appendChild(ee),this.element.appendChild(J),J.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),J.addEventListener("mouseup",function(){this.handleMouseUp.call(this,fe)}.bind(this))},de.prototype.handleMouseUp=function(fe){this.selectingListItem=!1,this.component.value(fe.original),this.clear(),this.draw()},de.prototype.move=function(fe){this.active=fe,this.draw()},de.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},de.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},de.prototype.drawError=function(fe){var s=document.createElement("li");s.innerHTML=fe,this.element.appendChild(s),this.show()},Ne.exports=de},{}],35:[function(Oe,Ne,ot){var de=Oe("xtend"),fe=Oe("fuzzy"),s=Oe("./list"),J=function(ee,me,X){return X=X||{},this.options=de({minLength:2,limit:5,filter:!0,hideOnBlur:!0},X),this.el=ee,this.data=me||[],this.list=new s(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(O){this.handleKeyUp(O.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(O){this.handleKeyDown(O)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(O){this.handlePaste(O)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};J.prototype.handleKeyUp=function(ee){ee!==40&&ee!==38&&ee!==27&&ee!==13&&ee!==9&&this.handleInputChange(this.el.value)},J.prototype.handleKeyDown=function(ee){switch(ee.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&ee.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},J.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},J.prototype.handlePaste=function(ee){if(ee.clipboardData)this.handleInputChange(ee.clipboardData.getData("Text"));else{var me=this;setTimeout(function(){me.handleInputChange(ee.target.value)},100)}},J.prototype.handleInputChange=function(ee){if(this.query=this.normalize(ee),this.list.clear(),this.query.length<this.options.minLength)return void this.list.draw();this.getCandidates(function(me){for(var X=0;X<me.length&&(this.list.add(me[X]),X!==this.options.limit-1);X++);this.list.draw()}.bind(this))},J.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},J.prototype.update=function(ee){this.data=ee,this.handleKeyUp()},J.prototype.clear=function(){this.data=[],this.list.clear()},J.prototype.normalize=function(ee){return ee=ee.toLowerCase()},J.prototype.match=function(ee,me){return ee.indexOf(me)>-1},J.prototype.value=function(ee){if(this.selected=ee,this.el.value=this.getItemValue(ee),document.createEvent){var me=document.createEvent("HTMLEvents");me.initEvent("change",!0,!1),this.el.dispatchEvent(me)}else this.el.fireEvent("onchange")},J.prototype.getCandidates=function(ee){var me,X={pre:"<strong>",post:"</strong>",extract:function(O){return this.getItemValue(O)}.bind(this)};this.options.filter?(me=fe.filter(this.query,this.data,X),me=me.map(function(O){return{original:O.original,string:this.render(O.original,O.string)}}.bind(this))):me=this.data.map(function(O){return{original:O,string:this.render(O)}}.bind(this)),ee(me)},J.prototype.getItemValue=function(ee){return ee},J.prototype.render=function(ee,me){if(me)return me;for(var X=ee.original?this.getItemValue(ee.original):this.getItemValue(ee),O=this.normalize(X),ie=O.lastIndexOf(this.query);ie>-1;){var _e=ie+this.query.length;X=X.slice(0,ie)+"<strong>"+X.slice(ie,_e)+"</strong>"+X.slice(_e),ie=O.slice(0,ie).lastIndexOf(this.query)}return X},J.prototype.renderError=function(ee){this.list.drawError(ee)},Ne.exports=J},{"./list":34,fuzzy:27,xtend:36}],36:[function(Oe,Ne,ot){function de(){for(var s={},J=0;J<arguments.length;J++){var ee=arguments[J];for(var me in ee)fe.call(ee,me)&&(s[me]=ee[me])}return s}Ne.exports=de;var fe=Object.prototype.hasOwnProperty},{}]},{},[3])(3)})})(Tp);var Nf=Tp.exports;const Gf={class:"dashboard-map-wrapper"},qf={class:"content-section"},$f={class:"content-section-body","data-simplebar":""},jf=si("h4",{class:"content-section-title"},"Recent Locations",-1),Zf={class:"map-box-place"},Xf={class:"map-box-header"},Wf={class:"map-box-body"},Hf={class:"map-box-actions"},Kf=Bf('<div class="rating"><i aria-hidden="true" class="fas fa-star highlighted"></i><i aria-hidden="true" class="fas fa-star highlighted"></i><i aria-hidden="true" class="fas fa-star highlighted"></i><i aria-hidden="true" class="fas fa-star highlighted"></i><i aria-hidden="true" class="fas fa-star highlighted"></i></div>',1),Yf={class:"actions"},Jf={class:"action"},Qf=si("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:flag"},null,-1),em={class:"dark-inverted"};var sm=xp({expose:[],props:{reversed:{type:Boolean,default:!1}},setup(qn){const pn=qn;Aa.accessToken="pk.eyJ1IjoiY3NzbmluamEiLCJhIjoiY2toZW1nYm0zMDAxODJycXFzZ3g4cnZ6diJ9.9ebfrGREuwkauRr_afDTgA";const Oe=Ms(),Ne=Ms(),ot=Ms(),de=Ms(),fe=Ms(),s=Ms("");let J,ee,me;const X={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Fast Pizza",logo:"/images/icons/logos/fastpizza.svg",distance:.3,openingCount:"6pm",phone:"+1 555 456-5659",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.038659,38.931567]}},{type:"Feature",properties:{name:"Envato",logo:"/images/icons/logos/envato.svg",distance:.8,openingCount:"5pm",phone:"+1 555 154-4568",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.003168,38.894651]}},{type:"Feature",properties:{name:"Lipflow",logo:"/images/icons/logos/lipflow.svg",distance:1.2,openingCount:"8pm",phone:"+1 555 456-7897",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.090372,38.881189]}},{type:"Feature",properties:{name:"Metamovies",logo:"/images/icons/logos/metamovies.svg",distance:.5,openingCount:"11pm",phone:"+1 555 456-5659",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.111561,38.882342]}},{type:"Feature",properties:{name:"Slicer",logo:"/images/icons/logos/slicer.svg",distance:.2,openingCount:"4:30pm",phone:"+1 555 456-7568",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.052477,38.943951]}},{type:"Feature",properties:{name:"Drop",logo:"/images/icons/logos/drop.svg",distance:2.1,openingCount:"7pm",phone:"+1 555 456-5659",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.043444,38.909664]}},{type:"Feature",properties:{name:"Fresco",logo:"/images/icons/logos/fresco.svg",distance:.6,openingCount:"6pm",phone:"+1 555 456-5659",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.031706,38.914581]}},{type:"Feature",properties:{name:"Hairz",logo:"/images/icons/logos/hairz.svg",distance:.3,openingCount:"6pm",phone:"+1 555 755-3382",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.020945,38.878241]}},{type:"Feature",properties:{name:"Vego LLC",logo:"/images/icons/logos/vego.svg",distance:.3,openingCount:"9pm",phone:"+1 555 456-8984",website:"https://huro.cssninja.io",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Memini me adesse meam."},geometry:{type:"Point",coordinates:[-77.007481,38.876516]}}]};function O(){!J||J.getSource("places")||(J.addSource("places",{type:"geojson",data:X}),J.addLayer({id:"places",type:"circle",source:"places",paint:{"circle-color":Ia.value?tc.accent:tc.primary,"circle-radius":6,"circle-stroke-width":2,"circle-stroke-color":Ia.value?tc.accentLight:tc.primaryMedium}}),J.on("click","places",_e=>{de.value=_e.features[0],fe.value=_e.lngLat}),J.on("mouseenter","places",()=>{!J||(J.getCanvas().style.cursor="pointer")}),J.on("mouseleave","places",()=>{!J||(J.getCanvas().style.cursor="")}))}function ie(_e){de.value=void 0,de.value=_e}return Mf(()=>{!Oe.value||!Ne.value||(J=new Aa.Map({container:Oe.value,style:Ia.value?"mapbox://styles/mapbox/dark-v10":"mapbox://styles/mapbox/light-v10",center:[-77.04,38.907],zoom:12}),me=new Nf({accessToken:Aa.accessToken,mapboxgl:Aa,marker:!0}),J.on("styledata",()=>{const _e=()=>{if(!(J!=null&&J.isStyleLoaded())){setTimeout(_e,1500);return}O()};_e()}),Ne.value.appendChild(me.onAdd(J)))}),zf(()=>{if(!de.value||!ot.value||!J)return;const _e=de.value.geometry.coordinates.slice(),De=de.value.properties.name;if(de.value.properties.logo,de.value.properties.openingCount,de.value.properties.description,fe.value)for(;Math.abs(fe.value.lng-_e[0])>180;)_e[0]+=fe.value.lng>_e[0]?360:-360;J.flyTo({center:_e,zoom:15,bearing:0,essential:!0}),ee&&ee.remove(),ee=new Aa.Popup().on("open",()=>{s.value=De}).on("close",()=>{s.value=""}).setLngLat(_e).setHTML(ot.value.innerHTML).addTo(J)},{flush:"post"}),kf(Ia,()=>{!J||(Ia.value?J.setStyle("mapbox://styles/mapbox/dark-v10"):J.setStyle("mapbox://styles/mapbox/light-v10"))}),(_e,De)=>{const Fe=Vf,G=gp,Q=yp;return Ca(),Ma("div",Gf,[si("div",{class:["dashboard-map-wrapper-inner",[pn.reversed&&"is-reversed"]]},[si("div",{ref:Oe,class:"map-section"},[si("div",{ref:Ne,class:"geocoder"},null,512),si("div",{ref:ot,style:{display:"none",visibility:"hidden"}},[de.value?(Ca(),Ma(Fe,{key:0,logo:de.value.properties.logo,name:de.value.properties.name,"opening-count":de.value.properties.openingCount,description:de.value.properties.description},null,8,["logo","name","opening-count","description"])):Pf("",!0)],512)],512),si("div",qf,[Df(_e.$slots,"header"),si("div",$f,[jf,(Ca(!0),Ma(Lf,null,Rf(X.features,(ye,xe)=>(Ca(),Ma("div",{class:["box map-box",[s.value===ye.properties.name&&"is-active"]],onClick:be=>ie(ye),key:xe},[si("div",Zf,[si("div",Xf,[si(Q,{title:ye.properties.name,subtitle:`Open until ${ye.properties.openingCount}`,center:""},{icon:vp(()=>[si(G,{size:"small",picture:ye.properties.logo},null,8,["picture"])]),_:2},1032,["title","subtitle"])]),si("div",Wf,[si("p",null,ph(ye.properties.description),1)]),si("div",Hf,[Kf,si("div",Yf,[si("div",Jf,[Qf,si("span",em,ph(ye.properties.distance)+" mile ",1)])])])])],10,["onClick"]))),128))])])],2)])}}});export{sm as _};
