var t=Object.defineProperty,e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,r=(t,r)=>{for(var o in r||(r={}))s.call(r,o)&&a(t,o,r[o]);if(e)for(var o of e(r))i.call(r,o)&&a(t,o,r[o]);return t};import{_ as o}from"./inputsLayaut.vue_vue&type=style&index=0&lang.cc6b43e6.js";import{_ as n}from"./formLayaut.vue_vue&type=style&index=0&lang.86bdaa84.js";import{d as l,b as h,o as d,h as c,B as u,D as f,j as y,k as m,a9 as p,A as g,r as x,L as w,G as k}from"./vendor.1ed36195.js";import{c as S,i as v}from"./Staffs.246264fc.js";import{_ as b}from"./V-Button.vue_vue&type=script&setup=true&lang.f17c03d3.js";import{_ as I}from"./V-Card.vue_vue&type=script&setup=true&lang.aba09015.js";import{_ as T}from"./pdf_icon.0444a540.js";var A=l({expose:[],props:{type:{type:String,default:"create"},buttons:{type:Array,default:["save","back"]},step:{type:Number,default:1}},setup(t){const e=t;f();const s=h((()=>"create"==e.type?{title:"Add a new staff",subtitle:"Add information for a new staff"}:{title:"Edit staff",subtitle:"Edit information for a staff"}));return(t,i)=>{const a=o,r=n;return d(),c(r,{buttons:e.buttons,step:e.step,titles:u(s)},{default:y((()=>[m(a,{"inputs-step":u(S)},null,8,["inputs-step"])])),_:1},8,["buttons","step","titles"])}}}),D=l({expose:[],props:{type:{type:String,default:"create"},buttons:{type:Array,default:["save","back"]},step:{type:Number,default:1}},setup(t){const e=t;f();const s=h((()=>"create"==e.type?{title:"Add a new staff",subtitle:"Add permitions and roles"}:{title:"Edit staff",subtitle:"Edit permitions and roles"}));return(t,i)=>{const a=o,r=n;return d(),c(r,{buttons:e.buttons,step:e.step,titles:u(s)},{default:y((()=>[m(a,{"inputs-step":u(v)},null,8,["inputs-step"])])),_:1},8,["buttons","step","titles"])}}}),_=l({name:"VueDrawingCanvas",props:{strokeType:{type:String,validator:t=>-1!==["dash","square","circle","triangle","half_triangle"].indexOf(t),default:()=>"dash"},fillShape:{type:Boolean,default:()=>!1},width:{type:[String,Number],default:()=>600},height:{type:[String,Number],default:()=>400},image:{type:String,default:()=>""},eraser:{type:Boolean,default:()=>!1},color:{type:String,default:()=>"#000000"},lineWidth:{type:Number,default:()=>5},lock:{type:Boolean,default:()=>!1},styles:{type:[Array,String,Object]},classes:{type:[Array,String,Object]},backgroundColor:{type:String,default:()=>"#FFFFFF"},backgroundImage:{type:String,default:()=>null},watermark:{type:Object,default:()=>null},saveAs:{type:String,validator:t=>-1!==["jpeg","png"].indexOf(t),default:()=>"png"},canvasId:{type:String,default:()=>"VueDrawingCanvas"},initialImage:{type:Array,default:()=>[]},additionalImages:{type:Array,default:()=>[]}},data:()=>({loadedImage:null,drawing:!1,context:null,images:[],strokes:{type:"",from:{x:0,y:0},coordinates:[],color:"",width:"",fill:!1},guides:[],trash:[]}),mounted(){this.setContext(),this.$nextTick((()=>{this.drawInitialImage(),this.drawAdditionalImages()}))},watch:{backgroundImage:function(){this.loadedImage=null}},methods:{async setContext(){let t=document.querySelector("#"+this.canvasId);this.context=this.context?this.context:t.getContext("2d"),await this.setBackground()},drawInitialImage(){this.initialImage&&this.initialImage.length>0&&(this.images=[].concat(this.images,this.initialImage),this.redraw(!0))},drawAdditionalImages(){if(this.additionalImages&&this.additionalImages.length>0){let t=document.querySelector("#"+this.canvasId);this.additionalImages.forEach((e=>{this.drawWatermark(t,this.context,e)}))}},clear(){this.context.clearRect(0,0,this.width,this.height)},async setBackground(){this.clear(),this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height),await this.$nextTick((async()=>{await this.drawBackgroundImage()})),this.save()},async drawBackgroundImage(){if(!this.loadedImage)return new Promise((t=>{if(!this.backgroundImage)return void t();const e=new Image;e.src=this.backgroundImage,e.onload=()=>{this.context.drawImage(e,0,0,this.width,this.height),this.loadedImage=e,t()}}));this.context.drawImage(this.loadedImage,0,0,this.width,this.height)},getCoordinates(t){let e,s;if(t.touches&&t.touches.length>0){let i=document.querySelector("#"+this.canvasId).getBoundingClientRect();e=t.touches[0].clientX-i.left,s=t.touches[0].clientY-i.top}else e=t.offsetX,s=t.offsetY;return{x:e,y:s}},startDraw(t){if(!this.lock){this.drawing=!0;let e=this.getCoordinates(t);this.strokes={type:this.eraser?"eraser":this.strokeType,from:e,coordinates:[],color:this.eraser?this.backgroundColor:this.color,width:this.lineWidth,fill:!this.eraser&&"dash"!==this.strokeType&&this.fillShape},this.guides=[]}},draw(t){if(this.drawing){this.context||this.setContext();let e=this.getCoordinates(t);if(this.eraser||"dash"===this.strokeType)this.strokes.coordinates.push(e),this.drawShape(this.strokes,!1);else{let t;switch(this.strokeType){case"square":t=[{x:e.x,y:this.strokes.from.y},{x:e.x,y:e.y},{x:this.strokes.from.x,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"triangle":let s=Math.floor((e.x-this.strokes.from.x)/2)<0?-1*Math.floor((e.x-this.strokes.from.x)/2):Math.floor((e.x-this.strokes.from.x)/2),i=this.strokes.from.x<e.x?this.strokes.from.x+s:this.strokes.from.x-s;t=[{x:e.x,y:this.strokes.from.y},{x:i,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"half_triangle":t=[{x:e.x,y:this.strokes.from.y},{x:this.strokes.from.x,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"circle":let a=this.strokes.from.x-e.x<0?-1*(this.strokes.from.x-e.x):this.strokes.from.x-e.x;t=[{x:this.strokes.from.x>e.x?this.strokes.from.x-a:this.strokes.from.x+a,y:this.strokes.from.y},{x:a,y:a}]}this.guides=t,this.drawGuide(!0)}}},drawGuide(t){this.redraw(!1),this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.setLineDash([15,15]),"circle"===this.strokes.type?this.context.ellipse(this.guides[0].x,this.guides[0].y,this.guides[1].x,this.guides[1].y,0,0,2*Math.PI):(this.context.moveTo(this.strokes.from.x,this.strokes.from.y),this.guides.forEach((t=>{this.context.lineTo(t.x,t.y)})),t&&this.context.closePath()),this.context.stroke()},drawShape(t,e){this.context.strokeStyle=t.color,this.context.fillStyle=t.color,this.context.lineWidth=t.width,this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.setLineDash([]),"circle"===t.type?this.context.ellipse(t.coordinates[0].x,t.coordinates[0].y,t.coordinates[1].x,t.coordinates[1].y,0,0,2*Math.PI):(this.context.moveTo(t.from.x,t.from.y),t.coordinates.forEach((t=>{this.context.lineTo(t.x,t.y)})),e&&this.context.closePath()),t.fill?this.context.fill():this.context.stroke()},stopDraw(){this.drawing&&(this.strokes.coordinates=this.guides.length>0?this.guides:this.strokes.coordinates,this.images.push(this.strokes),this.redraw(!0),this.drawing=!1,this.trash=[])},reset(){this.lock||(this.images=[],this.strokes={type:"",coordinates:[],color:"",width:"",fill:!1},this.guides=[],this.trash=[],this.redraw(!0))},undo(){if(!this.lock){let t=this.images.pop();t&&(this.trash.push(t),this.redraw(!0))}},redo(){if(!this.lock){let t=this.trash.pop();t&&(this.images.push(t),this.redraw(!0))}},async redraw(t){t=void 0===t||t,await this.setBackground().then((()=>{this.drawAdditionalImages()})).then((()=>{this.images.forEach((t=>{this.drawShape(t,"eraser"!==t.type&&"dash"!==t.type)}))})).then((()=>{t&&this.save()}))},wrapText(t,e,s,i,a,r){const o=/\s+/g;var n=e.split(/(\r\n|\n\r|\n|\r)+/g).filter((t=>t.length>0));for(let u=0;u<n.length;u++){for(var l=n[u].split(o).filter((t=>t.length>0)),h="",d=0;d<l.length;d++){var c=h+l[d]+" ";t.measureText(c).width>a&&d>0?(this.watermark&&this.watermark.fontStyle&&this.watermark.fontStyle.drawType&&"stroke"===this.watermark.fontStyle.drawType?t.strokeText(h,s,i):t.fillText(h,s,i),h=l[d]+" ",i+=r):h=c}this.watermark&&this.watermark.fontStyle&&this.watermark.fontStyle.drawType&&"stroke"===this.watermark.fontStyle.drawType?t.strokeText(h,s,i):t.fillText(h,s,i),i+=l.length>0?r:0}},save(){if(!this.watermark){let t=document.querySelector("#"+this.canvasId);return this.$emit("update:image",t.toDataURL("image/"+this.saveAs,1)),t.toDataURL("image/"+this.saveAs,1)}{let t=document.querySelector("#"+this.canvasId),e=document.createElement("canvas"),s=e.getContext("2d");s&&(e.width=Number(this.width),e.height=Number(this.height),s.drawImage(t,0,0,Number(this.width),Number(this.height)),this.drawWatermark(e,s,this.watermark))}},drawWatermark(t,e,s){if("Image"===s.type){let i=s.imageStyle&&s.imageStyle.width?s.imageStyle.width:this.width,a=s.imageStyle&&s.imageStyle.height?s.imageStyle.height:this.height;const r=new Image;r.src=s.source,r.onload=()=>(s&&e&&e.drawImage(r,s.x,s.y,Number(i),Number(a)),this.$emit("update:image",t.toDataURL("image/"+this.saveAs,1)),t.toDataURL("image/"+this.saveAs,1))}else if("Text"===s.type){let i=s.fontStyle&&s.fontStyle.font?s.fontStyle.font:"20px serif",a=s.fontStyle&&s.fontStyle.textAlign?s.fontStyle.textAlign:"start",r=s.fontStyle&&s.fontStyle.textBaseline?s.fontStyle.textBaseline:"alphabetic",o=s.fontStyle&&s.fontStyle.color?s.fontStyle.color:"#000000";if(e.font=i,e.textAlign=a,e.textBaseline=r,s.fontStyle&&s.fontStyle.rotate){let t,i;t=s.fontStyle&&s.fontStyle.width?s.x+Math.floor(s.fontStyle.width/2):s.x,i=s.fontStyle&&s.fontStyle.lineHeight?s.y+Math.floor(s.fontStyle.lineHeight/2):s.y,e.translate(t,i),e.rotate(s.fontStyle.rotate*Math.PI/180),e.translate(-1*t,-1*i)}return s.fontStyle&&s.fontStyle.drawType&&"stroke"===s.fontStyle.drawType?(e.strokeStyle=s.fontStyle.color,s.fontStyle&&s.fontStyle.width?this.wrapText(e,s.source,s.x,s.y,s.fontStyle.width,s.fontStyle.lineHeight):e.strokeText(s.source,s.x,s.y)):(e.fillStyle=o,s.fontStyle&&s.fontStyle.width?this.wrapText(e,s.source,s.x,s.y,s.fontStyle.width,s.fontStyle.lineHeight):e.fillText(s.source,s.x,s.y)),this.$emit("update:image",t.toDataURL("image/"+this.saveAs,1)),t.toDataURL("image/"+this.saveAs,1)}},isEmpty(){return!(this.images.length>0)},getAllStrokes(){return this.images}},render(){return p("canvas",{id:this.canvasId,height:this.height,width:this.width,style:r({touchAction:"none"},this.styles),class:this.classes,onMousedown:t=>this.startDraw(t),onMousemove:t=>this.draw(t),onMouseup:()=>this.stopDraw(),onMouseleave:()=>this.stopDraw(),onTouchstart:t=>this.startDraw(t),onTouchmove:t=>this.draw(t),onTouchend:()=>this.stopDraw(),onTouchleave:()=>this.stopDraw(),onTouchcancel:()=>this.stopDraw(),onPointerdown:t=>this.startDraw(t),onPointermove:t=>this.draw(t),onPointerup:()=>this.stopDraw(),onPointerleave:()=>this.stopDraw(),onPointercancel:()=>this.stopDraw()})}});const C={class:"columns is-multiline"},j={class:"d-flex justify-content-center column is-12 mb-4"},P={class:"text-center mr-6"},B=m("img",{src:T,width:"40",alt:""},null,-1),E=m("p",null,null,-1),M=k(" View PDF "),N={class:"text-center ml-6"},O=m("img",{src:T,width:"40",alt:""},null,-1),L=m("p",null,null,-1),W=k(" View PDF "),R={key:0,class:"text-center mb-4 mt-5 mx-auto"},q=m("p",{class:"mb-4 title is-5"},"Saved signature",-1),F={class:"column is-12 mx-auto d-flex justify-content-center"},U=k(" Sign and save "),V=k(" Reset ");var $=l({expose:[],props:{firmado:{type:Boolean,required:!1}},emits:["onSign"],setup(t,{emit:e}){const s=t;g((()=>{var t=document.querySelector("canvas");t.setAttribute("tabindex","0"),t.focus()}));const i=x(!1),a=x(null),r=x(),o=async()=>{let t=r.value.save();a.value=t,e("onSign",t),i.value=!0};return(t,e)=>{const i=b,n=I;return d(),c(n,{radius:"small"},{default:y((()=>[m("div",C,[m("div",j,[m("div",P,[m("a",{target:"_blank",href:"https://dev-api.ushuaiacreative.com/generateContract/"},[B,E,m(i,{color:"success",outlined:"",class:"mt-4 py-1"},{default:y((()=>[M])),_:1})],8,["href"])]),m("div",N,[m("a",{target:"_blank",href:"https://dev-api.ushuaiacreative.com/generateWeiver/"},[O,L,m(i,{color:"success",outlined:"",class:"mt-4 py-1"},{default:y((()=>[W])),_:1})],8,["href"])])]),m(u(_),{class:"column is-6 mx-auto",ref:r,"save-as":"jpeg",width:"600",height:"200"},null,512),s.firmado?(d(),c("div",R,[q,m("img",{src:a.value,width:"400",height:"135",alt:""},null,8,["src"])])):w("",!0),m("div",F,[m(i,{color:"info",class:"text-center mx-auto",onClick:o},{default:y((()=>[U])),_:1}),m(i,{color:"danger",class:"text-center mx-auto",onClick:e[1]||(e[1]=t=>r.value.reset())},{default:y((()=>[V])),_:1})])])])),_:1})}}}),H=l({expose:[],props:{type:{type:String,default:"create"},buttons:{type:Array,default:["save","back"]},step:{type:Number,default:1}},setup(t){const e=t;x([{name:"Waiver_010221.pdf",url:""}]);const s=h((()=>"create"==e.type?{title:"Add a new staff",subtitle:"Add Waiver"}:{title:"Edit staff waiver",subtitle:"Edit Waiver"})),i=t=>{console.log(t)};return(t,a)=>{const r=$,o=n;return d(),c(o,{buttons:e.buttons,step:e.step,titles:u(s)},{default:y((()=>[m(r,{onOnSign:i})])),_:1},8,["buttons","step","titles"])}}});export{A as _,D as a,H as b};
