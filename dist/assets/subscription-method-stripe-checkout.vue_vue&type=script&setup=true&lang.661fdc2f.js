import{_ as e}from"./V-Card.vue_vue&type=script&setup=true&lang.e9e64dc2.js";import{_ as t}from"./V-Loader.vue_vue&type=script&setup=true&lang.069747cb.js";import{_ as a}from"./V-Button.vue_vue&type=script&setup=true&lang.cc6d2b95.js";import{s as l,_ as s}from"./MemberCards.09df6f49.js";import{_ as n}from"./V-Modal.vue_vue&type=script&setup=true&lang.ef7028a7.js";import{n as i,m as u,A as o}from"./index.6baa4693.js";import{d as c,r,h as d,i as p,k as v,l as m,R as f,H as y,L as _,K as b,G as g,b as x,W as h,X as C,F as k,S as j,_ as S,u as N,A as w,w as O}from"./vendor.4454b83d.js";import{_ as J}from"./V-Control.63a8a239.js";import{_ as z}from"./V-Field.vue_vue&type=script&setup=true&lang.b3ed284d.js";import{c as P}from"./Companies.f986ca55.js";const V={class:"d-flex justify-content-between align-items-start"},T=m("p",{class:"title is-3"},[m("i",{class:"fas fa-credit-card","aria-hidden":"true"})],-1),$={class:"title is-5"},q={key:0,class:"title is-6"},B=m("p",null,[m("b",null,"Cards")],-1),F={key:0,class:"pb-3 mb-5"},I=g(" Sync Cards "),A=g("Confirm");var L=c({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0},card:{type:Boolean,default:!1},textCard:{type:String,default:"Debit Automatic"},newUser:{type:Boolean,dafutl:!1},outline:{type:Boolean,dafutl:!1}},emits:["onPayment"],setup(u,{emit:o}){const c=u,g=r(!1),x=()=>{null!=j.value?(g.value=!1,o("onPayment",{amount:c.total,payment_type_id:3,payment_method_id:j.value})):i.error("Select card")},h=r(!1),C=r(!0),k=()=>{l(c.user.id).then((e=>{C.value=!1,setTimeout((()=>{C.value=!0}),100)}))},j=r(null);return(l,i)=>{const o=e,r=t,S=a,N=s,w=n;return d(),p(f,null,[c.card?(d(),p(r,{key:1,class:"h-100",size:"small",active:l.isLoaderActive},{default:v((()=>[m(o,{color:"success",outlined:"",onClick:i[2]||(i[2]=e=>g.value=!0),class:"\r\n        mr-4\r\n        btn-card\r\n        text-center\r\n        px-2\r\n        h-100\r\n        d-flex\r\n        align-items-center\r\n        justify-content-center\r\n      ",style:{"font-size":"14px"}},{default:v((()=>[B,_(l.$slots,"default")])),_:3})])),_:1},8,["active"])):(d(),p(o,{key:0,onClick:i[1]||(i[1]=e=>g.value=!0),color:"success",class:"mx-2 btn-card w-100 justify-content-center h-100",outlined:c.outline},{default:v((()=>[m("div",V,[m("div",null,[T,m("p",$,y(c.textCard),1)]),(d(),p("p",q,[_(l.$slots,"righttop")]))])])),_:3},8,["outlined"])),m(w,{title:"",size:"big",open:g.value,actions:"center",onClose:i[4]||(i[4]=e=>g.value=!1)},{content:v((()=>[u.newUser?b("",!0):(d(),p("div",F,[m(r,{size:"large",active:h.value},{default:v((()=>[m(S,{color:"undefined",onClick:k,class:"d-flex justify-content-center",raised:""},{default:v((()=>[I])),_:1})])),_:1},8,["active"])])),c.user&&g.value&&C.value?(d(),p(N,{key:1,"show-option":!0,class:"mb-6",modelValue:j.value,"onUpdate:modelValue":i[3]||(i[3]=e=>j.value=e),method_default:c.user.pm_last_four,"show-new-card":!0,user:c.user,"on-new-card-u-r-l":"v2/stripe/setup","add-card-stripe-u-r-l":"v2/stripe/addCard",v2:!0,actions:[]},null,8,["modelValue","method_default","user"])):b("",!0)])),action:v((()=>[m(S,{color:"success",onClick:x,disabled:!j.value,class:"d-flex justify-content-center",raised:""},{default:v((()=>[A])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const D={class:"d-flex justify-content-between align-items-start"},U=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-money-bill-wave","aria-hidden":"true"})]),m("p",{class:"title is-5"},"Cash")],-1),M={class:"title is-6"},R={class:"d-flex mb-4 justify-content-between"},G={class:"title is-5"},H=g(" Total: "),K={class:"title is-5"},W=g(" Cash Total: "),X={class:"\r\n            d-flex\r\n            justify-content-center\r\n            align-items-center\r\n            flex-column\r\n            mb-4\r\n          "},E=m("p",{class:"title is-5 mb-4"},"Change Back:",-1),Q={class:"title is-3 mb-0"},Y={class:"d-flex justify-content-center flex-wrap mb-4"},Z=m("div",{class:"w-100"},null,-1),ee={class:"d-flex justify-content-center"},te=g("Reset"),ae=g("Confirm");var le=c({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0}},emits:["onPayment"],setup(t,{emit:l}){const s=t,i=r(!1),o=r(0),c=x((()=>{const e=parseFloat(o.value)-parseFloat(s.total);return e>0?e:0})),b=()=>{i.value=!1,l("onPayment",{cash:o.value,changeBack:c.value,amount:s.total,payment_type_id:1})},N=()=>{i.value=!0};return(l,r)=>{const x=e,w=a,O=J,P=z,V=n;return d(),p(f,null,[m(x,{onClick:N,color:s.define_status?"warning":void 0,class:"btn-card w-100 justify-content-center"},{default:v((()=>[m("div",D,[U,m("p",M,[_(l.$slots,"righttop")])])])),_:3},8,["color"]),m(V,{title:"",open:i.value,actions:"center",onClose:r[4]||(r[4]=e=>i.value=!1)},{content:v((()=>[h(m("div",null,[_(l.$slots,"modalprev")],512),[[C,!s.define_status]]),h(m("div",null,[m("div",R,[m("p",G,[H,m("b",null,y(k(u)(t.total)),1)]),m("p",K,[W,m("b",null,y(k(u)(o.value)),1)])]),m("div",X,[E,m("p",Q,[m("b",null,y(k(u)(k(c))),1)])]),m("div",Y,[m(w,{bold:"",class:"m-3",style:{"font-size":"14px"},onClick:r[1]||(r[1]=e=>o.value=t.total)},{default:v((()=>[g(" Full Payment "+y(k(u)(t.total)),1)])),_:1}),Z,(d(),p(f,null,j([5,10,20,50,100],((e,t)=>m(w,{key:`calculato-${t}`,bold:"",class:"m-3",style:{"font-size":"14px"},onClick:t=>(e=>{o.value=parseFloat(o.value)+parseFloat(e)})(e)},{default:v((()=>[g(" $"+y(e),1)])),_:2},1032,["onClick"]))),64))]),m("div",ee,[m(P,null,{default:v((()=>[m(O,null,{default:v((()=>[h(m("input",{"onUpdate:modelValue":r[2]||(r[2]=e=>o.value=e),type:"text",class:"input text-center",placeholder:"Cash"},null,512),[[S,o.value]])])),_:1})])),_:1})])],512),[[C,s.define_status]])])),action:v((()=>[m(w,{onClick:r[3]||(r[3]=e=>o.value=0),class:"d-flex justify-content-center",raised:""},{default:v((()=>[te])),_:1}),m(w,{color:"success",onClick:b,disabled:t.total>o.value,class:"d-flex justify-content-center",raised:""},{default:v((()=>[ae])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const se=r([{typeInput:"text",name:"description",placeholder:"Description",model:"",class:"is-12",isLabel:!0,required:!0},{typeInput:"text",name:"amount",placeholder:"Amount",model:"",class:"is-12",isLabel:!0,required:!0}]),ne={failure_code:null,failure_message:null,process_payment_intent:{payment_intent:""},status:"",type:""},ie={amount:0,id:"",created:"",status:""},ue=r(JSON.parse(JSON.stringify(ne))),oe=r(JSON.parse(JSON.stringify(ie))),ce=async(e={})=>await o.post("make-manual-payment",e),re=async e=>{const t=await o.post("v2/stripe/stopTerminal",e);return ue.value=JSON.parse(JSON.stringify(ne)),oe.value=JSON.parse(JSON.stringify(ie)),t},de={class:"d-flex justify-content-between align-items-start"},pe=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-mobile","aria-hidden":"true"})]),m("p",{class:"title is-5"},"Terminal")],-1),ve={class:"title is-6"},me={key:0},fe={key:0,class:"mt-4 mx-2"},ye={class:"column is-8"},_e=m("p",{class:"title is-1"},[m("i",{class:"lnir lnir-postcard","aria-hidden":"true"})],-1),be={class:"title is-5 mb-0"},ge={style:{"font-size":"10px"},class:"is-7 mb-0"},xe={style:{"font-size":"10px"},class:"is-7 mb-0"},he={style:{"font-size":"10px"},class:"is-7 mb-0"},Ce={style:{"font-size":"10px"},class:"is-7 mb-0"},ke={style:{"font-size":"10px"},class:"is-7 mb-0"},je={key:0},Se=m("p",{class:"title is-7 text-capitalize m-0"},"retry",-1),Ne=m("p",{class:"title is-6"},[m("i",{class:"lnil lnil-reload"})],-1),we={class:"column is-4"},Oe=m("div",null,[m("p",{class:"title is-6 mb-0"},"Terminal status")],-1),Je=m("p",{class:"title is-5"},[m("i",{class:"lnil lnil-reload"})],-1),ze=m("div",null,[m("p",{class:"title is-6 mb-0"},"Cancel payment")],-1),Pe=m("p",{class:"title is-5"},[m("i",{class:"lnil lnil-trash-can"})],-1),Ve={key:0,class:"column is-12"},Te=m("div",null,[m("p",{class:"title is-6 mb-0"},"Clean and Close")],-1),$e={key:0},qe=m("p",{class:"title is-5"},[m("i",{class:"lnil lnil-checkmark-circle"})],-1);var Be=c({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0}},emits:["onPayment"],setup(a,{emit:l}){const s=a,{cookies:c}=N(),g=r(!1),S=r([]),J=()=>{g.value=!0;let e=P.value.locations;if(e.length&&c.get("locations_id")){let t=e.find((e=>e.id==c.get("locations_id")));if(null!=t){let e=t.terminales;e.length&&(S.value=e)}}0==S.value&&i.error("No terminals found at this location")},z=w(JSON.parse(JSON.stringify({id:null,label:"",status:!1,amount:0}))),V=r(!1);O((()=>g.value),(e=>{z.id=null,z.label="",z.status=!1,z.amount=0,V.value=!1,I.value=!1,T.value=!1,M.value=0,ue.value=JSON.parse(JSON.stringify(ne)),oe.value=JSON.parse(JSON.stringify(ie))}));const T=r(!1),$=r(10);O((()=>ue.value.status),(e=>{T.value&&("succeeded"==e?(i.success("Payment Success"),g.value=!1,M.value<=$.value&&F()):"failed"==e?i.error(ue.value.failure_message):"in_progress"==e&&i.success("Payment in progress")),T.value||"succeeded"==e&&R()}));const q=x((()=>{let e={status:"",message:"",color:""};return e.status=ue.value.status,"succeeded"==e.status&&(e.color="success"),"failed"==e.status&&(e.color="danger"),"in_progress"==e.status&&(e.color="info"),e})),B=()=>{"in_progress"!=ue.value.status?"succeeded"!=ue.value.status?null!=z.id?(U(),V.value=!0,(async e=>{const t=await o.post("v2/stripe/paymentIntentTerminal",e);return null==t.data.terminal?ue.value=JSON.parse(JSON.stringify(ne)):ue.value=t.data.terminal,null==t.data.payment_intent?oe.value=JSON.parse(JSON.stringify(ie)):oe.value=t.data.payment_intent,t})(z).then((e=>{V.value=!1,i.success(e.data.message)})).catch((e=>{V.value=!1}))):console.log("alert. no selecciono el terminal de pago"):i.error("Payment processed"):i.error("Terminal busy")},F=()=>{l("onPayment",{amount:s.total,payment_type_id:5})},I=r(!1),A=e=>{"succeeded"!=ue.value.status&&(I.value=!0,(async e=>{const t=await o.post("v2/stripe/consultaTerminal",e);return null==t.data.terminal?ue.value=JSON.parse(JSON.stringify(ne)):ue.value=t.data.terminal,null==t.data.payment_intent?oe.value=JSON.parse(JSON.stringify(ie)):oe.value=t.data.payment_intent,t})({id:e.id}).then((()=>{I.value=!1})).catch((()=>{I.value=!1})))},L=x((()=>null!=z.id)),D=()=>{L.value||(g.value=!1)},U=()=>{new Pusher("2cd5b586808b2f41f8e6",{cluster:"us2"}).subscribe("terminal_channel").bind("terminal_event",(function(e){T.value=!0,null==e.terminal?ue.value=JSON.parse(JSON.stringify(ne)):ue.value=e.terminal,null==e.payment_intent?oe.value=JSON.parse(JSON.stringify(ie)):oe.value=e.payment_intent}))},M=r(0),R=()=>{M.value=0;let e=setInterval((()=>{M.value++,M.value==$.value&&clearInterval(e)}),1e3)};return(a,i)=>{const o=e,c=t,r=n;return d(),p(f,null,[m(o,{onClick:J,color:s.define_status?"info":void 0,class:"btn-card w-100 justify-content-center"},{default:v((()=>[m("div",de,[pe,m("p",ve,[_(a.$slots,"righttop")])])])),_:3},8,["color"]),m(r,{title:"",open:g.value,actions:"center",size:"big",noclose:"",onClose:D},{content:v((()=>[h(m("div",null,[_(a.$slots,"modalprev")],512),[[C,!s.define_status]]),0==S.value.length?(d(),p("p",me,"'No terminals found at this location'")):b("",!0),h(m("div",null,[S.value.length?(d(),p("div",fe,[m(c,{size:"small",active:V.value},{default:v((()=>[(d(!0),p(f,null,j(S.value,((e,t)=>(d(),p(o,{key:`terminal-${t}`,class:"columns is-multiline mb-4"},{default:v((()=>[m("div",ye,[m(o,{class:"p-4 btn-card d-flex justify-content-between",color:k(z).id==e.id?k(q).color:void 0,onClick:t=>(e=>{z.id=e.id,z.label=e.label,z.status=e.status,z.amount=s.total,B()})(e)},{default:v((()=>[m("div",null,[_e,m("p",be,y(e.label),1),m("p",null,"Status: "+y(e.status),1)]),m("div",null,[m("p",ge," ID: "+y(k(oe).id),1),m("p",xe," Amount: "+y(k(u)(k(oe).amount/100)),1),m("p",he," Date: "+y(k(oe).created),1),m("p",Ce," PI. Status: "+y(k(oe).status),1),m("p",ke," Status: "+y(k(ue).status),1),"failed"==k(ue).status?(d(),p("div",je,[m(o,{class:"d-flex justify-content-between mt-4 p-2 align-items-center"},{default:v((()=>[Se,Ne])),_:1})])):b("",!0)])])),_:2},1032,["color","onClick"])]),m("div",we,[m(c,{size:"small",active:I.value},{default:v((()=>[m(o,{color:"warning",outlined:"",onClick:t=>A(e),class:"d-flex justify-content-between mb-4"},{default:v((()=>[Oe,Je])),_:2},1032,["onClick"])])),_:2},1032,["active"]),m(c,{size:"small",active:I.value},{default:v((()=>[m(o,{color:"danger",outlined:"",onClick:t=>(e=>{"succeeded"!=ue.value.status&&(I.value=!0,re({id:e.id,payment_type_id:oe.value.id}).then((()=>{g.value=!1,I.value=!1})).catch((()=>{I.value=!1})))})(e),class:"d-flex justify-content-between"},{default:v((()=>[ze,Pe])),_:2},1032,["onClick"])])),_:2},1032,["active"])]),"succeeded"==k(ue).status?(d(),p("div",Ve,[m(c,{size:"small",active:I.value},{default:v((()=>[m(o,{color:M.value==$.value?"success":void 0,outlined:"",onClick:t=>(e=>{M.value==$.value&&(re({id:e.id,payment_type_id:null}),g.value=!1,I.value=!1,l("onPayment",{amount:s.total,payment_type_id:5}))})(e),class:"d-flex justify-content-between"},{default:v((()=>[Te,M.value<$.value?(d(),p("p",$e,"Loading ... "+y(M.value),1)):b("",!0),qe])),_:2},1032,["color","onClick"])])),_:2},1032,["active"])])):b("",!0)])),_:2},1024)))),128))])),_:1},8,["active"])])):b("",!0)],512),[[C,s.define_status]])])),action:v((()=>[])),_:1},8,["open"])],64)}}});const Fe={class:"d-flex justify-content-between align-items-start"},Ie=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-credit-card","aria-hidden":"true"})]),m("p",{class:"title is-5"},"Debit Card")],-1),Ae={key:0,class:"title is-6"};var Le=c({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0}},emits:["onPayment"],setup(t,{emit:a}){const l=t,s=r(!1),n=()=>{s.value=!1,a("onPayment",{amount:l.total,payment_type_id:3})};return(t,a)=>{const l=e;return d(),p(l,{onClick:n,color:"success",class:"mx-2 btn-card w-100 justify-content-center",outlined:""},{default:v((()=>[m("div",Fe,[Ie,(d(),p("p",Ae))])])),_:1})}}});export{L as _,le as a,Be as b,Le as c,ce as d,se as m};
