import{n as e,A as t,m as a}from"./index.d7809451.js";import{c as s}from"./Discounts.d786777e.js";import{r as l,A as n,d as i,h as u,i as c,k as o,l as r,R as d,H as p,L as m,K as v,G as f,b as y,W as _,X as b,F as h,S as g,_ as w,u as C,w as x}from"./vendor.4454b83d.js";import{_ as O}from"./V-Card.vue_vue&type=script&setup=true&lang.e9e64dc2.js";import{_ as N}from"./V-Loader.vue_vue&type=script&setup=true&lang.069747cb.js";import{_ as S}from"./V-Button.vue_vue&type=script&setup=true&lang.cc6d2b95.js";import{s as k,_ as j}from"./MemberCards.a2b9071f.js";import{_ as J}from"./V-Modal.vue_vue&type=script&setup=true&lang.ef7028a7.js";import{_ as I}from"./V-Control.63a8a239.js";import{_ as P}from"./V-Field.vue_vue&type=script&setup=true&lang.b3ed284d.js";import{c as $}from"./Companies.bbb4445f.js";const E=l([{value:"All",name:"All"},{value:"COBRAR HOY",name:"Pay Day"},{value:"PENDIENTE",name:"Pending"},{value:"VENCIDO",name:"Due"},{value:"PAGADO",name:"Paid"},{value:"CANCELADO",name:"Canceled"},{value:"EXPIRADO",name:"Expired"},{value:"PROX. EXPIRADO",name:"Prox. Expired"},{value:"HOLD",name:"Hold"}]),D=l(null),L=l(null),z={memberships_id:null,recurrences_id:null,is_initiation_fee:!0,is_card_price:!1,discount:null,is_last_month:!1,multigym:!1,prorrateo:!0,schedules:"",leo_vet_fr:!1,payment_type_id:3},A=n(JSON.parse(JSON.stringify(z))),q=()=>{Object.assign(A,JSON.parse(JSON.stringify(z)))},T=l([{typeInput:"switchEventChangeInput",name:"is_initiation_fee",values:["NO","YES"],placeholder:"Initiation fee",default:!0,model:A.is_initiation_fee,disabled:!1,class:"is-3 switch-button",isLabel:!0},{typeInput:"switchEventChangeInput",default:!1,name:"is_card_price",placeholder:"Card",values:["NO","YES"],model:!1,disabled:!1,class:"is-3 switch-button",isLabel:!0},{typeInput:"switchEventChangeInput",default:!1,name:"is_last_month",placeholder:"Last Month",values:["NO","YES"],model:!1,disabled:!1,class:"is-3 switch-button",isLabel:!0},{typeInput:"switchEventChangeInput",default:!1,name:"multigym",placeholder:"MultiGym",values:["NO","YES"],model:!1,disabled:!1,class:"is-3 switch-button",isLabel:!0},{typeInput:"switchEventChangeInput",name:"prorrateo",values:["NO","YES"],placeholder:"Prorated Payment",model:!0,default:!0,required:!1,class:"is-3 switch-button",isLabel:!0},{typeInput:"switch",name:"leo_vet_fr",values:["NO","YES"],placeholder:"Member is: Law Enforcement Officer, Veteran o First Responder.",model:!1,default:!1,required:!1,class:"is-9 switch-button",isLabel:!0,categories:["Adult"],typeMember:["Individual"]},{typeInput:"hidden",name:"schedules",placeholder:"Subscription Schedules",model:"",required:!1,class:"is-4",isLabel:!0},{typeInput:"selectDataActionChangeInput",name:"discount",placeholder:"Discount",values:[],data:null,model:"",disabled:!1,class:"is-4",isLabel:!0,change:function(t){""!=this.model?s(this.values.find((e=>e.id==this.model)).code,"membership").then((t=>{this.data=t.data,e.success("Discuount valid")})).catch((t=>{e.error(t.response.data),this.model=""})):this.data=null}},{name:"payment_type_id",typeInput:"selectData",placeholder:"Payment Type",model:3,required:!0,values:[{id:1,name:"Cash"},{id:3,name:"Debit automatic"}],class:"is-4",isLabel:!0,filterOptionText:function(e){return e.name}}]);n({recurrence:!0,locations:[],diciplines:[],member:{}});const V=async()=>await t.get("v2/get_membership"),B=async(e=null,a=null)=>await t.get(`discounts?status=${e}&applies=${a}`),F=async e=>await t.post("v2/presupuesto_member",e),R=async e=>await t.post("v2/create_suscripcion",e),Y=async(e,a)=>await t.post(`v2/suscripcion/remplace/${e}`,a),M=async(e,a=!0)=>await t.post(`v2/get_suscripcion/${e}?is_member=${a}`),H=async e=>await t.post(`v2/get_suscripcion/code/${e}`),U=async(e,a)=>await t.post(`v2/suscripcion/payment/${e}`,a),X=async(e,a)=>await t.post(`v2/suscripcion/cancel/${e}`,a),G=async(e,a)=>await t.post(`v2/suscripcion/upgrade/${e}`,a),K=async(e,a)=>await t.post(`v2/suscripcion/update/${e}`,a),W=async(e,a)=>await t.post(`v2/suscripcion/hold/${e}`,a),Q=async(e,a)=>await t.post(`v2/suscripcion/process_multigym/${e}`,a),Z=async(e,a)=>await t.post(`v2/suscripcion/get_amount_multigym/${e}`,a),ee=async e=>await t.post(`v2/suscripcion/calculo_suscripcion_restante/${e}`),te={class:"d-flex justify-content-between align-items-start"},ae=r("p",{class:"title is-3"},[r("i",{class:"fas fa-credit-card","aria-hidden":"true"})],-1),se={class:"title is-5"},le={key:0,class:"title is-6"},ne=r("p",null,[r("b",null,"Cards")],-1),ie={key:0,class:"pb-3 mb-5"},ue=f(" Sync Cards "),ce=f("Confirm");var oe=i({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0},card:{type:Boolean,default:!1},textCard:{type:String,default:"Debit Automatic"},newUser:{type:Boolean,dafutl:!1},outline:{type:Boolean,dafutl:!1}},emits:["onPayment"],setup(t,{emit:a}){const s=t,n=l(!1),i=()=>{null!=b.value?(n.value=!1,a("onPayment",{amount:s.total,payment_type_id:3,payment_method_id:b.value})):e.error("Select card")},f=l(!1),y=l(!0),_=()=>{k(s.user.id).then((e=>{y.value=!1,setTimeout((()=>{y.value=!0}),100)}))},b=l(null);return(e,a)=>{const l=O,h=N,g=S,w=j,C=J;return u(),c(d,null,[s.card?(u(),c(h,{key:1,class:"h-100",size:"small",active:e.isLoaderActive},{default:o((()=>[r(l,{color:"success",outlined:"",onClick:a[2]||(a[2]=e=>n.value=!0),class:"\r\n        mr-4\r\n        btn-card\r\n        text-center\r\n        px-2\r\n        h-100\r\n        d-flex\r\n        align-items-center\r\n        justify-content-center\r\n      ",style:{"font-size":"14px"}},{default:o((()=>[ne,m(e.$slots,"default")])),_:3})])),_:1},8,["active"])):(u(),c(l,{key:0,onClick:a[1]||(a[1]=e=>n.value=!0),color:"success",class:"mx-2 btn-card w-100 justify-content-center h-100",outlined:s.outline},{default:o((()=>[r("div",te,[r("div",null,[ae,r("p",se,p(s.textCard),1)]),(u(),c("p",le,[m(e.$slots,"righttop")]))])])),_:3},8,["outlined"])),r(C,{title:"",size:"big",open:n.value,actions:"center",onClose:a[4]||(a[4]=e=>n.value=!1)},{content:o((()=>[t.newUser?v("",!0):(u(),c("div",ie,[r(h,{size:"large",active:f.value},{default:o((()=>[r(g,{color:"undefined",onClick:_,class:"d-flex justify-content-center",raised:""},{default:o((()=>[ue])),_:1})])),_:1},8,["active"])])),s.user&&n.value&&y.value?(u(),c(w,{key:1,"show-option":!0,class:"mb-6",modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value=e),method_default:s.user.pm_last_four,"show-new-card":!0,user:s.user,"on-new-card-u-r-l":"v2/stripe/setup","add-card-stripe-u-r-l":"v2/stripe/addCard",v2:!0,actions:[]},null,8,["modelValue","method_default","user"])):v("",!0)])),action:o((()=>[r(g,{color:"success",onClick:i,disabled:!b.value,class:"d-flex justify-content-center",raised:""},{default:o((()=>[ce])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const re={class:"d-flex justify-content-between align-items-start"},de=r("div",null,[r("p",{class:"title is-3"},[r("i",{class:"fas fa-money-bill-wave","aria-hidden":"true"})]),r("p",{class:"title is-5"},"Cash")],-1),pe={class:"title is-6"},me={class:"d-flex mb-4 justify-content-between"},ve={class:"title is-5"},fe=f(" Total: "),ye={class:"title is-5"},_e=f(" Cash Total: "),be={class:"\r\n            d-flex\r\n            justify-content-center\r\n            align-items-center\r\n            flex-column\r\n            mb-4\r\n          "},he=r("p",{class:"title is-5 mb-4"},"Change Back:",-1),ge={class:"title is-3 mb-0"},we={class:"d-flex justify-content-center flex-wrap mb-4"},Ce=r("div",{class:"w-100"},null,-1),xe={class:"d-flex justify-content-center"},Oe=f("Reset"),Ne=f("Confirm");var Se=i({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0}},emits:["onPayment"],setup(e,{emit:t}){const s=e,n=l(!1),i=l(0),v=y((()=>{const e=parseFloat(i.value)-parseFloat(s.total);return e>0?e:0})),C=()=>{n.value=!1,t("onPayment",{cash:i.value,changeBack:v.value,amount:s.total,payment_type_id:1})},x=()=>{n.value=!0};return(t,l)=>{const y=O,N=S,k=I,j=P,$=J;return u(),c(d,null,[r(y,{onClick:x,color:s.define_status?"warning":void 0,class:"btn-card w-100 justify-content-center"},{default:o((()=>[r("div",re,[de,r("p",pe,[m(t.$slots,"righttop")])])])),_:3},8,["color"]),r($,{title:"",open:n.value,actions:"center",onClose:l[4]||(l[4]=e=>n.value=!1)},{content:o((()=>[_(r("div",null,[m(t.$slots,"modalprev")],512),[[b,!s.define_status]]),_(r("div",null,[r("div",me,[r("p",ve,[fe,r("b",null,p(h(a)(e.total)),1)]),r("p",ye,[_e,r("b",null,p(h(a)(i.value)),1)])]),r("div",be,[he,r("p",ge,[r("b",null,p(h(a)(h(v))),1)])]),r("div",we,[r(N,{bold:"",class:"m-3",style:{"font-size":"14px"},onClick:l[1]||(l[1]=t=>i.value=e.total)},{default:o((()=>[f(" Full Payment "+p(h(a)(e.total)),1)])),_:1}),Ce,(u(),c(d,null,g([5,10,20,50,100],((e,t)=>r(N,{key:`calculato-${t}`,bold:"",class:"m-3",style:{"font-size":"14px"},onClick:t=>(e=>{i.value=parseFloat(i.value)+parseFloat(e)})(e)},{default:o((()=>[f(" $"+p(e),1)])),_:2},1032,["onClick"]))),64))]),r("div",xe,[r(j,null,{default:o((()=>[r(k,null,{default:o((()=>[_(r("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>i.value=e),type:"text",class:"input text-center",placeholder:"Cash"},null,512),[[w,i.value]])])),_:1})])),_:1})])],512),[[b,s.define_status]])])),action:o((()=>[r(N,{onClick:l[3]||(l[3]=e=>i.value=0),class:"d-flex justify-content-center",raised:""},{default:o((()=>[Oe])),_:1}),r(N,{color:"success",onClick:C,disabled:e.total>i.value,class:"d-flex justify-content-center",raised:""},{default:o((()=>[Ne])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const ke={class:"d-flex justify-content-between align-items-start"},je=r("div",null,[r("p",{class:"title is-3"},[r("i",{class:"fas fa-credit-card","aria-hidden":"true"})]),r("p",{class:"title is-5"},"Debit Card")],-1),Je={key:0,class:"title is-6"};var Ie=i({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0}},emits:["onPayment"],setup(e,{emit:t}){const a=e,s=l(!1),n=()=>{s.value=!1,t("onPayment",{amount:a.total,payment_type_id:3})};return(e,t)=>{const a=O;return u(),c(a,{onClick:n,color:"success",class:"mx-2 btn-card w-100 justify-content-center",outlined:""},{default:o((()=>[r("div",ke,[je,(u(),c("p",Je))])])),_:1})}}});const Pe=l([{typeInput:"text",name:"description",placeholder:"Description",model:"",class:"is-12",isLabel:!0,required:!0},{typeInput:"text",name:"amount",placeholder:"Amount",model:"",class:"is-12",isLabel:!0,required:!0}]),$e={failure_code:null,failure_message:null,process_payment_intent:{payment_intent:""},status:"",type:""},Ee={amount:0,id:"",created:"",status:""},De=l(JSON.parse(JSON.stringify($e))),Le=l(JSON.parse(JSON.stringify(Ee))),ze=async(e={})=>await t.post("make-manual-payment",e),Ae=async e=>{const a=await t.post("v2/stripe/stopTerminal",e);return De.value=JSON.parse(JSON.stringify($e)),Le.value=JSON.parse(JSON.stringify(Ee)),a},qe={class:"d-flex justify-content-between align-items-start"},Te=r("div",null,[r("p",{class:"title is-3"},[r("i",{class:"fas fa-mobile","aria-hidden":"true"})]),r("p",{class:"title is-5"},"Terminal")],-1),Ve={class:"title is-6"},Be={key:0},Fe={key:0,class:"mt-4 mx-2"},Re={class:"column is-8"},Ye=r("p",{class:"title is-1"},[r("i",{class:"lnir lnir-postcard","aria-hidden":"true"})],-1),Me={class:"title is-5 mb-0"},He={style:{"font-size":"10px"},class:"is-7 mb-0"},Ue={style:{"font-size":"10px"},class:"is-7 mb-0"},Xe={style:{"font-size":"10px"},class:"is-7 mb-0"},Ge={style:{"font-size":"10px"},class:"is-7 mb-0"},Ke={style:{"font-size":"10px"},class:"is-7 mb-0"},We={key:0},Qe=r("p",{class:"title is-7 text-capitalize m-0"},"retry",-1),Ze=r("p",{class:"title is-6"},[r("i",{class:"lnil lnil-reload"})],-1),et={class:"column is-4"},tt=r("div",null,[r("p",{class:"title is-6 mb-0"},"Terminal status")],-1),at=r("p",{class:"title is-5"},[r("i",{class:"lnil lnil-reload"})],-1),st=r("div",null,[r("p",{class:"title is-6 mb-0"},"Cancel payment")],-1),lt=r("p",{class:"title is-5"},[r("i",{class:"lnil lnil-trash-can"})],-1),nt={key:0,class:"column is-12"},it=r("div",null,[r("p",{class:"title is-6 mb-0"},"Clean and Close")],-1),ut={key:0},ct=r("p",{class:"title is-5"},[r("i",{class:"lnil lnil-checkmark-circle"})],-1);var ot=i({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0}},emits:["onPayment"],setup(s,{emit:i}){const f=s,{cookies:w}=C(),S=l(!1),k=l([]),j=()=>{S.value=!0;let t=$.value.locations;if(t.length&&w.get("locations_id")){let e=t.find((e=>e.id==w.get("locations_id")));if(null!=e){let t=e.terminales;t.length&&(k.value=t)}}0==k.value&&e.error("No terminals found at this location")},I=n(JSON.parse(JSON.stringify({id:null,label:"",status:!1,amount:0}))),P=l(!1);x((()=>S.value),(e=>{I.id=null,I.label="",I.status=!1,I.amount=0,P.value=!1,q.value=!1,E.value=!1,R.value=0,De.value=JSON.parse(JSON.stringify($e)),Le.value=JSON.parse(JSON.stringify(Ee))}));const E=l(!1),D=l(10);x((()=>De.value.status),(t=>{E.value&&("succeeded"==t?(e.success("Payment Success"),S.value=!1,R.value<=D.value&&A()):"failed"==t?e.error(De.value.failure_message):"in_progress"==t&&e.success("Payment in progress")),E.value||"succeeded"==t&&Y()}));const L=y((()=>{let e={status:"",message:"",color:""};return e.status=De.value.status,"succeeded"==e.status&&(e.color="success"),"failed"==e.status&&(e.color="danger"),"in_progress"==e.status&&(e.color="info"),e})),z=()=>{"in_progress"!=De.value.status?"succeeded"!=De.value.status?null!=I.id?(F(),P.value=!0,(async e=>{const a=await t.post("v2/stripe/paymentIntentTerminal",e);return null==a.data.terminal?De.value=JSON.parse(JSON.stringify($e)):De.value=a.data.terminal,null==a.data.payment_intent?Le.value=JSON.parse(JSON.stringify(Ee)):Le.value=a.data.payment_intent,a})(I).then((t=>{P.value=!1,e.success(t.data.message)})).catch((e=>{P.value=!1}))):console.log("alert. no selecciono el terminal de pago"):e.error("Payment processed"):e.error("Terminal busy")},A=()=>{i("onPayment",{amount:f.total,payment_type_id:5})},q=l(!1),T=e=>{"succeeded"!=De.value.status&&(q.value=!0,(async e=>{const a=await t.post("v2/stripe/consultaTerminal",e);return null==a.data.terminal?De.value=JSON.parse(JSON.stringify($e)):De.value=a.data.terminal,null==a.data.payment_intent?Le.value=JSON.parse(JSON.stringify(Ee)):Le.value=a.data.payment_intent,a})({id:e.id}).then((()=>{q.value=!1})).catch((()=>{q.value=!1})))},V=y((()=>null!=I.id)),B=()=>{V.value||(S.value=!1)},F=()=>{new Pusher("2cd5b586808b2f41f8e6",{cluster:"us2"}).subscribe("terminal_channel").bind("terminal_event",(function(e){E.value=!0,null==e.terminal?De.value=JSON.parse(JSON.stringify($e)):De.value=e.terminal,null==e.payment_intent?Le.value=JSON.parse(JSON.stringify(Ee)):Le.value=e.payment_intent}))},R=l(0),Y=()=>{R.value=0;let e=setInterval((()=>{R.value++,R.value==D.value&&clearInterval(e)}),1e3)};return(e,t)=>{const s=O,l=N,n=J;return u(),c(d,null,[r(s,{onClick:j,color:f.define_status?"info":void 0,class:"btn-card w-100 justify-content-center"},{default:o((()=>[r("div",qe,[Te,r("p",Ve,[m(e.$slots,"righttop")])])])),_:3},8,["color"]),r(n,{title:"",open:S.value,actions:"center",size:"big",noclose:"",onClose:B},{content:o((()=>[_(r("div",null,[m(e.$slots,"modalprev")],512),[[b,!f.define_status]]),0==k.value.length?(u(),c("p",Be,"'No terminals found at this location'")):v("",!0),_(r("div",null,[k.value.length?(u(),c("div",Fe,[r(l,{size:"small",active:P.value},{default:o((()=>[(u(!0),c(d,null,g(k.value,((e,t)=>(u(),c(s,{key:`terminal-${t}`,class:"columns is-multiline mb-4"},{default:o((()=>[r("div",Re,[r(s,{class:"p-4 btn-card d-flex justify-content-between",color:h(I).id==e.id?h(L).color:void 0,onClick:t=>(e=>{I.id=e.id,I.label=e.label,I.status=e.status,I.amount=f.total,z()})(e)},{default:o((()=>[r("div",null,[Ye,r("p",Me,p(e.label),1),r("p",null,"Status: "+p(e.status),1)]),r("div",null,[r("p",He," ID: "+p(h(Le).id),1),r("p",Ue," Amount: "+p(h(a)(h(Le).amount/100)),1),r("p",Xe," Date: "+p(h(Le).created),1),r("p",Ge," PI. Status: "+p(h(Le).status),1),r("p",Ke," Status: "+p(h(De).status),1),"failed"==h(De).status?(u(),c("div",We,[r(s,{class:"\r\n                          d-flex\r\n                          justify-content-between\r\n                          mt-4\r\n                          p-2\r\n                          align-items-center\r\n                        "},{default:o((()=>[Qe,Ze])),_:1})])):v("",!0)])])),_:2},1032,["color","onClick"])]),r("div",et,[r(l,{size:"small",active:q.value},{default:o((()=>[r(s,{color:"warning",outlined:"",onClick:t=>T(e),class:"d-flex justify-content-between mb-4"},{default:o((()=>[tt,at])),_:2},1032,["onClick"])])),_:2},1032,["active"]),r(l,{size:"small",active:q.value},{default:o((()=>[r(s,{color:"danger",outlined:"",onClick:t=>(e=>{"succeeded"!=De.value.status&&(q.value=!0,Ae({id:e.id,payment_type_id:Le.value.id}).then((()=>{S.value=!1,q.value=!1})).catch((()=>{q.value=!1})))})(e),class:"d-flex justify-content-between"},{default:o((()=>[st,lt])),_:2},1032,["onClick"])])),_:2},1032,["active"])]),"succeeded"==h(De).status?(u(),c("div",nt,[r(l,{size:"small",active:q.value},{default:o((()=>[r(s,{color:R.value==D.value?"success":void 0,outlined:"",onClick:t=>(e=>{R.value==D.value&&(Ae({id:e.id,payment_type_id:null}),S.value=!1,q.value=!1,i("onPayment",{amount:f.total,payment_type_id:5}))})(e),class:"d-flex justify-content-between"},{default:o((()=>[it,R.value<D.value?(u(),c("p",ut,"Loading ... "+p(R.value),1)):v("",!0),ct])),_:2},1032,["color","onClick"])])),_:2},1032,["active"])])):v("",!0)])),_:2},1024)))),128))])),_:1},8,["active"])])):v("",!0)],512),[[b,f.define_status]])])),action:o((()=>[])),_:1},8,["open"])],64)}}});export{R as A,oe as _,Z as a,Se as b,X as c,V as d,B as e,D as f,H as g,W as h,T as i,F as j,ee as k,G as l,Y as m,U as n,Ie as o,Q as p,ot as q,q as r,A as s,z as t,K as u,M as v,Pe as w,ze as x,L as y,E as z};
