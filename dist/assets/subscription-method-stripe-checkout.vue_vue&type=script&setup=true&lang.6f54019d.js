import{_ as e}from"./V-Card.vue_vue&type=script&setup=true&lang.e9e64dc2.js";import{_ as t}from"./V-Loader.vue_vue&type=script&setup=true&lang.069747cb.js";import{_ as l}from"./V-Button.vue_vue&type=script&setup=true&lang.cc6d2b95.js";import{s as a,_ as s}from"./MemberCards.824aac93.js";import{_ as i}from"./V-Modal.vue_vue&type=script&setup=true&lang.ef7028a7.js";import{n,m as o,A as u}from"./index.bb46ca73.js";import{d as r,r as c,h as d,i as m,k as p,l as f,R as v,H as y,L as _,K as b,G as C,b as g,A as x,F as h,W as k,X as S,S as j,_ as N,u as w,w as O}from"./vendor.4454b83d.js";import{_ as J}from"./V-Control.63a8a239.js";import{_ as z}from"./V-Field.vue_vue&type=script&setup=true&lang.b3ed284d.js";import{_ as P}from"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.58b5fdfb.js";import{c as V}from"./Companies.1d517882.js";const q={class:"d-flex justify-content-between align-items-start"},B=f("p",{class:"title is-3"},[f("i",{class:"fas fa-credit-card","aria-hidden":"true"})],-1),T={class:"title is-5"},$={key:0,class:"title is-6"},E=f("p",null,[f("b",null,"Cards")],-1),F={key:0,class:"pb-3 mb-5"},I=C(" Sync Cards "),U=C("Confirm");var A=r({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0},card:{type:Boolean,default:!1},textCard:{type:String,default:"Debit Automatic"},newUser:{type:Boolean,dafutl:!1},outline:{type:Boolean,dafutl:!1}},emits:["onPayment"],setup(o,{emit:u}){const r=o,C=c(!1),g=()=>{null!=S.value?(C.value=!1,u("onPayment",{amount:r.total,payment_type_id:3,payment_method_id:S.value})):n.error("Select card")},x=c(!1),h=c(!0),k=()=>{a(r.user.id).then((e=>{h.value=!1,setTimeout((()=>{h.value=!0}),100)}))},S=c(null);return(a,n)=>{const u=e,c=t,j=l,N=s,w=i;return d(),m(v,null,[r.card?(d(),m(c,{key:1,class:"h-100",size:"small",active:a.isLoaderActive},{default:p((()=>[f(u,{color:"success",outlined:"",onClick:n[2]||(n[2]=e=>C.value=!0),class:"\r\n        mr-4\r\n        btn-card\r\n        text-center\r\n        px-2\r\n        h-100\r\n        d-flex\r\n        align-items-center\r\n        justify-content-center\r\n      ",style:{"font-size":"14px"}},{default:p((()=>[E,_(a.$slots,"default")])),_:3})])),_:1},8,["active"])):(d(),m(u,{key:0,onClick:n[1]||(n[1]=e=>C.value=!0),color:"success",class:"mx-2 btn-card w-100 justify-content-center h-100",outlined:r.outline},{default:p((()=>[f("div",q,[f("div",null,[B,f("p",T,y(r.textCard),1)]),(d(),m("p",$,[_(a.$slots,"righttop")]))])])),_:3},8,["outlined"])),f(w,{title:"",size:"big",open:C.value,actions:"center",onClose:n[4]||(n[4]=e=>C.value=!1)},{content:p((()=>[o.newUser?b("",!0):(d(),m("div",F,[f(c,{size:"large",active:x.value},{default:p((()=>[f(j,{color:"undefined",onClick:k,class:"d-flex justify-content-center",raised:""},{default:p((()=>[I])),_:1})])),_:1},8,["active"])])),r.user&&C.value&&h.value?(d(),m(N,{key:1,"show-option":!0,class:"mb-6",modelValue:S.value,"onUpdate:modelValue":n[3]||(n[3]=e=>S.value=e),method_default:r.user.pm_last_four,"show-new-card":!0,user:r.user,"on-new-card-u-r-l":"v2/stripe/setup","add-card-stripe-u-r-l":"v2/stripe/addCard",v2:!0,actions:[]},null,8,["modelValue","method_default","user"])):b("",!0)])),action:p((()=>[f(j,{color:"success",onClick:g,disabled:!S.value,class:"d-flex justify-content-center",raised:""},{default:p((()=>[U])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const L={class:"d-flex justify-content-between align-items-start"},D=f("div",null,[f("p",{class:"title is-3"},[f("i",{class:"fas fa-money-bill-wave","aria-hidden":"true"})]),f("p",{class:"title is-5"},"Cash")],-1),M={class:"title is-6"},R={class:"d-flex mb-4 justify-content-between"},W={class:"title is-5"},G=C(" Total: "),H={class:"title is-5"},K=C(" Cash Total: "),X={class:"\r\n            d-flex\r\n            justify-content-center\r\n            align-items-center\r\n            flex-column\r\n            mb-4\r\n          "},Q=f("p",{class:"title is-5 mb-4"},"Change Back:",-1),Y={class:"title is-3 mb-0"},Z={class:"d-flex justify-content-center flex-wrap mb-4"},ee=f("div",{class:"w-100"},null,-1),te={class:"d-flex justify-content-center"},le=C("Reset"),ae=C("Confirm"),se=C("Confirm");var ie=r({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0},email:{type:String,default:""},confirmar_email:{type:Boolean,default:!1}},emits:["onPayment"],setup(t,{emit:a}){const s=t,u=c(!1),r=c(0),b=g((()=>{const e=parseFloat(r.value)-parseFloat(s.total);return e>0?e:0})),w=()=>{u.value=!1,a("onPayment",{cash:r.value,changeBack:b.value,amount:s.total,payment_type_id:1})},O=()=>{s.confirmar_email&&V.email!=V.emailConfirm?n.error("Email does not match"):(u.value=!0,V.modal=!1,V.email="",V.emailConfirm="")},V=x({modal:!1,confirm:!1,email:"",emailConfirm:""}),q=()=>{s.confirmar_email?""!=s.email&&null!=s.email?(V.email=s.email,V.modal=!0):n.error("Email is required"):O()};return(a,n)=>{const c=e,g=l,x=J,B=z,T=i,$=P;return d(),m(v,null,[f(c,{onClick:q,color:s.define_status?"warning":void 0,class:"btn-card w-100 justify-content-center"},{default:p((()=>[f("div",L,[D,f("p",M,[_(a.$slots,"righttop")])])])),_:3},8,["color"]),f(T,{title:"",open:u.value,actions:"center",onClose:n[4]||(n[4]=e=>u.value=!1)},{content:p((()=>[k(f("div",null,[_(a.$slots,"modalprev")],512),[[S,!s.define_status]]),k(f("div",null,[f("div",R,[f("p",W,[G,f("b",null,y(h(o)(t.total)),1)]),f("p",H,[K,f("b",null,y(h(o)(r.value)),1)])]),f("div",X,[Q,f("p",Y,[f("b",null,y(h(o)(h(b))),1)])]),f("div",Z,[f(g,{bold:"",class:"m-3",style:{"font-size":"14px"},onClick:n[1]||(n[1]=e=>r.value=t.total)},{default:p((()=>[C(" Full Payment "+y(h(o)(t.total)),1)])),_:1}),ee,(d(),m(v,null,j([5,10,20,50,100],((e,t)=>f(g,{key:`calculato-${t}`,bold:"",class:"m-3",style:{"font-size":"14px"},onClick:t=>(e=>{r.value=parseFloat(r.value)+parseFloat(e)})(e)},{default:p((()=>[C(" $"+y(e),1)])),_:2},1032,["onClick"]))),64))]),f("div",te,[f(B,null,{default:p((()=>[f(x,null,{default:p((()=>[k(f("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>r.value=e),type:"text",class:"input text-center",placeholder:"Cash"},null,512),[[N,r.value]])])),_:1})])),_:1})])],512),[[S,s.define_status]])])),action:p((()=>[f(g,{onClick:n[3]||(n[3]=e=>r.value=0),class:"d-flex justify-content-center",raised:""},{default:p((()=>[le])),_:1}),f(g,{color:"success",onClick:w,disabled:t.total>r.value,class:"d-flex justify-content-center",raised:""},{default:p((()=>[ae])),_:1},8,["disabled"])])),_:1},8,["open"]),f(T,{open:h(V).modal,actions:"center",onClose:n[6]||(n[6]=e=>h(V).modal=!1)},{content:p((()=>[f($,{title:h(V).email,subtitle:"Please confirm the email before continuing"},null,8,["title"]),f(B,null,{default:p((()=>[f(x,null,{default:p((()=>[k(f("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>h(V).emailConfirm=e),type:"text",class:"input text-center",placeholder:"Email",style:{"font-size":"20px"}},null,512),[[N,h(V).emailConfirm]])])),_:1})])),_:1})])),action:p((()=>[f(g,{onClick:O,color:"primary",raised:""},{default:p((()=>[se])),_:1})])),_:1},8,["open"])],64)}}});const ne=c([{typeInput:"text",name:"description",placeholder:"Description",model:"",class:"is-12",isLabel:!0,required:!0},{typeInput:"text",name:"amount",placeholder:"Amount",model:"",class:"is-12",isLabel:!0,required:!0}]),oe={failure_code:null,failure_message:null,process_payment_intent:{payment_intent:""},status:"",type:""},ue={amount:0,id:"",created:"",status:""},re=c(JSON.parse(JSON.stringify(oe))),ce=c(JSON.parse(JSON.stringify(ue))),de=async(e={})=>await u.post("make-manual-payment",e),me=async e=>{const t=await u.post("v2/stripe/stopTerminal",e);return re.value=JSON.parse(JSON.stringify(oe)),ce.value=JSON.parse(JSON.stringify(ue)),t},pe={class:"d-flex justify-content-between align-items-start"},fe=f("div",null,[f("p",{class:"title is-3"},[f("i",{class:"fas fa-mobile","aria-hidden":"true"})]),f("p",{class:"title is-5"},"Terminal")],-1),ve={class:"title is-6"},ye={key:0},_e={key:0,class:"mt-4 mx-2"},be={class:"column is-8"},Ce=f("p",{class:"title is-1"},[f("i",{class:"lnir lnir-postcard","aria-hidden":"true"})],-1),ge={class:"title is-5 mb-0"},xe={style:{"font-size":"10px"},class:"is-7 mb-0"},he={style:{"font-size":"10px"},class:"is-7 mb-0"},ke={style:{"font-size":"10px"},class:"is-7 mb-0"},Se={style:{"font-size":"10px"},class:"is-7 mb-0"},je={style:{"font-size":"10px"},class:"is-7 mb-0"},Ne={key:0},we=f("p",{class:"title is-7 text-capitalize m-0"},"retry",-1),Oe=f("p",{class:"title is-6"},[f("i",{class:"lnil lnil-reload"})],-1),Je={class:"column is-4"},ze=f("div",null,[f("p",{class:"title is-6 mb-0"},"Terminal status")],-1),Pe=f("p",{class:"title is-5"},[f("i",{class:"lnil lnil-reload"})],-1),Ve=f("div",null,[f("p",{class:"title is-6 mb-0"},"Cancel payment")],-1),qe=f("p",{class:"title is-5"},[f("i",{class:"lnil lnil-trash-can"})],-1),Be={key:0,class:"column is-12"},Te=f("div",null,[f("p",{class:"title is-6 mb-0"},"Clean and Close")],-1),$e={key:0},Ee=f("p",{class:"title is-5"},[f("i",{class:"lnil lnil-checkmark-circle"})],-1),Fe=C("Confirm");var Ie=r({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0},email:{type:String,default:""},confirmar_email:{type:Boolean,default:!1}},emits:["onPayment"],setup(a,{emit:s}){const r=a,{cookies:C}=w(),q=c(!1),B=c([]),T=()=>{if(r.confirmar_email&&(""==H.emailConfirm&&n.error("Please confirm email"),H.email!=H.emailConfirm))return void n.error("Email does not match");H.email="",H.emailConfirm="",q.value=!0,H.modal=!1;let e=V.value.locations;if(e.length&&C.get("locations_id")){let t=e.find((e=>e.id==C.get("locations_id")));if(null!=t){let e=t.terminales;e.length&&(B.value=e)}}0==B.value&&n.error("No terminals found at this location")},$=x(JSON.parse(JSON.stringify({id:null,label:"",status:!1,amount:0}))),E=c(!1);O((()=>q.value),(e=>{$.id=null,$.label="",$.status=!1,$.amount=0,E.value=!1,D.value=!1,F.value=!1,X.value=0,re.value=JSON.parse(JSON.stringify(oe)),ce.value=JSON.parse(JSON.stringify(ue))}));const F=c(!1),I=c(10);O((()=>re.value.status),(e=>{F.value&&("succeeded"==e?(n.success("Payment Success"),q.value=!1,X.value<=I.value&&L()):"failed"==e?n.error(re.value.failure_message):"in_progress"==e&&n.success("Payment in progress")),F.value||"succeeded"==e&&Q()}));const U=g((()=>{let e={status:"",message:"",color:""};return e.status=re.value.status,"succeeded"==e.status&&(e.color="success"),"failed"==e.status&&(e.color="danger"),"in_progress"==e.status&&(e.color="info"),e})),A=()=>{"in_progress"!=re.value.status?"succeeded"!=re.value.status?null!=$.id?(G(),E.value=!0,(async e=>{const t=await u.post("v2/stripe/paymentIntentTerminal",e);return null==t.data.terminal?re.value=JSON.parse(JSON.stringify(oe)):re.value=t.data.terminal,null==t.data.payment_intent?ce.value=JSON.parse(JSON.stringify(ue)):ce.value=t.data.payment_intent,t})($).then((e=>{E.value=!1,n.success(e.data.message)})).catch((e=>{E.value=!1}))):console.log("alert. no selecciono el terminal de pago"):n.error("Payment processed"):n.error("Terminal busy")},L=()=>{s("onPayment",{amount:r.total,payment_type_id:5})},D=c(!1),M=e=>{"succeeded"!=re.value.status&&(D.value=!0,(async e=>{const t=await u.post("v2/stripe/consultaTerminal",e);return null==t.data.terminal?re.value=JSON.parse(JSON.stringify(oe)):re.value=t.data.terminal,null==t.data.payment_intent?ce.value=JSON.parse(JSON.stringify(ue)):ce.value=t.data.payment_intent,t})({id:e.id}).then((()=>{D.value=!1})).catch((()=>{D.value=!1})))},R=g((()=>null!=$.id)),W=()=>{R.value||(q.value=!1)},G=()=>{new Pusher("2cd5b586808b2f41f8e6",{cluster:"us2"}).subscribe("terminal_channel").bind("terminal_event",(function(e){F.value=!0,null==e.terminal?re.value=JSON.parse(JSON.stringify(oe)):re.value=e.terminal,null==e.payment_intent?ce.value=JSON.parse(JSON.stringify(ue)):ce.value=e.payment_intent}))},H=x({modal:!1,confirm:!1,email:"",emailConfirm:""}),K=()=>{r.confirmar_email?""!=r.email&&null!=r.email?(H.email=r.email,H.modal=!0):n.error("Email is required"):T()},X=c(0),Q=()=>{X.value=0;let e=setInterval((()=>{X.value++,X.value==I.value&&clearInterval(e)}),1e3)};return(a,n)=>{const u=e,c=t,C=i,g=P,x=J,w=z,O=l;return d(),m(v,null,[f(u,{onClick:K,color:r.define_status?"info":void 0,class:"btn-card w-100 justify-content-center"},{default:p((()=>[f("div",pe,[fe,f("p",ve,[_(a.$slots,"righttop")])])])),_:3},8,["color"]),f(C,{title:"",open:q.value,actions:"center",size:"big",noclose:"",onClose:W},{content:p((()=>[k(f("div",null,[_(a.$slots,"modalprev")],512),[[S,!r.define_status]]),0==B.value.length?(d(),m("p",ye,"'No terminals found at this location'")):b("",!0),k(f("div",null,[B.value.length?(d(),m("div",_e,[f(c,{size:"small",active:E.value},{default:p((()=>[(d(!0),m(v,null,j(B.value,((e,t)=>(d(),m(u,{key:`terminal-${t}`,class:"columns is-multiline mb-4"},{default:p((()=>[f("div",be,[f(u,{class:"p-4 btn-card d-flex justify-content-between",color:h($).id==e.id?h(U).color:void 0,onClick:t=>(e=>{$.id=e.id,$.label=e.label,$.status=e.status,$.amount=r.total,A()})(e)},{default:p((()=>[f("div",null,[Ce,f("p",ge,y(e.label),1),f("p",null,"Status: "+y(e.status),1)]),f("div",null,[f("p",xe," ID: "+y(h(ce).id),1),f("p",he," Amount: "+y(h(o)(h(ce).amount/100)),1),f("p",ke," Date: "+y(h(ce).created),1),f("p",Se," PI. Status: "+y(h(ce).status),1),f("p",je," Status: "+y(h(re).status),1),"failed"==h(re).status?(d(),m("div",Ne,[f(u,{class:"\n                          d-flex\n                          justify-content-between\n                          mt-4\n                          p-2\n                          align-items-center\n                        "},{default:p((()=>[we,Oe])),_:1})])):b("",!0)])])),_:2},1032,["color","onClick"])]),f("div",Je,[f(c,{size:"small",active:D.value},{default:p((()=>[f(u,{color:"warning",outlined:"",onClick:t=>M(e),class:"d-flex justify-content-between mb-4"},{default:p((()=>[ze,Pe])),_:2},1032,["onClick"])])),_:2},1032,["active"]),f(c,{size:"small",active:D.value},{default:p((()=>[f(u,{color:"danger",outlined:"",onClick:t=>(e=>{"succeeded"!=re.value.status&&(D.value=!0,me({id:e.id,payment_type_id:ce.value.id}).then((()=>{q.value=!1,D.value=!1})).catch((()=>{D.value=!1})))})(e),class:"d-flex justify-content-between"},{default:p((()=>[Ve,qe])),_:2},1032,["onClick"])])),_:2},1032,["active"])]),"succeeded"==h(re).status?(d(),m("div",Be,[f(c,{size:"small",active:D.value},{default:p((()=>[f(u,{color:X.value==I.value?"success":void 0,outlined:"",onClick:t=>(e=>{X.value==I.value&&(me({id:e.id,payment_type_id:null}),q.value=!1,D.value=!1,s("onPayment",{amount:r.total,payment_type_id:5}))})(e),class:"d-flex justify-content-between"},{default:p((()=>[Te,X.value<I.value?(d(),m("p",$e,"Loading ... "+y(X.value),1)):b("",!0),Ee])),_:2},1032,["color","onClick"])])),_:2},1032,["active"])])):b("",!0)])),_:2},1024)))),128))])),_:1},8,["active"])])):b("",!0)],512),[[S,r.define_status]])])),action:p((()=>[])),_:1},8,["open"]),f(C,{open:h(H).modal,actions:"center",onClose:n[2]||(n[2]=e=>h(H).modal=!1)},{content:p((()=>[f(g,{title:h(H).email,subtitle:"Please confirm the email before continuing"},null,8,["title"]),f(w,null,{default:p((()=>[f(x,null,{default:p((()=>[k(f("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>h(H).emailConfirm=e),type:"text",class:"input text-center",placeholder:"Write the email",style:{"font-size":"20px"}},null,512),[[N,h(H).emailConfirm]])])),_:1})])),_:1})])),action:p((()=>[f(O,{onClick:T,color:"primary",raised:""},{default:p((()=>[Fe])),_:1})])),_:1},8,["open"])],64)}}});const Ue={class:"d-flex justify-content-between align-items-start"},Ae=f("div",null,[f("p",{class:"title is-3"},[f("i",{class:"fas fa-credit-card","aria-hidden":"true"})]),f("p",{class:"title is-5"},"Debit Card")],-1),Le={key:0,class:"title is-6"},De=C("Confirm");var Me=r({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0},email:{type:String,default:""},confirmar_email:{type:Boolean,default:!1}},emits:["onPayment"],setup(t,{emit:a}){const s=t,o=c(!1),u=()=>{s.confirmar_email&&r.email!=r.emailConfirm?n.error("Email does not match"):(r.email="",r.emailConfirm="",o.value=!1,r.modal=!1,a("onPayment",{amount:s.total,payment_type_id:3}))},r=x({modal:!1,confirm:!1,email:"",emailConfirm:""}),v=()=>{s.confirmar_email?""!=s.email&&null!=s.email?(r.email=s.email,r.modal=!0):n.error("Email is required"):u()};return(t,a)=>{const s=P,n=J,o=z,c=l,y=i,_=e;return d(),m(_,{onClick:v,color:"success",class:"mx-2 btn-card w-100 justify-content-center",outlined:""},{default:p((()=>[f("div",Ue,[Ae,(d(),m("p",Le))]),f(y,{open:h(r).modal,actions:"center",onClose:a[2]||(a[2]=e=>h(r).modal=!1)},{content:p((()=>[f(s,{title:h(r).email,subtitle:"Please confirm the email before continuing"},null,8,["title"]),f(o,null,{default:p((()=>[f(n,null,{default:p((()=>[k(f("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>h(r).emailConfirm=e),type:"text",class:"input text-center",placeholder:"Email",style:{"font-size":"20px"}},null,512),[[N,h(r).emailConfirm]])])),_:1})])),_:1})])),action:p((()=>[f(c,{onClick:u,color:"primary",raised:""},{default:p((()=>[De])),_:1})])),_:1},8,["open"])])),_:1})}}});export{A as _,ie as a,Ie as b,Me as c,de as d,ne as m};
