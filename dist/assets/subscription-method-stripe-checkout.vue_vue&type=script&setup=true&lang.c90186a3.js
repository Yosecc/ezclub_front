import{_ as e}from"./V-Card.vue_vue&type=script&setup=true&lang.b57414a9.js";import{_ as t}from"./V-Loader.vue_vue&type=script&setup=true&lang.a67ef8b7.js";import{_ as l}from"./V-Button.vue_vue&type=script&setup=true&lang.115c9f56.js";import{s as a,_ as s}from"./MemberCards.b14fa83c.js";import{_ as i}from"./V-Modal.vue_vue&type=script&setup=true&lang.f91cc122.js";import{d as n,r as o,i as u,j as r,k as c,I as d,l as m,S as p,H as f,L as v,G as y,b as _,A as b,F as C,W as g,X as h,U as x,_ as k,u as j,w as S}from"./vendor.84e48f7c.js";import{n as N,m as w,A as O}from"./index.46ea8f6b.js";import{_ as J}from"./V-Control.b8a16a92.js";import{_ as z}from"./V-Field.vue_vue&type=script&setup=true&lang.5a5e683f.js";import{_ as P}from"./V-PlaceholderSection.vue_vue&type=script&setup=true&lang.12764c4e.js";import{c as V}from"./Companies.5af72a07.js";const B={class:"d-flex justify-content-between align-items-start"},q=m("p",{class:"title is-3"},[m("i",{class:"fas fa-credit-card","aria-hidden":"true"})],-1),E={class:"title is-5"},T={key:0,class:"title is-6"},$=m("p",null,[m("b",null,"Cards")],-1),I={key:0,class:"pb-3 mb-5"},U=y(" Sync Cards "),F=y("Confirm");var A=n({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0},card:{type:Boolean,default:!1},textCard:{type:String,default:"Debit Automatic"},newUser:{type:Boolean,dafutl:!1},outline:{type:Boolean,dafutl:!1}},emits:["onPayment"],setup(n,{emit:y}){const _=n,b=o(!1),C=()=>{null!=k.value?(b.value=!1,y("onPayment",{amount:_.total,payment_type_id:3,payment_method_id:k.value})):N.error("Select card")},g=o(!1),h=o(!0),x=()=>{a(_.user.id).then((e=>{h.value=!1,setTimeout((()=>{h.value=!0}),100)}))},k=o(null);return(a,o)=>{const y=e,j=t,S=l,N=s,w=i;return u(),r(p,null,[_.card?(u(),r(j,{key:1,class:"h-100",size:"small",active:a.isLoaderActive},{default:c((()=>[m(y,{color:"success",outlined:"",onClick:o[2]||(o[2]=e=>b.value=!0),class:"\r\n        mr-4\r\n        btn-card\r\n        text-center\r\n        px-2\r\n        h-100\r\n        d-flex\r\n        align-items-center\r\n        justify-content-center\r\n      ",style:{"font-size":"14px"}},{default:c((()=>[$,v(a.$slots,"default")])),_:3})])),_:1},8,["active"])):(u(),r(y,{key:0,onClick:o[1]||(o[1]=e=>b.value=!0),color:"success",class:"mx-2 btn-card w-100 justify-content-center h-100",outlined:_.outline},{default:c((()=>[m("div",B,[m("div",null,[q,m("p",E,f(_.textCard),1)]),(u(),r("p",T,[v(a.$slots,"righttop"),d(' <i class="fas fa-check" aria-hidden="true"></i> ')]))])])),_:3},8,["outlined"])),d("  "),m(w,{title:"",size:"big",open:b.value,actions:"center",onClose:o[4]||(o[4]=e=>b.value=!1)},{content:c((()=>[n.newUser?d("v-if",!0):(u(),r("div",I,[m(j,{size:"large",active:g.value},{default:c((()=>[m(S,{color:"undefined",onClick:x,class:"d-flex justify-content-center",raised:""},{default:c((()=>[U])),_:1})])),_:1},8,["active"])])),_.user&&b.value&&h.value?(u(),r(N,{key:1,"show-option":!0,class:"mb-6",modelValue:k.value,"onUpdate:modelValue":o[3]||(o[3]=e=>k.value=e),method_default:_.user.pm_last_four,"show-new-card":!0,user:_.user,"on-new-card-u-r-l":"v2/stripe/setup","add-card-stripe-u-r-l":"v2/stripe/addCard",v2:!0,actions:[]},null,8,["modelValue","method_default","user"])):d("v-if",!0)])),action:c((()=>[m(S,{color:"success",onClick:C,disabled:!k.value,class:"d-flex justify-content-center",raised:""},{default:c((()=>[F])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const L={class:"d-flex justify-content-between align-items-start"},D=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-money-bill-wave","aria-hidden":"true"})]),m("p",{class:"title is-5"},"Cash")],-1),M={class:"title is-6"},R={class:"d-flex mb-4 justify-content-between"},G={class:"title is-5"},H=y(" Total: "),W={class:"title is-5"},X=y(" Cash Total: "),K={class:"d-flex justify-content-center align-items-center flex-column mb-4"},Q=m("p",{class:"title is-5 mb-4"},"Change Back:",-1),Y={class:"title is-3 mb-0"},Z={class:"d-flex justify-content-center flex-wrap mb-4"},ee=m("div",{class:"w-100"},null,-1),te={class:"d-flex justify-content-center"},le=y("Reset"),ae=y("Confirm"),se=y("Confirm");var ie=n({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0},email:{type:String,default:""},confirmar_email:{type:Boolean,default:!1}},emits:["onPayment"],setup(t,{emit:a}){const s=t,n=o(!1),j=o(0),S=_((()=>{const e=parseFloat(j.value)-parseFloat(s.total);return e>0?e:0})),O=()=>{n.value=!1,a("onPayment",{cash:j.value,changeBack:S.value,amount:s.total,payment_type_id:1})},V=()=>{s.confirmar_email&&B.email!=B.emailConfirm?N.error("Email does not match"):(n.value=!0,B.modal=!1,B.email="",B.emailConfirm="")},B=b({modal:!1,confirm:!1,email:"",emailConfirm:""}),q=()=>{s.confirmar_email?""!=s.email&&null!=s.email?(B.email=s.email,B.modal=!0):N.error("Email is required"):V()};return(a,o)=>{const _=e,b=l,N=J,E=z,T=i,$=P;return u(),r(p,null,[m(_,{onClick:q,color:s.define_status?"warning":void 0,class:"btn-card w-100 justify-content-center"},{default:c((()=>[m("div",L,[D,m("p",M,[v(a.$slots,"righttop"),d(' <i class="fas fa-check" aria-hidden="true"></i> ')])])])),_:3},8,["color"]),m(T,{title:"",open:n.value,actions:"center",onClose:o[4]||(o[4]=e=>n.value=!1)},{content:c((()=>[g(m("div",null,[v(a.$slots,"modalprev")],512),[[h,!s.define_status]]),g(m("div",null,[m("div",R,[m("p",G,[H,m("b",null,f(C(w)(t.total)),1)]),m("p",W,[X,m("b",null,f(C(w)(j.value)),1)])]),m("div",K,[Q,m("p",Y,[m("b",null,f(C(w)(C(S))),1)])]),m("div",Z,[m(b,{bold:"",class:"m-3",style:{"font-size":"14px"},onClick:o[1]||(o[1]=e=>j.value=t.total)},{default:c((()=>[y(" Full Payment "+f(C(w)(t.total)),1)])),_:1}),ee,(u(),r(p,null,x([5,10,20,50,100],((e,t)=>m(b,{key:`calculato-${t}`,bold:"",class:"m-3",style:{"font-size":"14px"},onClick:t=>(e=>{j.value=parseFloat(j.value)+parseFloat(e)})(e)},{default:c((()=>[y(" $"+f(e),1)])),_:2},1032,["onClick"]))),64))]),m("div",te,[m(E,null,{default:c((()=>[m(N,null,{default:c((()=>[g(m("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>j.value=e),type:"text",class:"input text-center",placeholder:"Cash"},null,512),[[k,j.value]])])),_:1})])),_:1})])],512),[[h,s.define_status]])])),action:c((()=>[m(b,{onClick:o[3]||(o[3]=e=>j.value=0),class:"d-flex justify-content-center",raised:""},{default:c((()=>[le])),_:1}),m(b,{color:"success",onClick:O,disabled:t.total>j.value,class:"d-flex justify-content-center",raised:""},{default:c((()=>[ae])),_:1},8,["disabled"])])),_:1},8,["open"]),m(T,{open:C(B).modal,actions:"center",onClose:o[6]||(o[6]=e=>C(B).modal=!1)},{content:c((()=>[m($,{title:C(B).email,subtitle:"Please confirm the email before continuing"},null,8,["title"]),m(E,null,{default:c((()=>[m(N,null,{default:c((()=>[g(m("input",{"onUpdate:modelValue":o[5]||(o[5]=e=>C(B).emailConfirm=e),type:"text",class:"input text-center",placeholder:"Email",style:{"font-size":"20px"}},null,512),[[k,C(B).emailConfirm]])])),_:1})])),_:1})])),action:c((()=>[m(b,{onClick:V,color:"primary",raised:""},{default:c((()=>[se])),_:1})])),_:1},8,["open"])],64)}}});const ne=o([{typeInput:"text",name:"description",placeholder:"Description",model:"",class:"is-12",isLabel:!0,required:!0},{typeInput:"text",name:"amount",placeholder:"Amount",model:"",class:"is-12",isLabel:!0,required:!0}]),oe={failure_code:null,failure_message:null,process_payment_intent:{payment_intent:""},status:"",type:""},ue={amount:0,id:"",created:"",status:""},re=o(JSON.parse(JSON.stringify(oe))),ce=o(JSON.parse(JSON.stringify(ue))),de=async(e={})=>await O.post("make-manual-payment",e),me=async e=>{const t=await O.post("v2/stripe/stopTerminal",e);return re.value=JSON.parse(JSON.stringify(oe)),ce.value=JSON.parse(JSON.stringify(ue)),t},pe={class:"d-flex justify-content-between align-items-start"},fe=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-mobile","aria-hidden":"true"})]),m("p",{class:"title is-5"},"Terminal")],-1),ve={class:"title is-6"},ye={key:0},_e={key:0,class:"mt-4 mx-2"},be={class:"column is-8"},Ce=m("p",{class:"title is-1"},[m("i",{class:"lnir lnir-postcard","aria-hidden":"true"})],-1),ge={class:"title is-5 mb-0"},he={style:{"font-size":"10px"},class:"is-7 mb-0"},xe={style:{"font-size":"10px"},class:"is-7 mb-0"},ke={style:{"font-size":"10px"},class:"is-7 mb-0"},je={style:{"font-size":"10px"},class:"is-7 mb-0"},Se={style:{"font-size":"10px"},class:"is-7 mb-0"},Ne={key:0},we=m("p",{class:"title is-7 text-capitalize m-0"},"retry",-1),Oe=m("p",{class:"title is-6"},[m("i",{class:"lnil lnil-reload"})],-1),Je={class:"column is-4"},ze=m("div",null,[m("p",{class:"title is-6 mb-0"},"Terminal status")],-1),Pe=m("p",{class:"title is-5"},[m("i",{class:"lnil lnil-reload"})],-1),Ve=m("div",null,[m("p",{class:"title is-6 mb-0"},"Cancel payment")],-1),Be=m("p",{class:"title is-5"},[m("i",{class:"lnil lnil-trash-can"})],-1),qe={key:0,class:"column is-12"},Ee=m("div",null,[m("p",{class:"title is-6 mb-0"},"Clean and Close")],-1),Te={key:0},$e=m("p",{class:"title is-5"},[m("i",{class:"lnil lnil-checkmark-circle"})],-1),Ie=y("Confirm");var Ue=n({expose:[],props:{total:{type:Number,required:!0},define_status:{type:Boolean,default:!0},email:{type:String,default:""},confirmar_email:{type:Boolean,default:!1}},emits:["onPayment"],setup(a,{emit:s}){const n=a,{cookies:y}=j(),B=o(!1),q=o([]),E=()=>{if(n.confirmar_email&&W.email!=W.emailConfirm)return void N.error("Email does not match");W.email="",W.emailConfirm="",B.value=!0,W.modal=!1;let e=V.value.locations;if(e.length&&y.get("locations_id")){let t=e.find((e=>e.id==y.get("locations_id")));if(null!=t){let e=t.terminales;e.length&&(q.value=e)}}0==q.value&&N.error("No terminals found at this location")},T=b(JSON.parse(JSON.stringify({id:null,label:"",status:!1,amount:0}))),$=o(!1);S((()=>B.value),(e=>{T.id=null,T.label="",T.status=!1,T.amount=0,$.value=!1,D.value=!1,I.value=!1,K.value=0,re.value=JSON.parse(JSON.stringify(oe)),ce.value=JSON.parse(JSON.stringify(ue))}));const I=o(!1),U=o(10);S((()=>re.value.status),(e=>{I.value&&("succeeded"==e?(N.success("Payment Success"),B.value=!1,K.value<=U.value&&L()):"failed"==e?N.error(re.value.failure_message):"in_progress"==e&&N.success("Payment in progress")),I.value||"succeeded"==e&&Q()}));const F=_((()=>{let e={status:"",message:"",color:""};return e.status=re.value.status,"succeeded"==e.status&&(e.color="success"),"failed"==e.status&&(e.color="danger"),"in_progress"==e.status&&(e.color="info"),e})),A=()=>{"in_progress"!=re.value.status?"succeeded"!=re.value.status?null!=T.id?(H(),$.value=!0,(async e=>{const t=await O.post("v2/stripe/paymentIntentTerminal",e);return null==t.data.terminal?re.value=JSON.parse(JSON.stringify(oe)):re.value=t.data.terminal,null==t.data.payment_intent?ce.value=JSON.parse(JSON.stringify(ue)):ce.value=t.data.payment_intent,t})(T).then((e=>{$.value=!1,N.success(e.data.message)})).catch((e=>{$.value=!1}))):console.log("alert. no selecciono el terminal de pago"):N.error("Payment processed"):N.error("Terminal busy")},L=()=>{s("onPayment",{amount:n.total,payment_type_id:5})},D=o(!1),M=e=>{"succeeded"!=re.value.status&&(D.value=!0,(async e=>{const t=await O.post("v2/stripe/consultaTerminal",e);return null==t.data.terminal?re.value=JSON.parse(JSON.stringify(oe)):re.value=t.data.terminal,null==t.data.payment_intent?ce.value=JSON.parse(JSON.stringify(ue)):ce.value=t.data.payment_intent,t})({id:e.id}).then((()=>{D.value=!1})).catch((()=>{D.value=!1})))},R=_((()=>null!=T.id)),G=()=>{R.value||(B.value=!1)},H=()=>{new Pusher("2cd5b586808b2f41f8e6",{cluster:"us2"}).subscribe("terminal_channel").bind("terminal_event",(function(e){I.value=!0,null==e.terminal?re.value=JSON.parse(JSON.stringify(oe)):re.value=e.terminal,null==e.payment_intent?ce.value=JSON.parse(JSON.stringify(ue)):ce.value=e.payment_intent}))},W=b({modal:!1,confirm:!1,email:"",emailConfirm:""}),X=()=>{n.confirmar_email?""!=n.email&&null!=n.email?(W.email=n.email,W.modal=!0):N.error("Email is required"):E()},K=o(0),Q=()=>{K.value=0;let e=setInterval((()=>{K.value++,K.value==U.value&&clearInterval(e)}),1e3)};return(a,o)=>{const y=e,_=t,b=i,j=P,S=J,N=z,O=l;return u(),r(p,null,[m(y,{onClick:X,color:n.define_status?"info":void 0,class:"btn-card w-100 justify-content-center"},{default:c((()=>[m("div",pe,[fe,m("p",ve,[v(a.$slots,"righttop"),d(' <i class="fas fa-check" aria-hidden="true"></i> ')])])])),_:3},8,["color"]),m(b,{title:"",open:B.value,actions:"center",size:"big",noclose:"",onClose:G},{content:c((()=>[g(m("div",null,[v(a.$slots,"modalprev")],512),[[h,!n.define_status]]),0==q.value.length?(u(),r("p",ye,"'No terminals found at this location'")):d("v-if",!0),g(m("div",null,[q.value.length?(u(),r("div",_e,[m(_,{size:"small",active:$.value},{default:c((()=>[(u(!0),r(p,null,x(q.value,((e,t)=>(u(),r(y,{key:`terminal-${t}`,class:"columns is-multiline mb-4"},{default:c((()=>[d(" <p>{{ terminal }}</p> "),m("div",be,[m(y,{class:"p-4 btn-card d-flex justify-content-between",color:C(T).id==e.id?C(F).color:void 0,onClick:t=>(e=>{T.id=e.id,T.label=e.label,T.status=e.status,T.amount=n.total,A()})(e)},{default:c((()=>[m("div",null,[Ce,m("p",ge,f(e.label),1),m("p",null,"Status: "+f(e.status),1)]),m("div",null,[m("p",he," ID: "+f(C(ce).id),1),m("p",xe," Amount: "+f(C(w)(C(ce).amount/100)),1),m("p",ke," Date: "+f(C(ce).created),1),m("p",je," PI. Status: "+f(C(ce).status),1),m("p",Se," Status: "+f(C(re).status),1),"failed"==C(re).status?(u(),r("div",Ne,[m(y,{class:"d-flex justify-content-between mt-4 p-2 align-items-center"},{default:c((()=>[we,Oe])),_:1})])):d("v-if",!0)])])),_:2},1032,["color","onClick"])]),m("div",Je,[m(_,{size:"small",active:D.value},{default:c((()=>[m(y,{color:"warning",outlined:"",onClick:t=>M(e),class:"d-flex justify-content-between mb-4"},{default:c((()=>[ze,Pe])),_:2},1032,["onClick"])])),_:2},1032,["active"]),m(_,{size:"small",active:D.value},{default:c((()=>[m(y,{color:"danger",outlined:"",onClick:t=>(e=>{"succeeded"!=re.value.status&&(D.value=!0,me({id:e.id,payment_type_id:ce.value.id}).then((()=>{B.value=!1,D.value=!1})).catch((()=>{D.value=!1})))})(e),class:"d-flex justify-content-between"},{default:c((()=>[Ve,Be])),_:2},1032,["onClick"])])),_:2},1032,["active"])]),"succeeded"==C(re).status?(u(),r("div",qe,[m(_,{size:"small",active:D.value},{default:c((()=>[m(y,{color:K.value==U.value?"success":void 0,outlined:"",onClick:t=>(e=>{K.value==U.value&&(me({id:e.id,payment_type_id:null}),B.value=!1,D.value=!1,s("onPayment",{amount:n.total,payment_type_id:5}))})(e),class:"d-flex justify-content-between"},{default:c((()=>[Ee,K.value<U.value?(u(),r("p",Te,"Loading ... "+f(K.value),1)):d("v-if",!0),$e])),_:2},1032,["color","onClick"])])),_:2},1032,["active"])])):d("v-if",!0),d("")])),_:2},1024)))),128))])),_:1},8,["active"])])):d("v-if",!0)],512),[[h,n.define_status]])])),action:c((()=>[d(' <VButton @click="cash = 0" class="d-flex justify-content-center" raised\n        >Reset</VButton\n      >\n      <VButton\n        color="success"\n        @click="payment"\n        :disabled="total > cash"\n        class="d-flex justify-content-center"\n        raised\n        >Confirm</VButton\n      > ')])),_:1},8,["open"]),m(b,{open:C(W).modal,actions:"center",onClose:o[2]||(o[2]=e=>C(W).modal=!1)},{content:c((()=>[m(j,{title:C(W).email,subtitle:"Please confirm the email before continuing"},null,8,["title"]),m(N,null,{default:c((()=>[m(S,null,{default:c((()=>[g(m("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>C(W).emailConfirm=e),type:"text",class:"input text-center",placeholder:"Email",style:{"font-size":"20px"}},null,512),[[k,C(W).emailConfirm]])])),_:1})])),_:1})])),action:c((()=>[m(O,{onClick:E,color:"primary",raised:""},{default:c((()=>[Ie])),_:1})])),_:1},8,["open"])],64)}}});const Fe={class:"d-flex justify-content-between align-items-start"},Ae=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-credit-card","aria-hidden":"true"})]),m("p",{class:"title is-5"},"Debit Card")],-1),Le={key:0,class:"title is-6"},De=y("Confirm");var Me=n({expose:[],props:{total:{type:Number,required:!0},user:{type:Object,required:!0},email:{type:String,default:""},confirmar_email:{type:Boolean,default:!1}},emits:["onPayment"],setup(t,{emit:a}){const s=t,n=o(!1),p=()=>{s.confirmar_email&&f.email!=f.emailConfirm?N.error("Email does not match"):(f.email="",f.emailConfirm="",n.value=!1,f.modal=!1,a("onPayment",{amount:s.total,payment_type_id:3}))},f=b({modal:!1,confirm:!1,email:"",emailConfirm:""}),v=()=>{s.confirmar_email?""!=s.email&&null!=s.email?(f.email=s.email,f.modal=!0):N.error("Email is required"):p()};return(t,a)=>{const s=P,n=J,o=z,y=l,_=i,b=e;return u(),r(b,{onClick:v,color:"success",class:"mx-2 btn-card w-100 justify-content-center",outlined:""},{default:c((()=>[m("div",Fe,[Ae,(u(),r("p",Le,[d(' <i class="fas fa-check" aria-hidden="true"></i> ')]))]),m(_,{open:C(f).modal,actions:"center",onClose:a[2]||(a[2]=e=>C(f).modal=!1)},{content:c((()=>[m(s,{title:C(f).email,subtitle:"Please confirm the email before continuing"},null,8,["title"]),m(o,null,{default:c((()=>[m(n,null,{default:c((()=>[g(m("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>C(f).emailConfirm=e),type:"text",class:"input text-center",placeholder:"Email",style:{"font-size":"20px"}},null,512),[[k,C(f).emailConfirm]])])),_:1})])),_:1})])),action:c((()=>[m(y,{onClick:p,color:"primary",raised:""},{default:c((()=>[De])),_:1})])),_:1},8,["open"])])),_:1})}}});export{A as _,ie as a,Ue as b,Me as c,de as d,ne as m};
