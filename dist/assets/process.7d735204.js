var t=Object.defineProperty,e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,r=(t,r)=>{for(var o in r||(r={}))s.call(r,o)&&a(t,o,r[o]);if(e)for(var o of e(r))i.call(r,o)&&a(t,o,r[o]);return t};import{_ as o}from"./V-Placeload.3b9f21b3.js";import{_ as n}from"./V-Card.vue_vue&type=script&setup=true&lang.72cebf51.js";import{_ as l}from"./V-Button.vue_vue&type=script&setup=true&lang.3bef777d.js";import{_ as h}from"./pdf_icon.0444a540.js";import{d as c,ac as d,A as u,r as m,o as p,h as y,j as f,k as g,J as x,L as v,B as w,G as k,z as S,K as b,D as _,N as I,O as j}from"./vendor.95b3aaf6.js";import{A as T}from"./index.4bd91c18.js";import{_ as D}from"./SidebarLayout.vue_vue&type=script&setup=true&lang.40710c2e.js";import{p as A}from"./sidebarLayoutState.ce2538e0.js";import"./ActivityPanel.vue_vue&type=style&index=0&lang.d227ed8c.js";import"./useDropdown.a79a267f.js";import"./V-Avatar.vue_vue&type=script&setup=true&lang.ceac713f.js";import"./V-Dropdown.6e0dd345.js";import"./V-Icon.vue_vue&type=script&setup=true&lang.8893c022.js";import"./activePanelState.b2df5230.js";import"./fastpizza.1e58d0ec.js";import"./TaskPanel.vue_vue&type=style&index=0&lang.2450750c.js";import"./V-Tag.vue_vue&type=script&setup=true&lang.7000afa2.js";import"./V-Message.vue_vue&type=script&setup=true&lang.201c0e20.js";import"./V-Tabs.vue_vue&type=script&setup=true&lang.2cf13c12.js";import"./V-Modal.vue_vue&type=script&setup=true&lang.2bc45239.js";import"./navbarLayoutState.8a9ee85e.js";import"./video.ada25d72.js";import"./darkModeState.ec54b420.js";import"./SearchPanel.vue_vue&type=style&index=0&lang.c6e033de.js";import"./AnimatedLogo.afc77a0f.js";import"./V-Control.0f5d3efa.js";import"./V-Field.vue_vue&type=script&setup=true&lang.19d9fa93.js";import"./V-IconBox.vue_vue&type=script&setup=true&lang.54ae5c71.js";import"./V-Block.vue_vue&type=script&setup=true&lang.119380ef.js";import"./UserPopoverContent.vue_vue&type=script&setup=true&lang.809980e8.js";import"./userPopovers.f4b9fc60.js";import"./Toolbar.vue_vue&type=script&setup=true&lang.057e9f3a.js";var P=c({name:"VueDrawingCanvas",props:{strokeType:{type:String,validator:t=>-1!==["dash","square","circle","triangle","half_triangle"].indexOf(t),default:()=>"dash"},fillShape:{type:Boolean,default:()=>!1},width:{type:[String,Number],default:()=>600},height:{type:[String,Number],default:()=>400},image:{type:String,default:()=>""},eraser:{type:Boolean,default:()=>!1},color:{type:String,default:()=>"#000000"},lineWidth:{type:Number,default:()=>5},lock:{type:Boolean,default:()=>!1},styles:{type:[Array,String,Object]},classes:{type:[Array,String,Object]},backgroundColor:{type:String,default:()=>"#FFFFFF"},backgroundImage:{type:String,default:()=>null},watermark:{type:Object,default:()=>null},saveAs:{type:String,validator:t=>-1!==["jpeg","png"].indexOf(t),default:()=>"png"},canvasId:{type:String,default:()=>"VueDrawingCanvas"},initialImage:{type:Array,default:()=>[]},additionalImages:{type:Array,default:()=>[]}},data:()=>({loadedImage:null,drawing:!1,context:null,images:[],strokes:{type:"",from:{x:0,y:0},coordinates:[],color:"",width:"",fill:!1},guides:[],trash:[]}),mounted(){this.setContext(),this.$nextTick((()=>{this.drawInitialImage(),this.drawAdditionalImages()}))},watch:{backgroundImage:function(){this.loadedImage=null}},methods:{async setContext(){let t=document.querySelector("#"+this.canvasId);this.context=this.context?this.context:t.getContext("2d"),await this.setBackground()},drawInitialImage(){this.initialImage&&this.initialImage.length>0&&(this.images=[].concat(this.images,this.initialImage),this.redraw(!0))},drawAdditionalImages(){if(this.additionalImages&&this.additionalImages.length>0){let t=document.querySelector("#"+this.canvasId);this.additionalImages.forEach((e=>{this.drawWatermark(t,this.context,e)}))}},clear(){this.context.clearRect(0,0,this.width,this.height)},async setBackground(){this.clear(),this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height),await this.$nextTick((async()=>{await this.drawBackgroundImage()})),this.save()},async drawBackgroundImage(){if(!this.loadedImage)return new Promise((t=>{if(!this.backgroundImage)return void t();const e=new Image;e.src=this.backgroundImage,e.onload=()=>{this.context.drawImage(e,0,0,this.width,this.height),this.loadedImage=e,t()}}));this.context.drawImage(this.loadedImage,0,0,this.width,this.height)},getCoordinates(t){let e,s;if(t.touches&&t.touches.length>0){let i=document.querySelector("#"+this.canvasId).getBoundingClientRect();e=t.touches[0].clientX-i.left,s=t.touches[0].clientY-i.top}else e=t.offsetX,s=t.offsetY;return{x:e,y:s}},startDraw(t){if(!this.lock){this.drawing=!0;let e=this.getCoordinates(t);this.strokes={type:this.eraser?"eraser":this.strokeType,from:e,coordinates:[],color:this.eraser?this.backgroundColor:this.color,width:this.lineWidth,fill:!this.eraser&&"dash"!==this.strokeType&&this.fillShape},this.guides=[]}},draw(t){if(this.drawing){this.context||this.setContext();let e=this.getCoordinates(t);if(this.eraser||"dash"===this.strokeType)this.strokes.coordinates.push(e),this.drawShape(this.strokes,!1);else{let t;switch(this.strokeType){case"square":t=[{x:e.x,y:this.strokes.from.y},{x:e.x,y:e.y},{x:this.strokes.from.x,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"triangle":let s=Math.floor((e.x-this.strokes.from.x)/2)<0?-1*Math.floor((e.x-this.strokes.from.x)/2):Math.floor((e.x-this.strokes.from.x)/2),i=this.strokes.from.x<e.x?this.strokes.from.x+s:this.strokes.from.x-s;t=[{x:e.x,y:this.strokes.from.y},{x:i,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"half_triangle":t=[{x:e.x,y:this.strokes.from.y},{x:this.strokes.from.x,y:e.y},{x:this.strokes.from.x,y:this.strokes.from.y}];break;case"circle":let a=this.strokes.from.x-e.x<0?-1*(this.strokes.from.x-e.x):this.strokes.from.x-e.x;t=[{x:this.strokes.from.x>e.x?this.strokes.from.x-a:this.strokes.from.x+a,y:this.strokes.from.y},{x:a,y:a}]}this.guides=t,this.drawGuide(!0)}}},drawGuide(t){this.redraw(!1),this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.setLineDash([15,15]),"circle"===this.strokes.type?this.context.ellipse(this.guides[0].x,this.guides[0].y,this.guides[1].x,this.guides[1].y,0,0,2*Math.PI):(this.context.moveTo(this.strokes.from.x,this.strokes.from.y),this.guides.forEach((t=>{this.context.lineTo(t.x,t.y)})),t&&this.context.closePath()),this.context.stroke()},drawShape(t,e){this.context.strokeStyle=t.color,this.context.fillStyle=t.color,this.context.lineWidth=t.width,this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.setLineDash([]),"circle"===t.type?this.context.ellipse(t.coordinates[0].x,t.coordinates[0].y,t.coordinates[1].x,t.coordinates[1].y,0,0,2*Math.PI):(this.context.moveTo(t.from.x,t.from.y),t.coordinates.forEach((t=>{this.context.lineTo(t.x,t.y)})),e&&this.context.closePath()),t.fill?this.context.fill():this.context.stroke()},stopDraw(){this.drawing&&(this.strokes.coordinates=this.guides.length>0?this.guides:this.strokes.coordinates,this.images.push(this.strokes),this.redraw(!0),this.drawing=!1,this.trash=[])},reset(){this.lock||(this.images=[],this.strokes={type:"",coordinates:[],color:"",width:"",fill:!1},this.guides=[],this.trash=[],this.redraw(!0))},undo(){if(!this.lock){let t=this.images.pop();t&&(this.trash.push(t),this.redraw(!0))}},redo(){if(!this.lock){let t=this.trash.pop();t&&(this.images.push(t),this.redraw(!0))}},async redraw(t){t=void 0===t||t,await this.setBackground().then((()=>{this.drawAdditionalImages()})).then((()=>{this.images.forEach((t=>{this.drawShape(t,"eraser"!==t.type&&"dash"!==t.type)}))})).then((()=>{t&&this.save()}))},wrapText(t,e,s,i,a,r){const o=/\s+/g;var n=e.split(/(\r\n|\n\r|\n|\r)+/g).filter((t=>t.length>0));for(let u=0;u<n.length;u++){for(var l=n[u].split(o).filter((t=>t.length>0)),h="",c=0;c<l.length;c++){var d=h+l[c]+" ";t.measureText(d).width>a&&c>0?(this.watermark&&this.watermark.fontStyle&&this.watermark.fontStyle.drawType&&"stroke"===this.watermark.fontStyle.drawType?t.strokeText(h,s,i):t.fillText(h,s,i),h=l[c]+" ",i+=r):h=d}this.watermark&&this.watermark.fontStyle&&this.watermark.fontStyle.drawType&&"stroke"===this.watermark.fontStyle.drawType?t.strokeText(h,s,i):t.fillText(h,s,i),i+=l.length>0?r:0}},save(){if(!this.watermark){let t=document.querySelector("#"+this.canvasId);return this.$emit("update:image",t.toDataURL("image/"+this.saveAs,1)),t.toDataURL("image/"+this.saveAs,1)}{let t=document.querySelector("#"+this.canvasId),e=document.createElement("canvas"),s=e.getContext("2d");s&&(e.width=Number(this.width),e.height=Number(this.height),s.drawImage(t,0,0,Number(this.width),Number(this.height)),this.drawWatermark(e,s,this.watermark))}},drawWatermark(t,e,s){if("Image"===s.type){let i=s.imageStyle&&s.imageStyle.width?s.imageStyle.width:this.width,a=s.imageStyle&&s.imageStyle.height?s.imageStyle.height:this.height;const r=new Image;r.src=s.source,r.onload=()=>(s&&e&&e.drawImage(r,s.x,s.y,Number(i),Number(a)),this.$emit("update:image",t.toDataURL("image/"+this.saveAs,1)),t.toDataURL("image/"+this.saveAs,1))}else if("Text"===s.type){let i=s.fontStyle&&s.fontStyle.font?s.fontStyle.font:"20px serif",a=s.fontStyle&&s.fontStyle.textAlign?s.fontStyle.textAlign:"start",r=s.fontStyle&&s.fontStyle.textBaseline?s.fontStyle.textBaseline:"alphabetic",o=s.fontStyle&&s.fontStyle.color?s.fontStyle.color:"#000000";if(e.font=i,e.textAlign=a,e.textBaseline=r,s.fontStyle&&s.fontStyle.rotate){let t,i;t=s.fontStyle&&s.fontStyle.width?s.x+Math.floor(s.fontStyle.width/2):s.x,i=s.fontStyle&&s.fontStyle.lineHeight?s.y+Math.floor(s.fontStyle.lineHeight/2):s.y,e.translate(t,i),e.rotate(s.fontStyle.rotate*Math.PI/180),e.translate(-1*t,-1*i)}return s.fontStyle&&s.fontStyle.drawType&&"stroke"===s.fontStyle.drawType?(e.strokeStyle=s.fontStyle.color,s.fontStyle&&s.fontStyle.width?this.wrapText(e,s.source,s.x,s.y,s.fontStyle.width,s.fontStyle.lineHeight):e.strokeText(s.source,s.x,s.y)):(e.fillStyle=o,s.fontStyle&&s.fontStyle.width?this.wrapText(e,s.source,s.x,s.y,s.fontStyle.width,s.fontStyle.lineHeight):e.fillText(s.source,s.x,s.y)),this.$emit("update:image",t.toDataURL("image/"+this.saveAs,1)),t.toDataURL("image/"+this.saveAs,1)}},isEmpty(){return!(this.images.length>0)},getAllStrokes(){return this.images}},render(){return d("canvas",{id:this.canvasId,height:this.height,width:this.width,style:r({touchAction:"none"},this.styles),class:this.classes,onMousedown:t=>this.startDraw(t),onMousemove:t=>this.draw(t),onMouseup:()=>this.stopDraw(),onMouseleave:()=>this.stopDraw(),onTouchstart:t=>this.startDraw(t),onTouchmove:t=>this.draw(t),onTouchend:()=>this.stopDraw(),onTouchleave:()=>this.stopDraw(),onTouchcancel:()=>this.stopDraw(),onPointerdown:t=>this.startDraw(t),onPointermove:t=>this.draw(t),onPointerup:()=>this.stopDraw(),onPointerleave:()=>this.stopDraw(),onPointercancel:()=>this.stopDraw()})}});const C={class:"columns is-multiline"},V={class:"d-flex justify-content-center column is-12 mb-4"},q={class:"text-center mr-6"},B=g("img",{src:h,width:"40",alt:""},null,-1),M=k(" View PDF "),L={class:"text-center ml-6"},O=g("img",{src:h,width:"40",alt:""},null,-1),$=k(" View PDF "),F={key:2,class:"text-center mb-4 mt-5 mx-auto"},N=g("p",{class:"mb-4 title is-5"},"Saved signature",-1),R={key:3,class:"column is-12 mx-auto d-flex justify-content-center"},W=k(" Sign and save "),E=k(" Reset ");var U=c({expose:[],props:{member:{type:Object,required:!0}},setup(t){const e=t;u((()=>{var t=document.querySelector("canvas");console.log(t),t.setAttribute("tabindex","0"),t.focus()}));const s=m(!1),i=m(!1),a=m(null),r=m(),h=async()=>{let t=r.value.save();return a.value=t,s.value=!0,T.post(`sign/${e.member.membership_members.id}`,{sign:t}).then((t=>{i.value=!0,s.value=!1}))};return(e,c)=>{const d=l,u=o,m=n;return p(),y(m,{radius:"small"},{default:f((()=>[g("div",C,[g("div",V,[g("div",q,[g("a",{target:"_blank",href:`http://ezclub.loc/generateContract/${t.member.id}`},[B,g("p",null,"contract_"+x(t.member.id)+"_"+x(t.member.membership_members.id)+"_"+x(t.member.personal_identifications)+".pdf",1),g(d,{color:"success",outlined:"",class:"mt-4 py-1"},{default:f((()=>[M])),_:1})],8,["href"])]),g("div",L,[g("a",{target:"_blank",href:`http://ezclub.loc/generateWeiver/${t.member.id}`},[O,g("p",null,"weiver_"+x(t.member.id)+"_"+x(t.member.membership_members.id)+"_"+x(t.member.personal_identifications)+".pdf",1),g(d,{color:"success",outlined:"",class:"mt-4 py-1"},{default:f((()=>[$])),_:1})],8,["href"])])]),s.value&&!i.value?(p(),y(u,{key:0,width:"400px",height:"135px",style:{"margin-top":"10px"},class:"mx-auto"})):v("",!0),i.value||s.value?v("",!0):(p(),y(w(P),{key:1,class:"column is-6 mx-auto",ref:r,saveAs:"jpeg",width:"600",height:"200"},null,512)),i.value?(p(),y("div",F,[N,g("img",{src:a.value,width:"400",height:"135",alt:""},null,8,["src"])])):v("",!0),i.value?v("",!0):(p(),y("div",R,[g(d,{color:"info",class:"text-center mx-auto",onClick:h},{default:f((()=>[W])),_:1}),g(d,{color:"danger",class:"text-center mx-auto",onClick:c[1]||(c[1]=t=>r.value.reset())},{default:f((()=>[E])),_:1})]))])])),_:1})}}});const z={class:"page-content-inner "},H={key:1},G=g("h1",{class:"title is-4"},"Successful Payment",-1),J={class:"title is-3"},X={key:0,class:"mt-6"},Y={class:"title is-3"},K=k(" View and sign: Family ");var Q=c({expose:[],setup(t){A.value="Add New members",S({title:"Members"});const e=b();_();const s=m([]),i=m(null),a=m(null);let r=m([]);u((()=>{T.post(`payment/${e.query.id}`,{payment_intent_client_secret:e.query.payment_intent_client_secret,redirect_status:e.query.redirect_status}).then((t=>{t.data.status&&(i.value=e.query.redirect_status,a.value=t.data.urlPDF,s.value=t.data.member,r.value=t.data.familiares)}))}));return(t,a)=>{const h=o,c=n,d=U,u=l,m=D;return p(),y(m,null,{default:f((()=>[g("div",z,[null==i.value?(p(),y(h,{key:0,height:"500px"})):v("",!0),"succeeded"==i.value?(p(),y("div",H,[g(c,{class:"mb-4",radius:"small",color:"success"},{default:f((()=>[G])),_:1}),g("h2",J,"Sign "+x(s.value.name)+" "+x(s.value.second_name)+" "+x(s.value.last_name),1),g(d,{member:s.value},null,8,["member"]),w(r).length>0?(p(),y("div",X,[(p(!0),y(I,null,j(w(r),((t,s)=>(p(),y("div",null,[g(c,{class:"mb-4",radius:"small"},{default:f((()=>[g("h2",Y,"Sign Family: "+x(t.name)+" "+x(t.second_name)+" "+x(t.last_name),1),g(u,{color:"warning",class:"text-center mx-auto",onClick:s=>(t=>{window.location.href=`http://localhost:3000/members/process?id=${t.id}&payment_intent=${e.query.payment_intent}&payment_intent_client_secret=${e.query.payment_intent_client_secret}&redirect_status=${e.query.redirect_status}`})(t)},{default:f((()=>[K])),_:2},1032,["onClick"])])),_:2},1024)])))),256))])):v("",!0)])):v("",!0)])])),_:1})}}});export default Q;
