import{_ as e}from"./V-Button.vue_vue&type=script&setup=true&lang.940c9f5e.js";import{_ as t}from"./V-Loader.vue_vue&type=script&setup=true&lang.72c1da57.js";import{_ as a}from"./V-Card.vue_vue&type=script&setup=true&lang.d3d76712.js";import{_ as s}from"./V-Control.9f6b030b.js";import{_ as l}from"./V-Field.vue_vue&type=script&setup=true&lang.9839f63b.js";import{_ as r}from"./V-Modal.vue_vue&type=script&setup=true&lang.793fc7c9.js";import{d as i,r as n,c as u,i as o,j as c,l as m,k as p,S as d,H as v,F as b,G as y,U as f,I as _,W as h,_ as g,o as j,w as k,X as x,a2 as S}from"./vendor.b96c0b62.js";import{m as C,b as P,P as w,n as $,A as M,g as F,p as A}from"./index.ce5372c8.js";import{c as N}from"./Companies.cbf9f4c6.js";import{_ as O}from"./MemberCards.1c7b3040.js";import{_ as V}from"./V-Placeload.43c61814.js";import{_ as q}from"./signComponent.vue_vue&type=script&setup=true&lang.5571c3d8.js";import{W as E,X as I,x as R,h as T,Y as B,Z as z,_ as D}from"./Members.c5336adc.js";const U=m("p",{class:"title is-3"},[m("i",{class:"fas fa-money-bill","aria-hidden":"true"})],-1),L={class:"title is-5"},W=y(" Cash "),X={class:"d-flex mb-4 justify-content-between"},Y={class:"title is-5"},G=y(" Total: "),H={class:"title is-5"},Z=y(" Cash Total: "),J={class:"\n          d-flex\n          justify-content-center\n          align-items-center\n          flex-column\n          mb-4\n        "},K=m("p",{class:"title is-5 mb-4"},"Change Back:",-1),Q={class:"title is-3 mb-0"},ee={class:"d-flex justify-content-center flex-wrap mb-4"},te=m("div",{class:"w-100"},null,-1),ae={class:"d-flex justify-content-center"},se=y("Reset"),le=y("Confirm");var re=i({expose:[],props:{total:{type:[Number,String],default:0},margin:{type:String,default:"mx-2"},presupuesto:{type:Object,defaukt:{}}},emits:["onPaymentCash"],setup(t,{emit:i}){const j=t,k=n(!1),x=n(0),S=u((()=>{const e=parseFloat(x.value)-parseFloat(j.total/100);return e>0?e:0})),P=()=>{k.value=!1,i("onPaymentCash",{changeBack:S.value,cash:x.value,presupuesto:j.presupuesto})};return(i,n)=>{const u=a,j=e,w=s,$=l,M=r;return o(),c(d,null,[m(u,{color:"warning",class:["btn-card w-100 justify-content-center column is-4",t.margin],onClick:n[1]||(n[1]=e=>k.value=!0)},{default:p((()=>[U,m("p",L,[W,m("b",null,v(b(C)(t.total)),1)])])),_:1},8,["class"]),m(M,{title:"",open:k.value,actions:"center",onClose:n[5]||(n[5]=e=>k.value=!1)},{content:p((()=>[m("div",X,[m("p",Y,[G,m("b",null,v(b(C)(t.total)),1)]),m("p",H,[Z,m("b",null,v(b(C)(x.value)),1)])]),m("div",J,[K,m("p",Q,[m("b",null,v(b(C)(b(S))),1)])]),m("div",ee,[m(j,{bold:"",class:"m-3",style:{"font-size":"14px"},onClick:n[2]||(n[2]=e=>x.value=Number.parseFloat(t.total).toFixed(2))},{default:p((()=>[y(" Full Payment "+v(b(C)(t.total)),1)])),_:1}),te,(o(),c(d,null,f([5,10,20,50,100],((e,t)=>m(j,{key:`calculato-${t}`,bold:"",class:"m-3",style:{"font-size":"14px"},onClick:t=>(e=>{x.value=parseFloat(x.value)+parseFloat(e)})(e)},{default:p((()=>[y(" $"+v(e),1)])),_:2},1032,["onClick"]))),64))]),m("div",ae,[m($,null,{default:p((()=>[m(w,null,{default:p((()=>[_(" <p>{{ Number.parseFloat(cash).toFixed(2)  }}</p> "),h(m("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>x.value=e),type:"text",class:"input text-center",placeholder:"Cash"},null,512),[[g,x.value]])])),_:1})])),_:1})])])),action:p((()=>[m(j,{onClick:n[4]||(n[4]=e=>x.value=0),class:"d-flex justify-content-center",raised:""},{default:p((()=>[se])),_:1}),m(j,{color:"success",onClick:P,disabled:parseFloat(x.value)<parseFloat(parseFloat(t.total/100).toFixed(2)),class:"d-flex justify-content-center",raised:""},{default:p((()=>[le])),_:1},8,["disabled"])])),_:1},8,["open"])],64)}}});const ie={class:"d-flex justify-content-between align-items-start"},ne=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-receipt",style:{color:"white !important"},"aria-hidden":"true"})]),m("p",{class:"title is-5",style:{color:"white !important"}},"View Order")],-1),ue={key:0,class:"title is-6"},oe=m("i",{class:"fas fa-check","aria-hidden":"true"},null,-1);var ce=i({expose:[],props:{membership_member:{type:[Number,String],default:0},invoice_id:{type:[Number,String],default:0}},setup(e){const t=e,s=n(!1);return j((()=>{})),(e,l)=>{const i=a,n=r;return o(),c(d,null,[m(i,{style:{background:"#388e3c"},class:"mx-2 mx-auto mt-4 is-4 column btn-card justify-content-center",onClick:l[1]||(l[1]=e=>s.value=!0)},{default:p((()=>[m("div",ie,[ne,e.openModalRecibo?(o(),c("p",ue,[oe])):_("v-if",!0)])])),_:1}),m(n,{title:"",open:s.value,actions:"center",onClose:l[2]||(l[2]=e=>s.value=!1)},{content:p((()=>[_(' <iframe id="printf" :src="`${FRONTEND_URL}members/recibo?id=${props.membership_member}`"></iframe> '),m("iframe",{src:`${b(P)}ticket_membership/${t.membership_member}?companie_id=${b(N).id}&invoice_id=${t.invoice_id}`,width:"100%",height:"500px",frameborder:"0"},null,8,["src"]),m("a",{href:`${b(P)}ticket_membership/${t.membership_member}?companie_id=${b(N).id}&invoice_id=${t.invoice_id}`},"Open",8,["href"])])),action:p((()=>[])),_:1},8,["open"])],64)}}});const me=m("div",{id:"payment-element"},[_("Stripe.js injects the Payment Element")],-1),pe=y("Pay now "),de=m("div",{id:"payment-message",class:"hidden"},null,-1);var ve=i({expose:[],props:{presupuesto:{type:Object,default:{}},amount:{type:[Number,String],required:!0},id:{type:Number,required:!0},url:{type:String,default:"stripe"},member_membership:{type:Number,default:0},variosMiembros:{type:Boolean,default:!1},miembros:{type:Array,default:[]}},emits:["PaymentAction"],setup(s,{emit:l}){const r=s,i=Stripe(w.value);k((()=>r.id),(e=>{v.value=!0,A()}));const v=n(!0);n({id:r.id,amount:r.amount});const b=n(),y=u((()=>"stripe"!=r.url?{payment_type_id:3,amount:r.amount}:{id:r.id,member_mermship_id:r.member_membership,amount:r.amount,payment_type_id:1}));n(null);const f=n(null),C=n(null),P=n(!1),F=n(null),A=async()=>{let e=await M.post(r.url,y.value).then((e=>{f.value=e.data.clientSecret,F.value=e.data.user_id,b.value=i.elements({clientSecret:f.value,appearance:{theme:"night",rules:{".Input":{boxShadow:"none"}}}}),C.value=b.value.create("card",{classes:{base:"base_card"}}),C.value.mount("#payment-element")})).catch((e=>{v.value=!1}));return v.value=!1,e},N=n(null),O=async e=>{e.preventDefault(),P.value=!0;const{setupIntent:t,error:a}=await i.confirmCardSetup(f.value,{payment_method:{card:C.value,billing_details:{name:N.value}}});if(a)P.value=!1,$.error(a.message);else{const{payment_method:e}=t;r.variosMiembros?(r.miembros.forEach((t=>{M.post("paymentStripe",{payment_method:e,user_id:t.idMember,membership_member_id:t.idMemberMembership,payment_type_id:3,presupuesto:r.presupuesto}).catch((e=>{P.value=!1}))})),response.then((e=>{l("PaymentAction",e.data),$.success("Success Payment")})).catch((e=>{P.value=!1}))):await M.post("paymentStripe",{payment_method:e,amount:r.amount,user_id:F.value,membership_member_id:r.member_membership,payment_type_id:3,presupuesto:r.presupuesto}).then((e=>{l("PaymentAction",e.data),$.success("Success Payment")})).catch((e=>{P.value=!1}))}P.value=!1};return j((()=>{P.value=!1,A(),new Pusher("2cd5b586808b2f41f8e6",{cluster:"us2"}).subscribe("payment_stripe_channel").bind("payment_stripe_event",(function(e){$.error("ALERT PAYMENT: "+e.member+" "+e.message)}))})),(s,l)=>{const r=V,i=e,n=t,u=a;return o(),c(d,null,[v.value?(o(),c(r,{key:0,height:"200px",class:"mt-6"})):_("v-if",!0),h(m(u,{class:"mt-6"},{default:p((()=>[m("form",{onSubmit:S(O,["prevent"]),id:"payment-form"},[h(m("input",{id:"card-holder-name",class:"input mb-3","onUpdate:modelValue":l[1]||(l[1]=e=>N.value=e),placeholder:"Name",type:"text"},null,512),[[g,N.value]]),me,m(n,{size:"small",active:P.value},{default:p((()=>[m(i,{id:"submit",class:"mt-4",color:"info"},{default:p((()=>[pe])),_:1})])),_:1},8,["active"]),de],40,["onSubmit"])])),_:1},512),[[x,!v.value]])],64)}}});const be={class:"w-100"},ye={class:"my-4"},fe={key:0},_e=m("small",null,"Register the principal first",-1),he=y(" Process Membership "),ge=y(" Process Membership "),je={key:0,class:"columns is-multiline justify-content-center mt-6"},ke={class:"d-flex justify-content-between align-items-start"},xe=m("div",null,[m("p",{class:"title is-3"},[m("i",{class:"fas fa-credit-card","aria-hidden":"true"})]),m("p",{class:"title is-5"},"Debit Automatic")],-1),Se={key:0,class:"title is-6"},Ce=m("i",{class:"fas fa-check","aria-hidden":"true"},null,-1),Pe={class:"columns is-multiline justify-content-center mt-6"},we=m("p",{class:"title is-4"},"Payment Success",-1);var $e=i({expose:[],props:{presupuesto:{type:Object,default:{}},member:{type:Array,required:!0},member_id:{type:Number,default:0},membresia:{type:Array,required:!0},contact:{type:Array,required:!0},presupuesto_id:{type:String},total:{type:[String,Number],required:!0},categoriesMembers:{type:Object,required:!0},notasInput:{type:Object,required:!0},type:{type:String,default:"create"}},emits:["PaymentAction"],setup(s,{emit:l}){const r=s,i=n(null),d=n(!1),y=n(null),f=n(null);j((()=>{d.value=!1,g.value=!1}));const h=()=>{i.value=null,d.value=!0,y.value=r.member.id,f.value=null,console.log("props.membresia",r.membresia);const e=A(r.membresia);e.members_id=r.member_id,e.total=r.total,e.payment_type_id=3,console.log(e),D(e).then((e=>{y.value=e.data.id,f.value=e.data.membership_members_id,$.success("Success"),d.value=!1})).catch((e=>{for(var t in e.response.data.errores)e.response.data.errores[t].forEach((e=>{$.error(`${t}: ${e}`)}))}))},g=n(!1),k=e=>{"object"==typeof e&&(y.value=e.id,P.value=e.invoice_id,l("PaymentAction",y)),g.value=!0},x=u((()=>0==F(r.member,"is_family").model)),S=u((()=>!g.value&&!(!x.value&&!E.value))),C=e=>{R(e,f.value).then((e=>{if(e.data.status)$.success("Sign Success");else for(var t in $.error(e.data.mensaje),e.data.errores)e.data.errores[t].forEach((e=>{$.error(`${t} : ${e}`)}))})).catch((e=>{}))},P=n(0),w=e=>{if(i.value=1,f.value){const t={cash:e.cash,payment_type_id:i.value,total:r.total,cash_back:e.changeBack,membership_member_id:f.value,presupuesto:r.presupuesto};console.log("datos",t),T(f.value,t).then((e=>{console.log("cash",e),k({id:e.data.member_id,invoice_id:e.data.invoice_id}),$.success("Success Payment")})).catch((e=>{console.log(e.response)}))}else $.error("The membership ID is required. Click on Process Membership to generate it automatically")},M=e=>{d.value=!0,B({payment_method:e,amount:r.total,user_id:y.value,membership_member_id:f.value,payment_type_id:3,presupuesto:r.presupuesto}).then((e=>{P.value=e.data.invoice_id,k(y.value),$.success("Success"),d.value=!1})).catch((e=>{for(var t in e.response.data.errores)e.response.data.errores[t].forEach((e=>{$.error(`${t}: ${e}`)}))}))};return(l,n)=>{const u=e,j=t,$=a,A=re,N=ce,V=O,R=ve,T=q;return o(),c("div",be,[m("div",ye,[m("p",null,v(b(F)(r.member,"name").model)+" "+v(b(F)(r.member,"last_name").model),1),m("p",null,[m("small",null,v(b(x)?"Main member":"Family"),1)]),b(x)||b(E)?_("v-if",!0):(o(),c("p",fe,[_e]))]),m(j,{size:"small",active:d.value},{default:p((()=>["create"==r.type?(o(),c(u,{key:0,color:"success",onClick:n[1]||(n[1]=e=>b(S)?(i.value=null,d.value=!0,y.value=null,f.value=null,z({member:r.member,contact:r.contact,membresia:r.membresia,total:r.total,categoriesMembers:r.categoriesMembers,notasInput:r.notasInput}).then((e=>{y.value=e.data.id,f.value=e.data.membership_members_id})).catch((e=>{})),void(d.value=!1)):null),style:b(S)?{}:{opacity:".5"}},{default:p((()=>[he])),_:1},8,["style"])):(o(),c(u,{key:1,color:"success",onClick:h},{default:p((()=>[ge])),_:1}))])),_:1},8,["active"]),_(" <p>{{ paymentMethod }}</p> "),y.value&&!g.value?(o(),c("div",je,[m($,{color:"info",class:"mx-2 btn-card w-100 column is-4",style:1==i.value?{opacity:"0.4"}:{},onClick:n[2]||(n[2]=e=>i.value=3)},{default:p((()=>[m("div",ke,[xe,3==i.value?(o(),c("p",Se,[Ce])):_("v-if",!0)])])),_:1},8,["style"]),m(A,{presupuesto:s.presupuesto,total:r.total,onOnPaymentCash:w},null,8,["presupuesto","total"])])):_("v-if",!0),m("div",Pe,[_(" <p>{{ typeof invoice_id }}</p> "),f.value&&g.value?(o(),c(N,{key:0,membership_member:f.value,invoice_id:P.value},null,8,["membership_member","invoice_id"])):_("v-if",!0)]),3!=i.value||g.value?_("v-if",!0):(o(),c(V,{key:1,"show-new-card":!1,memberid:y.value,"member-guardian-id":b(I)?b(I).id:null,onOnMethodPayment:M},null,8,["memberid","member-guardian-id"])),3!=i.value||g.value?_("v-if",!0):(o(),c(R,{key:2,amount:r.total,id:y.value,member_membership:f.value,presupuesto:s.presupuesto,onPaymentAction:k},null,8,["amount","id","member_membership","presupuesto"])),g.value?(o(),c($,{key:3,color:"success",class:"my-6"},{default:p((()=>[we])),_:1})):_("v-if",!0),g.value?(o(),c(T,{key:4,onOnSign:C,"is-sign":!0,contract:`contract_${y.value}_${f.value}_${b(F)(r.member,"personal_identifications").model}.pdf`,"url-contract":`generateContract/${y.value}`},null,8,["contract","url-contract"])):_("v-if",!0)])}}});export{re as _,$e as a};
