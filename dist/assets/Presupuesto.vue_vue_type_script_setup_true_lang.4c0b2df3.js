import{_ as T}from"./V-Button.vue_vue_type_script_setup_true_lang.72d178c7.js";import{_ as G}from"./V-Loader.vue_vue_type_script_setup_true_lang.f82321d3.js";import{_ as N}from"./V-Card.vue_vue_type_script_setup_true_lang.f80f1beb.js";import{_ as se}from"./V-Control.92200beb.js";import{_ as ae}from"./V-Field.vue_vue_type_script_setup_true_lang.33752939.js";import{_ as H}from"./V-Modal.vue_vue_type_script_setup_true_lang.f0368080.js";import{d as I,r as f,c as q,o as r,e as u,f as e,w as _,F,t as c,u as l,ad as x,i as M,G as K,H as L,L as W,j as R,y,C as z,P as ne,m as oe,n as g,I as le,A as B,S as ie,g as E,k as re,h as ue,z as ce}from"./index.4457215e.js";import{c as D}from"./Companies.4f645ec0.js";import{_ as me}from"./MemberCards.vue_vue_type_script_setup_true_lang.ec94bd88.js";import{_ as de}from"./V-Placeload.9684d098.js";import{_ as pe}from"./signComponent.vue_vue_type_script_setup_true_lang.4373d048.js";import{V as Y,t as _e,d as he,W as ve,X as U,Y as fe,Z as ye}from"./Members.3210ead2.js";const be=e("p",{class:"title is-3"},[e("i",{class:"fas fa-money-bill","aria-hidden":"true"})],-1),$e={class:"title is-5"},ge=M(" Cash "),xe={class:"d-flex mb-4 justify-content-between"},ke={class:"title is-5"},Ce=M(" Total: "),Se={class:"title is-5"},Me=M(" Cash Total: "),Pe={class:`\r
          d-flex\r
          justify-content-center\r
          align-items-center\r
          flex-column\r
          mb-4\r
        `},we=e("p",{class:"title is-5 mb-4"},"Change Back:",-1),Ve={class:"title is-3 mb-0"},Ae={class:"d-flex justify-content-center flex-wrap mb-4"},je=e("div",{class:"w-100"},null,-1),Fe={class:"d-flex justify-content-center"},Ne=M("Reset"),Ie=M("Confirm");var Ee=I({expose:[],props:{total:{type:[Number,String],default:0},margin:{type:String,default:"mx-2"}},emits:["onPaymentCash"],setup(n,{emit:b}){const t=n,d=f(!1),s=f(0),m=q(()=>{const k=parseFloat(s.value)-parseFloat(t.total/100);return k>0?k:0}),v=k=>{s.value=parseFloat(s.value)+parseFloat(k)},P=()=>{d.value=!1,b("onPaymentCash",{changeBack:m.value,cash:s.value})};return(k,o)=>{const V=N,C=T,A=se,j=ae,$=H;return r(),u(F,null,[e(V,{color:"warning",class:["btn-card w-100 justify-content-center column is-4",n.margin],onClick:o[1]||(o[1]=p=>d.value=!0)},{default:_(()=>[be,e("p",$e,[ge,e("b",null,c(l(x)(n.total/100)),1)])]),_:1},8,["class"]),e($,{title:"",open:d.value,actions:"center",onClose:o[5]||(o[5]=p=>d.value=!1)},{content:_(()=>[e("div",xe,[e("p",ke,[Ce,e("b",null,c(l(x)(n.total/100)),1)]),e("p",Se,[Me,e("b",null,c(l(x)(s.value)),1)])]),e("div",Pe,[we,e("p",Ve,[e("b",null,c(l(x)(l(m))),1)])]),e("div",Ae,[e(C,{bold:"",class:"m-3",style:{"font-size":"14px"},onClick:o[2]||(o[2]=p=>s.value=Number.parseFloat(n.total/100).toFixed(2))},{default:_(()=>[M(" Full Payment "+c(l(x)(n.total/100)),1)]),_:1}),je,(r(),u(F,null,K([5,10,20,50,100],(p,S)=>e(C,{key:`calculato-${S}`,bold:"",class:"m-3",style:{"font-size":"14px"},onClick:i=>v(p)},{default:_(()=>[M(" $"+c(p),1)]),_:2},1032,["onClick"])),64))]),e("div",Fe,[e(j,null,{default:_(()=>[e(A,null,{default:_(()=>[L(e("input",{"onUpdate:modelValue":o[3]||(o[3]=p=>s.value=p),type:"text",class:"input text-center",placeholder:"Cash"},null,512),[[W,s.value]])]),_:1})]),_:1})])]),action:_(()=>[e(C,{onClick:o[4]||(o[4]=p=>s.value=0),class:"d-flex justify-content-center",raised:""},{default:_(()=>[Ne]),_:1}),e(C,{color:"success",onClick:P,disabled:parseFloat(s.value)<parseFloat(parseFloat(n.total/100).toFixed(2)),class:"d-flex justify-content-center",raised:""},{default:_(()=>[Ie]),_:1},8,["disabled"])]),_:1},8,["open"])],64)}}});const qe={class:"d-flex justify-content-between align-items-start"},Be=e("div",null,[e("p",{class:"title is-3"},[e("i",{class:"fas fa-receipt",style:{color:"white !important"},"aria-hidden":"true"})]),e("p",{class:"title is-5",style:{color:"white !important"}},"View Order")],-1),Le={key:0,class:"title is-6"},Te=e("i",{class:"fas fa-check","aria-hidden":"true"},null,-1);var Re=I({expose:[],props:{membership_member:{type:[Number,String],default:0},invoice_id:{type:[Number,String],default:0}},setup(n){const b=n,t=f(!1);return R(()=>{}),(d,s)=>{const m=N,v=H;return r(),u(F,null,[e(m,{style:{background:"#388e3c"},class:"mx-2 mx-auto mt-4 is-4 column btn-card justify-content-center",onClick:s[1]||(s[1]=P=>t.value=!0)},{default:_(()=>[e("div",qe,[Be,d.openModalRecibo?(r(),u("p",Le,[Te])):y("",!0)])]),_:1}),e(v,{title:"",open:t.value,actions:"center",onClose:s[2]||(s[2]=P=>t.value=!1)},{content:_(()=>[e("iframe",{src:`${l(z)}ticket_membership/${b.membership_member}?companie_id=${l(D).id}&invoice_id=${b.invoice_id}`,width:"100%",height:"500px",frameborder:"0"},null,8,["src"]),e("a",{href:`${l(z)}ticket_membership/${b.membership_member}?companie_id=${l(D).id}&invoice_id=${b.invoice_id}`},"Open",8,["href"])]),action:_(()=>[]),_:1},8,["open"])],64)}}});const Oe=e("div",{id:"payment-element"},null,-1),ze=M("Pay now "),De=e("div",{id:"payment-message",class:"hidden"},null,-1);var Ye=I({expose:[],props:{amount:{type:[Number,String],required:!0},id:{type:Number,required:!0},url:{type:String,default:"stripe"},member_membership:{type:Number,default:0},variosMiembros:{type:Boolean,default:!1},miembros:{type:Array,default:[]}},emits:["PaymentAction"],setup(n,{emit:b}){const t=n,d=Stripe(ne.value);oe(()=>t.id,$=>{s.value=!0,C()});const s=f(!0);f({id:t.id,amount:t.amount});const m=f(),v=q(()=>t.url!="stripe"?{payment_type_id:3,amount:t.amount}:{id:t.id,member_mermship_id:t.member_membership,amount:t.amount,payment_type_id:1});f(null);const P=f(null),k=f(null),o=f(!1),V=f(null),C=async()=>{let $=await B.post(t.url,v.value).then(p=>{P.value=p.data.clientSecret,V.value=p.data.user_id,m.value=d.elements({clientSecret:P.value,appearance:{theme:"night",rules:{".Input":{boxShadow:"none"}}}}),k.value=m.value.create("card",{classes:{base:"base_card"}}),k.value.mount("#payment-element")}).catch(p=>{s.value=!1});return s.value=!1,$},A=f(null),j=async $=>{$.preventDefault(),o.value=!0;const{setupIntent:p,error:S}=await d.confirmCardSetup(P.value,{payment_method:{card:k.value,billing_details:{name:A.value}}});if(S)o.value=!1,g.error(S.message);else{const{payment_method:i}=p;t.variosMiembros?(t.miembros.forEach(a=>{B.post("paymentStripe",{payment_method:i,user_id:a.idMember,membership_member_id:a.idMemberMembership,payment_type_id:3}).catch(h=>{o.value=!1})}),response.then(a=>{console.log("addcard",a.data),b("PaymentAction",a.data),g.success("Success Payment")}).catch(a=>{o.value=!1})):await B.post("paymentStripe",{payment_method:i,amount:t.amount,user_id:V.value,membership_member_id:t.member_membership,payment_type_id:3}).then(a=>{console.log("addcard",a.data),b("PaymentAction",a.data),g.success("Success Payment")}).catch(a=>{o.value=!1})}o.value=!1};return R(()=>{o.value=!1,C();var $=new Pusher({}.VITE_KEY_PUSHER,{cluster:"us2"}),p=$.subscribe("payment_stripe_channel");p.bind("payment_stripe_event",function(S){g.error("ALERT PAYMENT: "+S.member+" "+S.message)})}),($,p)=>{const S=de,i=T,a=G,h=N;return r(),u(F,null,[s.value?(r(),u(S,{key:0,height:"200px",class:"mt-6"})):y("",!0),L(e(h,{class:"mt-6"},{default:_(()=>[e("form",{onSubmit:ie(j,["prevent"]),id:"payment-form"},[L(e("input",{id:"card-holder-name",class:"input mb-3","onUpdate:modelValue":p[1]||(p[1]=w=>A.value=w),placeholder:"Name",type:"text"},null,512),[[W,A.value]]),Oe,e(a,{size:"small",active:o.value},{default:_(()=>[e(i,{id:"submit",class:"mt-4",color:"info"},{default:_(()=>[ze]),_:1})]),_:1},8,["active"]),De],40,["onSubmit"])]),_:1},512),[[le,!s.value]])],64)}}});const Ue={class:"w-100"},Ge={class:"my-4"},He={key:0},Ke=e("small",null,"Register the principal first",-1),We=M(" Process Membership "),Qe=M(" Process Membership "),Xe={key:0,class:"columns is-multiline justify-content-center mt-6"},Ze={class:"d-flex justify-content-between align-items-start"},Je=e("div",null,[e("p",{class:"title is-3"},[e("i",{class:"fas fa-credit-card","aria-hidden":"true"})]),e("p",{class:"title is-5"},"Debit Automatic")],-1),et={key:0,class:"title is-6"},tt=e("i",{class:"fas fa-check","aria-hidden":"true"},null,-1),st={class:"columns is-multiline justify-content-center mt-6"},at=e("p",{class:"title is-4"},"Payment Success",-1);var Et=I({expose:[],props:{presupuesto:{type:Object,default:{}},member:{type:Array,required:!0},member_id:{type:Number,default:0},membresia:{type:Array,required:!0},contact:{type:Array,required:!0},presupuesto_id:{type:String},total:{type:[String,Number],required:!0},categoriesMembers:{type:Object,required:!0},notasInput:{type:Object,required:!0},type:{type:String,default:"create"}},emits:["PaymentAction"],setup(n,{emit:b}){const t=n,d=f(null),s=f(!1),m=f(null),v=f(null);R(()=>{s.value=!1,o.value=!1});const P=()=>{d.value=null,s.value=!0,m.value=null,v.value=null,fe({member:t.member,contact:t.contact,membresia:t.membresia,total:t.total,categoriesMembers:t.categoriesMembers,notasInput:t.notasInput,presupuesto_id:t.presupuesto_id}).then(i=>{m.value=i.data.id,v.value=i.data.membership_members_id}).catch(i=>{}),s.value=!1},k=()=>{d.value=null,s.value=!0,m.value=t.member.id,v.value=null;const i=re(t.membresia);i.members_id=t.member_id,i.total=t.total,i.payment_type_id=3,ye(i).then(a=>{m.value=a.data.id,v.value=a.data.membership_members_id,g.success("Success"),s.value=!1}).catch(a=>{for(var h in a.response.data.errores)a.response.data.errores[h].forEach(w=>{g.error(`${h}: ${w}`)})})},o=f(!1),V=i=>{console.log("yy",i),m.value=i.id,$.value=i.invoice_id,o.value=!0,b("PaymentAction",m)},C=q(()=>E(t.member,"is_family").model==0),A=q(()=>o.value?!1:!(!C.value&&!Y.value)),j=i=>{_e(i,v.value).then(a=>{if(a.data.status)g.success("Sign Success");else{g.error(a.data.mensaje);for(var h in a.data.errores)a.data.errores[h].forEach(w=>{g.error(`${h} : ${w}`)})}}).catch(a=>{})},$=f(0),p=i=>{if(d.value=1,v.value){const a={cash:i.cash,payment_type_id:d.value,total:t.total,cash_back:i.changeBack,membership_member_id:v.value,presupuesto:t.presupuesto.membresias};console.log("datos",a),he(v.value,a).then(h=>{console.log("cash",h),V({id:h.data.member_id,invoice_id:h.data.invoice_id}),g.success("Success Payment")}).catch(h=>{console.log(h.response)})}else g.error("The membership ID is required. Click on Process Membership to generate it automatically")},S=i=>{s.value=!0,ve({payment_method:i,amount:t.total,user_id:m.value,membership_member_id:v.value,payment_type_id:3}).then(a=>{$.value=a.data.invoice_id,V(m.value),g.success("Success"),s.value=!1}).catch(a=>{for(var h in a.response.data.errores)a.response.data.errores[h].forEach(w=>{g.error(`${h}: ${w}`)})})};return(i,a)=>{const h=T,w=G,O=N,Q=Ee,X=Re,Z=me,J=Ye,ee=pe;return r(),u("div",Ue,[e("div",Ge,[e("p",null,c(l(E)(t.member,"name").model)+" "+c(l(E)(t.member,"last_name").model),1),e("p",null,[e("small",null,c(l(C)?"Main member":"Family"),1)]),!l(C)&&!l(Y)?(r(),u("p",He,[Ke])):y("",!0)]),e(w,{size:"small",active:s.value},{default:_(()=>[t.type=="create"?(r(),u(h,{key:0,color:"success",onClick:a[1]||(a[1]=te=>l(A)?P():null),style:l(A)?{}:{opacity:".5"}},{default:_(()=>[We]),_:1},8,["style"])):(r(),u(h,{key:1,color:"success",onClick:k},{default:_(()=>[Qe]),_:1}))]),_:1},8,["active"]),m.value&&!o.value?(r(),u("div",Xe,[e(O,{color:"info",class:"mx-2 btn-card w-100 column is-4",style:d.value==1?{opacity:"0.4"}:{},onClick:a[2]||(a[2]=te=>d.value=3)},{default:_(()=>[e("div",Ze,[Je,d.value==3?(r(),u("p",et,[tt])):y("",!0)])]),_:1},8,["style"]),e(Q,{total:t.total,onOnPaymentCash:p},null,8,["total"])])):y("",!0),e("div",st,[v.value&&o.value?(r(),u(X,{key:0,membership_member:v.value,invoice_id:$.value},null,8,["membership_member","invoice_id"])):y("",!0)]),d.value==3&&!o.value?(r(),u(Z,{key:1,"show-new-card":!1,memberid:m.value,"member-guardian-id":l(U)?l(U).id:null,onOnMethodPayment:S},null,8,["memberid","member-guardian-id"])):y("",!0),d.value==3&&!o.value?(r(),u(J,{key:2,amount:t.total,id:m.value,member_membership:v.value,onPaymentAction:V},null,8,["amount","id","member_membership"])):y("",!0),o.value?(r(),u(O,{key:3,color:"success",class:"my-6"},{default:_(()=>[at]),_:1})):y("",!0),o.value?(r(),u(ee,{key:4,onOnSign:j,"is-sign":!0,contract:`contract_${m.value}_${v.value}_${l(E)(t.member,"personal_identifications").model}.pdf`,"url-contract":`generateContract/${m.value}`},null,8,["contract","url-contract"])):y("",!0)])}}});const nt={class:"table is-hoverable is-striped is-fullwidth"},ot=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Membership Name"),e("th",{scope:"col"},"Plan"),e("th",{scope:"col"},"Quantity"),e("th",{scope:"col"},"Cost"),e("th",{scope:"col"},"Import")])],-1),lt={class:"text-capitalize"},it={style:{"text-align":"right"}},rt={style:{"text-align":"right"}},ut={style:{"text-align":"right"}},ct=e("td",{colspan:"4",style:{"text-align":"right"}},[e("b",null,"Subtotal")],-1),mt={key:0,style:{"text-align":"right"}},dt={colspan:"4"},pt={key:0},_t={key:1},ht={style:{"text-align":"right"}},vt=e("td",{colspan:"4",style:{"text-align":"right"}},"Tax 7%",-1),ft={style:{"text-align":"right"}},yt={colspan:"4",style:{"text-align":"right"}},bt={key:0},$t=e("b",null,"Total to pay today",-1),gt={key:1,style:{"text-align":"right"}},xt=e("td",{colspan:"4",style:{"text-align":"right"}},"Recurring Payment",-1);var qt=I({expose:[],props:{presupuesto:{type:Object,required:!0}},setup(n){return(b,t)=>{const d=N;return n.presupuesto?(r(),u(d,{key:0,class:"mb-4"},{default:_(()=>[e("table",nt,[ot,e("tbody",null,[(r(!0),u(F,null,K(n.presupuesto.membresias,(s,m)=>(r(),u("tr",{key:`membresia-${m}`},[e("td",null,c(s.description),1),e("td",lt,c(s.interval_count)+" "+c(s.type?s.type:"Initiation Fee"),1),e("td",null,c(s.quantity),1),e("td",it,c(l(x)(s.amount_subtotal/s.quantity/100)),1),e("td",rt,c(l(x)(s.amount_subtotal/100)),1)]))),128)),e("tr",ut,[ct,e("td",null,c(l(x)(n.presupuesto.totales.upfront.amount_subtotal/100)),1)]),n.presupuesto.discount?(r(),u("tr",mt,[e("td",dt,[M(c(n.presupuesto.discount.name)+" ",1),n.presupuesto.discount.type=="percentaje"?(r(),u("span",pt," ( "+c(n.presupuesto.discount.value)+"% off ) ",1)):(r(),u("span",_t," ( $"+c(n.presupuesto.discount.value)+" off ) ",1))]),e("td",null," - "+c(l(x)(n.presupuesto.totales.upfront.total_details.amount_discount/100)),1)])):y("",!0),e("tr",ht,[vt,e("td",null,c(l(x)(n.presupuesto.totales.upfront.total_details.amount_tax/100)),1)]),e("tr",ft,[e("td",yt,[n.presupuesto.schedules?(r(),u("p",bt,[e("small",null,"Scheduled Membership: "+c(l(ue)(n.presupuesto.schedules).format("MM-DD-YYYY")),1)])):y("",!0),$t]),e("td",null,c(l(x)(n.presupuesto.totales.upfront.amount_total/100)),1)]),n.presupuesto.totales.recurring?(r(),u("tr",gt,[xt,e("td",null,c(l(x)(n.presupuesto.totales.recurring.amount_total/100)),1)])):y("",!0)])]),ce(b.$slots,"default")]),_:3})):y("",!0)}}});export{Ee as _,Et as a,qt as b};
